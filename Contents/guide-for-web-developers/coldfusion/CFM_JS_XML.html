<?xml version="1.0" encoding="iso-8859-1"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<title>Combining FusionCharts XT, ColdFusion and JavaScript (Data String) method </title>
<link rel="stylesheet" href="../../assets/ui/css/style.css" type="text/css" />
<script type="text/javascript" src="../../assets/prettify/prettify.js"></script>
<link rel="stylesheet" type="text/css" href="../../assets/prettify/prettify.css" />
<script type="text/javascript" src="../../assets/ui/js/jquery.min.js" ></script>
<style type="text/css">
<!--
div.WebHelpPopupMenu { position:absolute;
left:0px;
top:0px;
z-index:4;
visibility:hidden; }

a.whtbtnhide, a.whtbtnshow, a.whtbtnhidenav , a.whtbtnshownav { border-bottom:none !important; }
-->
</style>
<script type="text/javascript" language="javascript1.2" src="../../assets/ui/js/whmsg.js"></script>
<script type="text/javascript" language="javascript" src="../../assets/ui/js/whver.js"></script>
<script type="text/javascript" language="javascript1.2" src="../../assets/ui/js/whproxy.js"></script>
<script type="text/javascript" language="javascript1.2" src="../../assets/ui/js/whutils.js"></script>
<script type="text/javascript" language="javascript1.2" src="../../assets/ui/js/whlang.js"></script>
<script type="text/javascript" language="javascript1.2" src="../../assets/ui/js/whtopic.js"></script>
<script type="text/javascript" src="../../assets/ui/js/lib.js"></script>
</head>

<body>
<!-- breadcrumb starts here -->
<div id="breadcrumb"></div>
<script type="text/javascript">
	document.write( addFCBreadcrumb( [ "Home|../../Introduction/Overview.html", "Guide for web developers", "Using with ColdFusion|CFM_BasicExample.html", "ColdFusion, JavaScript and Data String method" ] ) );
</script>
<!-- breadcrumb ends here -->


<table width="98%" border="0" cellspacing="0" cellpadding="3" align="center">
  <tr> 
    <td class="pageHeader">Combining FusionCharts XT, ColdFusion and JavaScript (Data String) method </td>
  </tr>
  <tr> 
    <td valign="top" class="text"><p>In our previous example, we had combined FusionCharts XT, CFM and JavaScript to create client side dynamic charts. We were updating the chart by asking it to fetch new data from server and update itself, without  any page refreshes. </p>
      <p>In this example, <strong>instead of asking the chart to get XML data </strong>from server, <strong>we will provide updated XML data to chart using JavaScript </strong>functions. The chart will simply accept that XML data and render. </p>
      <p class="highlightBlock">This method can effectively be used in your AJAX applications, where your JavaScript code gets the updated XML from server and then provides it to charts locally. You can process the data received from AJAX Calls, build XML from it and finally provide it to the chart. </p>
      <p><strong>Before you proceed with the contents in this page, we strictly recommend you to please go through the  <a href="../how-fusioncharts-works/HowFCWorks.html">How FusionCharts XT works?</a> and <a href="CFM_BasicExample.html">Basic Examples</a> sections, as we will directly use a lot of concepts defined in those sections.</strong></p>
      <p class="highlightBlock">The code discussed in this example is present in<span class="codeInline"> Download Package &gt; Code &gt; CFM &gt; DB_JS </span>folder. </p></td>
  </tr>
  
  <tr>
    <td valign="top" class="header">Defining the application </td>
  </tr>
  <tr>
    <td valign="top" class="text"><p>We will carry on from our previous <span class="codeInline">&quot;CFM, JavaScript and Data URL</span>&quot; example and convert it to use JavaScript + XML, so that the new XML is provided to the chart using JavaScript functions - the charts no more directly request data from server. To attain this, we send all the pertinent data from our server to the end viewer as JavaScript arrays in the same page. The JavaScript arrays are dynamically generated by the CFM pages at run-time and filled with data. </p>
      <p>Effectively, we will do the following:</p>
      <ol>
      <li>Contain the pie chart (summary) and column chart (detailed) in one page (<span class="codeInline">Default.cfm</span>).</li>
      <li>Configure the pie chart to use the <span class="codeInline">Data XML</span> method to show summary of all factories when  the page loads. This data will be built in  <span class="codeInline">Default.cfm</span> itself. </li>
      <li>Build a  JavaScript array named as <span class="codeInline">data</span> in this page. This array will contain detailed data for the factories. The array will be dynamically built using CFM and then outputted as JavaScript code. </li>
      <li>Build  a local JavaScript function <span class="codeInline">updateChart()</span>, which will process the data in this array and convert it to XML data document, for direct usage by the column chart. </li>
      <li>Customize the  &quot;<span class="codeInline">No data to display</span>&quot; message of the chart to show a friendly message. This message is required because the column chart will initialize with no data, as, initially, the user does not select a factory. </li>
      <li>Define the JavaScript links for each pie slice. These JavaScript links refer to the <span class="codeInline">updateChart()</span> JavaScript function present on the same page. We will later see how to manually code this function. When a pie slice is clicked, the <span class="codeInline">factory ID</span> is passed to this function.</li>
      <li>Generate   the XML 
	    data from the data stored in JavaScript <span class="codeInline">data</span> array and convey it to the column chart, using the <span class="codeInline"> updateChart()</span> function. This function is responsible for updating the column chart. The column chart  now accepts this XML data, parses it and finally gets rendered. </li>
     
      </ol>    </td>
  </tr>
  <tr>
    <td valign="top" class="text">&nbsp;</td>
  </tr>
  <tr>
    <td valign="top" class="header">Creating the page - <span class="codeInline">Default.cfm</span></td>
  </tr>
  
  <tr>
    <td valign="top" class="text"><p>Both the charts and JavaScript functions to manipulate the charts is contained in <span class="codeInline">Default.cfm</span>. It has the following code:</p>
	<pre class="prettyprint code_container">&lt;HTML&gt;
   &lt;HEAD&gt;
&nbsp;&nbsp;&nbsp;&lt;TITLE&gt;
&nbsp;&nbsp;&nbsp;FusionCharts XT - Database + JavaScript Example
&nbsp;&nbsp;&nbsp;&lt;/TITLE&gt;
&nbsp;&nbsp;&nbsp;&lt;cfinclude template=&quot;../Includes/FusionCharts.cfm&quot;&gt;

<span class="codeComment">&nbsp;&nbsp;&nbsp;&lt;!---
&nbsp;&nbsp;&nbsp;In this example, we show a combination of database + JavaScript rendering using FusionCharts.

&nbsp;&nbsp;&nbsp;The entire app (page) can be summarized as under. This app shows the break-down
&nbsp;&nbsp;&nbsp;of factory wise output generated. In a pie chart, we first show the sum of quantity
&nbsp;&nbsp;&nbsp;generated by each factory. These pie slices, when clicked will show detailed date-wise
&nbsp;&nbsp;&nbsp;output of that factory.

&nbsp;&nbsp;&nbsp;The XML data for the pie chart is fully created in CFM at run-time. CFM interacts
&nbsp;&nbsp;&nbsp;with the database and creates the XML for this.
&nbsp;&nbsp;&nbsp;Now, for the column chart (date-wise output report), we do not submit request to the server.
&nbsp;&nbsp;&nbsp;Instead we store the data for the factories in JavaScript arrays. These JavaScript
&nbsp;&nbsp;&nbsp;arrays are rendered by our CFM Code (at run-time). We also have a few defined JavaScript
&nbsp;&nbsp;&nbsp;functions which react to the click event of pie slice.

&nbsp;&nbsp;&nbsp; Before the page is rendered, we need to connect to the database and get the
&nbsp;&nbsp;&nbsp;data, as we will need to convert this data into JavaScript variables.

&nbsp;&nbsp;&nbsp;The following string will contain the JS Data and variables.
&nbsp;&nbsp;&nbsp;This string will be built in CFM and rendered at run-time as JavaScript.
&nbsp;&nbsp;&nbsp;---&gt;</span>
       &nbsp;&nbsp;&nbsp;&lt;cfquery name=&quot;qry&quot; datasource=&quot;dev&quot;&gt;
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;select * from Factory_Master
&nbsp;&nbsp;&nbsp;&lt;/cfquery&gt;
  
&nbsp;&nbsp;&nbsp;&lt;cfset jsVarString = &quot;&quot;&gt;
      &nbsp;&nbsp;&nbsp;&lt;cfset indexCount = 0&gt;
&nbsp;&nbsp;&nbsp;&lt;cfloop query=&quot;qry&quot;&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;cfset indexCount = indexCount + 1&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;cfset factoryID = qry.FactoryId&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;cfset factoryName = qry.FactoryName&gt;
  
  <span class="codeComment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;!--- 
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Create JavaScript code to add sub-array to data array
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;data is an array defined in JavaScript (see below)
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;We have added new lines to data so that if you View Source of the
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output HTML, it will appear properly. It helps during debugging
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;---&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;cfset jsVarString = jsVarString &amp; &quot;data[&quot; &amp; indexCount &amp; &quot;] = new Array();&quot; &amp; Chr(13) &amp; Chr(10)&gt;
  
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;cfquery name=&quot;qryDetails&quot; datasource=&quot;dev&quot;&gt;
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;select * from Factory_Output where FactoryId=#factoryID# order by DatePro Asc
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/cfquery&gt;
       &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;cfloop query=&quot;qryDetails&quot;&gt;
        <span class="codeComment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;!---
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Put this data into JavaScript as another nested array.
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Finally the array will look like data[factoryIndex][i][dataLabel,dataValue]
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;---&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;cfset jsVarString = jsVarString &amp; &quot;data[&quot; &amp; indexCount &amp; &quot;].push(new Array('&quot; &amp; datePart(&quot;d&quot;,qryDetails.DatePro) &amp; &quot;/&quot; &amp; datePart(&quot;m&quot;,qryDetails.DatePro) &amp; &quot;',&quot; &amp; qryDetails.Quantity &amp; &quot;));&quot; &amp; Chr(13) &amp; Chr(10)&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/cfloop&gt;
&nbsp;&nbsp;&nbsp;&lt;/cfloop&gt;
  
&nbsp;&nbsp;&nbsp;&lt;SCRIPT LANGUAGE=&quot;Javascript&quot; SRC=&quot;../../FusionCharts/FusionCharts.js&quot;&gt;
&nbsp;&nbsp;&nbsp;&lt;/SCRIPT&gt;
 
&nbsp;&nbsp;&nbsp;&lt;SCRIPT LANGUAGE=&quot;JavaScript&quot;&gt;
  <span class="codeComment">&nbsp;&nbsp;&nbsp;//Here, we use a mix of server side script (CFM) and JavaScript to
  &nbsp;&nbsp;&nbsp;//render our data for factory chart in JavaScript variables. We will later
  &nbsp;&nbsp;&nbsp;//utilize this data to dynamically plot charts.
  &nbsp;&nbsp;&nbsp;
  &nbsp;&nbsp;&nbsp;//All our data is stored in the data array. From CFM, we iterate through
  &nbsp;&nbsp;&nbsp;//each recordset of data and then store it as nested arrays in this data array.</span>
  &nbsp;&nbsp;&nbsp;var data = new Array();
  
  <span class="codeComment">&nbsp;&nbsp;&nbsp;&lt;!--- Write the data as JavaScript variables here ---&gt;</span>
&nbsp;&nbsp;&nbsp;&lt;cfoutput&gt;#jsVarString#&lt;/cfoutput&gt;
<span class="codeComment">&nbsp;&nbsp;&nbsp;&lt;!---
  &nbsp;&nbsp;&nbsp;The data is now present as arrays in JavaScript. Local JavaScript functions
  &nbsp;&nbsp;&nbsp;can access it and make use of it. We will see how to make use of it.
  &nbsp;&nbsp;&nbsp;---&gt;
  
  &nbsp;&nbsp;&nbsp;/** 
  &nbsp;&nbsp;&nbsp;* the updateChart method is invoked when the user clicks a pie slice.
  &nbsp;&nbsp;&nbsp;* In this method, we get the index of the factory, build the XML data
  &nbsp;&nbsp;&nbsp;* for that that factory, using data stored in data array, and finally
  &nbsp;&nbsp;&nbsp;* update the Column Chart.
  &nbsp;&nbsp;&nbsp;* @param factoryIndex Sequential Index of the factory.
  &nbsp;&nbsp;&nbsp;*/ </span>
  &nbsp;&nbsp;&nbsp;function updateChart(factoryIndex){
  <span class="codeComment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Storage for XML data document</span>
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var strXML = &quot;&lt;chart palette='2' caption='Factory &quot; + factoryIndex + &quot; Output ' subcaption='(In Units)' xAxisName='Date' showValues='1' labelStep='2' &gt;&quot;;
  
  <span class="codeComment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Add &lt;set&gt; elements</span>
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var i=0;
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for (i=0; i&lt;data[factoryIndex].length; i++){
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;strXML = strXML + &quot;&lt;set label='&quot; + data[factoryIndex][i][0] + &quot;' value='&quot; + data[factoryIndex][i][1] + &quot;' /&gt;&quot;;
  &nbsp;&nbsp;&nbsp;}
  <span class="codeComment">
  &nbsp;&nbsp;&nbsp;//Closing Chart Element</span>
  &nbsp;&nbsp;&nbsp;strXML = strXML + &quot;&lt;/chart&gt;&quot;;
  <span class="codeComment">
  &nbsp;&nbsp;&nbsp;//Get reference to chart object using Dom ID &quot;FactoryDetailed&quot;</span>
  &nbsp;&nbsp;&nbsp;var chartObj = getChartFromId(&quot;FactoryDetailed&quot;);
  <span class="codeComment">&nbsp;&nbsp;&nbsp;//Update its XML</span>
  &nbsp;&nbsp;&nbsp;chartObj.setXMLData(strXML);
  &nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&lt;/SCRIPT&gt;
&lt;/HEAD&gt;
  
&lt;BODY&gt;
      <span class="codeComment">&nbsp;&nbsp;&nbsp;&lt;!---
  &nbsp;&nbsp;&nbsp;Initialize the Pie chart with sum of production for each of the factories
  &nbsp;&nbsp;&nbsp;strXML will be used to store the entire XML document generated
  &nbsp;&nbsp;&nbsp;---&gt;</span>
&nbsp;&nbsp;&nbsp;&lt;cfset indexCount=0&gt;
  
  <span class="codeComment">&nbsp;&nbsp;&nbsp;&lt;!--- Generate the chart element ---&gt;</span>
&nbsp;&nbsp;&nbsp;&lt;cfset strXML = &quot;&lt;chart caption='Factory Output report' subCaption='By Quantity' pieSliceDepth='30' showBorder='1' formatNumberScale='0' numberSuffix=' Units' &gt;&quot;&gt;
  
  <span class="codeComment">&nbsp;&nbsp;&nbsp;&lt;!--- Iterate through each factory ---&gt;</span>
&nbsp;&nbsp;&nbsp;&lt;cfquery name=&quot;qry&quot; datasource=&quot;dev&quot;&gt;
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;select * from Factory_Master
&nbsp;&nbsp;&nbsp;&lt;/cfquery&gt;
  
&nbsp;&nbsp;&nbsp;&lt;cfloop query=&quot;qry&quot;&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;cfset indexCount = indexCount + 1&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;cfset factoryID = qry.FactoryId&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;cfset factoryName = qry.FactoryName&gt;
<span class="codeComment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;!--- Now get details for this factory ---&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;cfquery name=&quot;qryDetails&quot; datasource=&quot;dev&quot;&gt;
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;select sum(Quantity) as TotOutput from Factory_Output where FactoryId=#factoryID#
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/cfquery&gt;
<span class="codeComment">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;!--- Generate &lt;set label='..' value='..'/&gt; ---&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;cfset strXML = strXML &amp; &quot;&lt;set label='#factoryName#' value='#qryDetails.totOutput#' link='javaScript:updateChart(&quot; &amp; indexCount &amp; &quot;)'/&gt;&quot;&gt;
&nbsp;&nbsp;&nbsp;&lt;/cfloop&gt;
       <span class="codeComment">&nbsp;&nbsp;&nbsp;&lt;!--- Finally, close the &lt;chart&gt; element ---&gt;</span>
&nbsp;&nbsp;&nbsp;&lt;cfset strXML = strXML &amp; &quot;&lt;/chart&gt;&quot;&gt;
  
  <span class="codeComment">&nbsp;&nbsp;&nbsp;&lt;!--- Create the chart - Pie 3D Chart with data from strXML ---&gt;</span>
&nbsp;&nbsp;&nbsp;&lt;cfoutput&gt;#renderChart(&quot;../../FusionCharts/Pie3D.swf&quot;, &quot;&quot;, strXML, &quot;FactorySum&quot;, 500, 250, false, false)#&lt;/cfoutput&gt;

<span class="codeComment">&lt;!---
Column 2D Chart with changed &quot;No data to display&quot; message
We initialize the chart with &lt;chart&gt;&lt;/chart&gt;
---&gt;</span>
&nbsp;&nbsp;&nbsp;&lt;cfoutput&gt;#renderChart(&quot;../../FusionCharts/Column2D.swf?ChartNoDataText=Please select a factory from pie chart above to view detailed data.&quot;, &quot;&quot;, &quot;&lt;chart&gt;&lt;/chart&gt;&quot;, &quot;FactoryDetailed&quot;, 600, 250, false, false)#&lt;/cfoutput&gt;
&lt;/BODY&gt;
&lt;/HTML&gt;</pre>
<p>In this page, before rendering any HTML code, we first generate all the data in database as JavaScript array. To do so, we use string concatenation in CFM variables to store all data as JavaScript array code. Once the JavaScript code is built in our CFM variable, we write it out in the <span class="codeInline">&lt;SCRIPT&gt;</span> section of HTML <span class="codeInline">&lt;HEAD&gt;</span>. </p>
      <pre class="prettyprint code_container">&lt;SCRIPT LANGUAGE=&quot;JavaScript&quot;&gt;
	var data = new Array();
	&lt;cfoutput&gt;#jsVarString#&lt;/cfoutput&gt;
&lt;/SCRIPT&gt;</pre>
    <p>If you run this page and view the source JavaScript code, you'll see the following: </p>
	<pre class="prettyprint code_container">var data = new Array();
      
data[1] = new Array();
data[1].push(new Array('1/1',21));
data[1].push(new Array('2/1',23));
data[1].push(new Array('3/1',22));
data[1].push(new Array('4/1',24));
data[1].push(new Array('5/1',32));
data[1].push(new Array('6/1',21));
data[1].push(new Array('7/1',34));
data[1].push(new Array('8/1',32));
data[1].push(new Array('9/1',32));
data[1].push(new Array('10/1',23));
data[1].push(new Array('11/1',23));
data[1].push(new Array('12/1',32));
data[1].push(new Array('13/1',53));
data[1].push(new Array('14/1',23));
data[1].push(new Array('15/1',26));
data[1].push(new Array('16/1',43));
data[1].push(new Array('17/1',16));
data[1].push(new Array('18/1',45));
data[1].push(new Array('19/1',65));
data[1].push(new Array('20/1',54));
data[2] = new Array();
data[2].push(new Array('1/1',121));
data[2].push(new Array('2/1',123));
data[2].push(new Array('3/1',122));
data[2].push(new Array('4/1',124));
data[2].push(new Array('5/1',132));
data[2].push(new Array('6/1',121));
data[2].push(new Array('7/1',134));
data[2].push(new Array('8/1',132));
data[2].push(new Array('9/1',132));
data[2].push(new Array('10/1',123));
data[2].push(new Array('11/1',123));
data[2].push(new Array('12/1',132));
data[2].push(new Array('13/1',153));
data[2].push(new Array('14/1',123));
data[2].push(new Array('15/1',126));
data[2].push(new Array('16/1',143));
data[2].push(new Array('17/1',116));
data[2].push(new Array('18/1',145));
data[2].push(new Array('19/1',165));
data[2].push(new Array('20/1',154));
data[3] = new Array();
data[3].push(new Array('1/1',54));
data[3].push(new Array('2/1',56));
data[3].push(new Array('3/1',89));
data[3].push(new Array('4/1',56));
data[3].push(new Array('5/1',98));
data[3].push(new Array('6/1',76));
data[3].push(new Array('7/1',65));
data[3].push(new Array('8/1',45));
data[3].push(new Array('9/1',75));
data[3].push(new Array('10/1',54));
data[3].push(new Array('11/1',75));
data[3].push(new Array('12/1',76));
data[3].push(new Array('13/1',34));
data[3].push(new Array('14/1',97));
data[3].push(new Array('15/1',55));
data[3].push(new Array('16/1',43));
data[3].push(new Array('17/1',16));
data[3].push(new Array('18/1',35));
data[3].push(new Array('19/1',78));
data[3].push(new Array('20/1',75));</pre>
<p>You can clearly see that our CFM code has outputted JavaScript code that can now locally create an array and feed it with requisite data. </p>
      <p>Now, before we get to the JavaScript functions, let's first see what we are doing in our CFM Code. </p>
      <p>We first create the XML data document for Pie chart - summary of factory output. For each <span class="codeInline">&lt;set&gt;</span>, we provide a JavaScript link to the <span class="codeInline">updateChart()</span> function and pass the factory ID to it as shown in the line below:</p>
    <pre class="prettyprint code_container">&lt;cfset strXML = strXML &amp; &quot;&lt;set label='#factoryName#' value='#qryDetails.totOutput#' link='javaScript:updateChart(&quot; &amp; indexCount &amp; &quot;)'/&gt;&quot;&gt;</pre>
    <p class="text">      We now render the Pie 3D chart using Data String method. The Pie 3D chart has its DOM Id as <span class="codeInline">FactorySum</span>:</p>
    <pre class="prettyprint code_container">&lt;cfoutput&gt;#renderChart(&quot;../../FusionCharts/Pie3D.swf&quot;, &quot;&quot;, <b>strXML, &quot;FactorySum&quot;</b>, 500, 250, false, false)#&lt;/cfoutput&gt;</pre>
    <p>Now, we render an empty Column 2D chart  with <span class="codeInline">&lt;chart&gt;&lt;/chart&gt;</span> data initially. We also change the &quot;<span class="codeInline">No data to display.</span>&quot; error to a friendly and intuitive &quot;<span class="codeInline">Please select a factory from pie chart above to view detailed data.</span>&quot; This chart has its DOM Id as <span class="codeInline">FactoryDetailed</span>.</p>
    <pre class="prettyprint code_container">&lt;cfoutput&gt;#renderChart(&quot;../../FusionCharts/Column2D.swf?<b>ChartNoDataText=Please select a factory from pie chart above to view detailed data.&quot;</b>, &quot;&quot;, &quot;&lt;chart&gt;&lt;/chart&gt;&quot;, &quot;FactoryDetailed&quot;, 600, 250, false, false)#&lt;/cfoutput&gt;</pre>
    <p>Effectively, our page is now  set to show two charts. The pie chart shows the summary data provided to it using Data String method. The column chart shows the above &quot;friendly&quot; error message. Now, when each pie slice is clicked, the <span class="codeInline">updateChart()</span> JavaScript function is called and the <span class="codeInline">factoryID</span> of the pie is passed to it. This function is responsible for updating the column chart and contains the following code: </p>
	<pre class="prettyprint code_container">function updateChart(factoryIndex){<br />     <span class="codeComment">//Storage for XML data document</span><br />     var strXML = &quot;&lt;chart palette='2' caption='Factory &quot; + factoryIndex  + &quot; Output ' subcaption='(In Units)' xAxisName='Date' showValues='1' labelStep='2' &gt;&quot;;<br />
<br /><span class="codeComment">//Add &lt;set&gt; elements</span><br />var i=0;<br />for (i=0; i&lt;data[factoryIndex].length; i++){<br />strXML = strXML + &quot;&lt;set label='&quot; + data[factoryIndex][i][0] + &quot;' value='&quot; + data[factoryIndex][i][1] + &quot;' /&gt;&quot;;<br />}<br />
<br /><span class="codeComment">//Closing Chart Element</span><br />strXML = strXML + &quot;&lt;/chart&gt;&quot;;<br />
<br /><span class="codeComment">//Get reference to chart object using Dom ID &quot;FactoryDetailed&quot;</span><br />var chartObj = getChartFromId(&quot;FactoryDetailed&quot;);<br />
<span class="codeComment">//Update its XML</span><br />
chartObj.setXMLData(strXML);<br />
}</pre></td>
  </tr>
  <tr>
    <td valign="top" class="text"><p>Here, </p>
      <ol>
        <li>We first create the XML data document for the column chart by iterating through data contained in our JavaScript <span class="codeInline">data</span> array. </li>
        <li>Thereafter, we convey this XML data to the column chart. To do so, we first get a reference to the column chart using its DOM Id <span class="codeInline">FactoryDetailed</span>. We use the <span class="codeInline">getChartFromId</span>() function defined in <span class="codeInline">FusionCharts.js</span> to do so. </li>
        <li>Once we have the reference to the chart, we simply call the <span class="codeInline">setXMLData</span> method of the chart and pass the XML data document. </li>
        <li>This updates the chart with new data. </li>
      </ol>    
      <p class="highlightBlock">If you have your chart objects inside the <span class="codeInline">&lt;FORM&gt;</span> elements, you cannot use the <span class="codeInline">getChartFromId()</span> method to get a reference to the chart, as the DOM Hierarchy of the chart object has changed. You will get a JavaScript &quot;<span class="codeInline">&lt;&lt;ChartId&gt;&gt; is undefined</span>&quot; error. In these cases, you'll manually need to get a reference to the chart object. Or, you can opt to place the chart object outside <span class="codeInline">&lt;FORM&gt;</span> element. </p>
      <p>When you now see the application, the initial state will look as under: </p></td>
  </tr>
  <tr>
    <td valign="top" class="text"><img src="../Images/Code_JS_URL_Ini.jpg" width="511" height="458" class="imageBorder" /></td>
  </tr>
  <tr>
    <td valign="top" class="text"><p>And when you click  a pie slice, the following will appear on the same page (without involving any browser refreshes): </p></td>
  </tr>
  <tr>
    <td valign="top" class="text"><img src="../Images/Code_JS_URL_Fin.jpg" width="610" height="526" class="imageBorder" /></td>
  </tr>
  <tr>
    <td valign="top" class="text"><p>This example demonstrated a very basic sample of the integration capabilities possible with FusionCharts XT. For advanced demos, you can see and download our FusionCharts XT Blueprint/Demo Applications. </p></td>
  </tr>
</table>
<!-- footer links starts-->
<div id="fcfooter"></div>
<script type="text/javascript">
	document.getElementById("fcfooter").innerHTML =  addFCFooter("ColdFusion, JavaScript &amp; dataURL|CFM_JS_URL.html","Using with VB.NET (ASP.NET)|../vbnet/VBNET_BasicExample.html");
</script>
<!-- footer links ends -->
<script type="text/javascript" language="javascript1.2">//<![CDATA[
<!--

	highlightSearch();

//-->
//]]></script>
</body>
</html>
