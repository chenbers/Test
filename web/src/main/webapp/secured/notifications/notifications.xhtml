<ui:composition template="/layout/layout.xhtml" xmlns="http://www.w3.org/1999/xhtml" xmlns:ui="http://java.sun.com/jsf/facelets" xmlns:h="http://java.sun.com/jsf/html"
    xmlns:rich="http://richfaces.org/rich" xmlns:a4j="http://richfaces.org/a4j" xmlns:f="http://java.sun.com/jsf/core" xmlns:pretty="http://ocpsoft.com/prettyfaces">

    <ui:param name="notificationsSelected" value="current" />

    <ui:define name="scripts">
        <script src="http://maps.google.com/maps?file=api&amp;v=#{gmBean.version}&amp;key=#{gmBean.key}" type="text/javascript"></script>
        <script src="#{facesContext.externalContext.requestContextPath}/js/drawZone.js" type="text/javascript"></script>
        <script src="#{facesContext.externalContext.requestContextPath}/js/mapGeocode.js" type="text/javascript"></script>
        <script type="text/javascript">
          var map;
        	
          function initializeMap(lat, lng, zonePoints, noteID) 
          {
            if (GBrowserIsCompatible()) {
              map = new GMap2(document.getElementById("address-canvas"));
              var location = new GLatLng(lat, lng)
              map.setCenter(location, 15);
              map.addOverlay(new GMarker(location)); 

              
		      var outline = fromOutlineString(zonePoints);
              if (outline)
              {
            	// Draw Zone and set center
                centerMapAtZone(getLatLngBounds(outline));
                loadZone(outline, false);
                map.addOverlay(new GMarker(getLatLngBounds(outline).getCenter()));
                showInfoBubble(noteID, getLatLngBounds(outline).getCenter());
              }
              else
              {
            	showInfoBubble(noteID, location);
              }
            }
          }

	      function showInfoBubble(divID, latLng)
	      {
	    	  var node = document.getElementById(divID).cloneNode(true);
    		  node.style.display = 'block';
       		  map.openInfoWindow(latLng, node);
		  }
          
          function initializeTable()
          {
              jQuery(".clickable-map-icon").click(function(){
                  var address = jQuery(this).siblings("[id$='addressToolTip']").find("[id$='address']").text();
                  jQuery('#mapModalHeader').text("Event Location: " + address);
                });
              jQuery('tr:has(a[name*="excluded"])').addClass('excluded-row');
          }

  		/* CreateMarker(GLatLng, divID, GIcon or null)
  		 *	
  		 * Creates a marker using specified GIcon or
  		 * default icon if null is passed for iconImage.
  		 * divID is the id of a DIV you want displayed in the info window. 
  		 */
          function createMarker(point, divID, iconImage) 
          {
          	var markerIcon;
          	var marker;

  			//Use passed in image.
          	if(iconImage != null)
          	{
  				markerIcon = new GIcon(baseIcon);
  	       	    markerIcon.image = iconImage;
  	       	 	markerOptions = { icon:markerIcon };
  	       	 	marker = new GMarker(point, markerOptions);
          	}
          	//Use default GoogleMap marker image.
          	else
          	{
  		      	markerIcon = new GIcon();
  				marker = new GMarker(point);
          	}
         
         		GEvent.addListener(marker, "click", function() {
  					var node = document.getElementById(divID).cloneNode(true);
            			node.style.display = 'block';
  		            marker.openInfoWindow(node);
  		 			});

          	return marker;
          }
        </script>
    </ui:define>

    <ui:define name="subnavigation">
        <div class="sub_nav">
            <div class="sub_nav-bg">
                <ul>
                    <li id="redflagtab" class="#{customSubSelected}">
                        <pretty:link mappingId="redFlags"><span>#{messages.notes_tab_redflag}</span></pretty:link>
                    </li>
                    <li id="safetytab" class="#{safetySubSelected}">
                        <pretty:link mappingId="safety"><span>#{messages.notes_tab_safety}</span></pretty:link>
                    </li>
                    <li id="diagnosticstab" class="#{diagnosticsSubSelected}">
                        <pretty:link mappingId="diagnostics"><span>#{messages.notes_tab_diagnostics}</span></pretty:link>
                    </li>
                    <li id="emergencytab" class="#{emergencySubSelected}">
                        <pretty:link mappingId="emergency"><span>#{messages.notes_tab_emergency}</span></pretty:link>
                    </li>
                    <li id="crashhistorytab" class="#{crashhistorySubSelected}">
                        <pretty:link mappingId="crashHistory"><span>#{messages.notes_tab_crashhistory}</span></pretty:link>
                    </li>                    
                </ul>
            </div>
        </div>
    </ui:define>
</ui:composition>