<ui:composition template="/layout/layout.xhtml"
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:rich="http://richfaces.org/rich"
	xmlns:a4j="http://richfaces.org/a4j"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:security="http://pro.tiwi.com/jsf/security"
    xmlns:tiwiprofn="http://pro.tiwi.com/jsffunctions">

	<ui:param name="adminSelected" value="current" />
    <ui:param name="title" value="#{reportScheduleBean.add ? messages.adminHeader_addReportSchedule : (reportScheduleBean.batchEdit ? messages.adminHeader_editReportSchedules : messages.adminHeader_editReportSchedule)}"/>
	<ui:param name="helpFile" value="Add_Edit_a_Report.htm" />
   
    <ui:define name="scripts">
		<script src="http://maps.google.com/maps?file=api&amp;v=#{gmBean.version}&amp;key=#{gmBean.key}&amp;hl=#{localeBean.locale.language}" type="text/javascript"></script>
        <script src="#{facesContext.externalContext.request.contextPath}/js/mapstraction/mapstraction.js" type="text/javascript"></script>
        <script src="http://dev.virtualearth.net/mapcontrol/mapcontrol.ashx?v=6"></script>
	</ui:define>
    
	<ui:define name="content">
		
		<table width="920" border="0" cellspacing="0"
			cellpadding="0" align="center" style="margin: 0 auto 0 auto;">
			<tr>
				<td valign="top">
				<a4j:form id="edit-form">
				<div class="">
					<div class="panel_nw">
					<div class="panel_title">
						<span class="email"><h:outputText value="#{messages.crashReport_add}" /></span>
						<span class="panel_links"></span></div>
					</div>

					<div class="panel_w"><!-- MAIN CONTENT -->
						<div class="panel_content">
		                
						<rich:messages globalOnly="true"
							errorClass="error" fatalClass="error" warnClass="warning"
							infoClass="info" styleClass="msg" />
							
						<ul id="grid_nav" style="margin: 0;">
		                   	<li class="r">
		                      <h:commandButton action="#{reportScheduleBean.save}" styleClass="left"><span class="save"><h:outputText value="#{messages.button_save}" /></span></h:commandButton>
		                      <h:outputText value=" " /><h:commandButton action="#{reportScheduleBean.cancelEdit}" immediate="true" styleClass="left"><span class="cancel"><h:outputText value="#{messages.button_cancel}" /></span></h:commandButton>
		                    </li>
		                </ul>
		                
		                <ui:fragment rendered="${tiwiprofn:messagesAvailable()}">
		                  <dl id="display-form:j_id122" class="rich-messages msg" style="">
		                     <dt class="error">
		                        <h:outputFormat value="#{messages.error_validationMsg}">
		                           <f:param value="${tiwiprofn:getMessageCount()}"/>
		                        </h:outputFormat>
		                     </dt>
		                  </dl>
		                </ui:fragment>
					   
						<table width="900" border="0" cellspacing="0" cellpadding="0">
							<tr>
								<td width="425" valign="top" align="left">
			                        <div class="spacer"></div>
									<div class="add_section_title"><h:outputText
										value="#{messages.crashReport_crashDetails}" /></div>
									
									<table width="415" border="0" cellspacing="2" cellpadding="4" align="center">
										<tr>
											<td width="150" valign="top">
												<h:outputText value="#{messages.crashReport_status}" />
												<h:outputText styleClass="required" value=" *" />
											</td>
											<td>
												<rich:message for="status" errorClass="field-error" fatalClass="field-error" warnClass="field-warning" infoClass="field-info" styleClass="field-msg" />
												<h:selectOneMenu value="#{crashReportBean.crashReport.crashReportStatus}" converter="SimpleBeanConverter">
													<f:selectItems value="#{crashReportBean.crashReportStatusAsSelectItems}"/>
												</h:selectOneMenu>	
											</td>
										</tr>
										<tr>
											<td width="150" valign="top">
												<h:outputText value="#{messages.crashReport_date}" />
												<h:outputText styleClass="required" value=" *" />
											</td>
											<td>
			      								<rich:message for="description" errorClass="field-error" fatalClass="field-error" warnClass="field-warning" infoClass="field-info" styleClass="field-msg" />
												<rich:calendar value="#{crashReportBean.crashReport.date}"/>
											</td>
										</tr>
										<tr>
											<td width="150" valign="top">
			                                    <h:outputText value="#{messages.crashReport_vehicle}" />
			                                    <h:outputText styleClass="required" value=" *" />
											</td>
											<td>
												<h:selectOneMenu value="#{crashReportBean.crashReport.vehicleID}">
													<f:selectItems value="#{crashReportBean.vehiclesAsSelectItems}"/>
												</h:selectOneMenu>
											</td>
										</tr>
										<tr>
											<td width="150" valign="top">
			                                    <h:outputText value="#{messages.crashReport_driver}" />
			                                    <h:outputText styleClass="required" value=" *" />
											</td>
											<td>
												<h:selectOneMenu value="#{crashReportBean.crashReport.driverID}">
													<f:selectItems value="#{crashReportBean.driversAsSelectItems}"/>
												</h:selectOneMenu>
											</td>
										</tr>
										<tr>
											<td width="150" valign="top">
												<h:outputText value="#{messages.crashReport_weather}" />
											</td>
											<td>
			      								<rich:message for="weather" errorClass="field-error" fatalClass="field-error" warnClass="field-warning" infoClass="field-info" styleClass="field-msg" />
												<h:inputText id="weather" value="#{crashReportBean.crashReport.weather}" styleClass="text" size="30" maxlength="30"></h:inputText>	
											</td>
										</tr>
										<tr>
											<td width="150" valign="top">
												<h:outputText value="#{messages.crashReport_occupantCount}" />
											</td>
											<td>
												<rich:inputNumberSpinner minValue="0" maxValue="50" value="#{crashReportBean.crashReport.occupantCount}"/>
											</td>
										</tr>
										
										
			                        </table>
								</td>
								<td width="10"><h:graphicImage value="/images/x.gif" width="10" /></td>
								<td width="425" valign="top" align="left">
									
			                        <div class="spacer"></div>
									<div class="add_section_title"><h:outputText
											value="#{messages.crashReport_description}" /></div>
									
									<table width="420" border="0" cellspacing="2" cellpadding="4"
										align="center">
										<tr>
											<td>
												<div class="instructions"><h:outputText value="#{messages.crashReport_descriptionExplanation}" /></div>
												<h:inputTextarea cols ="50" rows="10" value="#{crashReportBean.crashReport.description}" />
											</td>
										</tr>
									</table>
								</td>
							</tr>
						 </table>
						 
						 <div class="spacer"></div>
						 <div class="add_section_title"><h:outputText value="#{messages.crashReport_crashLocation}" /></div>
						 <table width="850" style="padding:10px">
						 	<tr>
						 		<td width="200">
									<h:outputText value="#{messages.crashReport_existingTrip}"/>
								</td>
								<td align="left">
									<h:selectOneRadio value="#{crashReportBean.useExistingTrip}" layout="lineDirection">
										<f:selectItem itemValue="FALSE" itemLabel="No"/>
										<f:selectItem itemValue="TRUE" itemLabel="Yes"/>
									</h:selectOneRadio>
								</td>
						   </tr>
						   <tr>
						   		<td colspan="2">
									<table width="850">
										<tr>
											<ui:fragment rendered="#{crashReportBean.crashReport.crashDataPoints ne null}">
												<td width="400">
												
												</td>	
											</ui:fragment>
											<td>
												<div id="map-canvas" style="width: 100%; height: 500px; border: 0"></div>
												
												<script type="text/javascript">
													var mapstraction = null;
													function initMap()
						                            {
						                                mapstraction = new Mapstraction('map-canvas',"google");
						                                // create a lat/lon object
						                                var myPoint = new LatLonPoint(40,-111);
	
						                                // display the map centered on a latitude and longitude (Google zoom levels)
						                                mapstraction.setCenterAndZoom(myPoint, 12);
	
						                                mapstraction.addEventListener('moveend',function() {
						                                   var center = mapstraction.getCenter();
						                                   var zoom = mapstraction.getZoom();
						                                   updateMapValues(center.lat,center.lon,zoom);
						                                });
											
														
						                                                                
						                               mapstraction.dragging(false);
						      						   mapstraction.addControls({
					                                        pan: true, 
					                                        zoom: 'large',
					                                        map_type: true});                            
						                            }

													initMap();
												</script>
											</td>
										</tr>
									</table>
						 		</td>
						 	</tr>
						 </table>
						
						 <div class="required-key"><h:outputText value="#{messages.requiredKey}" /></div>
						 
						 <ul id="grid_nav" style="margin: 0;">
		                   	<li class="r">
		                      <h:commandButton action="#{reportScheduleBean.save}" styleClass="left"><span class="save"><h:outputText value="#{messages.button_save}" /></span></h:commandButton>
		                      <h:outputText value=" " /><h:commandButton action="#{reportScheduleBean.cancelEdit}" immediate="true" styleClass="left"><span class="cancel"><h:outputText value="#{messages.button_cancel}" /></span></h:commandButton>
		                    </li>
		                 </ul>
					</div>

				</div>

				<div class="panel_sw">
				<div class="panel_statusbar"></div>
				</div>
				</div>
					</a4j:form>
				</td>
			</tr>
		</table>
	</ui:define>

</ui:composition>
