<ui:composition template="/layout/layout.xhtml" 
				xmlns="http://www.w3.org/1999/xhtml" 
				xmlns:ui="http://java.sun.com/jsf/facelets"
	  			xmlns:h="http://java.sun.com/jsf/html" 
	  			xmlns:rich="http://richfaces.org/rich"
	  			xmlns:a4j="http://richfaces.org/a4j"
	  			xmlns:f="http://java.sun.com/jsf/core">

	<ui:define name="scripts">
		<script src="/tiwipro/js/FusionCharts.js" type="text/javascript"></script>	
		<script src="http://maps.google.com/maps?file=api&amp;v=2&amp;key=ABQIAAAAyQYKk4__l80DyIsqLPvvuxTRFLl8Tcq3arEgFHYFeOMvEMiJ8RQehhrYXPIDrf1muScWAd1MXrlVkQ" type="text/javascript"></script>	
	</ui:define>

	<ui:param name="homeSelected" value="current" />
	
	<ui:define name="subnavigation">
		<ui:include src="../includes/reports/subNavigation.xhtml" />
	</ui:define>
	
	<ui:define name="content">
<div id="wrapper">

<ul id="grid_nav">
	<li class="l grid_icon"><img src="images/ico_line.png" /></li>
	<li class="l grid_title">Driver Performance: <h:outputText>#{driverBean.driverName}</h:outputText></li>
	<li class="l divider"><img src="/images/grid_nav_divider.png" /></li>
	<li class="l">
	
		<ul id="breadcrumb">
			<li class="first"><a href="/">Home</a></li>
			<li><a href="drivers.html">Drivers</a></li>
			<li class="last"><h:outputText></h:outputText></li>
		</ul>
	</li>
</ul>
<div class="spacer"></div>
<table width="940" border="0" cellspacing="0" cellpadding="0" align="center">
  <tr>
    <td width="330" valign="top">
<!-- START PANEL -->
			<div class="">
				<div class="panel_nw">
					<div class="panel_title">
						<span class="cal">Date Range </span>
						<span class="panel_links"></span>
					</div>
				</div>
					<div class="panel_w">
					  <div class="panel_content">
					    <rich:panel id="date_picker_panel">
						<h:form>
							<table width="320" cellpadding="4" cellspacing="0" class="" id="">
							  <tbody>
							  <tr>
								<td width="73">Start Date </td>
								<td width="178">
									<a4j:outputPanel id="calendarStart" layout="block">
				                    	<rich:calendar value="#{driverTripsBean.startDate}"
				                        	locale="en/US"
				                        	popup="true"
				                        	datePattern="MMMMM d, yyyy"
				                        	showApplyButton="false" cellWidth="24px" cellHeight="22px"/>
				           			</a4j:outputPanel> 
								</td>
								<td width="51">to</td>
							  </tr>
							  <tr>
								<td>End Date </td>
								<td>
								  <a4j:outputPanel id="calendarEnd" layout="block">
				                    	<rich:calendar value="#{driverTripsBean.endDate}"
				                        	locale="en/US"
				                        	popup="true"
				                        	datePattern="MMMMM d, yyyy"
				                        	showApplyButton="false" cellWidth="24px" cellHeight="22px"/>
				           			</a4j:outputPanel>
								</td>
								<td></td>
							  </tr>
							  <tr>
							    <td> </td>
							    <td> <h:commandButton value="Apply Date Range" /></td>
							    <td> </td>
							    </tr>
							  </tbody>
						  </table>
						 </h:form>
						</rich:panel>
					  </div>
					</div>
				<div class="panel_sw">
					<div class="panel_statusbar"></div>
				</div>
			</div>
		<!-- END PANEL -->
		
		<div class="spacer"></div>
		
		<!-- START PANEL -->
			<div class="">
				<div class="panel_nw">
					<div class="panel_title">
						<span class="">Stats: #{driverTripsBean.startDateAsShortString} - #{driverTripsBean.endDateAsShortString}</span>
						<span class="panel_links"></span>
					</div>
				</div>
					<div class="panel_w">
					  <div class="panel_content">
					    <div class="" id="">
								<table width="320" id="" cellpadding="4" cellspacing="0" class="">
								  <tbody>
								  <tr>
									<td width="240">Total Miles Driven:</td>
									<td width="70"><h:outputText>#{driverTripsBean.milesDriven}</h:outputText></td>
								  </tr>
								  <tr>
									<td>Total Stops: </td>
									<td><h:outputText>#{driverTripsBean.numStops}</h:outputText></td>
								  </tr>
								  <tr>
								    <td>Total Idle Time: </td>
								    <td><h:outputText>#{driverTripsBean.idleTime}</h:outputText></td>
								    </tr>
								  <tr>
								    <td>Total Trips:</td>
								    <td><h:outputText>#{driverTripsBean.numTrips}</h:outputText></td>
								    </tr>
								  <tr>
								    <td>Total Drive Time:</td>
								    <td><h:outputText>#{driverTripsBean.totalDriveTime}</h:outputText></td>
								    </tr>
								  </tbody>
						  </table>
						</div>
					  </div>
					</div>
				<div class="panel_sw">
					<div class="panel_statusbar"></div>
				</div>
			</div>
		<!-- END PANEL -->
		
		<div class="spacer"></div>
		
		<!-- START PANEL -->
			<div class="">
				<div class="panel_nw">
					<div class="panel_title">
						<span class="">Events</span>
						<span class="panel_links"></span>
					</div>
				</div>
					<div class="panel_w">
					  <div class="panel_content">
				<!-- Start Trip table --> 
				<rich:panel id="selectedTrip">
					
						<rich:dataTable 
						value="#{driverTripsBean.selectedTrip.trip.events}" 
						id="selectedTripTable"
						var="item" styleClass="datagrid"
						rowClasses="trendTableOdd,trendTableEven" cellspacing="1" rows="10"  
						width="100%">  <!-- //TODO: Make generic Odd Even CSS -->

							<!-- Data -->
							<rich:column sortBy="#{item.addressStr}">
								<f:facet name="header">
									<h:outputText value="Address" />
								</f:facet>
								<h:outputText value="#{item.addressStr}" />
								
							</rich:column>
							
							<rich:column sortBy="#{item.time}">
								<f:facet name="header">
									<h:outputText value="Time" />
								</f:facet>
								<h:outputText value="#{item.time}" />
							</rich:column>
						</rich:dataTable>
					 </rich:panel>
				<!-- End Trip table -->
					    
					  </div>
					</div>
				<div class="panel_sw">
					<div class="panel_statusbar"></div>
				</div>
			</div>
		<!-- END PANEL -->
		
		<div class="spacer"></div>
		
		<!-- START PANEL -->
			<div class="">
				<div class="panel_nw">
					<div class="panel_title">
						<span class="">Settings </span>
						<span class="panel_links"></span>
					</div>
				</div>
					<div class="panel_w">
					  <div class="panel_content">
					    <div class="" id="">
					    <h:form>
							<table width="320" cellpadding="4" cellspacing="0" class="" id="settings">
								  <tbody>
								  <tr>
									<td width="290">Show all Trips on this map</td>
								    <td width="20">
								      <h:selectBooleanCheckbox value="#{driverTripsBean.showAllTrips}" />
								    </td>
								    </tr>
								  <tr>
									<td>Show idle markers</td>
								    <td>
								      <h:selectBooleanCheckbox value="#{driverTripsBean.showIdleMarkers}" />
								    </td>
								    </tr>
								  <tr>
								    <td>Show warnings</td>
								    <td>
								      <h:selectBooleanCheckbox value="#{driverTripsBean.showWarnings}" />
								    </td>
								    </tr>
								  </tbody>
								</table>
						    </h:form>
						</div>
					  </div>
					</div>
				<div class="panel_sw">
					<div class="panel_statusbar"></div>
				</div>
			</div>
		<!-- END PANEL -->
		
		<div class="spacer"></div>
		
		<!-- START PANEL -->
			<div class="">
				<div class="panel_nw">
					<div class="panel_title">
						<span class="">Legend</span>
						<span class="panel_links"></span>
					</div>
				</div>
					<div class="panel_w">
					  <div class="panel_content">
					    <div class="" id="">
							<div class="" id="">
								<table width="320" id="legend" cellpadding="4" cellspacing="0" class="sortable-onload-show no-arrow colstyle-alt paginate-15 max-pages-4">
								  <tbody>
								  <tr>
									<td width="25"><img src="../images/ico_start.png" width="21" height="20" /></td>
									<td width="120">Start</td>
								    <td width="30"><img src="../images/ico_stop.png" width="20" height="20" /></td>
								    <td width="119">Engine Stop</td>
								  </tr>
								  <tr>
									<td><img src="../images/ico_idle.png" width="20" height="20" /></td>
									<td>Engine Idle</td>
								    <td><img src="../images/ico_new_trip.png" width="21" height="20" /></td>
								    <td>New Trip</td>
								  </tr>
								  <tr>
								    <td><img src="../images/ico_violation.png" width="20" height="20" /></td>
								    <td>Violation</td>
								    <td><img src="../images/ico_end_trip.png" width="21" height="20" /></td>
								    <td>End</td>
								    </tr>
								  </tbody>
								</table>
							</div>
						</div>
					  </div>
					</div>
				<div class="panel_sw">
					<div class="panel_statusbar"></div>
				</div>
			</div>
		<!-- END PANEL -->
	</td>
    <td width="10"><img src="images/x.gif" width="10" /></td>
    <td width="600" valign="top">
		<!-- START PANEL -->
		<div class="" style="width:600px; margin: 0 auto 0 auto;">
			<div class="panel_nw">
				<div class="panel_title">
					<span class="vehicle">Trips by #{driverBean.driverName}</span>
					<span class="panel_links"></span></div>
			</div>
			<div class="panel_w">
			  <div class="panel_content" align="center">
				<!-- Start Trip table --> 
					<a4j:form id="trendTable">
						<rich:dataTable 
						value="#{driverTripsBean.trips}" id="items"
						var="item" styleClass="datagrid"
						rowClasses="trendTableOdd,trendTableEven" cellspacing="1" rows="5"  
						width="100%">  <!-- //TODO: Make generic Odd Even CSS -->

							<!-- Data -->
										
							<rich:column sortBy="#{item.dateShort}">
								<f:facet name="header">
									<h:outputText value="Date" />
								</f:facet>
									<a4j:commandLink value="#{item.dateShort}" reRender="selectedTrip,selectedTripMap">
										<f:setPropertyActionListener value="#{item}" target="#{driverTripsBean.selectedTrip}" />
									</a4j:commandLink>
							</rich:column>
							
							<rich:column sortBy="#{item.timeShort}">
								<f:facet name="header">
									<h:outputText value="Time" />
								</f:facet>
									<h:outputText value="#{item.timeShort}" />
							</rich:column>
							
							<rich:column sortBy="#{item.distance}">
								<f:facet name="header">
									<h:outputText value="Dist" />
								</f:facet>
								<h:outputText value="#{item.distance}" />		
							</rich:column>
							
							<rich:column sortBy="#{item.startAddress}">
								<f:facet name="header">
									<h:outputText value="Start" />
								</f:facet>
								<h:outputText value="#{item.startAddress}" />
							</rich:column>
							
							<rich:column sortBy="#{item.endAddress}">
								<f:facet name="header">
									<h:outputText value="End" />
								</f:facet>
								<h:outputText value="#{item.endAddress}" />
							</rich:column>
							
							<rich:column sortBy="#{item.duration}">
								<f:facet name="header">
									<h:outputText value="Dur" />
								</f:facet>
								<h:outputText value="#{item.duration}" />
							</rich:column>
						</rich:dataTable>
						<div class="spacer"></div>
						<rich:datascroller align="center" for="items" maxPages="20"
           				 page="#{driverTripsBean.tripsPager}" id="scroller" reRender="items" />
					</a4j:form> 
				<!-- End Trip table -->
			  </div>
			</div>
			<div class="panel_sw">
				<div class="panel_statusbar"></div>
			</div>
		</div>
		<!-- END PANEL -->
		
		<div class="spacer"></div>
		
		<!-- START PANEL -->
		<div class="" style="width:600px; margin: 0 auto 0 auto;">
			<div class="panel_nw">
				<div class="panel_title">
					<span class="map">Map</span>
					<span class="panel_links"></span></div>
			</div>
			<div class="panel_w">
			  <rich:panel bodyClass="panel_content" id="selectedTripMap">
			  <h:panelGroup styleClass="map-border" layout="block">
							<div id="map-canvas" style="width:588px;height:500px;border:0"></div>
					  	</h:panelGroup>
					   					    <script type="text/javascript">
      						if (GBrowserIsCompatible()) {
        						map = new GMap2(document.getElementById("map-canvas"));
        						map.addControl(new GLargeMapControl());
        						map.addControl(new GMapTypeControl());
        						map.addControl(new GOverviewMapControl()); 
								map.setCenter(new GLatLng(#{driverTripsBean.selectedTrip.routeLastStep.lat}, #{driverTripsBean.selectedTrip.routeLastStep.lng}), 14);
								map.setMapType(G_NORMAL_MAP);
								
								var polyline = new GPolyline([
								
									<ui:repeat value="#{driverTripsBean.selectedTrip.route}" var="route">
										new GLatLng(#{route.lat}, #{route.lng}),
								  	</ui:repeat>
								  		  //Repeating the last step to finish JS array.
								  		  new GLatLng(#{driverTripsBean.selectedTrip.routeLastStep.lat}, #{driverTripsBean.selectedTrip.routeLastStep.lng})
									], "#0000ff", 6);
									map.addOverlay(polyline);
								
      						}
    					</script> 
			  </rich:panel>
			</div>
			<div class="panel_sw">
				<div class="panel_statusbar"></div>
			</div>
		</div>
		<!-- END PANEL -->
	</td>
  </tr>
</table>
</div>
</ui:define>

</ui:composition>
