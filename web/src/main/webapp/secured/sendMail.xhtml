<ui:composition template="/layout/layout.xhtml" 
              xmlns="http://www.w3.org/1999/xhtml" 
              xmlns:ui="http://java.sun.com/jsf/facelets"
              xmlns:h="http://java.sun.com/jsf/html"
              xmlns:rich="http://richfaces.org/rich"
              xmlns:a4j="http://richfaces.org/a4j"
              xmlns:f="http://java.sun.com/jsf/core"
              xmlns:t="http://myfaces.apache.org/tomahawk"
              xmlns:security="http://pro.tiwi.com/jsf/security">

  <ui:param name="messagesSelected" value="current" />
  <ui:param name="context" value="sendMail" />
  
  <ui:param name="title" value="#{messages.adminHeader_people}"/>
  <ui:define name="content">

    <table width="800" border="0" cellspacing="0" cellpadding="0" align="center" style="margin: 0 auto 0 auto;">
      <tr>
      <td valign="top" width="130">
        <ui:include src="/includes/navigation/messagesSideNav.xhtml">
          <ui:param name="selectedAction" value="go_sendMail" />
          <ui:param name="parentAction" value="go_sendMail" />
          <ui:param name="context" value="sendMail"/>
        </ui:include>
      </td>
      <td valign="top">
      
          <div class="">

            <div class="panel_nw">
              <div class="panel_title">
                <span class="admin"><h:outputText value="Send Mail" /></span>
                <span class="panel_links">
                </span>
              </div>
            </div>      
      
      
		<a4j:form id="display-form">
		
		<table width="800" border="0" cellspacing="0" cellpadding="0" align="center" style="margin: 0 auto 0 auto;">
			<tr>
				<td valign="top">


							<div class="panel_w">
								<div class="panel_content">		
			<!-- List of things to select -->	
									<table width="800" align="center" style="margin: 0 auto 0 auto;">									
						
										<tr>
											<td valign="top">
												<div style="textAlign: top; width: 200px">
													
													<div class="add_section_title">
                       									<h:outputText value="Acccount: #{messagesBean.accountName}" />
                       									<a4j:status	id="overview_ajax_status_send" for="treeSendRegion">
															<f:facet name="start">
																<h:outputText>
																	<img src="#{facesContext.externalContext.request.contextPath}/images/progress2.gif" align="top" />&#160;
																</h:outputText>
															</f:facet>
														</a4j:status>
                     								</div>
													<br></br>
													
								<!-- Can't seem to set the immediate to true. When doing so, on select, the node is being set
									to a SwingTreeNodeImpl -->
													<a4j:region id="treeSendRegion">
      													<h:panelGroup id="sendTreePanel">
      														<rich:tree 
      															id="treeSend"
      															switchType="ajax" 
      															selectedClass="selectedNode"
      															style="overflow: auto;width:178px;height:355px;border-left:1px solid #A1C667;border-right:1px solid #A1C667;border-bottom:1px solid #A1C667; border-top:1px solid #A1C667; margin-left: 11px"
      															value="#{messagesBean.rootGroupNode}" 
      															var="item"
      															reRender="display-form:toList"
      															nodeFace="#{item.data.treeNodeType}"
      															nodeSelectListener="#{messagesBean.selectNode}"
      															adviseNodeSelected="#{messagesBean.adviseNodeSelected}"
      															adviseNodeOpened="#{messagesBean.adviseNodeExpanded}"
      															changeExpandListener="#{messagesBean.changeExpandListener}"
      															ajaxSubmitSelection="true">
      															<rich:treeNode id="fleetSend" type="FLEET" iconLeaf="/images/ico_truck.png"
      																icon="/images/ico_truck.png">
      																<rich:dndParam name="labelSend" type="drag" value="#{item.label}"/>
      																<h:outputText value="#{item.label}" />
      															</rich:treeNode>
      															<rich:treeNode id="divisionSend" type="DIVISION"
      																iconLeaf="/images/ico_trucks.png"
      																icon="/images/ico_trucks.png">
      																<rich:dndParam name="labelSend" type="drag" value="#{item.label}"/>
      																<h:outputText value="#{item.label}" />
      															</rich:treeNode>
      															<rich:treeNode id="teamSend" type="TEAM" iconLeaf="/images/ico_team.png"
      																icon="/images/ico_team.png">
      																<rich:dndParam name="label" type="drag" value="#{item.label}"/>
      																<h:outputText value="#{item.label}" />
      															</rich:treeNode>
      															<rich:treeNode id="driverSend" type="DRIVER" iconLeaf="/images/ico_steering_wheel.png"
      																icon="/images/ico_steering_wheel.png">
      																<rich:dndParam name="labelSend" type="drag" value="#{item.label}"/>
      																<h:outputText value="#{item.label}" />
      															</rich:treeNode>
      															<rich:treeNode id="vehicleSend" type="VEHICLE"
      																iconLeaf="/images/ico_vehicle.png"
      																icon="/images/ico_vehicle.png">
      																<rich:dndParam name="labelSend" type="drag" value="#{item.label}"/>
      																<h:outputText value="#{item.label}" />
      															</rich:treeNode>
                                              					<rich:treeNode id="deviceSend" type="DEVICE"
                                                					iconLeaf="/images/ico_tiwi.png"
                                                					icon="/images/ico_tiwi.png">
                                                					<rich:dndParam name="labelSend" type="drag" value="#{item.label}"/>
                                                					<h:outputText value="#{item.label}" />
                                              					</rich:treeNode>
                                              					<rich:treeNode id="userSend" type="USER" iconLeaf="/images/ico_driver.png" 
      																icon="/images/ico_driver.png">
      																<rich:dndParam name="labelSend" type="drag" value="#{item.label}"/>
      																<h:outputText value="#{item.label}" />
      															</rich:treeNode>
      														</rich:tree>
      													</h:panelGroup>
												</a4j:region>
												<rich:dragIndicator id="indicator" />
                                <!-- onDrop of a tree node reRender tree. Also set the delay to 200 -->
												<script type="text/javascript">
													function doRefreshTree(){
														setTimeout('refreshTree()', 200)
													}
                                    				function submitSelection()
                                    				{
                                        
                                   					}
									
												</script>
							   					<a4j:jsFunction name="refreshTree" reRender="organizationTreePanel,groupPanel" oncomplete="getNavigationTreeData()">
							   					</a4j:jsFunction>
                               
											</div>
										</td>
										<td valign="top">
											
                     						<div class="add_section_title">
                       							<h:outputText value="To" />
                     						</div>
											<br></br>
										
											<h:inputTextarea id="toList" value="#{messagesBean.mailingList}" rows="50" cols="50" disabled="false"
												style="width:565px;height:150px;margin-left:10px;overflow-y:scroll" />
											<!-- type ahead -->
											<rich:suggestionbox for="toList" suggestionAction="#{messagesBean.findPeople}" 
												var="personName" tokens=";" ignoreDupResponses="true">
                              					<h:column><h:outputText value="#{personName}"/></h:column>
                            				</rich:suggestionbox>
                            				<!-- end type ahead -->
											<br></br>
											<br></br>		
																					
                     						<div class="add_section_title">
                       							<h:outputText value="Message" />
                     						</div>
											<br></br>
											
											<h:inputTextarea id="msgText" value="#{messagesBean.messageToSend}" 
												style="width:565px;height:90px;margin-left:10px" />
											<br></br>
											<br></br>									
											
											<h:panelGroup id="buttonPanel">
												<ul id="grid_nav_dark">

													<li class="r">
														<a4j:commandButton id="send" styleClass="left" action="#{messagesBean.sendMessage}" 
															reRender="#{context}-sendList,#{context}-sendListBottomScroller,display-form:toList,display-form:msgText"
															oncomplete="javascript:Richfaces.showModalPanel('summary')">
															<span class="email"><h:outputText 
																value="Send" /></span></a4j:commandButton>
													</li>
													
													<li class="r">
														<a4j:commandButton id="reset" styleClass="left" action="#{messagesBean.resetMailingList}" reRender="display-form:toList">
															<span class="refresh"><h:outputText 
																value="Reset" /></span></a4j:commandButton>
													</li>													
				
												</ul>
											</h:panelGroup>
										</td>
									</tr>

								</table>										
							</div>
						</div>
					
				
					<div class="panel_sw">
						<div class="panel_statusbar"></div>
					</div>
				</td>
			</tr>
			
		</table>	
			
		</a4j:form>
		
	</div>	
		
    <rich:modalPanel id="summary" headerClass="popupHeader" controlsClass="popupControls" 
    	width="500" height="140" autosized="true" resizeable="false" zindex="2001">
      	<f:facet name="header">
        	<h:outputText value="Summary of Message Send" />
      	</f:facet>
      	<f:facet name="controls">
        	<h:graphicImage value="/images/modal_close.png" style="cursor:pointer" onclick="Richfaces.hideModalPanel('summary')" />
      	</f:facet>

      	<div class="popupsubtitle"><h:outputText value="The following are the results of your message send." /></div>

      	<h:form id="confirmCloseSummary">
          									
        <rich:dataTable id="#{context}-sendList" value="#{messagesBean.sentMessages}" var="item"                                    	 
        	styleClass="datagrid filterabledatagrid" 
            rowClasses="tableOdd,tableEven" 
 			cellspacing="1" rows="5" width="100%">
 										 		
            <rich:column width="30%">
                <f:facet name="header">
                  	<h:outputText value="Entity"/>
                </f:facet>
                <h:outputText id="entity" value="#{item.entity}"/>
            </rich:column>
            
            <rich:column width="30%">
                <f:facet name="header">
                  	<h:outputText value="Date"/>
                </f:facet>
                <h:outputText id="date" value="#{item.sendDate}"/>
            </rich:column>
            
            <rich:column width="40%">
                <f:facet name="header">
                  	<h:outputText value="Result"/>
                </f:facet>
                <h:outputText id="result" value="#{item.result}"/>
            </rich:column>            
                              		
        </rich:dataTable>	
        
        <rich:datascroller for="#{context}-sendList" 
        	id="#{context}-sendListBottomScroller" page="#{messagesBean.pageNumber}">
        </rich:datascroller>
        
        <div class="popupactions">
          <button id="#{context}-confirmDeleteCancel" type="submit" class="left" onclick="Richfaces.hideModalPanel('summary'); return false;">
          	<span class="ok">
          		<h:outputText value="#{messages.button_ok}" />
          	</span>
          </button>
        </div>        

      </h:form>

    </rich:modalPanel>		
 	       
        </td>

      </tr>
    </table>
  </ui:define>

</ui:composition>
