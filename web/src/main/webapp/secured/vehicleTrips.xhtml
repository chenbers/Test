<ui:composition template="/layout/layout.xhtml" 
				xmlns="http://www.w3.org/1999/xhtml" 
				xmlns:ui="http://java.sun.com/jsf/facelets" 
				xmlns:h="http://java.sun.com/jsf/html"
			    xmlns:rich="http://richfaces.org/rich" 
			    xmlns:a4j="http://richfaces.org/a4j" 
			    xmlns:f="http://java.sun.com/jsf/core"
			    xmlns:t="http://myfaces.apache.org/tomahawk">

    <ui:define name="scripts">
        <script src="#{facesContext.externalContext.request.contextPath}/js/FusionCharts.js" type="text/javascript"></script>
        <script src="http://maps.google.com/maps?file=api&amp;v=#{gmBean.version}&amp;key=#{gmBean.key}&amp;hl=#{localeBean.locale.language}" type="text/javascript"></script>
        <script type="text/javascript">
		var map;
		var showWarnings = new Boolean(true);
		var showIdleMarkers = new Boolean(true);
		var baseIcon = new GIcon();
			baseIcon.iconSize = new GSize(21, 20);
			baseIcon.iconAnchor = new GPoint(6, 20);
			baseIcon.infoWindowAnchor = new GPoint(5, 1);
		var bounds = new GLatLngBounds();
		var mapNeedsInit = true;
		
		function initMap(lat,lng,zoom)
		{
   			if (GBrowserIsCompatible()) 
			{
		 	  	map = new GMap2(document.getElementById("map-canvas"));
				map.addControl(new GLargeMapControl());
				map.addControl(new GMapTypeControl());
				map.addControl(new GOverviewMapControl()); 
				map.setCenter(new GLatLng(lat, lng), zoom);
				map.setMapType(G_NORMAL_MAP);
				bounds = new GLatLngBounds();
			}
		}
			
	    function orderOfCreation(marker,b) 
	    {
	          return 1;
	    }	
	    
		function createMarker(point, divID, iconImage) 
        {
        	var markerIcon;
        	var marker;

			//Use passed in image.
        	if(iconImage != null)
        	{
				markerIcon = new GIcon(baseIcon);
	       	    markerIcon.image = iconImage;
	       	 	markerOptions = { icon:markerIcon,zIndexProcess:orderOfCreation };
	       	 	marker = new GMarker(point, markerOptions);
        	}
        	//Use default GoogleMap marker image.
        	else
        	{
		      	markerIcon = new GIcon();
				marker = new GMarker(point);
        	}
       
       		GEvent.addListener(marker, "click", function() {
					var node = document.getElementById(divID).cloneNode(true);
          			node.style.display = 'block';
		            marker.openInfoWindow(node);
		 			});

        	return marker;
        }
        
        function showInfoWindow(noteID, latLng)
        {
        	var node = document.getElementById(noteID).cloneNode(true);
  			node.style.display = 'block';

  			map.openInfoWindow(latLng, node);
        	
        }

	    // Show Warnings Checkbox changed   //TODO: CLEANER WAY TO DO THIS??
	    function showWarningsChanged()
	    {
	    	if(document.getElementById('showWarningsCheckBox').checked == true)
	    	{
				showWarnings = true;
				drawSelectedTrips();
	    	}
	    	else
	    	{
				showWarnings = false;
				drawSelectedTrips();
	    	}
		}

		// Show Idle Markers Checkbox changed
	    function showIdleChanged()
	    {
	      	if(document.getElementById('showIdleCheckBox').checked == true)
	    	{
	      		showIdleMarkers = true;
	      		drawSelectedTrips();
	    	}
	    	else
	    	{
	    		showIdleMarkers = false;
	    		drawSelectedTrips();
	    	}
		}

		//On page load and A4J Re-render
		function showTrips()
		{
			drawSelectedTrips();
		    map.setZoom(map.getBoundsZoomLevel(bounds));
		    map.setCenter(bounds.getCenter());
	    }

		var isReady;
		isReady = false;
		function dynamicTableStyles()
		{
			
			jQuery('#tripsTableForm\\:tripsTable tr').click(function(){
                			jQuery('#tripsTableForm\\:tripsTable tr').each(function() {
								jQuery(this).removeClass('selected-row');
								jQuery(this).children().removeClass('selected-row');
								
							});
							jQuery(this).addClass('selected-row');
							jQuery(this).children().addClass('selected-row');
			});
			
		}
		function onReRender()
		{
			isReady = true;
			dynamicTableStyles();
            jQuery('#tripsTableForm\\:tripsTable tr:eq(1)').click();
		}
		function onReRenderWithSelection()
		{	
			isReady = true;
			dynamicTableStyles();
		}
	    
		</script>

    <rich:panel id="script">
        <script type="text/javascript">
		
	    //Unload Google Map objects
		function bodyUnload()
		{
			GUnload();
		}	

		// This is called on pageLoad and A4J re-renders
		function bodyLoad()
		{
			initMap(#{vehicleTripsBean.selectedTrips[0].routeLastStep.lat}0, #{vehicleTripsBean.selectedTrips[0].routeLastStep.lng}0, 14);
	   		showTrips();
		}
		
   		function drawSelectedTrips()
   		{
				var polyline;
				var marker;
				var startlatlng;
				var endlatlng;

				map.clearOverlays();
				
   				<ui:repeat value="#{vehicleTripsBean.selectedTrips}" var="trip">
   				//alert('drawing selected trip #{trip.trip.startTime}');
					polyline = new GPolyline([
					<ui:repeat value="#{trip.route}" var="rt">
							new GLatLng(#{rt.lat}, #{rt.lng}),
					</ui:repeat>
			  				new GLatLng(#{trip.routeLastStep.lat}, #{trip.routeLastStep.lng})
					], "#0000ff", 6);
					map.addOverlay(polyline);

					<ui:repeat value="#{trip.route}" var="rt2">
						bounds.extend(new GLatLng(#{rt2.lat}, #{rt2.lng}));
					</ui:repeat>

					//Start of trip marker
					startlatlng = new GLatLng(#{trip.route[0].lat}, #{trip.route[0].lng});
					marker = createMarker(startlatlng, "#{trip.trip.startTime}_START", "#{facesContext.externalContext.request.contextPath}/images/ico_start.png");
					map.addOverlay(marker);
					bounds.extend(marker.getPoint());

					//End of trip marker
					endlatlng = new GLatLng(#{trip.routeLastStep.lat}, #{trip.routeLastStep.lng});
					marker = createMarker(endlatlng, "#{trip.trip.endTime}_END", "#{facesContext.externalContext.request.contextPath}/images/ico_end_trip.png");
					map.addOverlay(marker);
					bounds.extend(marker.getPoint());
  				</ui:repeat>

  				if(showWarnings == true)
				{
	  				var violation;
					<ui:repeat value="#{vehicleTripsBean.violationEvents}" var="vio">
						violation = new GLatLng(#{vio.event.latitude}, #{vio.event.longitude});
						map.addOverlay(createMarker(violation, "#{vio.event.noteID}", "#{facesContext.externalContext.request.contextPath}/images/ico_violation.png"));
					</ui:repeat>
				}

				var idleMarker;
				if(showIdleMarkers == true)
				{
					var idle;
					<ui:repeat value="#{vehicleTripsBean.idleEvents}" var="idle">
						idle = new GLatLng(#{idle.event.latitude}, #{idle.event.longitude});
						map.addOverlay(createMarker(idle, "#{idle.event.noteID}", "#{facesContext.externalContext.request.contextPath}/images/ico_idle.png"));
					</ui:repeat>
				}	
			}
		
   		
		</script>
    </rich:panel>

    </ui:define>
    <ui:param name="homeSelected" value="current" />
    <ui:param name="helpFile" value="Trips.htm" />

    <ui:define name="content">
        <t:saveState value="#{vehicleTripsBean.trips}" />
        <t:saveState value="#{vehicleTripsBean.numTrips}" />
        <t:saveState value="#{vehicleTripsBean.selectedDriver}" />
        <t:saveState value="#{vehicleTripsBean.idleEvents}" />
        <t:saveState value="#{vehicleTripsBean.violationEvents}" />
        <t:saveState value="#{vehicleTripsBean.allEvents}" />

        <rich:panel id="bubbles">
            <!-- BEGIN GOOGLE BUBBLES -->
            <ui:repeat value="#{vehicleTripsBean.selectedTrips}" var="trip">
                <ui:include src="/includes/tripBubble.xhtml">
                    <ui:param name="hiddenDivID" value="#{trip.trip.startTime}_START" />
                    <ui:param name="bubbleTitle" value="#{messages.TRIP_START}" />                  
                    <ui:param name="eventDateTime" value="#{trip.dateShort} #{trip.timeStartShort}" />
                    <ui:param name="dateFormatPattern" value="#{messages.dateTimeFormat}" />
                    <ui:param name="eventLocation" value="#{trip.startAddress}" />
                </ui:include>
                <ui:include src="/includes/tripBubble.xhtml">
                    <ui:param name="hiddenDivID" value="#{trip.trip.endTime}_END" />
                    <ui:param name="bubbleTitle" value="#{messages.TRIP_END}" />
                    <ui:param name="eventDateTime" value="#{trip.dateShort} #{trip.timeEndShort}" />
                    <ui:param name="dateFormatPattern" value="#{messages.dateTimeFormat}" />
                    <ui:param name="eventLocation" value="#{trip.endAddress}" />
                </ui:include>
            </ui:repeat>
            <ui:repeat value="#{vehicleTripsBean.allEvents}" var="evt">
                <ui:include src="/includes/eventBubble.xhtml">
                    <ui:param name="hiddenDivID" value="#{evt.event.noteID}" />
                    <ui:param name="eventType" value="#{evt.event.eventType}" />
                    <ui:param name="eventDateTime" value="#{evt.date}" />
                    <ui:param name="eventLocation" value="#{evt.event.addressStr}" />
                    <ui:param name="timeZoneObject" value="#{evt.timeZone}" />
                    <ui:param name="datePattern" value="#{messages.dateTimeFormat}" />
                    <ui:param name="eventSpeedLimit" value="#{evt.event.speedLimit}" />
                    <ui:param name="eventAvgSpeed" value="#{evt.event.avgSpeed}" />
                    <ui:param name="eventTopSpeed" value="#{evt.event.topSpeed}" />
                    <ui:param name="eventDistance" value="#{evt.event.distance}" />
                    <ui:param name="eventSpeed" value="#{evt.event.speed}" />
                    <ui:param name="eventSeverity" value="#{evt.event.severity}" />
                    <ui:param name="eventLowIdle" value="#{evt.event.lowIdleDuration}" />
                    <ui:param name="eventHighIdle" value="#{evt.event.highIdleDuration}" />
                </ui:include>
            </ui:repeat>
        </rich:panel>

        <!-- END GOOGLE BUBBLES -->

        <div id="wrapper"><h:form>
            <ul id="grid_nav">
                <li class="l grid_icon"><h:graphicImage value="/images/ico_line.png" /></li>
                <li class="l grid_title">#{messages.vehicletrip_title}:<h:commandLink action="go_vehicle" value=" #{navigationBean.vehicle.name}" /></li>
                <li class="l divider"><h:graphicImage value="/images/grid_nav_divider.png" /></li>

                <li class="l"><ui:include src="/includes/breadcrumb.xhtml">
                    <ui:param name="groupTreeNode" value="#{navigationBean.groupTreeNode}" />
                    <ui:param name="lastBreadCrumb" value="true" />
                </ui:include></li>

                <li class="l" style="margin-left: -15px;">
                <ul id="breadcrumb">
                    <li><h:commandLink action="go_vehicle" value="#{navigationBean.vehicle.name}" /></li>
                    <li class="last">#{messages.vehicletrip_trips}</li>
                </ul>
                </li>
            </ul>
        </h:form>
        <div class="spacer"></div>
        <table width="940" border="0" cellspacing="0" cellpadding="0" align="center">
            <tr>
                <td width="330" valign="top"><!-- START PANEL -->
                <div class=""><rich:panel id="date_picker_panel">
                    <a4j:region id="dateFormRegion">
                        <a4j:form id="dateForm">
                            <div class="panel_nw">
                            <div class="panel_title"><span class="cal">#{messages.vehicletrip_date_range}</span> <span class="panel_links"> <a4j:status id="dateFormStatus"
                                for="dateFormRegion">
                                <f:facet name="start">
                                    <h:outputText>
                                        <img src="#{facesContext.externalContext.request.contextPath}/images/progress2.gif" align="top" />&#160;</h:outputText>
                                </f:facet>
                            </a4j:status> </span></div>
                            </div>
                            <div class="panel_w">
                            <div class="panel_content">

                            <table width="320" cellpadding="4" cellspacing="0" class="" id="">
                                <tbody>
                                    <tr>
                                        <td width="80">#{messages.vehicletrip_start_date}</td>
                                        <td width="178"><a4j:outputPanel id="calendarStart" layout="block">
                                            <rich:calendar value="#{vehicleTripsBean.startDate}" locale="en/US" popup="true" immediate="true" datePattern="#{messages.dateFormat}"
                                               timeZone="#{vehicleTripsBean.timeZone}" showApplyButton="false" cellWidth="24px" cellHeight="22px" />
                                        </a4j:outputPanel></td>
                                        <td></td>
                                    </tr>
                                    <tr>
                                        <td>#{messages.vehicletrip_end_date}</td>
                                        <td><a4j:outputPanel id="calendarEnd" layout="block">
                                            <rich:calendar value="#{vehicleTripsBean.endDate}" locale="en/US" popup="true" immediate="true" datePattern="#{messages.dateFormat}"
                                               timeZone="#{vehicleTripsBean.timeZone}" showApplyButton="false" cellWidth="24px" cellHeight="22px" />
                                        </a4j:outputPanel></td>
                                        <td></td>
                                    </tr>
                                    <tr>
                                        <td></td>
                                        <td><a4j:commandButton action="#{vehicleTripsBean.DateChangedAction}"
                                            reRender="script,statsPanel,tripsPanel,bubbles,selectedTrip,selectedTripMap" immediate="false" styleClass="left"
                                            oncomplete="bodyLoad();">
                                            <span class="edit"> <h:outputText value="#{messages.vehciletrip_updateDateRange}" /> </span>
                                        </a4j:commandButton></td>
                                        <td></td>
                                    </tr>
                                </tbody>
                            </table>
                            </div>
                            </div>
                        </a4j:form>
                    </a4j:region>
                </rich:panel>

                <div class="panel_sw">
                <div class="panel_statusbar"></div>
                </div>
                </div>
                <!-- END PANEL -->

                <div class="spacer"></div>

                <!-- START PANEL --> <rich:panel id="statsPanel">
                    <div class="panel_nw">
                    <div class="panel_title">
                        <span class="">
                            <h:outputText style="" value="#{messages.vehicletrip_stats}: "/>
                            <h:outputText value="#{vehicleTripsBean.startDate}" rendered="#{not empty vehicleTripsBean.timeZone}">
                                <f:convertDateTime pattern="#{messages.dateFormat}" timeZone="#{vehicleTripsBean.timeZone}"  />
                            </h:outputText>
                            <h:outputText value=" #{messages.vehicletrip_to} "/>
                            <h:outputText value="#{vehicleTripsBean.endDate}" rendered="#{not empty vehicleTripsBean.timeZone}">
                                <f:convertDateTime pattern="#{messages.dateFormat}" timeZone="#{vehicleTripsBean.timeZone}" />
                            </h:outputText> 
                         </span> 
                         <span class="panel_links"></span></div>
                    </div>
                    <div class="panel_w">
                    <div class="panel_content">
                    <div class="" id="">
                    <table id="" cellpadding="4" cellspacing="0" class="">
                        <tbody>
                            <tr>
                                <td>#{messages.vehicletrip_total_drive_time}:</td>
                                <td><rich:spacer width="4" /></td>
                                <td><h:outputText>#{vehicleTripsBean.totalDriveTime}</h:outputText></td>
                            </tr>
                            <tr>
                                <td>#{messages.vehicletrip_total_miles_driven}:</td>
                                <td></td>
                                <td><h:outputText value="#{vehicleTripsBean.milesDriven}" converter="DistanceConverter" /></td>
                            </tr>
                            <tr>
                                <td>#{messages.vehicletrip_total_idle_time}:</td>
                                <td></td>
                                <td><h:outputText>#{vehicleTripsBean.idleTime}</h:outputText></td>
                            </tr>
                            <tr>
                                <td>#{messages.vehicletrip_total_trips}:</td>
                                <td></td>
                                <td><h:outputText>#{vehicleTripsBean.numTrips}</h:outputText></td>
                            </tr>
                            <tr>
                                <td valign="top">#{messages.vehicletrip_driver_timezone}:</td>
                                <td></td>
                                <td><h:outputText>#{vehicleTripsBean.displayTimeZone}</h:outputText></td>
                            </tr>
                        </tbody>
                    </table>
                    </div>
                    </div>
                    </div>
                    <div class="panel_sw">
                    <div class="panel_statusbar"></div>
                    </div>
                </rich:panel> <!-- END PANEL -->

                <div class="spacer"></div>

                <!-- START PANEL -->
                <div class="">
                <div class="panel_nw">
                <div class="panel_title"><span class="">#{messages.vehicletrip_events}</span> <span class="panel_links"></span></div>
                </div>
                <div class="panel_w">
                <div class="panel_content"><!-- Start Trip table --> <rich:panel id="selectedTrip">
                    <a4j:form>
                        <rich:dataTable value="#{vehicleTripsBean.allEvents}" id="selectedTripTable" var="item" styleClass="datatable" rowClasses="tableOdd,tableEven"
                            cellspacing="1" rows="5" width="100%" onRowClick="showInfoWindow('#{item.event.noteID}', new GLatLng(#{item.event.latitude}, #{item.event.longitude}));">

                            <!-- Data -->
                            <rich:column sortBy="#{item.event.addressStr}" style="cursor: pointer;">
                                <h:graphicImage value="/images/ico_idle.png" rendered="#{item.event.type eq 208}" title="#{messages[item.event.eventType]}" />
                                <h:graphicImage value="/images/ico_violation.png" rendered="#{item.event.type ne 208}" title="#{messages[item.event.eventType]}" />
                            </rich:column>

                            <rich:column sortBy="#{item.event.addressStr}" style="cursor: pointer;">
                                <f:facet name="header">
                                    <h:outputText value="#{messages.vehicletrip_event_address}" />
                                </f:facet>
                                <h:outputText value="#{item.event.addressStr}" />
                            </rich:column>

                            <rich:column sortBy="#{item.event.time}" style="cursor: pointer;">
                                <f:facet name="header">
                                    <h:outputText value="#{messages.vehicletrip_event_datetime}" />
                                </f:facet>

                                <h:outputText value="#{item.date}">
                                    <f:convertDateTime pattern="#{messages.dateTimeFormat}" timeZone="#{item.timeZone}" />
                                </h:outputText>

                            </rich:column>
                        </rich:dataTable>
                        
                        <rich:datascroller align="center" for="selectedTripTable" id="eventScroller" styleClass="dataScrollerSmall" maxPages="5" 
                        				   reRender="script,selectedTripTable" page="#{vehicleTripsBean.eventsPage}" />
                    </a4j:form>
                </rich:panel> <!-- End Trip table --></div>
                </div>
                <div class="panel_sw">
                <div class="panel_statusbar"></div>
                </div>
                </div>
                <!-- END PANEL -->

                <div class="spacer"></div>

                <!-- START PANEL -->
                <div class="">
                <div class="panel_nw">
                <div class="panel_title"><span class="">#{messages.vehicletrip_settings}</span> <span class="panel_links"></span></div>
                </div>
                <div class="panel_w">
                <div class="panel_content">
                <div class="" id=""><a4j:region id="optionsRegion">
                    <table width="320" cellpadding="4" cellspacing="0" class="" id="settings">
                        <tbody>
                            <tr>
                                <td width="290">#{messages.vehicletrip_last_ten_trips}</td>
                                <td width="25">
                                <a4j:status id="showLastTenStatus" for="optionsRegion">
                                    <f:facet name="start">
                                        <h:outputText>
                                            <img src="#{facesContext.externalContext.request.contextPath}/images/progress2.gif" align="top" />&#160;</h:outputText>
                                    </f:facet>
                                </a4j:status></td>
                                <td width="20"><a4j:form id="showLastTenForm" reRender="script,selectedTripMap,selectedTrip">
                                    <h:selectBooleanCheckbox id="showAllCheckBox" value="#{vehicleTripsBean.showLastTenTrips}">
                                        <a4j:support event="onclick" reRender="script,bubbles,selectedTrip" oncomplete="bodyLoad();" />
                                    </h:selectBooleanCheckbox>
                                </a4j:form></td>
                            </tr>
                            <tr>
                                <td>#{messages.vehicletrip_show_idle_marker}</td>
                                <td></td>
                                <td><h:selectBooleanCheckbox id="showIdleCheckBox" value="#{vehicleTripsBean.showIdleMarkers}" onclick="showIdleChanged();" /></td>
                            </tr>
                            <tr>
                                <td>#{messages.vehicletrip_show_warnings}</td>
                                <td></td>
                                <td><h:selectBooleanCheckbox id="showWarningsCheckBox" value="#{vehicleTripsBean.showWarnings}" onclick="showWarningsChanged();" /></td>
                            </tr>
                        </tbody>
                    </table>
                </a4j:region></div>
                </div>
                </div>
                <div class="panel_sw">
                <div class="panel_statusbar"></div>
                </div>
                </div>
                <!-- END PANEL -->

                <div class="spacer"></div>

                <!-- START PANEL -->
                <div class="">
                <div class="panel_nw">
                <div class="panel_title"><span class="">#{messages.vehicletrip_legend}</span> <span class="panel_links"></span></div>
                </div>
                <div class="panel_w">
                <div class="panel_content">
                <div class="" id="">
                <div class="" id="">
                <table width="320" id="legend" cellpadding="4" cellspacing="0">
                    <tbody>
                        <tr>
                            <td width="25"><img src="#{facesContext.externalContext.request.contextPath}/images/ico_start.png" width="21" height="20" /></td>
                            <td width="120">#{messages.vehicletrip_legend_start}</td>
                            <td width="30"><img src="#{facesContext.externalContext.request.contextPath}/images/ico_idle.png" width="20" height="20" /></td>
                            <td width="119">#{messages.vehicletrip_legend_engine_idle}</td>
                        </tr>
                        <tr>
                            <td><img src="#{facesContext.externalContext.request.contextPath}/images/ico_violation.png" width="20" height="20" /></td>
                            <td>#{messages.vehicletrip_legend_violation}</td>
                            <td><img src="#{facesContext.externalContext.request.contextPath}/images/ico_end_trip.png" width="21" height="20" /></td>
                            <td>#{messages.vehicletrip_legend_end}</td>
                        </tr>
                    </tbody>
                </table>
                </div>
                </div>
                </div>
                </div>
                <div class="panel_sw">
                <div class="panel_statusbar"></div>
                </div>
                </div>
                <!-- END PANEL --></td>
                <td width="10"><h:graphicImage value="/images/x.gif" width="10" /></td>
                <td width="600" valign="top">
                
                <!-- START PANEL -->
                <a4j:region>
                <div class="" style="width: 600px; margin: 0 auto 0 auto;">
                
                    <div class="panel_nw">
                        <div class="panel_title">
                            <h:outputText value="#{messages.drivertrip_trips_by} #{navigationBean.vehicle.fullName}" styleClass="vehicle" /> 
                            <span class="panel_links">
                                <a4j:status onstop="onReRenderWithSelection();">
                                    <f:facet name="start">
                                        <h:graphicImage value="/images/progress2.gif" style="padding-left: 10px" />
                                    </f:facet>
                                </a4j:status>
                            </span>
                        </div>
                    </div>
                    
                    <a4j:form id="tripsTableForm">
                    <div class="panel_w">
                    <rich:panel id="tripsPanel" bodyClass="panel_content" align="center">
                        <!-- Start Trip table -->
                        <rich:dataTable value="#{vehicleTripsBean.trips}" id="tripsTable" var="item" styleClass="datatable" rowClasses="tableOdd,tableEven" rows="4" width="100%">

                            <a4j:support event="onRowClick" reRender="script,bubbles,selectedTrip,showLastTenForm,selectDriverForm" oncomplete="bodyLoad();">
                                <f:setPropertyActionListener value="#{item}" target="#{vehicleTripsBean.selectedTrip}" />
                            </a4j:support>

                            <rich:column id="date_column" sortBy="#{item.trip.startTime}" label="#{messages.vehicletrip_date}" style="white-space:nowrap; cursor: pointer;">
                                <f:facet name="header">
                                    <h:outputText value="#{messages.vehicletrip_date}" />
                                </f:facet>
                                <h:outputText value="#{item.dateShort}" />
                            </rich:column>

                            <rich:column id="time_column" sortBy="#{item.trip.startTime}" label="#{messages.vehicletrip_time}" style="white-space:nowrap; cursor: pointer;">
                                <f:facet name="header">
                                    <h:outputText value="#{messages.vehicletrip_time}" />
                                </f:facet>
                                <h:outputText value="#{item.timeStartShort}" />
                                <br />
                                <h:outputText value="#{item.timeEndShort}" />
                            </rich:column>


                            <rich:column id="distance_column" sortBy="#{item.distance}" label="#{messages.vehicletrip_distance}" style="white-space:nowrap; cursor: pointer;">
                                <f:facet name="header">
                                    <h:outputText value="#{messages.vehicletrip_distance}" />
                                </f:facet>
                                <h:outputText value="#{item.distance} #{messages.mi_label}" />
                            </rich:column>

                            <rich:column id="end_column" sortBy="#{item.endAddress}" label="#{messages.vehicletrip_end_address}" style="cursor: pointer;">
                                <f:facet name="header">
                                    <h:outputText value="#{messages.vehicletrip_end_address}" />
                                </f:facet>
                                <h:outputText value="#{item.endAddress}" />
                            </rich:column>

                            <rich:column id="duration_column" sortBy="#{item.duration}" label="#{messages.vehicletrip_duration}" style="white-space:nowrap; cursor: pointer;">
                                <f:facet name="header">
                                    <h:outputText value="#{messages.vehicletrip_duration}" />
                                </f:facet>
                                <h:outputText value="#{item.duration}" />
                            </rich:column>
                        </rich:dataTable>
						<rich:spacer height="5" />
                        <rich:datascroller align="center" for="tripsTable" id="scroller" styleClass="dataScrollerSmall"
                        oncomplete="onReRender();" reRender="tripsTable" />

                        <rich:jQuery selector="document" query="ready(function(){onReRender()})" />
                        <!-- End Trip table -->
                    </rich:panel></div>
                </a4j:form>
                <div class="panel_sw">
                <div class="panel_statusbar"></div>
                </div>
                </div>
                </a4j:region>
                <!-- END PANEL -->

                <div class="spacer"></div>

                <!-- START PANEL -->
                <div class="" style="width: 600px; margin: 0 auto 0 auto;">
                <div class="panel_nw">
                <div class="panel_title">
                <h:form id="selectDriverForm">
                    <span class="map">
	                    <h:outputText value="">#{messages.vehicletrip_driver}</h:outputText><rich:spacer width="5" />
	                     <a4j:htmlCommandLink action="go_driver" value="#{vehicleTripsBean.selectedDriver.person.fullName}">
	                        <f:setPropertyActionListener value="#{vehicleTripsBean.selectedDriver}" target="#{navigationBean.driver}" />
	                    </a4j:htmlCommandLink>
                    </span>
                    <span class="panel_links"></span>
                </h:form></div>
                </div>
                <div class="panel_w"><rich:panel bodyClass="panel_content" id="selectedTripMap">
                    <h:outputText rendered="#{vehicleTripsBean.numTrips gt 0}">
                        <h:panelGroup styleClass="map-border" layout="block">
                            <div id="map-canvas" style="width: 588px; height: 400px; border: 0"></div>
                        </h:panelGroup>
                    </h:outputText>

                    <h:outputText rendered="#{vehicleTripsBean.numTrips lt 1}">
                        <h2>#{messages.no_trips_found}</h2>
                    </h:outputText>
                </rich:panel></div>
                <div class="panel_sw">
                <div class="panel_statusbar"></div>
                </div>
                </div>
                <!-- END PANEL --></td>
            </tr>
        </table>
        </div>
    </ui:define>

</ui:composition>
