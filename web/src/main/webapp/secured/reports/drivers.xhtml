<ui:composition template="/layout/layout.xhtml" 
              xmlns="http://www.w3.org/1999/xhtml" 
              xmlns:ui="http://java.sun.com/jsf/facelets"
              xmlns:h="http://java.sun.com/jsf/html"
              xmlns:rich="http://richfaces.org/rich"
              xmlns:a4j="http://richfaces.org/a4j"
              xmlns:f="http://java.sun.com/jsf/core"
              xmlns:security="http://pro.tiwi.com/jsf/security"
              xmlns:pretty="http://ocpsoft.com/prettyfaces">

	 
              
	<ui:param name="reportsSelected" value="current" />
	<ui:param name="driversSelected" value="current" />
	<ui:param name="helpFile" value="Drivers.htm" />
    <ui:param name="ajaxPanels" value="outerDriverReport" />

	<ui:define name="subnavigation">
		<ui:include src="/includes/reports/subNavigation.xhtml" />
	</ui:define>
	
	<ui:define name="content">
		

			<table width="940" border="0" cellspacing="0" cellpadding="0" align="center" style="margin: 0 auto 0 auto;">
				<tr>
					<td valign="top">
												
							<div class="">
								<div class="panel_nw">
									<div class="panel_title">
										<span class="driver">#{messages.reports_driverreporttitle}</span>
										<span class="panel_links">#{messages.reports_driverreport_note}</span>
									</div>
								</div>
									
									<div class="panel_w">
									<div class="panel_content">		
									
									<a4j:form id="outerDriverReport">	
									
										<ui:include src="/includes/redFlagsCount.xhtml" />	
																										
										<ul id="grid_nav" style="margin: 0;">            							
            								<li class="l">
              									<table border="0" cellspacing="0" cellpadding="4" id="grid_nav_search_box">
                									<tr>
                  										<td>
                  											<h:outputText value="#{messages.button_search}" />
                  										</td>
                  										<td>
                    										<h:inputText id="filterTable" value="#{searchCoordinationBean.searchFor}" class="text" size="25" onkeypress="if (event &amp;&amp; event.keyCode == 13) { document.getElementById('outerDriverReport:searchButton').onclick(); return false; } return true;" />
                  										</td>
                									</tr>
              									</table>
            								</li>
            								<li class="l">
            									<a4j:commandButton id="searchButton" action="#{driverReportBean.doSearch}" 
            										reRender="navigation:redirectSearch,headerRedCount,items,topScroller,bottomScroller,headerDrivers" styleClass="left">
            											<span class="search">
            												<h:outputText value="#{messages.button_search}" />
            											</span>
            									</a4j:commandButton>            								
            								</li>
            								<li class="l text">
            									<a4j:commandLink 
            										reRender="editColumnsForm:editColumnGrid"
            										action="#"
            									 	styleClass="ls_tab_edit_columns"
            										onclick="Richfaces.showModalPanel('editColumns');">            									
            										<h:outputText value="#{messages.button_editColumns}" />
            									</a4j:commandLink>
            								</li> 
            								<li class="r grid_icon">
            									<h:panelGroup id="driverReportToolImageId">
													<h:graphicImage value="/images/ico_tools.png"/>
												</h:panelGroup>
											</li>
											<li class="r divider"><img src="#{facesContext.externalContext.request.contextPath}/images/grid_nav_divider.png" />
											</li> 
            								     							
          								</ul>		
                                 
                                  <div align="right" style="width: 100%"> 
                                     <h:outputFormat id="headerDrivers" value="#{messages.recordCountHeader}">
										<a4j:actionparam value="#{driverReportBean.start}"/>
										<a4j:actionparam value="#{driverReportBean.end}"/>
										<a4j:actionparam value="#{driverReportBean.maxCount}"/>
									</h:outputFormat>   
                                  </div>																															
									
								<rich:contextMenu event="onclick" attachTiming="onavailable"
									disableDefaultMenu="false" submitMode="server"
									attachTo="driverReportToolImageId">
									<rich:menuItem ajaxSingle="true" rendered="true"
													iconDisabled="/images/ico_email.gif" 
													icon="/images/ico_email.gif" 
													onclick="Richfaces.showModalPanel('driverReportEmailModal');return false;"
													value="#{messages.contextMenu_email_this_report}" id="emailMenuItem" submitMode="none">
									</rich:menuItem>
			
									<rich:menuItem ajaxSingle="true"
										iconDisabled="/images/ico_pdf.gif" icon="/images/ico_pdf.gif"
										value="Export To PDF"
										action="#{driverReportBean.exportReportToPdf}"
										id="export_menu_item">
									</rich:menuItem>
									<rich:menuItem ajaxSingle="true"
										iconDisabled="/images/ico_excel.png" icon="/images/ico_excel.png"
										value="Export To Excel"
										action="#{driverReportBean.exportReportToExcel}"
										id="exportExcelMEnuItem">
									</rich:menuItem>
								</rich:contextMenu>
                                <div class="spacer"></div>
                                <rich:datascroller id="topScroller" for="items"  styleClass="datascroller"
                                      immediate="true" scrollerListener="#{driverReportBean.scrollerListener}" 
                                      reRender="bottomScroller,items,headerDrivers"
                                      requestDelay="200" eventsQueue="pagerQueue"
                                      page="#{driverReportBean.page}">
                                 </rich:datascroller> 
                             
                                <div class="datagrid_panel" style="width: 925px;">

                                    <rich:dataTable value="#{driverReportBean.driverData}" 
                                         id="items" 
                                         var="item" 
                                         styleClass="datagrid" 
                                         rowClasses="tableOdd,tableEven" 
                                         rows="#{driverReportBean.numRowsPerPg}" >
                                
                                        <rich:column rendered="#{driverReportBean.tableColumns['group'].visible}" sortBy="#{item.group}">
                                            <f:facet name="header">
                                                <h:outputText value="#{messages.reports_group}" />
                                            </f:facet>
                                            <pretty:link mappingId="dashboard">
                                                <h:outputText value="#{item.group}"/>
                                                <f:param value="#{item.groupID}"/>
                                            </pretty:link> 
                                        </rich:column>
                                        <rich:column rendered="#{driverReportBean.tableColumns['driver_person_empid'].visible}" sortBy="#{item.driver.person.empid}">
                                            <f:facet name="header">
                                                <h:outputText value="#{messages.reports_empID}" />
                                            </f:facet>
                                            <h:outputText value="#{item.driver.person.empid}" />
                                        </rich:column>
                                        <rich:column rendered="#{driverReportBean.tableColumns['driver_person_fullName'].visible}" sortBy="#{item.driver.person.first}">
                                            <f:facet name="header">
                                                <h:outputText value="#{messages.reports_driver}" />
                                            </f:facet>
                                            <pretty:link mappingId="driverPerformance">
                                                <h:outputText value="#{item.driver.person.fullName}"/>
                                                <f:param value="#{item.driver.driverID}"/>
                                            </pretty:link>
                                        
                                        </rich:column>
                                        <rich:column rendered="#{driverReportBean.tableColumns['vehicle_name'].visible}" sortBy="#{item.vehicle.name}">
                                            <f:facet name="header">
                                                <h:outputText value="#{messages.reports_vehicle}" />
                                            </f:facet>
                                            <pretty:link mappingId="vehiclePerformance" rendered="#{item.vehicle ne null}">
                                                <h:outputText value="#{item.vehicle.name}"/>
                                                <f:param value="#{item.vehicle.vehicleID}"/>
                                            </pretty:link>
                                            
                                            <h:outputText rendered="#{item.vehicle eq null}" value="#{messages.reports_none_assigned}" />
                                        </rich:column>
                                        <rich:column rendered="#{driverReportBean.tableColumns['distanceDriven'].visible}" sortBy="#{item.milesDriven}">
                                            <f:facet name="header">
                                                <h:outputText value="#{messages.reports_distanceDriven}"/>
                                            </f:facet>
                                            <h:outputFormat value="#{messages.reports_distanceDrivenInUnits}" >
                                                <a4j:actionparam value="#{item.milesDriven}" converter="MilesToKilometersConverter"/>
                                                <a4j:actionparam value="mi" converter="MeasurementTextConverter"/>
                                            </h:outputFormat>
                                        </rich:column>
                                        <rich:column rendered="#{driverReportBean.tableColumns['overallScore'].visible}" sortBy="#{item.overallScore}">
                                            <f:facet name="header">
                                                <h:outputText value="#{messages.reports_overall}" />
                                            </f:facet>                       
                                            <ui:include src="/includes/scoreBox.xhtml">
                                                    <ui:param name="score" value="#{item.overallScore}" />
                                                    <ui:param name="scoreStyle" value="#{item.styleOverall}" /> 
                                                    <ui:param name="item" value="#{item.driver.driverID}" /> 
                                                    <ui:param name="scoreMappingId" value="driverPerformance"/>
                                            </ui:include> 
                                        </rich:column>
                                        <rich:column rendered="#{driverReportBean.tableColumns['speedScore'].visible}" sortBy="#{item.speedScore}">
                                            <f:facet name="header">
                                                <h:outputText value="#{messages.reports_speed}" />
                                            </f:facet>                               
                                            <ui:include src="/includes/scoreBox.xhtml">
                                                    <ui:param name="score" value="#{item.speedScore}" />
                                                    <ui:param name="scoreStyle" value="#{item.styleSpeed}" /> 
                                                    <ui:param name="item" value="#{item.driver.driverID}" /> 
                                                    <ui:param name="scoreMappingId" value="driverPerformanceSpeed"/>
                                            </ui:include> 
                                        </rich:column>
                                        <rich:column rendered="#{driverReportBean.tableColumns['styleScore'].visible}" sortBy="#{item.styleScore}">
                                            <f:facet name="header">
                                                <h:outputText value="#{messages.reports_style}" />
                                            </f:facet>                     
                                            <ui:include src="/includes/scoreBox.xhtml">
                                                    <ui:param name="score" value="#{item.styleScore}" />
                                                    <ui:param name="scoreStyle" value="#{item.styleStyle}" /> 
                                                    <ui:param name="item" value="#{item.driver.driverID}" />  
                                                    <ui:param name="scoreMappingId" value="driverPerformanceStyle"/>
                                            </ui:include> 
                                        </rich:column>
                                        <rich:column rendered="#{driverReportBean.tableColumns['seatBeltScore'].visible}" sortBy="#{item.seatBeltScore}">
                                            <f:facet name="header">
                                                <h:outputText value="#{messages.reports_seatbelt}" />
                                            </f:facet>      
                                            <ui:include src="/includes/scoreBox.xhtml">
                                                    <ui:param name="score" value="#{item.seatBeltScore}" />
                                                    <ui:param name="scoreStyle" value="#{item.styleSeatBelt}" /> 
                                                    <ui:param name="item" value="#{item.driver.driverID}" /> 
                                                    <ui:param name="scoreMappingId" value="driverPerformanceSeatBelt"/>
                                            </ui:include> 
                                        </rich:column>
                                    </rich:dataTable> 
                                </div>
                                <div class="spacer"></div>
                                <rich:datascroller id="bottomScroller" 
                                          for="items" immediate="true" 
                                          scrollerListener="#{driverReportBean.scrollerListener}" 
                                          eRender="topScroller,items,headerDrivers"
                                          requestDelay="200" eventsQueue="pagerQueue" 
                                          page="#{driverReportBean.page}"
                                          styleClass="datascroller">
                                    </rich:datascroller>
                                
                                
    							</a4j:form>
								<ui:include src="/includes/editColumnsPopup.xhtml">
									<ui:param name="bean" value="#{driverReportBean}"/>	
									<ui:param name="reRender" value="outerDriverReport:items" />
								</ui:include>    
								
								</div>
								</div>
														
    					    	<div class="panel_sw">
									<div class="panel_statusbar"></div>
								</div>
							</div>
														
					</td>
				</tr>
			</table>
		
		<h:outputText id="driver_email_modalPanel">
			<ui:include src="/includes/emailReportPopup.xhtml">	
				<ui:param  name="id" value="driverReportEmailModal" />
				<ui:param  name="reportBean" value="#{driverReportBean}"/>
			</ui:include>
		</h:outputText>
		

	</ui:define>
	
</ui:composition>
