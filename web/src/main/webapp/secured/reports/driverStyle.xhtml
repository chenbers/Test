<ui:composition template="/layout/layout.xhtml" 
				xmlns="http://www.w3.org/1999/xhtml" 
				xmlns:ui="http://java.sun.com/jsf/facelets"
  				xmlns:h="http://java.sun.com/jsf/html" 
  				xmlns:rich="http://richfaces.org/rich"
  				xmlns:a4j="http://richfaces.org/a4j"
  				xmlns:f="http://java.sun.com/jsf/core"
  				xmlns:t="http://myfaces.apache.org/tomahawk">

	<ui:define name="scripts">
		<script src="#{facesContext.externalContext.request.contextPath}/js/FusionCharts.js" type="text/javascript"></script>	
		<script src="http://maps.google.com/maps?file=api&amp;v=2&amp;key=#{gmBean.key}" type="text/javascript"></script>
	    <script type="text/javascript">
	      function initialize(lat, lng) 
	      {
	        if (GBrowserIsCompatible())
		        {
					var map = new GMap2(document.getElementById("location-canvas"));
					var location = new GLatLng(lat, lng)
					map.setCenter(location, 15);
					map.addOverlay(new GMarker(location)); 
	        	}
	      }
    	</script>
	</ui:define>

	<ui:param name="reportsSelected" value="current" />
	
	<t:saveState value="#{driverStyleBean.styleEvents}"/>
	
	<ui:define name="content">
<div id="wrapper">

<h:form>
	<ul id="grid_nav">
		<li class="l grid_icon"><h:graphicImage value="/images/ico_line.png" /></li>
		<li class="l grid_title">Driver Performance:&#160;<h:commandLink action="go_driver" value="#{navigationBean.driver.person.fullName}" /></li>
		<li class="l divider"><h:graphicImage value="/images/grid_nav_divider.png" /></li>
		
		<li class="l">
			<ui:include src="/includes/breadcrumb.xhtml">
				<ui:param name="groupTreeNode" value="#{navigationBean.groupTreeNode}" />
				<ui:param name="lastBreadCrumb" value="true" />
			</ui:include>
		</li>
		
		<li class="l" style="margin-left: -15px;">
			<ul id="breadcrumb">
				<li><h:commandLink action="go_driver" value="#{navigationBean.driver.person.fullName}" /></li>
				<li class="last">Driving Style</li>
			</ul>
		</li>
	</ul>
</h:form>

<script type="text/javascript">

//Set default selected box.
var selected = 'OVERALL';

	function SelectBreakDown(region, chartVar)
	{
		//Un-Select last component in CSS.
		document.getElementById(selected).className="tiny_chart";
		
		//remember current selected region.
		selected = region;
		
		//change style to new selected region.
		document.getElementById(region).className="tiny_selected";
		
		//resize chart and render it in the top box.
		//chartVar.attributes.width = 650;
		//chartVar.attributes.height = 200;

		//turn on X and Y axis labels.
		var data = chartVar.variables.dataXML;
	    data = data.replace("showLabels=\'0\'", "showLabels=\'1\'");
	    data = data.replace("showYAxisValues=\'0\'", "showYAxisValues=\'1\'");
		
	    overallChart.setDataXML(data);
		
		//chartVar.render('overall_chart');
	}
</script>

<table width="940" border="0" cellspacing="0" cellpadding="0" align="center" class="dash_table">
  <tr>
    <td colspan="3" valign="top">
		<!-- START PANEL -->
			<div class="">
				<div class="panel_nw">
					<div class="panel_title">
						<span class="vehicle">Driving Style</span>
							<a4j:region id="dateLinksForm_region">
							<a4j:form id="dateLinksForm">
							<span class="panel_links">
								<a4j:status id="dateLinksStatus" for="dateLinksForm_region">
									<f:facet name="start">
										<h:outputText><img src="#{facesContext.externalContext.request.contextPath}/images/progress2.gif" align="top" />&#160;</h:outputText>
									</f:facet>
								</a4j:status>
								<rich:spacer width="10" />
								<a4j:commandLink title="#{messages.duration_days}" immediate="true"
									styleClass="#{(driverStyleBean.duration eq 'DAYS') ? 'on' : ''}"		
									reRender="dateLinksForm,overallPanel,breakdown_panel,eventsTable"
									value="#{messages.duration_days}">
									<a4j:actionparam name="duration" assignTo="#{driverStyleBean.duration}"	value="DAYS" />
								</a4j:commandLink>
								<rich:spacer width="5"></rich:spacer>
								<a4j:commandLink title="#{messages.duration_three}" immediate="true"
									styleClass="#{(driverStyleBean.duration eq 'THREE') ? 'on' : ''}"	
									reRender="dateLinksForm,overallPanel,breakdown_panel,eventsTable"
									value="#{messages.duration_three}">
									<a4j:actionparam name="duration" assignTo="#{driverStyleBean.duration}"	value="THREE" />
								</a4j:commandLink>
								<rich:spacer width="5"></rich:spacer>
								<a4j:commandLink title="#{messages.duration_six}" immediate="true"
									styleClass="#{(driverStyleBean.duration eq 'SIX') ? 'on' : ''}"	
									reRender="dateLinksForm,overallPanel,breakdown_panel,eventsTable"
									value="#{messages.duration_six}">
									<a4j:actionparam name="duration" assignTo="#{driverStyleBean.duration}"	value="SIX" />
								</a4j:commandLink>
								<rich:spacer width="5"></rich:spacer>
								<a4j:commandLink title="#{messages.duration_twelve}" immediate="true"
									styleClass="#{(driverStyleBean.duration eq 'TWELVE') ? 'on' : ''}"	
									reRender="dateLinksForm,overallPanel,breakdown_panel,eventsTable"
									value="#{messages.duration_twelve}">
									<a4j:actionparam name="duration" assignTo="#{driverStyleBean.duration}"	value="TWELVE" />
								</a4j:commandLink>
								</span>
							</a4j:form>
							</a4j:region>
					</div>
				</div>
				<div class="panel_w">
				  <rich:panel bodyClass="panel_content" id="overallPanel" border="0">
				  <table width="920" border="0" cellspacing="0" cellpadding="0" align="center" style="margin: 10px auto 0 auto;">
					  <tr>
						<td valign="top" width="600">
						   <ui:include src="../../includes/lineChart.xhtml">
						            <ui:param name="lineChartDef" value="#{driverStyleBean.styleScoreHistoryOverall}" />
						            <ui:param name="hiddenFieldID" value="HiddenField" />
						            <ui:param name="width" value="650" /> 
						            <ui:param name="height" value="200" />  
						            <ui:param name="tartgetElementVar" value="targetElement" />
						            <ui:param name="ChartDivID" value="overall_chart" />
						            <ui:param name="chartVar" value="overallChart" />
							</ui:include>
						</td>
						<td valign="top" align="right">
							<table width="220" border="0" cellspacing="0" cellpadding="0" class="scorebox" style="margin: 20px 20px 0 0;">
							  <tr>
								<td>
									<h4>Overall Score</h4>
									<div style="margin-top: 8px;"><a href="#" class="ls_tab_email">E-mail</a></div>
								</td>
								<td width="80" align="center">
									<ui:include src="../../includes/scoreBox.xhtml">
								            <ui:param name="score" value="#{driverStyleBean.styleScoreOverall}" />
								            <ui:param name="scoreStyle" value="#{driverStyleBean.styleScoreOverallStyle}" />
									</ui:include>
								</td>
							  </tr>
							</table>
						</td>
					  </tr>
					</table>
				  
				  </rich:panel>
				</div>
				<div class="panel_sw">
					<div class="panel_statusbar"></div>
				</div>
			</div>
			<div class="spacer"></div>
		<!-- END PANEL -->
	</td>
    </tr>
  <tr>
    <td colspan="3" valign="top"><h:graphicImage value="/images/x.gif" width="10" height="10" /></td>
    </tr>
  <tr>
    <td width="465" valign="top">
<!-- END PANEL -->
	</td>
    </tr>
  <tr>
    <td colspan="3" valign="top"><h:graphicImage value="/images/x.gif" width="10" height="10" /></td>
    </tr>
  <tr>
    <td width="465" valign="top">
		<!-- START PANEL -->
			<div class="" style="width: 938px;">
				<div class="panel_nw">
					<div class="panel_title">
						<span class="vehicle">Breakdown by Driving Style</span>
						<span class="panel_links"></span></div>
				</div>
				<div class="panel_w">
				  <rich:panel bodyClass="panel_content" id="breakdown_panel" border="0">
					<table width="920" border="0" cellspacing="0" cellpadding="0" align="center" style="margin: 10px auto 0 auto;">
					  <tr>
					    <td id="OVERALL" valign="top" class="tiny_selected">
						  <div class="tiny_title">
							  <a href="#" onclick="SelectBreakDown('OVERALL', overallChart2)">Overall</a>
						  </div>
							<table width="300" border="0" cellspacing="0" cellpadding="0">
							  <tr>
								<td>
									<ui:include src="../../includes/lineChart.xhtml">
								            <ui:param name="lineChartDef" value="#{driverStyleBean.styleScoreHistoryOverall}" />
								            <ui:param name="hiddenFieldID" value="HiddenOverall" />
								            <ui:param name="width" value="220" /> 
								            <ui:param name="height" value="90" />  
								            <ui:param name="tartgetElementVar" value="targetElement1" />
								            <ui:param name="ChartDivID" value="style_chart_tiny_overall" />
								            <ui:param name="chartVar" value="overallChart2" />
								            <ui:param name="disableLabels" value="true" />
									</ui:include>
								</td>
								<td align="center">
									<ui:include src="../../includes/scoreBox.xhtml">
								            <ui:param name="score" value="#{driverStyleBean.styleScoreOverall}" />
								            <ui:param name="scoreStyle" value="#{driverStyleBean.styleScoreOverallStyle}" /> 
									</ui:include>
								</td>
							  </tr>
							</table>
						</td>
					    <td id="BRAKE" valign="top" class="tiny_chart">
							<div class="tiny_title">
								<a href="#" onclick="SelectBreakDown('BRAKE', chartBrake)">Hard Brake</a>
							</div>
							<table width="300" border="0" cellspacing="0" cellpadding="0">
							  <tr>
								<td>
									<ui:include src="../../includes/lineChart.xhtml">
									            <ui:param name="lineChartDef" value="#{driverStyleBean.styleScoreHistoryBrake}" />
									            <ui:param name="hiddenFieldID" value="HiddenBRAKE" />
									            <ui:param name="width" value="220" /> 
									            <ui:param name="height" value="90" />  
									            <ui:param name="tartgetElementVar" value="targetElementBrake" />
									            <ui:param name="ChartDivID" value="style_chart_tiny_brake" />
									            <ui:param name="chartVar" value="chartBrake" />
									            <ui:param name="disableLabels" value="true" />
									</ui:include>
								</td>
								<td align="center">
								<ui:include src="../../includes/scoreBox.xhtml">
								            <ui:param name="score" value="#{driverStyleBean.styleScoreBrake}" />
								            <ui:param name="scoreStyle" value="#{driverStyleBean.styleScoreBrakeStyle}" /> 
									</ui:include>
								</td>
							  </tr>
							</table>
						</td>
					    <td id="ACCELERATE" valign="top" class="tiny_chart">
							<div class="tiny_title">
								<a href="#" onclick="SelectBreakDown('ACCELERATE', chartAccel)">Hard Accelerate</a></div>
							<table width="300" border="0" cellspacing="0" cellpadding="0">
							  <tr>
								<td>
									<ui:include src="../../includes/lineChart.xhtml">
								            <ui:param name="lineChartDef" value="#{driverStyleBean.styleScoreHistoryAccel}" />
								            <ui:param name="hiddenFieldID" value="HiddenACCEL" />
								            <ui:param name="width" value="220" /> 
								            <ui:param name="height" value="90" />  
								            <ui:param name="tartgetElementVar" value="targetElementAccel" />
								            <ui:param name="ChartDivID" value="style_chart_tiny_Accel" />
								            <ui:param name="chartVar" value="chartAccel" />
								            <ui:param name="disableLabels" value="true" />
									</ui:include>
									</td>
									<td align="center">
									<ui:include src="../../includes/scoreBox.xhtml">
								            <ui:param name="score" value="#{driverStyleBean.styleScoreAccel}" />
								            <ui:param name="scoreStyle" value="#{driverStyleBean.styleScoreAccelStyle}" /> 
									</ui:include>
								</td>
							  </tr>
							</table>
						</td>
				      </tr>
					  <tr>
						<td id="TURN" valign="top" class="tiny_chart">
							<div class="tiny_title">
							<a href="#" onclick="SelectBreakDown('TURN', chartTurn)">Hard Turn</a></div>
							<table width="300" border="0" cellspacing="0" cellpadding="0">
							  <tr>
								<td>
									<ui:include src="../../includes/lineChart.xhtml">
								            <ui:param name="lineChartDef" value="##{driverStyleBean.styleScoreHistoryTurn}" />
								            <ui:param name="hiddenFieldID" value="HiddenTURN" />
								            <ui:param name="width" value="220" /> 
								            <ui:param name="height" value="90" />  
								            <ui:param name="tartgetElementVar" value="targetElementTurn" />
								            <ui:param name="ChartDivID" value="style_chart_tiny_turn" />
								            <ui:param name="chartVar" value="chartTurn" />
								            <ui:param name="disableLabels" value="true" />
									</ui:include>
								</td>
								<td align="center">
									<ui:include src="../../includes/scoreBox.xhtml">
								            <ui:param name="score" value="#{driverStyleBean.styleScoreTurn}" />
								            <ui:param name="scoreStyle" value="#{driverStyleBean.styleScoreTurnStyle}" /> 
									</ui:include>
								</td>
							  </tr>
							</table>
						</td>
						
					    <td id="BUMP" valign="top" class="tiny_chart">
							<div class="tiny_title">
							<a href="#" onclick="SelectBreakDown('BUMP', chartBump)">Hard Bump</a></div>
							<table width="300" border="0" cellspacing="0" cellpadding="0">
							  <tr>
								<td>
									<ui:include src="../../includes/lineChart.xhtml">
								            <ui:param name="lineChartDef" value="#{driverStyleBean.styleScoreHistoryBump}" />
								            <ui:param name="hiddenFieldID" value="HiddenBUMP" />
								            <ui:param name="width" value="220" /> 
								            <ui:param name="height" value="90" />  
								            <ui:param name="tartgetElementVar" value="targetElementBump" />
								            <ui:param name="ChartDivID" value="style_chart_tiny_bump" />
								            <ui:param name="chartVar" value="chartBump" />
								            <ui:param name="disableLabels" value="true" />
									</ui:include>
								</td>
								<td align="center">
									<ui:include src="../../includes/scoreBox.xhtml">
								            <ui:param name="score" value="#{driverStyleBean.styleScoreBump}" />
								            <ui:param name="scoreStyle" value="#{driverStyleBean.styleScoreBumpStyle}" /> 
									</ui:include>
								</td>
							  </tr>
							</table>
						</td>
					  </tr>
					</table>
				  </rich:panel>
				</div>
				<div class="panel_sw">
					<div class="panel_statusbar"></div>
				</div>
			</div>
		<!-- END PANEL -->
		<div class="spacer"></div>
		
		<!-- START PANEL -->
			<div class="" style="width: 938px;">
				<div class="panel_nw">
					<div class="panel_title">
						<span class="details">Details</span>
						<span class="panel_links"></span>
					</div>
				</div>
				<div class="panel_w">
				  <div class="panel_content">
				     

			<div class="datagrid">
				<!-- Start Event table --> 
					<h:form id="eventTable">
					<rich:datascroller align="center" for="items" immediate="true"
							id="scrollerTop" reRender="items,scrollerBottom" />
						<rich:dataTable value="#{driverStyleBean.styleEvents}" 
						id="items" var="item" styleClass="datagrid"
						rowClasses="tableOdd,tableEven" cellspacing="1" 
						rows="10" width="100%">
						
							<rich:column>
								<f:facet name="header">
									<h:outputText value="Location" />
								</f:facet>
								<div class="maplink">
					              <a4j:commandLink style="cursor:pointer">
						                <rich:componentControl for="eventLocationModal" event="onclick" disableDefault="true" operation="show">
						                  <f:param name="lat" value="#{item.latitude}"/>
						                  <f:param name="lng" value="#{item.longitude}"/>
						                </rich:componentControl>
						                		#{item.addressStr}<br />
					              </a4j:commandLink>
				              	</div>
				            </rich:column>
							
							<rich:column sortBy="#{item.time}">
								<f:facet name="header">
									<h:outputText value="Date/Time" />
								</f:facet>
									<h:outputText value="#{item.time}">
										<f:convertDateTime pattern="MMM DD yyyy hh:mm a"/>
									</h:outputText>
							</rich:column>
							
							<rich:column sortBy="#{item.eventType}">
								<f:facet name="header">
									<h:outputText value="Event" />
								</f:facet>
								<strong><h:outputText value="#{item.eventType}" /></strong>		
							</rich:column>
							
							<rich:column sortBy="#{item.avgSpeed}">
								<f:facet name="header">
									<h:outputText value="Avg Speed" />
								</f:facet>
								<strong><h:outputText value="#{item.avgSpeed} #{messages.measurement_speed}" /></strong>
							</rich:column>
							
							<rich:column sortBy="#{item.severity}">
								<f:facet name="header">
									<h:outputText value="Severity" />
								</f:facet>
								<div class="#{(item.severity gt 65) ? 'sev_bar_ex' : ''}
											#{(item.severity lt 66) and (item.severity gt 32) ? 'sev_bar_med' : ''}
											#{(item.severity lt 33) ? 'sev_bar_low' : ''}"></div>
							</rich:column>
							
							<rich:column>
								<f:facet name="header">
									<h:outputText value="" />
								</f:facet>
								<a href="#">clear</a>
							</rich:column>
							
						</rich:dataTable>
						
						<rich:datascroller align="center" for="items" immediate="true"
							id="scrollerBottom" reRender="items,scrollerTop" />
					</h:form> 
				<!-- End Event table -->
				</div>
				</div>
				</div>
			</div>
		</td>
    </tr>
</table>
 </div>
				
<div class="panel_sw">
	<div class="panel_statusbar"></div>
</div>

<rich:modalPanel id="eventLocationModal" width="540" height="450" headerClass="popupHeader" onshow="initialize(event.parameters.lat, event.parameters.lng);" onhide="GUnload()">
	<f:facet name="header">
    	<h:outputText value="Event Location" />
    </f:facet>
    <f:facet name="controls">
    	<h:graphicImage value="/images/modal_close.png" style="cursor:pointer" onclick="Richfaces.hideModalPanel('eventLocationModal')" />
    </f:facet>

    <div class="eventmap-border">
    	<div id="location-canvas" style="width: 522px; height: 355px; border: 0"></div>
    </div>

    <div class="popupactions">
    	<a4j:commandButton value="#{messages.button_close}" onclick="Richfaces.hideModalPanel('eventLocationModal')" styleClass="left">
   			<span class="edit">
   				<h:outputText value="#{messages.button_close}" />
   			</span>
	 	</a4j:commandButton>
    </div>
</rich:modalPanel>

</ui:define>
</ui:composition>