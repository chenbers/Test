<html xmlns="http://www.w3.org/1999/xhtml"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:c="http://java.sun.com/jstl/core"
    xmlns:a4j="http://richfaces.org/a4j"
    xmlns:rich="http://richfaces.org/rich">

<!--
	Common code for driver/vehicle performance details pages.
	
-->
<ui:composition>
	
		<ui:include src="/includes/mapv3/portalMap.xhtml"/>

	    <script type="text/javascript">
	    
	    (function($){ 

	    	$.fn.refreshTable = function(index, refreshSpeed){
	              jQuery('.rich-table-row:has(a[name*="excluded"]) a').css("color","#cccccc");
	              jQuery('.rich-table-row:has(a[name*="excluded"]) td').css("color","#cccccc");
	              if ('#{doReverseGeocode}' == 'true') {
				  	setAddress(index);
	              }
				  if (refreshSpeed) {
		  			  setAverageSpeedDifference(index);
		  			  setTopSpeedDifference(index);
				  }
	    	};
	    })(jQuery);


	    var map = null;

		function initialize(lat, lng) 
	    {
  			if (map == null) {
				map = inthincMap.init({
					'canvasID' : '#{mapDiv}',
					'center' : {
						'lat' : lat,
						'lng' : lng
					},
					'zoom' : 14
				});
				initLayers(map, "#{formName}-layersControl");
  			}
  			else {
  				inthincMap.clearMarkers(map);
  			}
			inthincMap.center(map, lat, lng);
        	inthincMap.createMarker(map, { 
        		position: new google.maps.LatLng(lat, lng)
        	});
        	

	    }

		function setAverageSpeedDifference(index){
    		
      		document.getElementById("#{formName}:notificationsTable:"+index+":averageSpeedDifference").innerHTML = 	
      	      parseInt(document.getElementById("#{formName}:notificationsTable:"+index+":averageSpeedValue").innerHTML)-
    		  parseInt(document.getElementById("#{formName}:notificationsTable:"+index+":speedLimitValue").innerHTML);
    		
    	}

      	function setTopSpeedDifference(index){
    		
      		document.getElementById("#{formName}:notificationsTable:"+index+":topSpeedDifference").innerHTML = 	
					parseInt(document.getElementById("#{formName}:notificationsTable:"+index+":topSpeedValue").innerHTML)-
    				parseInt(document.getElementById("#{formName}:notificationsTable:"+index+":speedLimitValue").innerHTML);
    		
    	}
    	function setAddress(index){
    		var addressElements = [];
			var addressElement = {
						"domElement" : document.getElementById("#{formName}:notificationsTable:"+index+":eventAddress"),
						"lat" : document.getElementById("#{formName}:notificationsTable:"+index+":eventLat").value,
   						"lng" : document.getElementById("#{formName}:notificationsTable:"+index+":eventLng").value,
   						"altText" : document.getElementById("#{formName}:notificationsTable:"+index+":altText").value
			};
   			addressElements.push(addressElement);
			inthincMap.reverseGeocodeList(addressElements);
    	}
		
    	</script>

</ui:composition>
</html>
