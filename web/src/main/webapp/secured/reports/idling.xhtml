<ui:composition template="/layout/layout.xhtml" 
			xmlns="http://www.w3.org/1999/xhtml" 
			xmlns:ui="http://java.sun.com/jsf/facelets"
  			xmlns:h="http://java.sun.com/jsf/html" 
  			xmlns:rich="http://richfaces.org/rich"
            xmlns:a4j="http://richfaces.org/a4j"
  			xmlns:f="http://java.sun.com/jsf/core">

	<ui:param name="reportsSelected" value="current" />
	<ui:param name="idlingSelected" value="current" />
	<ui:param name="helpFile" value="Idling.htm" />
    <ui:param name="ajaxPanels" value="outerIdlingReport" />

	<ui:define name="subnavigation">
		<ui:include src="/includes/reports/subNavigation.xhtml" />
	</ui:define>
	
	
	<ui:define name="content">
		

			<table width="940" border="0" cellspacing="0" cellpadding="0" align="center" style="margin: 0 auto 0 auto;">
				<tr>
					<td valign="top">
												
							<div class="">
								<div class="panel_nw">
									<div class="panel_title">
										<span class="driver">#{messages.reports_idlingreporttitle}</span>
										<span class="panel_links"></span>
									</div>
								</div>
									<div class="panel_w">
									<div class="panel_content">	
									
									<a4j:form id="outerIdlingReport">	
									
<!--										<h:inputHidden value="#{idlingReportBean.secret}"/>									-->
											<ui:include src="/includes/redFlagsCount.xhtml" />																
																				
										<ul id="grid_nav" style="margin: 0;">            							
            								<li class="l">
              									<table border="0" cellspacing="0" cellpadding="4" id="grid_nav_search_box">
                									<tr>
                  										<td>
                  											<h:outputText value="#{messages.button_search}" />
                  										</td>
                  										<td>
                    										<h:inputText id="filterTable" value="#{searchCoordinationBean.searchFor}" class="text" size="15" onkeypress="if (event &amp;&amp; event.keyCode == 13) { document.getElementById('outerIdlingReport:searchButton').onclick(); return false; } return true;" />
                  										</td>
                									</tr>
              									</table>
            								</li>
            								<li class="l">
            									<a4j:commandButton id="searchButton" action="#{idlingReportBean.search}" 
            										reRender="navigation:redirectSearch,headerRedCount,items,topScroller,bottomScroller,headerIdlings,startCalendar,endCalendar,errMsg" styleClass="left">
            											<span class="search">
            												<h:outputText value="#{messages.button_search}" />
            											</span>
            									</a4j:commandButton>            								
            								</li>            									
            								<li class="l">   
            								    <table border="0" cellspacing="0" cellpadding="4" id="grid_nav_search_box">
													<tr>
            								         	<td>								
            												<h:outputText value="#{messages.idlingReports_dateRange} " />
            											</td>
            											<td>            									
            												<rich:calendar id="startCalendar" inputSize="10" value="#{idlingReportBean.startDate}" datePattern="#{messages.dateFormat}"/>
            											</td>
            											<td>
            												<rich:calendar id="endCalendar" inputSize="10" value="#{idlingReportBean.endDate}" datePattern="#{messages.dateFormat}"/>
            											</td>
            										</tr>
            									</table>
            								</li>
            								<li class="l text">
            									<a4j:commandLink 
            										reRender="editColumnsForm:editColumnGrid"
            										action="#"
            									 	styleClass="ls_tab_edit_columns"
            										onclick="Richfaces.showModalPanel('editColumns');">            									
            										<h:outputText value="#{messages.button_editColumns}" />
            									</a4j:commandLink>            									
            								</li>  
            								<li class="r grid_icon">
            									<h:panelGroup id="idleReportToolImageId">
													<h:graphicImage value="/images/ico_tools.png"/>
												</h:panelGroup>
											</li>
											<li class="r divider"><img src="#{facesContext.externalContext.request.contextPath}/images/grid_nav_divider.png" />
											</li>
            								<li class="r text">
              									<h:outputFormat id="headerIdlings" value="#{messages.recordCountHeader}">
													<a4j:actionparam value="#{idlingReportBean.start}"/>
													<a4j:actionparam value="#{idlingReportBean.end}"/>
													<a4j:actionparam value="#{idlingReportBean.maxCount}"/>
												</h:outputFormat> 
            								</li>          							
          								</ul>		
          								
          						<rich:contextMenu event="onclick" attachTiming="onavailable"
									disableDefaultMenu="false" submitMode="server"
									attachTo="idleReportToolImageId">
									<rich:menuItem ajaxSingle="true" rendered="true"
													iconDisabled="/images/ico_email.gif" 
													icon="/images/ico_email.gif" 
													onclick="Richfaces.showModalPanel('idleReportEmailModal');return false;"
													value="#{messages.contextMenu_email_this_report}" id="emailMenuItem" submitMode="none">
									</rich:menuItem>
			
									<rich:menuItem ajaxSingle="true"
										iconDisabled="/images/ico_pdf.gif" icon="/images/ico_pdf.gif"
										value="Export To PDF"
										action="#{idlingReportBean.exportReportToPdf}"
										id="export_menu_item">
									</rich:menuItem>
									<rich:menuItem ajaxSingle="true"
										iconDisabled="/images/ico_excel.png" icon="/images/ico_excel.png"
										value="Export To Excel"
										action="#{idlingReportBean.exportReportToExcel}"
										id="exportExcelMEnuItem">
									</rich:menuItem>
								</rich:contextMenu>																																	
                            	<div class="datagrid">
                            			<div class="spacer"></div> 
                            						        	        	
                                    	<table border="0">
                                    		<tr>
                                    			<td><h:outputText 
                                    				id="errMsg" style="color:red"
                                    				value="#{idlingReportBean.badDates}"/>
                                    			</td>
                                    		</tr>
                                    	</table>					
                            			
                                    	<rich:datascroller id="topScroller" for="items" immediate="true" 
                                    		scrollerListener="#{idlingReportBean.scrollerListener}"
                                    		reRender="bottomScroller,items,headerIdlings"
                                    		requestDelay="200" eventsQueue="pagerQueue" page="#{idlingReportBean.page}">
                                    	</rich:datascroller>
                            			      		        						
                            				<rich:dataTable value="#{idlingReportBean.idlingData}" id="items"
                            					var="item" styleClass="datagrid" 
                            					rowClasses="tableOdd,tableEven" cellspacing="1" 
                            					rows="#{idlingReportBean.numRowsPerPg}"
                            					width="100%">
                            
                            					<rich:column rendered="#{idlingReportBean.tableColumns['group'].visible}" 
                            						sortBy="#{item.group}">
                            						<f:facet name="header">
                            							<h:outputText value="#{messages.reports_group}" />
                            						</f:facet>
                            						<h:outputText value="#{item.group}" />   
                                				</rich:column>
                                				<rich:column rendered="#{idlingReportBean.tableColumns['driver_person_fullName'].visible}" 
                                					sortBy="#{item.driver.person.first}">
                                  					<f:facet name="header">
                                  						<h:outputText value="#{messages.reports_driver}" />
                                  					</f:facet>
                            						<a4j:htmlCommandLink action="go_driver" 
                            							value="#{item.driver.person.fullName}">
                                  						<f:setPropertyActionListener 
                            								value="#{item.driver}" 
                            								target="#{navigationBean.driver}">
                            							</f:setPropertyActionListener>
                                  					</a4j:htmlCommandLink>       
                                				</rich:column>
                                				<rich:column rendered="#{idlingReportBean.tableColumns['driveTime'].visible}" 
                                					sortBy="#{item.driveTime}">    					
                                  					<f:facet name="header">
                                  						<h:outputText value="#{messages.reports_drivetime}" />
                                  					</f:facet>
                                  					<h:outputText value="#{item.driveTime}" converter="FloatConverter"/>        					
                                				</rich:column>    				
                                				<rich:column rendered="#{idlingReportBean.tableColumns['lowHrs'].visible}" 
                                					sortBy="#{item.lowHrs}">
                                  					<f:facet name="header">
                                  						<h:outputText value="#{messages.reports_lowidlehrs}" />
                                  					</f:facet>
                                  					<h:outputText value="#{item.lowHrs}" converter="FloatConverter"/>
                                				</rich:column>
                                				<rich:column rendered="#{idlingReportBean.tableColumns['lowPercent'].visible}">    					
                                  					<f:facet name="header">
                                  						<h:outputText value="#{messages.reports_percent}" />
                                  					</f:facet>
                                  					<h:outputText value="#{item.lowPercent}" /> 
                                				</rich:column>
                                				<rich:column rendered="#{idlingReportBean.tableColumns['highHrs'].visible}"
                                					sortBy="#{item.highHrs}">
                                  					<f:facet name="header">
                                  						<h:outputText value="#{messages.reports_highidlehrs}" />
                                  					</f:facet>
                                  					<h:outputText value="#{item.highHrs}" converter="FloatConverter"/> 
                                				</rich:column>
                                				<rich:column rendered="#{idlingReportBean.tableColumns['highPercent'].visible}">
                                  					<f:facet name="header">
                                  						<h:outputText value="#{messages.reports_percent}" />
                                  					</f:facet>
                                  					<h:outputText value="#{item.highPercent}" /> 
                                				</rich:column>
                                				<rich:column rendered="#{idlingReportBean.tableColumns['totalHrs'].visible}"
                                					sortBy="#{item.totalHrs}">
                                  					<f:facet name="header">
                                  						<h:outputText value="#{messages.reports_totalidlehrs}" />
                                  					</f:facet>      					
                                  					<h:outputText value="#{item.totalHrs}" converter="FloatConverter"/> 
                                				</rich:column>
                                				
                                				<rich:column rendered="#{idlingReportBean.tableColumns['totalPercent'].visible}">    					
                                  					<f:facet name="header">
                                  						<h:outputText value="#{messages.reports_percent}" />
                                  					</f:facet>      					
                                  					<h:outputText value="#{item.totalPercent}" /> 
                                				</rich:column>    				
                                				<rich:column>
                                  					<f:facet name="header">
                                  						<h:outputText value="" />
                                  					</f:facet>    
                                  					<a4j:htmlCommandLink action="go_driverTrips" value="#{messages.reports_trips}">
                                  						<f:setPropertyActionListener 
                                  							value="#{item.driver}" 
                                  							target="#{navigationBean.driver}">
                                  						</f:setPropertyActionListener>
                                  					</a4j:htmlCommandLink>  					      					
                                				</rich:column>
                                			</rich:dataTable>    	
                                			
                                			<rich:datascroller id="bottomScroller" for="items" immediate="true" 
                                				scrollerListener="#{idlingReportBean.scrollerListener}"
                                    			reRender="topScroller,items,headerIdlings"
                                    			requestDelay="200" eventsQueue="pagerQueue" page="#{idlingReportBean.page}">        			
                                    		</rich:datascroller>
                            	</div>	
    							</a4j:form>
								<ui:include src="/includes/editColumnsPopup.xhtml">
									<ui:param name="bean" value="#{idlingReportBean}"/>	
									<ui:param name="reRender" value="outerIdlingReport:items" />
								</ui:include>    
								
								</div>
								</div>
														
    					    	<div class="panel_sw">
									<div class="panel_statusbar"></div>
								</div>
							</div>
														
					</td>
				</tr>
			</table>
		<h:outputText id="idle_email_modalPanel">
			<ui:include src="/includes/emailReportPopup.xhtml">	
				<ui:param  name="id" value="idleReportEmailModal" />
				<ui:param  name="reportBean" value="#{idlingReportBean}"/>
			</ui:include>
		</h:outputText>
		
	</ui:define>
	

</ui:composition>