<ui:composition template="/layout/layout.xhtml" 
              xmlns="http://www.w3.org/1999/xhtml" 
              xmlns:ui="http://java.sun.com/jsf/facelets"
              xmlns:h="http://java.sun.com/jsf/html"
              xmlns:rich="http://richfaces.org/rich"
              xmlns:a4j="http://richfaces.org/a4j"
              xmlns:f="http://java.sun.com/jsf/core"
              xmlns:security="http://pro.tiwi.com/jsf/security">

	<ui:param name="reportsSelected" value="current" />
	<ui:param name="devicesSelected" value="current" />
	<ui:param name="helpFile" value="Devices.htm" />
    <ui:param name="ajaxPanels" value="outerDeviceReport" />

	<ui:define name="subnavigation">
		<ui:include src="/includes/reports/subNavigation.xhtml" />
	</ui:define>


	<ui:define name="content">
		

			<table width="940" border="0" cellspacing="0" cellpadding="0" align="center" style="margin: 0 auto 0 auto;">
				<tr>
					<td valign="top">
												
							<div class="">
								<div class="panel_nw">
									<div class="panel_title">
										<span class="driver">#{messages.reports_devicereporttitle}</span>
										<span class="panel_links"></span>
									</div>
								</div>
									
								<div class="panel_w">
								<div class="panel_content">		
									
								<a4j:form id="outerDeviceReport">
																	
<!--									<h:inputHidden value="#{deviceReportBean.secret}"/>-->
																										
										<ui:include src="/includes/redFlagsCount.xhtml" />																
																		
									<ul id="grid_nav" style="margin: 0;">            							
            							<li class="l">
              								<table border="0" cellspacing="0" cellpadding="4" id="grid_nav_search_box">
                								<tr>
                  									<td>
                  										<h:outputText value="#{messages.button_search}" />
                  									</td>
                  									<td>
                    									<h:inputText id="filterTable" value="#{searchCoordinationBean.searchFor}" class="text" size="25" onkeypress="if (event &amp;&amp; event.keyCode == 13) { document.getElementById('outerDeviceReport:searchButton').onclick(); return false; } return true;" />
                  									</td>
                								</tr>
              								</table>
            							</li>
            							<li class="l">
            								<a4j:commandButton id="searchButton" action="#{deviceReportBean.search}" 
            									reRender="navigation:redirectSearch,headerRedCount,items,topScroller,bottomScroller,headerDevices" styleClass="left">
            										<span class="search">
            											<h:outputText value="#{messages.button_search}" />
            										</span>
            								</a4j:commandButton>            								
            							</li>
            							<li class="l text">
            								<a4j:commandLink 
            									action="#"
            								 	styleClass="ls_tab_edit_columns"
            									onclick="Richfaces.showModalPanel('editColumns');"
            									reRender="editColumnsForm:editColumnGrid">        									
            									<h:outputText value="#{messages.button_editColumns}" />
            								</a4j:commandLink>
            								
            							</li>  
            							<li class="r grid_icon">
            								<h:panelGroup id="devicesReportToolImageId">
													<h:graphicImage value="/images/ico_tools.png"/>
											</h:panelGroup>
										</li>
										<li class="r divider"><img src="#{facesContext.externalContext.request.contextPath}/images/grid_nav_divider.png" />
										</li>          							
          							</ul>
                              
                                    <div align="right" style="width: 100%"> 
                                          <h:outputFormat id="headerDevices" value="#{messages.recordCountHeader}">
   											<a4j:actionparam value="#{deviceReportBean.start}"/>
   											<a4j:actionparam value="#{deviceReportBean.end}"/>
   											<a4j:actionparam value="#{deviceReportBean.maxCount}"/>
										  </h:outputFormat>     
                                    </div> 
          							
          							<rich:contextMenu event="onclick" attachTiming="onavailable"
										disableDefaultMenu="false" submitMode="server"
										attachTo="devicesReportToolImageId">
										<rich:menuItem ajaxSingle="true" rendered="true"
														iconDisabled="/images/ico_email.gif" 
														icon="/images/ico_email.gif" 
														onclick="Richfaces.showModalPanel('deviceReportEmailModal');return false;"
														value="#{messages.contextMenu_email_this_report}" id="emailMenuItem" submitMode="none">
										</rich:menuItem>
				
										<rich:menuItem ajaxSingle="true"
											iconDisabled="/images/ico_pdf.gif" icon="/images/ico_pdf.gif"
											value="Export To PDF"
											action="#{deviceReportBean.exportReportToPdf}"
											id="export_menu_item">
										</rich:menuItem>
										<rich:menuItem ajaxSingle="true"
											iconDisabled="/images/ico_excel.png" icon="/images/ico_excel.png"
											value="Export To Excel"
											action="#{deviceReportBean.exportReportToExcel}"
											id="exportExcelMEnuItem">
										</rich:menuItem>
									</rich:contextMenu>		
                                    <div class="spacer"></div>                                        
                                    
                                       
                                    <rich:datascroller id="topScroller" for="items" immediate="true"
                                       scrollerListener="#{deviceReportBean.scrollerListener}"
                                       reRender="bottomScroller,items,headerDevices"
                                       requestDelay="200" eventsQueue="pagerQueue" page="#{deviceReportBean.page}" 
                                       styleClass="datascroller">
                                    </rich:datascroller>																															
									
                                	<div class="datagrid" style="width:925px; overflow: auto">		        						
                                				<rich:dataTable value="#{deviceReportBean.deviceData}" id="items"
                                					var="item" styleClass="datagrid" 
                                					rowClasses="tableOdd,tableEven" cellspacing="1" 
                                					rows="#{deviceReportBean.numRowsPerPg}"
                                					width="100%">
                                
                                					<rich:column rendered="#{deviceReportBean.tableColumns['device_name'].visible}" 
                                						sortBy="#{item.device.name}">
                                						<f:facet name="header">
                                							<h:outputText value="#{messages.reports_deviceid}" />
                                						</f:facet>							
                                						<h:outputText value="#{item.device.name}"/>										
                                    				</rich:column>
                                    				<rich:column rendered="#{deviceReportBean.tableColumns['vehicle_name'].visible}" 
                                    					sortBy="#{item.vehicle.name}">
                                      					<f:facet name="header">
                                      						<h:outputText value="#{messages.reports_assignedvehicle}" />
                                      					</f:facet>
                                						<a4j:htmlCommandLink action="go_vehicle" 
                                      						value="#{item.vehicle.name}">
                                							<f:setPropertyActionListener 
                                									value="#{item.vehicle}" 
                                									target="#{navigationBean.vehicle}">
                                							</f:setPropertyActionListener>
                                						</a4j:htmlCommandLink>  	      
                                    				</rich:column>
                                    				<rich:column rendered="#{deviceReportBean.tableColumns['device_imei'].visible}" 
                                    					sortBy="#{item.device.imei}">    					
                                      					<f:facet name="header">
                                      						<h:outputText value="#{messages.reports_imei}" />
                                      					</f:facet>
                                      					<h:outputText value="#{item.device.imei}" />    					     					
                                    				</rich:column>
                                    				<rich:column rendered="#{deviceReportBean.tableColumns['device_phone'].visible}" 
                                    					sortBy="#{item.device.phone}">
                                      					<f:facet name="header">
                                      						<h:outputText value="#{messages.reports_devicephonenbr}" />
                                      					</f:facet>
                                      					<h:outputText value="#{item.device.phone}" />   
                                    				</rich:column>
                                    				<rich:column rendered="#{deviceReportBean.tableColumns['device_status'].visible}" 
                                    					sortBy="#{item.device.status}">
                                      					<f:facet name="header">
                                      						<h:outputText value="#{messages.reports_status}" />
                                      					</f:facet>
                                      					<h:outputText value="#{item.device.status}" />
                                    				</rich:column>  
                                    				<rich:column rendered="#{deviceReportBean.tableColumns['device_ephone'].visible}" 
                                    					sortBy="#{item.device.ephone}">
                                      					<f:facet name="header">
                                      						<h:outputText value="#{messages.reports_ecallphonenbr}" />
                                      					</f:facet>
                                      					<h:outputText value="#{item.device.ephone}" />
                                    				</rich:column>   		
                                    			</rich:dataTable>    	
                                			</div>
                                       <rich:datascroller id="bottomScroller" for="items" immediate="true"
                                          scrollerListener="#{deviceReportBean.scrollerListener}"
                                          reRender="topScroller,items,headerDevices"
                                          requestDelay="200" eventsQueue="pagerQueue" page="#{deviceReportBean.page}" styleClass="datascroller">                 
                                       </rich:datascroller>
    							</a4j:form>
								<ui:include src="/includes/editColumnsPopup.xhtml">
									<ui:param name="bean" value="#{deviceReportBean}"/>	
									<ui:param name="reRender" value="outerDeviceReport:items" />
								</ui:include>    
								</div>
								</div>
														
    					    	<div class="panel_sw">
									<div class="panel_statusbar"></div>
								</div>
							</div>
														
					</td>
				</tr>
			</table>
		
		<h:outputText id="device_email_modalPanel">
			<ui:include src="/includes/emailReportPopup.xhtml">	
				<ui:param  name="id" value="deviceReportEmailModal" />
				<ui:param  name="reportBean" value="#{deviceReportBean}"/>
			</ui:include>
		</h:outputText>
	</ui:define>

</ui:composition>
