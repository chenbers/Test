<ui:composition template="/layout/layout.xhtml" 
              xmlns="http://www.w3.org/1999/xhtml" 
              xmlns:ui="http://java.sun.com/jsf/facelets"
              xmlns:h="http://java.sun.com/jsf/html"
              xmlns:rich="http://richfaces.org/rich"
              xmlns:a4j="http://richfaces.org/a4j"
              xmlns:f="http://java.sun.com/jsf/core"
              xmlns:security="http://pro.tiwi.com/jsf/security"
              xmlns:t="http://myfaces.apache.org/tomahawk"
              xmlns:tiwiprofn="http://pro.tiwi.com/jsffunctions">

  <ui:param name="adminSelected" value="current" />
  <ui:param name="title" value="#{zoneAlertsBean.add ? messages.adminHeader_addZoneAlert : (zoneAlertsBean.batchEdit ? messages.adminHeader_editZoneAlerts : messages.adminHeader_editZoneAlert)}"/>
  
  <ui:define name="scripts">
    <a4j:loadScript src="#{googleMapURLBean.mapUrl}&amp;hl=#{localeBean.locale.language}" />
    <script src="#{facesContext.externalContext.requestContextPath}/js/mapGeocode.js" type="text/javascript"></script>
    <script src="#{facesContext.externalContext.requestContextPath}/js/drawZone.js" type="text/javascript"></script>
    <script type="text/javascript">    
      var map;
    </script>
     <script type="text/javascript" src="#{facesContext.externalContext.requestContextPath}/js/adminEdit.js"></script>
  </ui:define>

  <ui:define name="content">
	
    <table width="920" border="0" cellspacing="0" cellpadding="0" align="center" style="margin: 0 auto 0 auto;">
      <tr>
        <td valign="top" width="130">
          <ui:include src="/includes/navigation/adminSideNav.xhtml">
            <ui:param name="selectedAction" value="#{(zoneAlertsBean.add) ? 'go_adminAddZoneAlert' : 'go_adminZoneAlerts'}" />
            <ui:param name="parentAction" value="go_adminZoneAlerts" />
             <ui:param name="context" value="editZoneAlert"/>
          </ui:include>
        </td>
        <td valign="top">
          <!-- START PANEL -->

          <a4j:form id="edit-form">
	
			<h:panelGroup id="zonePoints-panel" >
           		<h:inputHidden  id="editZoneAlert-zonePoints" value="#{zoneAlertsBean.item.zone.pointsString}" rendered="#{zoneAlertsBean.item.zone ne null}" />
            </h:panelGroup>

            <div class="">
              <div class="panel_nw">
                <div class="panel_title">
                  <span class="admin"><h:outputText value="#{zoneAlertsBean.add ? messages.adminHeader_addZoneAlert : (zoneAlertsBean.batchEdit ? messages.adminHeader_editZoneAlerts : messages.adminHeader_editZoneAlert)}" /></span>
                  <span class="panel_links"></span>
                </div>
              </div>

              <div class="panel_w">

                <div class="panel_content">

                  <ul id="grid_nav" style="margin: 0;">
                    <li class="r">
                      <h:commandButton id="editZoneAlertSave1" action="#{zoneAlertsBean.save}" styleClass="left"><span class="save"><h:outputText value="#{messages.button_save}" /></span></h:commandButton>
                      <h:outputText value=" " /><h:commandButton id="editZoneAlertCancel1" action="#{zoneAlertsBean.cancelEdit}" immediate="true" styleClass="left"><span class="cancel"><h:outputText value="#{messages.button_cancel}" /></span></h:commandButton>
                    </li>
                  </ul>
                   <ui:fragment rendered="${tiwiprofn:messagesAvailable()}">
                     <dl id="display-form:j_id122" class="rich-messages msg" style="">
                        <dt class="error">
                           <h:outputFormat value="#{messages.error_validationMsg}">
                              <f:param value="${tiwiprofn:getMessageCount()}"/>
                           </h:outputFormat>
                        </dt>
                     </dl>
                   </ui:fragment>
                  <rich:messages globalOnly="true" errorClass="error" fatalClass="error" warnClass="warning" infoClass="info" styleClass="msg" />

                  <div class="add_section_title"><h:outputText value="#{messages.editZoneAlert_nameDescriptionZone}" /></div>

                  <div class="spacer"></div>

                  <table width="790" border="0" cellspacing="0" cellpadding="0">
                    <tr>
                      <td width="390" valign="top">

                        <table width="100%" border="0" cellspacing="2" cellpadding="4" style="background-color: #f2efe9; border: 1px solid #acacac;">
                          <tr>
                            <td width="105" valign="top">
                              <ui:include src="../../includes/admin/inputLabel.xhtml">
                                 <ui:param name="required" value="TRUE"/>
                                 <ui:param name="for" value="zoneID"/>
                                 <ui:param name="fieldName" value="zoneID"/>
                                 <ui:param name="editBean" value="#{zoneAlertsBean}"/>
                                 <ui:param name="label" value="#{messages.editZoneAlert_zone}"/>
								<ui:param name="context" value="editZoneAlertZoneId"/>
                              </ui:include>
                            </td>
                            <td>
                              <rich:message for="editZoneAlert-zoneID" errorClass="field-error" fatalClass="field-error" warnClass="field-warning" infoClass="field-info" styleClass="field-msg" />
                              <h:selectOneMenu id="editZoneAlert-zoneID" value="#{zoneAlertsBean.item.zoneID}" required="#{(not zoneAlertsBean.batchEdit) or zoneAlertsBean.updateField['zoneID']}"  requiredMessage="#{messages.required}" style="width: 200px">
                                <a4j:support event="onchange" reRender="zonePoints-panel" limitToList="true" ajaxSingle="true" onsubmit="checkMultiple(this)" oncomplete="showZone()"/>
                                <f:selectItems value="#{zoneAlertsBean.zones}" />
                              </h:selectOneMenu>
                            </td>
                          </tr>
                        </table>

                        <table width="100%" border="0" cellspacing="2" cellpadding="4">
                          <tr>
                            <td width="105" valign="top">
                              <ui:include src="../../includes/admin/inputLabel.xhtml">
                                 <ui:param name="required" value="TRUE"/>
                                 <ui:param name="for" value="name"/>
                                 <ui:param name="fieldName" value="name"/>
                                 <ui:param name="editBean" value="#{zoneAlertsBean}"/>
                                 <ui:param name="label" value="#{messages.editAlerts_name}"/>
 								<ui:param name="context" value="editZoneAlertName"/>
                              </ui:include>
                            </td>
                            <td>
                              <rich:message for="editZoneAlert-name" errorClass="field-error" fatalClass="field-error" warnClass="field-warning" infoClass="field-info" styleClass="field-msg" />
                              <h:inputText value="#{zoneAlertsBean.item.name}" id="editZoneAlert-name" onchange="checkMultiple(this)" styleClass="text" size="30"
                                maxlength="30"/>
                            </td>
                          </tr>
                          <tr>
                            <td width="105" valign="top">
                              <h:selectBooleanCheckbox rendered="#{zoneAlertsBean.batchEdit}" id="editZoneAlert-update_description" value="#{zoneAlertsBean.updateField['description']}" />
                              <h:outputText value="#{messages.editAlerts_description}" />
                            </td>
                            <td>
                              <h:inputText value="#{zoneAlertsBean.item.description}" id="editZoneAlert-description" onchange="checkMultiple(this)" styleClass="text" size="30"
                                maxlength="64" />
                            </td>
                          </tr>
						  <tr>
								<td width="115" valign="top">
									<ui:include src="../../includes/admin/inputLabel.xhtml">
										<ui:param name="required" value="TRUE"/>
										<ui:param name="reRender" value="status"/>
										<ui:param name="for" value="status"/>
										<ui:param name="fieldName" value="status"/>
										<ui:param name="editBean" value="#{zoneAlertsBean}"/>
										<ui:param name="label" value="#{messages.editAlerts_status}"/>
        								<ui:param name="context" value="zoneAlertsStatus" />
									</ui:include>
								</td>
								<td>
      								<h:selectOneMenu id="zoneAlertsStatus" value="#{zoneAlertsBean.item.status}" converter="SimpleBeanConverter" onchange="checkMultiple(this)">
      									<f:selectItems value="#{zoneAlertsBean.statuses}"/> 
      								</h:selectOneMenu>
								</td>
						  </tr>
                          <tr>
                            <td width="105" valign="top">
                              <ui:include src="../../includes/admin/inputLabel.xhtml">
                                 <ui:param name="required" value="TRUE"/>
                                 <ui:param name="for" value="dayOfWeek"/>
                                 <ui:param name="fieldName" value="dayOfWeek"/>
                                 <ui:param name="editBean" value="#{zoneAlertsBean}"/>
                                 <ui:param name="label" value="#{messages.editAlerts_dayOfWeek}"/>
        						<ui:param name="context" value="editZoneAlertDayOfWeek" />
                              </ui:include>
                            </td>
                            <td>
                              <rich:message for="editZoneAlert-day0" errorClass="field-error" fatalClass="field-error" warnClass="field-warning" infoClass="field-info" styleClass="field-msg" />
                              <ui:include src="../../includes/dayPicker.xhtml">
                                <ui:param name="days" value="#{zoneAlertsBean.item.dayOfWeek}" />
                                <ui:param name="onchange" value="checkMultiple('dayOfWeek')" />
       							<ui:param name="context" value="editZoneAlert" />
        						<ui:param name="formName" value="edit-form"/>
                              </ui:include>
                            </td>
                          </tr>
                          <tr>
                            <td width="105" valign="top">
                              <ui:include src="../../includes/admin/inputLabel.xhtml">
                                 <ui:param name="required" value="TRUE"/>
                                 <ui:param name="for" value="timeframe"/>
                                 <ui:param name="fieldName" value="anytime"/>
                                 <ui:param name="editBean" value="#{zoneAlertsBean}"/>
                                 <ui:param name="label" value="#{messages.editAlerts_timeframe}"/>
        						<ui:param name="context" value="editZoneAlertAnyTime" />
                              </ui:include>
                            </td>
                            <td>
                              <rich:message for="editZoneAlert-stopTOD" errorClass="field-error" fatalClass="field-error" warnClass="field-warning" infoClass="field-info" styleClass="field-msg" />
                              <h:selectOneRadio id="editZoneAlert-timeframe" onchange="checkMultiple('timeframe')" value="#{zoneAlertsBean.item.anytime}" onclick="document.getElementById('editZoneAlert-timeframePickers').style.display = (this.value == 'true' ? 'none' : '')" enabledClass="radioitem">
                                <f:selectItem itemValue="true" itemLabel="#{messages.editAlerts_timeframeAnytime}" />
                                <f:selectItem itemValue="false" itemLabel="#{messages.editAlerts_timeframeBetween}" />
                              </h:selectOneRadio>
                              <table id="editZoneAlert-timeframePickers" border="0" style="#{zoneAlertsBean.item.anytime ? 'display:none' : ''}">
                                <tr>
                                  <td>
                                    <ui:include src="../../includes/timePicker.xhtml">
                                      <ui:param name="id" value="startTOD" />
                                      <ui:param name="value" value="#{zoneAlertsBean.item.startTOD}" />
                                      <ui:param name="onchange" value="checkMultiple('timeframe')" />
        								<ui:param name="context" value="editZoneAlert" />
        								<ui:param name="formName" value="edit-form"/>
                                    </ui:include>
                                  </td>
                                  <td><h:outputText value="#{messages.editAlerts_betweenAnd}" /></td>
                                  <td>
                                    <ui:include src="../../includes/timePicker.xhtml">
                                      <ui:param name="id" value="stopTOD" />
                                      <ui:param name="value" value="#{zoneAlertsBean.item.stopTOD}" />
                                      <ui:param name="onchange" value="checkMultiple('timeframe')" />
        							  <ui:param name="context" value="editZoneAlert" />
        							  <ui:param name="formName" value="edit-form"/>
                                    </ui:include>
                                  </td>
                                </tr>
                              </table>
                            </td>
                          </tr>
                        </table>

                      </td>
                      <td width="10"><h:graphicImage value="/images/x.gif" width="10" /></td>
                      <td width="390" valign="top" style="background-color: #f2efe9; border: 1px solid #acacac;">
                        <div id="map-canvas" style="height:100%;height:220px;border:0"></div>
                      </td>
                    </tr>
                  </table>

                  <div class="spacer"></div>

                  <table width="790" border="0" cellspacing="0" cellpadding="0">
                    <tr>
                      <td width="390" valign="top">

                        <div class="add_section_title">
                          <ui:include src="../../includes/admin/inputLabel.xhtml">
                              <ui:param name="required" value="TRUE"/>
                              <ui:param name="for" value="defineAlerts"/>
                              <ui:param name="fieldName" value="defineAlerts"/>
                              <ui:param name="editBean" value="#{zoneAlertsBean}"/>
                              <ui:param name="label" value="#{messages.editZoneAlert_alertType}"/>
 								<ui:param name="context" value="editZoneAlertDefineAlerts"/>
                          </ui:include>
                        </div>

                        <rich:message for="editZoneAlert-arrival" errorClass="field-error" fatalClass="field-error" warnClass="field-warning" infoClass="field-info" styleClass="field-msg" />

                        <table width="380" border="0" cellspacing="2" cellpadding="4" align="center">
                          <tr>
                            <td width="50%">
                              <h:selectBooleanCheckbox id="editZoneAlert-arrival" value="#{zoneAlertsBean.item.arrival}" onchange="checkMultiple('defineAlerts')" />
                              <h:outputText value="#{messages.editZoneAlert_arrival}" />
                            </td>
                            <td width="50%">
                              <h:selectBooleanCheckbox id="editZoneAlert-departure" value="#{zoneAlertsBean.item.departure}" onchange="checkMultiple('defineAlerts')" />
                              <h:outputText value="#{messages.editZoneAlert_departure}" />
                            </td>
                          </tr>
                        </table>

                      </td>
                      <td width="10"><h:graphicImage value="/images/x.gif" width="10" /></td>
                      <td width="390" valign="top">
                        <div class="add_section_title">
                          <ui:include src="../../includes/admin/inputLabel.xhtml">
                              <ui:param name="required" value="TRUE"/>
                              <ui:param name="for" value="assignTo"/>
                              <ui:param name="fieldName" value="assignTo"/>
                              <ui:param name="editBean" value="#{zoneAlertsBean}"/>
                              <ui:param name="label" value="#{messages.editAlerts_assignTo}"/>
								<ui:param name="context" value="editZoneAlertAssignTo"/>
                          </ui:include>
                        </div>
                        <rich:message for="editZoneAlert-from" errorClass="field-error" fatalClass="field-error" warnClass="field-warning" infoClass="field-info" styleClass="field-msg" />

                        <ui:include src="../../includes/admin/listPicker.xhtml">
                          <ui:param name="bean" value="#{zoneAlertsBean.assignPicker}" />
                          <ui:param name="id" value="alertAssign" />
                          <ui:param name="onchange" value="checkMultiple('assignTo')" />
						  <ui:param name="context" value="editZoneAlert"/>
						  <ui:param name="formName" value="edit-form"/>
                        </ui:include>

						<ui:fragment rendered="#{zoneAlertsBean.admin}">
						<table border="0" cellspacing="4" cellpadding="2">
     						<tr>
     							<td><h:outputText value="#{messages.editAlerts_owner}" /></td>
     							<td>
								<h:selectOneMenu id="editZoneAlert-userID" value="#{zoneAlertsBean.item.userID}" style="width: 200px">
									<f:selectItems value="#{zoneAlertsBean.allGroupUsers}" />
               						<a4j:support action="#{zoneAlertsBean.ownerChangedAction}" event="onchange" 
               							reRender="edit-form:editZoneAlert-from,edit-form:editZoneAlert-pickedIDs,edit-form:editZoneAlert-picked"/>
       							</h:selectOneMenu>
       							</td>
     						</tr>
							<tr>
								<td colspan='2'>        
       								<div class="instructions"><h:outputText value="#{messages.editAlerts_ownerInstructions}" /></div>
       							</td>
       						</tr>
						</table>
      					</ui:fragment>
                      </td>
                    </tr>
                  </table>

                  <div class="spacer"></div>

                  <rich:message for="editZoneAlert-emailToString" errorClass="field-error" fatalClass="field-error" warnClass="field-warning" infoClass="field-info" styleClass="field-msg" />

                  <table width="790" border="0" cellspacing="0" cellpadding="0">
                    <tr>
                      <td width="390" valign="top">

                        <div class="add_section_title">
                          <h:selectBooleanCheckbox rendered="#{zoneAlertsBean.batchEdit}" id="update_editZoneAlert-notifyPersonIDs" value="#{zoneAlertsBean.updateField['notifyPersonIDs']}" />
                          <h:outputText value="#{messages.editAlerts_notificationsByName}" />
                        </div>

                        <div class="instructions"><h:outputText value="#{messages.editAlerts_notificationsByNameInstructions}" /></div>

                        <ui:include src="../../includes/autocompletePicker.xhtml">
                          <ui:param name="autocompleter" value="#{zoneAlertsBean.peoplePicker}" />
                          <ui:param name="onchange" value="checkMultiple('notifyPersonIDs')" />
						  <ui:param name="context" value="editZoneAlert"/>
 						  <ui:param name="formName" value="edit-form"/>
                        </ui:include>

                      </td>
                      <td width="10"><h:graphicImage value="/images/x.gif" width="10" /></td>
                      <td width="390" valign="top">
                        <!-- 
                        <div class="add_section_title">
                          <h:selectBooleanCheckbox rendered="#{zoneAlertsBean.batchEdit}" id="update_emailToString" value="#{zoneAlertsBean.updateField['emailToString']}" />
                          <h:outputText value="#{messages.editAlerts_notificationsByEmail}" />
                        </div>

                        <div class="instructions"><h:outputText value="#{messages.editAlerts_notificationsByEmailInstructions}" /></div>

                        <h:inputTextarea id="emailToString" value="#{zoneAlertsBean.item.emailToString}" rows="4" style="width:100%" onchange="checkMultiple(this)" />
                        -->
                      </td>
                    </tr>
                  </table>

                  <div class="required-key"><h:outputText value="#{messages.requiredKey}" /></div>

                  <div class="spacer"></div>

                  <ul id="grid_nav" style="margin: 0;">
                    <li class="r">
                      <h:commandButton id="editZoneAlertSave2" action="#{zoneAlertsBean.save}" styleClass="left"><span class="save"><h:outputText value="#{messages.button_save}" /></span></h:commandButton>
                      <h:outputText value=" " /><h:commandButton id="editZoneAlertCancel2" action="#{zoneAlertsBean.cancelEdit}" immediate="true" styleClass="left"><span class="cancel"><h:outputText value="#{messages.button_cancel}" /></span></h:commandButton>
                    </li>
                  </ul>

                </div>
              </div>

              <div class="panel_sw">
                <div class="panel_statusbar"></div>
              </div>
            </div>

          </a4j:form>

          <!-- END PANEL -->
        </td>
      </tr>
    </table>

    <script type="text/javascript">
      function showZone()
      {
        map.clearOverlays();
        if(document.getElementById("edit-form:editZoneAlert-zonePoints") != null)
        { 
           
	        var outline = fromOutlineString(document.getElementById("edit-form:editZoneAlert-zonePoints").value);
	        if (outline)
	        {
	          centerMapAtZone(getLatLngBounds(outline));
	          loadZone(outline, false);
	        }
        }
      }

      var formElements = ["text", "checkbox", "radio", "select-one", "select-multiple", "textarea"];

      function bodyLoad()
      {
        if (GBrowserIsCompatible())
        {
          map = new GMap2(document.getElementById("map-canvas"));
          map.disableDragging();
          map.disableDoubleClickZoom();
          map.disableInfoWindow();
          showZone();
        }

        document.getElementById("editZoneAlert-timeframePickers").style.display = (document.getElementById("edit-form:editZoneAlert-timeframe:0").checked ? 'none' : '');

        var elements = document.getElementById("edit-form").elements;
        for (var i = 0; i &lt; elements.length; i++)
          for (var j = 0; j &lt; formElements.length; j++)
            if (elements[i].getAttribute("type") == formElements[j])
            {
              elements[i].focus();
              return;
            }
      }

      function bodyUnload()
      {
        GUnload();
      }

    </script>

  </ui:define>

</ui:composition>
