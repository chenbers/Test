<ui:composition template="/layout/layout.xhtml"
              xmlns="http://www.w3.org/1999/xhtml" 
              xmlns:ui="http://java.sun.com/jsf/facelets"
              xmlns:h="http://java.sun.com/jsf/html"
              xmlns:rich="http://richfaces.org/rich"
              xmlns:a4j="http://richfaces.org/a4j"
              xmlns:f="http://java.sun.com/jsf/core"
              xmlns:c="http://java.sun.com/jstl/core"
              xmlns:security="http://pro.tiwi.com/jsf/security"
              xmlns:tiwiprofn="http://pro.tiwi.com/jsffunctions">

  <ui:param name="adminSelected" value="current" />
  <ui:param name="helpFile" value="Admin_Add_Profile.htm" />
  <ui:param name="title" value="#{redFlagOrZoneAlertsBean.add ? messages.adminHeader_addRedFlag : (redFlagOrZoneAlertsBean.batchEdit ? messages.adminHeader_editRedFlags : messages.adminHeader_editRedFlag)}"/>
  
  <ui:define name="scripts">
    <a4j:loadScript src="#{googleMapURLBean.mapUrl}&amp;hl=#{localeBean.locale.language}" />
    <script src="#{facesContext.externalContext.requestContextPath}/js/mapGeocode.js" type="text/javascript"></script>
    <script src="#{facesContext.externalContext.requestContextPath}/js/drawZone.js" type="text/javascript"></script>
    <script type="text/javascript">    
      var map;
    </script>
      <script type="text/javascript" src="#{facesContext.externalContext.requestContextPath}/js/adminEdit.js"></script>
  </ui:define>
  
  <ui:define name="content">

    <table width="920" border="0" cellspacing="0" cellpadding="0" align="center" style="margin: 0 auto 0 auto;">
      <tr>
        <td valign="top" width="130">
          <ui:include src="/includes/navigation/adminSideNav.xhtml">
            <ui:param name="selectedAction" value="#{(redFlagOrZoneAlertsBean.add) ? 'go_adminAddRedFlag' : 'go_adminRedFlags'}" />
            <ui:param name="parentAction" value="go_adminRedFlags" />
            <ui:param name="context" value="editRedFlag"/>
          </ui:include>
        </td>
        <td valign="top">
          <!-- START PANEL -->

          <a4j:form id="edit-form">
          
			<h:panelGroup id="zonePoints-panel" >
           		<h:inputHidden  id="editZoneAlert-zonePoints" value="#{redFlagOrZoneAlertsBean.item.zone.pointsString}" />
            </h:panelGroup>

            <div class="">
              <div class="panel_nw">
                <div class="panel_title">
                  <span class="admin"><h:outputText value="#{redFlagOrZoneAlertsBean.add ? messages.adminHeader_addRedFlag : (redFlagOrZoneAlertsBean.batchEdit ? messages.adminHeader_editRedFlags : messages.adminHeader_editRedFlag)}" /></span>
                  <span class="panel_links"></span>
                </div>
              </div>

              <div class="panel_w">

                <div class="panel_content">

                  <ul id="grid_nav" style="margin: 0;">
                    <li class="r">
                      <h:commandButton id="editRedFlagSave1" action="#{redFlagOrZoneAlertsBean.save}" styleClass="left"><span class="save"><h:outputText value="#{messages.button_save}" /></span></h:commandButton>
                      <h:outputText value=" " /><h:commandButton id="editRedFlagCancel1" action="#{redFlagOrZoneAlertsBean.cancelEdit}" immediate="true" styleClass="left"><span class="cancel"><h:outputText value="#{messages.button_cancel}" /></span></h:commandButton>
                    </li>
                  </ul>
                   <div class="msg">
                  <p id="info">
                     <h:outputText  id="editMessage1" value="#{messages.editRedFlag_message}"/>
                  </p>
               </div>
                   <ui:fragment rendered="${tiwiprofn:messagesAvailable()}">
                     <dl id="display-form:j_id122" class="rich-messages msg" style="">
                        <dt class="error">
                           <h:outputFormat value="#{messages.error_validationMsg}">
                              <f:param value="${tiwiprofn:getMessageCount()}"/>
                           </h:outputFormat>
                        </dt>
                     </dl>
                   </ui:fragment>
                  <rich:messages globalOnly="true" errorClass="error" fatalClass="error" warnClass="warning" infoClass="info" styleClass="msg" />

                  <div class="spacer"></div>

                  <table width="790" border="0" cellspacing="0" cellpadding="0">
                    <tr>
                    <td>
                  <div class="add_section_title">
                  <ui:include src="../../includes/admin/inputLabel.xhtml">
                     <ui:param name="required" value="false"/>
                     <ui:param name="for" value="alertType"/>
                     <ui:param name="fieldName" value="alertType"/>
                     <ui:param name="editBean" value="#{redFlagOrZoneAlertsBean}"/>
                     <ui:param name="label" value="#{messages.editRedFlag_redFlagType}"/>
        			<ui:param name="context" value="editRedFlagType" />
                  </ui:include>
                  </div>
                  	  <div class="spacer"></div>
                      <table width="790" border="0" cellspacing="0" cellpadding="0">
                    	<tr>
                		<td width="160" valign="top">
                        <h:selectOneMenu id="alertType" value="#{redFlagOrZoneAlertsBean.item.type}" onchange="checkMultiple(this)">
                          <a4j:support event="onclick" reRender="editRedFlagType" limitToList="true" />
                          <f:selectItems value="#{redFlagOrZoneAlertsBean.alertTypeSelectItems}" />
                        </h:selectOneMenu>
                      	</td>
                		</tr>
                		</table>
                	</td>
                	</tr>
                </table>
                  <div class="spacer"></div>
                  <table width="790" border="0" cellspacing="0" cellpadding="0">
                    <tr>
                      <td width="390" valign="top">
                
                        <div class="add_section_title"><h:outputText value="#{messages.editRedFlag_nameDescriptionType}" /></div>

                        <table width="370" border="0" cellspacing="2" cellpadding="4" align="center">
                          <tr>
                            <td width="105" valign="top">
                              <ui:include src="../../includes/admin/inputLabel.xhtml">
                                 <ui:param name="required" value="TRUE"/>
                                 <ui:param name="for" value="name"/>
                                 <ui:param name="fieldName" value="name"/>
                                 <ui:param name="editBean" value="#{redFlagOrZoneAlertsBean}"/>
                                 <ui:param name="label" value="#{messages.editAlerts_name}"/>
        					<ui:param name="context" value="editRedFlagName" />
                              </ui:include>
                            </td>
                            <td>
                              <rich:message for="editRedFlag-name" errorClass="field-error" fatalClass="field-error" warnClass="field-warning" infoClass="field-info" styleClass="field-msg" />
                              <h:inputText value="#{redFlagOrZoneAlertsBean.item.name}" id="editRedFlag-name" onchange="checkMultiple(this)" styleClass="text" size="30"
                                maxlength="30" />
                            </td>
                          </tr>
                          <tr>
                            <td width="105" valign="top">
                              <h:selectBooleanCheckbox rendered="#{redFlagOrZoneAlertsBean.batchEdit}" id="update_editRedFlag-description" value="#{redFlagOrZoneAlertsBean.updateField['description']}" />
                              <h:outputText value="#{messages.editAlerts_description}" />
                            </td>
                            <td>
                              <h:inputText value="#{redFlagOrZoneAlertsBean.item.description}" id="description" onchange="checkMultiple(this)" styleClass="text" size="30"
                                maxlength="64" />
                            </td>
                          </tr>

                          <tr>
                            <td width="105" valign="top">
                              <h:selectBooleanCheckbox rendered="#{redFlagOrZoneAlertsBean.batchEdit}" id="update_editRedFlag-severityLevel" value="#{redFlagOrZoneAlertsBean.updateField['severityLevel']}" />
                              <h:outputText value="#{messages.editRedFlag_notification}" />
                            </td>
                            <td>
								<h:selectOneMenu id="severityLevel" value="#{redFlagOrZoneAlertsBean.item.severityLevel}" onchange="checkMultiple(this);">
                                      <f:selectItem itemValue="INFO" itemLabel="#{messages.redFlag_info}" />
                                      <f:selectItem itemValue="WARNING" itemLabel="#{messages.redFlag_warning}" />
                                      <f:selectItem itemValue="CRITICAL" itemLabel="#{messages.redFlag_critical}" />
                                </h:selectOneMenu>
                            </td>
                          </tr>
                          
                          <h:outputText value="#{messages.editRedFlag_notification}" />
							<tr>
								<td width="115" valign="top">
									<ui:include src="../../includes/admin/inputLabel.xhtml">
										<ui:param name="required" value="TRUE"/>
										<ui:param name="reRender" value="status"/>
										<ui:param name="for" value="status"/>
										<ui:param name="fieldName" value="status"/>
										<ui:param name="editBean" value="#{redFlagOrZoneAlertsBean}"/>
										<ui:param name="label" value="#{messages.editAlerts_status}"/>
        								<ui:param name="context" value="redFlagAlertsStatus" />
									</ui:include>
								</td>
								<td>
      								<h:selectOneMenu id="redFlagAlertsStatus" value="#{redFlagOrZoneAlertsBean.item.status}" converter="SimpleBeanConverter" onchange="checkMultiple(this)">
      									<f:selectItems value="#{redFlagOrZoneAlertsBean.statuses}"/> 
      								</h:selectOneMenu>
								</td>
							</tr>
                          <tr>
                            <td width="105" valign="top">
                              <ui:include src="../../includes/admin/inputLabel.xhtml">
                                 <ui:param name="required" value="TRUE"/>
                                 <ui:param name="for" value="dayOfWeek"/>
                                 <ui:param name="fieldName" value="dayOfWeek"/>
                                 <ui:param name="editBean" value="#{redFlagOrZoneAlertsBean}"/>
                                 <ui:param name="label" value="#{messages.editAlerts_dayOfWeek}"/>
        						<ui:param name="context" value="editRedFlagDayOfWeek" />
                              </ui:include>
                            </td>
                            <td>
                              <rich:message for="editRedFlag-day0" errorClass="field-error" fatalClass="field-error" warnClass="field-warning" infoClass="field-info" styleClass="field-msg" />
                              <ui:include src="../../includes/dayPicker.xhtml">
                                <ui:param name="days" value="#{redFlagOrZoneAlertsBean.item.dayOfWeek}" />
                                <ui:param name="onchange" value="checkMultiple('dayOfWeek')" />
        						<ui:param name="context" value="editRedFlag" />
        						<ui:param name="formName" value="edit-form"/>
                              </ui:include>
                            </td>
                          </tr>
                          <tr>
                            <td width="105" valign="top">
                               <ui:include src="../../includes/admin/inputLabel.xhtml">
                                 <ui:param name="required" value="TRUE"/>
                                 <ui:param name="for" value="timeframe"/>
                                 <ui:param name="fieldName" value="anytime"/>
                                 <ui:param name="editBean" value="#{redFlagOrZoneAlertsBean}"/>
                                 <ui:param name="label" value="#{messages.editAlerts_timeframe}"/>
        							<ui:param name="context" value="editRedFlagAnyTime" />
 	                             </ui:include>
                            </td>
                            <td>
                              <rich:message for="editRedFlag-stopTOD" errorClass="field-error" fatalClass="field-error" warnClass="field-warning" infoClass="field-info" styleClass="field-msg" />
                              <h:selectOneRadio id="editRedFlag-timeframe" onchange="checkMultiple('timeframe')" value="#{redFlagOrZoneAlertsBean.item.anytime}" onclick="document.getElementById('editRedFlag-timeframePickers').style.display = (this.value == 'true' ? 'none' : '')" enabledClass="radioitem">
                                <f:selectItem itemValue="true" itemLabel="#{messages.editAlerts_timeframeAnytime}" />
                                <f:selectItem itemValue="false" itemLabel="#{messages.editAlerts_timeframeBetween}" />
                              </h:selectOneRadio>
                              <table id="editRedFlag-timeframePickers" border="0" style="#{redFlagOrZoneAlertsBean.item.anytime ? 'display:none' : ''}">
                                <tr>
                                  <td>
                                    <ui:include src="../../includes/timePicker.xhtml">
                                      <ui:param name="id" value="startTOD" />
                                      <ui:param name="value" value="#{redFlagOrZoneAlertsBean.item.startTOD}" />
                                      <ui:param name="onchange" value="checkMultiple('timeframe')" />
        							<ui:param name="context" value="editRedFlag" />
         								<ui:param name="formName" value="edit-form"/>
                                    </ui:include>
                                  </td>
                                  <td><h:outputText value="#{messages.editAlerts_betweenAnd}" /></td>
                                  <td>
                                    <ui:include src="../../includes/timePicker.xhtml">
                                      <ui:param name="id" value="stopTOD" />
                                      <ui:param name="value" value="#{redFlagOrZoneAlertsBean.item.stopTOD}" />
                                      <ui:param name="onchange" value="checkMultiple('timeframe')" />
       								  <ui:param name="context" value="editRedFlag" />
        								<ui:param name="formName" value="edit-form"/>
                                     </ui:include>
                                  </td>
                                </tr>
                              </table>
                            </td>
                          </tr>
                        </table>

                      </td>
                      <td width="10"><h:graphicImage value="/images/x.gif" width="10" /></td>
                      <td width="390" valign="top">

                        <div class="add_section_title">
                          <ui:include src="../../includes/admin/inputLabel.xhtml">
                              <ui:param name="required" value="TRUE"/>
                              <ui:param name="for" value="assignTo"/>
                              <ui:param name="fieldName" value="assignTo"/>
                              <ui:param name="editBean" value="#{redFlagOrZoneAlertsBean}"/>
                              <ui:param name="label" value="#{messages.editAlerts_assignTo}"/>
         					<ui:param name="context" value="editRedFlagAssignTo" />
                          </ui:include>
                        </div>

                        <rich:message for="editRedFlag-from" errorClass="field-error" fatalClass="field-error" warnClass="field-warning" infoClass="field-info" styleClass="field-msg" />

                        <ui:include src="../../includes/admin/alertAssign.xhtml">
                         	<ui:param name="alertsBean" value="#{redFlagOrZoneAlertsBean}" />
                          	<ui:param name="onchange" value="checkMultiple('assignTo')" />
          					<ui:param name="context" value="editRedFlag" />
         				  	<ui:param name="formName" value="edit-form"/>
                        </ui:include>

                      </td>
                    </tr>
                  </table>

                  <div class="spacer"></div>

                  <table width="790" border="0" cellspacing="0" cellpadding="0">
                    <tr>
                      <td width="650" valign="top">
                        <rich:message id="message" for="editRedFlagType" errorClass="field-error" fatalClass="field-error" warnClass="field-warning" infoClass="field-info" styleClass="field-msg" />
						<a4j:outputPanel id="editRedFlagType">
                        <a4j:outputPanel id="editRedFlag-speed">
                          <h:panelGroup rendered="#{redFlagOrZoneAlertsBean.item.type == 'ALERT_TYPE_SPEEDING'}" id="speedPanel">

                            <table width="100%" border="0" cellpadding="2" cellspacing="0">
                              <tr class="datagrid">
                                <th><h:outputText value="#{messages.editRedFlag_speedHeader}" /></th>
                                <th width="300" colspan="2"><h:outputText value="#{messages.editRedFlag_speedSettingHeader}" /></th>
                              </tr>
                              <c:forEach begin="0" var="index" end="14">
                                <c:set var="id" value="speed#{index}" />
                                <c:set var="minimum" value="#{(index lt 4) ? ((-index * 5) - 5) : -25}" />
                                <tr class="#{((index % 2) == 0) ? 'tableOdd' : 'tableEven'}">
                                  <td style="padding: 6px 12px 6px 12px; border-bottom: 1px solid #8BAD37;">
                                    <h:selectBooleanCheckbox id="#{id}Selected" value="#{redFlagOrZoneAlertsBean.item.speedSelected[index]}" onchange="checkMultiple('type')" />
                                    <h:outputText value="#{(index * 5) + 5}" converter="MphToKphLabelConverter"/>
                                    <h:outputText value=" " />
                                    <h:outputText value="mph" converter="MeasurementTextConverter"/>
                                  </td>
                                  <td style="padding: 6px 0px 6px 12px; border-bottom: 1px solid #8BAD37;" width="250">
                                    <rich:inputNumberSlider id="#{id}" value="#{redFlagOrZoneAlertsBean.item.speedSettings[index]}" 
                                          width="250" onfocus="this.select();" showToolTip="false" 
                                          showBoundaryValues="false" minValue="${tiwiprofn:convertMphToKph(minimum)}" maxValue="${tiwiprofn:convertMphToKph(25)}" step="1" 
                                          converter="MphToKphConverter" onchange="adminSetCheckbox(this.mainTable.id,'redflag','','')"
                                          convertonchange="checkMultiple('type'); document.getElementById(this.mainTable.id + 'Selected').checked = true" />
                                  </td>
                                  <td style="padding: 6px 12px 6px 2px; border-bottom: 1px solid #8BAD37;">
                                     <h:outputText value=" " />
                                     <h:outputText value="mph" converter="MeasurementTextConverter"/>
                                  </td>
                                </tr>
                              </c:forEach>
                              <tr class="tableEven">
                                <ui:fragment rendered="#{redFlagOrZoneAlertsBean.batchEdit}">
                                  <td style="border-bottom: 1px solid #8BAD37"></td>
                                </ui:fragment>
                                <td colspan="2" align="right" style="border-bottom: 1px solid #8BAD37">
                                  <h:outputText value="#{messages.editDevice_speedAdjustAll}" />
                                  <a href="#" onclick="bumpSpeeds(true); return false;"><h:graphicImage value="/images/btn_plus.png" style="border: 0px; vertical-align: middle;" /></a>
                                  <a href="#" onclick="bumpSpeeds(false); return false;"><h:graphicImage value="/images/btn_minus.png" style="border: 0px; vertical-align: middle;" /></a>
                                </td>
                                <td colspan="2" style="border-bottom: 1px solid #8BAD37"></td>
                              </tr>
                            </table>
                            <script type="text/javascript">
                              function bumpSpeeds(up)
                              {
                                for (var i = 0; i &lt; 15; i++) {
                                    var check = document.getElementById("edit-form:speed" + i + "Selected");                                                                  
                                    check.checked = true;
                                                                            
                                    var input = document.getElementById("edit-form:speed" + i).component;
                                    if (up) {
                                      input.setValue(Number(input.input.value) + 1);
                                    } else {
                                      input.setValue(Number(input.input.value) - 1);
                                    }
                                }
                              }
                            </script>

                          </h:panelGroup>
                        </a4j:outputPanel>

                        <a4j:outputPanel id="drivingStyle">
                          <h:panelGroup rendered="#{redFlagOrZoneAlertsBean.item.type == 'ALERT_TYPE_AGGRESSIVE_DRIVING'}">

                            <script type="text/javascript">
                              var sensitivities = new Array();
                              <c:forEach begin="1" var="sensitivity" end="5">
                                <c:set var="sLevel" value="editRedFlag_severity#{sensitivity}" />
                                sensitivities[#{sensitivity}] = '<h:outputText value="#{messages[sLevel]}" />';
                              </c:forEach>
                            </script>

                            <table width="100%" border="0" cellpadding="0" cellspacing="0">
                              <tr class="datagrid">
                                <th><h:outputText value="#{messages.editRedFlag_setting}" /></th>
                                <th width="300" colspan="2"><h:outputText value="#{messages.editRedFlag_severity}" /></th>
                              </tr>
                              <c:forEach begin="1" var="index" end="4">
                                <c:set var="sensitivityItem" value="#{(index == 1) ? 'hardAcceleration' : ((index == 2) ? 'hardBrake' : ((index == 3) ? 'hardTurn' : 'hardVertical'))}" />
                                <tr class="#{((index % 2) == 0) ? 'tableOdd' : 'tableEven'}">
                                  <td style="padding: 0px 12px 6px 12px; border-bottom: 1px solid #8BAD37;">
                                    <c:set var="sensitivitySelected" value="#{sensitivityItem}Selected" />
                                    <h:selectBooleanCheckbox id="#{sensitivityItem}Selected" value="#{redFlagOrZoneAlertsBean.item[sensitivitySelected]}" onchange="checkMultiple('type')" />
                                    <c:set var="sensitivityLabel" value="editDevice_#{sensitivityItem}" />
                                    <h:outputText value="#{messages[sensitivityLabel]}" />
                                  </td>
                                  <td style="padding: 0px 12px 6px 12px; border-bottom: 1px solid #8BAD37;" width="120">
                                    <style>
                                       .dr-insldr-track-decor-1{
                                          border: none;
                                       }
                                       
                                       .dr-insldr-track-decor-2{
                                          border: none;
                                       }

                                    </style>
                                    <rich:inputNumberSlider id="#{sensitivityItem}" 
                                             value="#{redFlagOrZoneAlertsBean.item[sensitivityItem]}" showToolTip="false" 
                                             showBoundaryValues="false" showInput="false" minValue="1" maxValue="5" 
                                             handleClass="severity-slider-handle"
                                             width="105px"
         
                                             onchange="checkMultiple('type'); document.getElementById(this.mainTable.id + 'Selected').checked = true; document.getElementById(this.mainTable.id + 'Level').innerHTML = sensitivities[this.value]" 
                                             barClass="#{((index % 2) == 0) ? 'severity-table-odd' : 'severity-table-even'} severity-slider-bar"/>
                                  </td>
                                  <td style="padding: 0px 12px 6px 0px; border-bottom: 1px solid #8BAD37; width:180">
                                    <c:set var="sensitivityLevel" value="editRedFlag_severity#{redFlagOrZoneAlertsBean.item[sensitivityItem]}" />
                                    <h:outputText id="#{sensitivityItem}Level" style="font-weight:bold" value="#{messages[sensitivityLevel]}" />
                                  </td>
                                  <td style="padding: 6px 12px 6px 12px; border-bottom: 1px solid #8BAD37;">
                                    <c:set var="sensitivityLevel" value="#{sensitivityItem}Level" />
                                  </td>
                                </tr>
                              </c:forEach>
                            </table>

                          </h:panelGroup>
                        </a4j:outputPanel>

                        <a4j:outputPanel id="editRedFlag-compliance">
                          <h:panelGroup rendered="#{redFlagOrZoneAlertsBean.item.type eq 'ALERT_TYPE_COMPLIANCE'}">

                            <table width="100%" border="0" cellpadding="2" cellspacing="0" class="datagrid">
                              <tr>
                                <th><h:outputText value="#{messages.editRedFlag_setting}" /></th>
                              </tr>
                              <tr class="tableEven">
                                <td>
                                  <c:set var="mp" value="editRedFlag_#{redFlagOrZoneAlertsBean.item.type.description}" />
                                  <h:outputText value="#{messages[mp]}" />
                                </td>
                              </tr>
<!--                                <tr class="tableOdd">-->
<!--                                  <td style="padding: 0px 12px 6px 12px; border-bottom: 1px solid #8BAD37;">-->
<!--                                    <h:selectBooleanCheckbox id="seatbeltSelected" value="#{redFlagOrZoneAlertsBean.item.}" onchange="checkMultiple('type')" />-->
<!--                                    <c:set var="sensitivityLabel" value="editDevice_#{sensitivityItem}" />-->
<!--                                    <h:outputText value="#{messages[sensitivityLabel]}" />-->
<!--                                  </td>-->
                            </table>

                          </h:panelGroup>
                        </a4j:outputPanel>

                        <a4j:outputPanel id="zoneAlerts">
                          <h:panelGroup rendered="#{redFlagOrZoneAlertsBean.item.type == 'ALERT_TYPE_ZONES'}">

                  <div class="spacer"></div>

                  <table width="790" border="0" cellspacing="0" cellpadding="0">
                    <tr>
                      <td width="390" valign="top">
						<table width="390px">
						<tr><td>
                        <table width="100%" border="0" cellspacing="2" cellpadding="4" style="background-color: #f2efe9; border: 1px solid #acacac;">
                          <tr>
                            <td width="105" valign="top">
                              <ui:include src="../../includes/admin/inputLabel.xhtml">
                                 <ui:param name="required" value="TRUE"/>
                                 <ui:param name="for" value="zoneID"/>
                                 <ui:param name="fieldName" value="zoneID"/>
                                 <ui:param name="editBean" value="#{redFlagOrZoneAlertsBean}"/>
                                 <ui:param name="label" value="#{messages.editZoneAlert_zone}"/>
								<ui:param name="context" value="editZoneAlertZoneId"/>
                              </ui:include>
                            </td>
                            <td>
                              <rich:message for="editZoneAlert-zoneID" errorClass="field-error" fatalClass="field-error" warnClass="field-warning" infoClass="field-info" styleClass="field-msg" />
                              <h:selectOneMenu id="editZoneAlert-zoneID" value="#{redFlagOrZoneAlertsBean.item.zoneID}" required="#{(not redFlagOrZoneAlertsBean.batchEdit) or redFlagOrZoneAlertsBean.updateField['zoneID']}"  requiredMessage="#{messages.required}" style="width: 200px">
                                <a4j:support event="onchange" reRender="zonePoints-panel" limitToList="true" ajaxSingle="true" onsubmit="checkMultiple(this)" oncomplete="showZone()"/>
                                <f:selectItems value="#{redFlagOrZoneAlertsBean.zones}" />
                              </h:selectOneMenu>
                            </td>
                          </tr>
                          </table></td></tr>
                          <tr>
                          <td>
                          <rich:message for="editZoneAlert-arrival" errorClass="field-error" fatalClass="field-error" warnClass="field-warning" infoClass="field-info" styleClass="field-msg" />

                        <table width="380" border="0" cellspacing="2" cellpadding="4" align="center">
                          <tr>
                            <td width="50%">
                              <h:selectBooleanCheckbox id="editZoneAlert-arrival" value="#{redFlagOrZoneAlertsBean.item.arrival}" onchange="checkMultiple('defineAlerts')" />
                              <h:outputText value="#{messages.editZoneAlert_arrival}" />
                            </td>
                            <td width="50%">
                              <h:selectBooleanCheckbox id="editZoneAlert-departure" value="#{redFlagOrZoneAlertsBean.item.departure}" onchange="checkMultiple('defineAlerts')" />
                              <h:outputText value="#{messages.editZoneAlert_departure}" />
                            </td>
                          </tr>
                        </table>
                          </td>
                          </tr>
                        </table>
                      </td>
                      <td width="10"><h:graphicImage value="/images/x.gif" width="10" /></td>
                      <td width="390" valign="top" style="background-color: #f2efe9; border: 1px solid #acacac;">
                        <div id="map-canvas" style="height:100%;height:220px;border:0"></div>
                      </td>
                    </tr>
                  </table>
                          </h:panelGroup>
                        </a4j:outputPanel>

                        <a4j:outputPanel id="editRedFlag-other">
                          <h:panelGroup rendered="#{redFlagOrZoneAlertsBean.item.type != 'ALERT_TYPE_ZONES' and redFlagOrZoneAlertsBean.item.type != 'ALERT_TYPE_SPEEDING' and redFlagOrZoneAlertsBean.item.type != 'ALERT_TYPE_AGGRESSIVE_DRIVING' and redFlagOrZoneAlertsBean.item.type != 'ALERT_TYPE_COMPLIANCE' and redFlagOrZoneAlertsBean.item.type != null}">

                            <table width="100%" border="0" cellpadding="2" cellspacing="0" class="datagrid">
                              <tr>
                                <th><h:outputText value="#{messages.editRedFlag_setting}" /></th>
                              </tr>
                              <tr class="tableEven">
                                <td>
                                  <c:set var="mp" value="editRedFlag_#{redFlagOrZoneAlertsBean.item.type.description}" />
                                  <h:outputText value="#{messages[mp]}" />
                                </td>
                              </tr>
                            </table>

                          </h:panelGroup>
                        </a4j:outputPanel>

						</a4j:outputPanel>
                      </td>
                    </tr>
                  </table>

                  <div class="spacer"></div>

                  <rich:message for="editRedFlag-emailToString" errorClass="field-error" fatalClass="field-error" warnClass="field-warning" infoClass="field-info" styleClass="field-msg" />

                  <table width="790" border="0" cellspacing="0" cellpadding="0">
                    <tr>
                      <td width="390" valign="top">

                        <div class="add_section_title">
                          <h:selectBooleanCheckbox rendered="#{redFlagOrZoneAlertsBean.batchEdit}" id="update_editRedFlag-notifyPersonIDs" value="#{redFlagOrZoneAlertsBean.updateField['notifyPersonIDs']}" />
                          <h:outputText value="#{messages.editAlerts_notificationsByName}" />
                        </div>

                        <div class="instructions"><h:outputText value="#{messages.editAlerts_notificationsByNameInstructions}" /></div>

                        <ui:include src="../../includes/autocompletePicker.xhtml">
                          <ui:param name="autocompleter" value="#{redFlagOrZoneAlertsBean.peoplePicker}" />
                          <ui:param name="onchange" value="checkMultiple('notifyPersonIDs')" />
 						  <ui:param name="context" value="editRedFlag"/>
 						  <ui:param name="formName" value="edit-form"/>
                        </ui:include>

                      </td>
                       
                      <td width="10"><h:graphicImage value="/images/x.gif" width="10" /></td>
                      <td width="390" valign="top">
                      
                        <!-- 
                        <div class="add_section_title">
                          <h:selectBooleanCheckbox rendered="#{redFlagOrZoneAlertsBean.batchEdit}" id="update_emailToString" value="#{redFlagOrZoneAlertsBean.updateField['emailToString']}" />
                          <h:outputText value="#{messages.editAlerts_notificationsByEmail}" />
                        </div>

                        <div class="instructions"><h:outputText value="#{messages.editAlerts_notificationsByEmailInstructions}" /></div>

                        <h:inputTextarea id="emailToString" value="#{redFlagOrZoneAlertsBean.item.emailToString}" rows="4" style="width:100%" onchange="checkMultiple(this)" />
                        -->
                      </td>
                      
                    </tr>
                  </table>

                  <div class="required-key"><h:outputText value="#{messages.requiredKey}" /></div>

                  <div class="spacer"></div>

                  <ul id="grid_nav" style="margin: 0;">
                    <li class="r">
                      <h:commandButton id="editRedFlagSave2" action="#{redFlagOrZoneAlertsBean.save}" styleClass="left"><span class="save"><h:outputText value="#{messages.button_save}" /></span></h:commandButton>
                      <h:outputText value=" " /><h:commandButton id="editRedFlagCancel2" action="#{redFlagOrZoneAlertsBean.cancelEdit}" immediate="true" styleClass="left"><span class="cancel"><h:outputText value="#{messages.button_cancel}" /></span></h:commandButton>
                    </li>
                  </ul>

                </div>
              </div>

              <div class="panel_sw">
                <div class="panel_statusbar"></div>
              </div>
            </div>

          </a4j:form>

          <!-- END PANEL -->
        </td>
      </tr>
    </table>
    
    <script type="text/javascript">
      var formElements = ["text", "checkbox", "radio", "select-one", "select-multiple", "textarea"];

      function bodyLoad()
      {
          if (GBrowserIsCompatible())
          {
            map = new GMap2(document.getElementById("map-canvas"));
            map.disableDragging();
            map.disableDoubleClickZoom();
            map.disableInfoWindow();
            showZone();
          }
        document.getElementById("editRedFlag-timeframePickers").style.display = (document.getElementById("edit-form:editRedFlag-timeframe:0").checked ? 'none' : '');

        var elements = document.getElementById("edit-form").elements;
        for (var i = 0; i &lt; elements.length; i++)
          for (var j = 0; j &lt; formElements.length; j++)
            if (elements[i].getAttribute("type") == formElements[j])
            {
              elements[i].focus();
              return;
            }
      }
      function showZone()
      {
        map.clearOverlays();
        if(document.getElementById("edit-form:editZoneAlert-zonePoints") != null)
        { 
           
	        var outline = fromOutlineString(document.getElementById("edit-form:editZoneAlert-zonePoints").value);
	        if (outline)
	        {
	          centerMapAtZone(getLatLngBounds(outline));
	          loadZone(outline, false);
	        }
        }
      }

      function bodyUnload()
      {
        GUnload();
      }

    </script>

  </ui:define>

</ui:composition>
