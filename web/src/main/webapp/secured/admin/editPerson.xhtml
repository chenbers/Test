<ui:composition template="/layout/layout.xhtml"
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:rich="http://richfaces.org/rich"
	xmlns:a4j="http://richfaces.org/a4j"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:security="http://pro.tiwi.com/jsf/security"
     xmlns:tiwiprofn="http://pro.tiwi.com/jsffunctions"
     xmlns:t="http://myfaces.apache.org/tomahawk">

  <ui:param name="adminSelected" value="current" />
  <ui:param name="helpFile" value="Add_a_Person.htm" />
  <ui:param name="title" value="#{personBean.add ? messages.adminHeader_addPerson : (personBean.batchEdit ? messages.adminHeader_editPeople : messages.adminHeader_editPerson)}"/>
  <ui:define name="scripts">
      <script type="text/javascript" src="#{facesContext.externalContext.requestContextPath}/js/adminEdit.js"></script>
  </ui:define>
  
  <ui:define name="content">
    <table width="920" border="0" cellspacing="0" cellpadding="0" align="center" style="margin: 0 auto 0 auto;">
      <tr>
      <td valign="top" width="130">
        <ui:include src="/includes/adminSideNav.xhtml">
          <ui:param name="selectedAction" value="#{(personBean.add) ? 'go_adminAddPerson' : 'go_adminPeople'}" />
          <ui:param name="parentAction" value="go_adminPeople" />
        </ui:include>
      </td>
      <td valign="top">
          <!-- START PANEL -->

        <a4j:form id="edit-form">

          <div class="">
            <div class="panel_nw">
              <div class="panel_title">
                <span class="admin"><h:outputText value="#{personBean.add ? messages.adminHeader_addPerson : (personBean.batchEdit ? messages.adminHeader_editPeople : messages.adminHeader_editPerson)}" /></span>
                <span class="panel_links"></span>
              </div>
            </div>
            <div class="panel_w">
              <div class="panel_content">

                <ul id="grid_nav" style="margin: 0;">
                  <li class="r">
                    <h:commandButton action="#{personBean.save}" styleClass="left"><span class="save"><h:outputText value="#{messages.button_save}" /></span></h:commandButton>
                    <h:outputText value=" " /><h:commandButton action="#{personBean.cancelEdit}" immediate="true" styleClass="left"><span class="cancel"><h:outputText value="#{messages.button_cancel}" /></span></h:commandButton>
                  </li>
                </ul>
                
                <ui:fragment rendered="${tiwiprofn:messagesAvailable()}">
                  <dl id="display-form:j_id122" class="rich-messages msg" style="">
                     <dt class="error">
                        <h:outputFormat value="#{messages.error_validationMsg}">
                           <f:param value="${tiwiprofn:getMessageCount()}"/>
                        </h:outputFormat>
                     </dt>
                  </dl>
                </ui:fragment>
                
                <rich:messages globalOnly="true" errorClass="error" fatalClass="error" warnClass="warning" infoClass="info" styleClass="msg"/>

                <div class="spacer"></div>

                <table width="790" border="0" cellspacing="0" cellpadding="0">
                  <tr>
                    <td width="390" valign="top">

                      <div class="add_section_title"><h:outputText value="#{messages.editPerson_personalInformation}" /></div>

                      <table width="370" border="0" cellspacing="2" cellpadding="4" align="center">
                        <ui:fragment rendered="#{not personBean.batchEdit}">
                        <tr>
                          <td width="100" valign="top">
                            <h:outputText value="#{messages.editPerson_first}" />
                            <span class="required">*</span>
                          </td>
                          <td>
                            <rich:message for="first" errorClass="field-error" fatalClass="field-error" warnClass="field-warning" infoClass="field-info" styleClass="field-msg" />
                            <h:inputText value="#{personBean.item.first}" id="first" disabled="#{!personBean.item.userEditable}" onchange="checkMultiple(this)" styleClass="text" size="30"
                              maxlength="20" required="#{(not personBean.batchEdit) or personBean.updateField['first']}" requiredMessage="#{messages.required}" />
                          </td>
                        </tr>
                        <tr>
                          <td width="100" valign="top"><h:outputText value="#{messages.editPerson_middle}" /></td>
                          <td>
                            <h:inputText value="#{personBean.item.middle}" id="middle" disabled="#{!personBean.item.userEditable}" onchange="checkMultiple(this)" styleClass="text" size="30" maxlength="20" />
                          </td>
                        </tr>
                        <tr>
                          <td width="100" valign="top">
                            <h:outputText value="#{messages.editPerson_last}" />
                            <span class="required">*</span>
                          </td>
                          <td>
                            <rich:message for="last" errorClass="field-error" fatalClass="field-error" warnClass="field-warning" infoClass="field-info" styleClass="field-msg" />
                            <h:inputText value="#{personBean.item.last}" id="last" disabled="#{!personBean.item.userEditable}" onchange="checkMultiple(this)" styleClass="text" size="30"
                              maxlength="20" required="#{(not personBean.batchEdit) or personBean.updateField['last']}" requiredMessage="#{messages.required}" />
                          </td>
                        </tr>
                        <tr>
                        <td width="100" valign="top"><h:outputText value="#{messages.editPerson_suffix}" /></td>
                          <td>
                            <h:selectOneMenu value="#{personBean.item.suffix}" id="suffix" disabled="#{!personBean.item.userEditable}" onchange="checkMultiple(this)">
                              <f:selectItem itemLabel="" />
                              <f:selectItem itemValue="#{messages.editPerson_suffixJr}" />
                              <f:selectItem itemValue="#{messages.editPerson_suffixSr}" />
                              <f:selectItem itemValue="#{messages.editPerson_suffixIII}" />
                            </h:selectOneMenu>
                          </td>
                        </tr>
                        <tr>
                          <td width="100" valign="top"><h:outputText value="#{messages.editPerson_dob}" /></td>
                          <td>
                            <rich:message for="dob" errorClass="field-error" fatalClass="field-error" warnClass="field-warning" infoClass="field-info" styleClass="field-msg" />
                            <rich:calendar value="#{personBean.item.dob}" id="dob" disabled="#{!personBean.item.userEditable}" todayControlMode="hidden" enableManualInput="true" converterMessage="#{messages.editPerson_dateFormat}" timeZone="#{personBean.utcTimeZone}" />
                          </td>
                        </tr>
                        </ui:fragment>
                        <tr>
                          <td width="100" valign="top">
                            <h:selectBooleanCheckbox rendered="#{personBean.batchEdit}" id="update_gender" disabled="#{!personBean.item.userEditable}" value="#{personBean.updateField['gender']}" />
                            <h:outputText value="#{messages.editPerson_gender}" />
                          </td>
                          <td>
                            <h:selectOneMenu value="#{personBean.item.gender}" id="gender" disabled="#{!personBean.item.userEditable}" onchange="checkMultiple(this)" converter="SimpleBeanConverter">
                              <f:selectItem itemLabel="" />
                              <f:selectItems value="#{personBean.genders}" />
                            </h:selectOneMenu>
                          </td>
                        </tr>
                        <tr>
                          <td width="100" valign="top">
                            <h:selectBooleanCheckbox rendered="#{personBean.batchEdit}" id="update_height" disabled="#{!personBean.item.userEditable}" value="#{personBean.updateField['height']}" />
                            <h:outputText value="#{messages.editPerson_height}" />
                          </td>
                          <td>
                            <h:selectOneMenu value="#{personBean.item.height}" id="height" disabled="#{!personBean.item.userEditable}" onchange="checkMultiple(this)">
                              <f:selectItem itemLabel="" />
                              <f:selectItems value="#{personBean.heights}" />
                            </h:selectOneMenu>
                          </td>
                        </tr>
                        <tr>
                          <td width="100" valign="top">
                            <h:selectBooleanCheckbox rendered="#{personBean.batchEdit}" id="update_weight" disabled="#{!personBean.item.userEditable}" value="#{personBean.updateField['weight']}" />
                            <h:outputText value="#{messages.editPerson_weight}" />
                          </td>
                          <td>
                            <rich:message for="weight" errorClass="field-error" fatalClass="field-error" warnClass="field-warning" infoClass="field-info" styleClass="field-msg" />
                            <rich:inputNumberSpinner value="#{personBean.item.weight}" id="weight" disabled="#{!personBean.item.userEditable}" onchange="checkMultiple('weight')" minValue="50" maxValue="400" step="1" />
                          </td>
                        </tr>
                      </table>
                      <!-- 
                      <div class="spacer"></div>

                      <div class="add_section_title"><h:outputText value="#{messages.editPerson_contactInformation}" /></div>

                      <table width="370" border="0" cellspacing="2" cellpadding="4" align="center">
                        <ui:fragment rendered="#{not personBean.batchEdit}">
                        <tr>
                          <td width="100" valign="top"><h:outputText value="#{messages.editPerson_address_addr1}" /></td>
                          <td>
                            <rich:message for="address_addr1" errorClass="field-error" fatalClass="field-error" warnClass="field-warning" infoClass="field-info" styleClass="field-msg" />
                            <h:inputText value="#{personBean.item.address.addr1}" id="address_addr1" disabled="#{!personBean.item.userEditable}" onchange="checkMultiple(this)" styleClass="text" size="30" maxlength="126" />
                          </td>
                        </tr>
                        <tr>
                          <td width="100" valign="top"><h:outputText value="#{messages.editPerson_address_addr2}" /></td>
                          <td>
                            <h:inputText value="#{personBean.item.address.addr2}" id="address_addr2" disabled="#{!personBean.item.userEditable}" onchange="checkMultiple(this)" styleClass="text" size="30" maxlength="126" />
                          </td>
                        </tr>
                        </ui:fragment>
                        <tr>
                          <td width="100" valign="top">
                            <h:selectBooleanCheckbox rendered="#{personBean.batchEdit}" id="update_address_city" disabled="#{!personBean.item.userEditable}" value="#{personBean.updateField['address.city']}" />
                            <h:outputText value="#{messages.editPerson_address_city}" />
                          </td>
                          <td>
                            <rich:message for="address_city" errorClass="field-error" fatalClass="field-error" warnClass="field-warning" infoClass="field-info" styleClass="field-msg" />
                            <h:inputText value="#{personBean.item.address.city}" id="address_city" disabled="#{!personBean.item.userEditable}" onchange="checkMultiple(this)" styleClass="text" size="30" maxlength="30" />
                          </td>
                        </tr>
                        <tr>
                          <td width="100" valign="top">
                            <h:selectBooleanCheckbox rendered="#{personBean.batchEdit}" id="update_address_state" disabled="#{!personBean.item.userEditable}" value="#{personBean.updateField['address.state']}" />
                            <h:outputText value="#{messages.editPerson_address_state}" />
                          </td>
                          <td>
                            <rich:message for="address_state" errorClass="field-error" fatalClass="field-error" warnClass="field-warning" infoClass="field-info" styleClass="field-msg" />
                            <h:selectOneMenu value="#{personBean.item.address.state}" id="address_state" disabled="#{!personBean.item.userEditable}" onchange="checkMultiple(this)">
                              <f:selectItem itemLabel="" />
                              <f:converter  converterId="StateConverter"/>
                              <f:selectItems value="#{personBean.states}" />
                            </h:selectOneMenu>
                          </td>
                        </tr>
                        <tr>
                          <td width="100" valign="top">
                            <h:selectBooleanCheckbox rendered="#{personBean.batchEdit}" id="update_address_zip" disabled="#{!personBean.item.userEditable}" value="#{personBean.updateField['address.zip']}" />
                            <h:outputText value="#{messages.editPerson_address_zip}" />
                          </td>
                          <td>
                            <rich:message for="address_zip" errorClass="field-error" fatalClass="field-error" warnClass="field-warning" infoClass="field-info" styleClass="field-msg" />
                            <h:inputText value="#{personBean.item.address.zip}" label="#{messages.editPerson_address_zip}" id="address_zip" disabled="#{!personBean.item.userEditable}" onchange="checkMultiple(this)" styleClass="text" size="12" maxlength="10" validatorMessage="#{messages.editPerson_zipFormat}">
                              <f:validator validatorId="com.inthinc.pro.validators.RegexValidator" />
                              <f:attribute name="regex" value="\d{5}(-\d{4})?" />
                            </h:inputText>
                          </td>
                        </tr>
                      </table>
                      -->
                       
                      <div class="spacer"></div>

                      <div class="add_section_title">
                        <h:selectBooleanCheckbox rendered="#{not personBean.batchEdit}" id="isDriver" value="#{personBean.item.driverSelected}">
                          <a4j:support event="onclick" onsubmit="showSection('driverTable', this.checked)" ajaxSingle="true" reRender="isDriver" limitToList="true" />
                        </h:selectBooleanCheckbox>
                        <h:outputText value="#{messages.editPerson_driverInformation}" />
                      </div>

                      <table id="driverTable" width="370" border="0" cellspacing="2" cellpadding="4" align="center">
                        <ui:fragment rendered="#{not personBean.batchEdit}">
                        <tr>
                          <td width="100" valign="top"><h:outputText value="#{messages.editPerson_driver_license}" /></td>
                          <td>
                            <rich:message for="driver_license" errorClass="field-error" fatalClass="field-error" warnClass="field-warning" infoClass="field-info" styleClass="field-msg" />
                            <h:inputText value="#{personBean.item.driver.license}" id="driver_license" onchange="checkMultiple(this)" styleClass="text" size="30" maxlength="10" />
                          </td>
                        </tr>
                        </ui:fragment>
                        <tr>
                          <td width="100" valign="top">
                            <h:selectBooleanCheckbox rendered="#{personBean.batchEdit}" id="update_driver_licenseClass" value="#{personBean.updateField['driver.licenseClass']}" />
                            <h:outputText value="#{messages.editPerson_driver_licenseClass}" />
                          </td>
                          <td>
                            <h:selectOneMenu value="#{personBean.item.driver.licenseClass}" id="driver_licenseClass" onchange="checkMultiple(this)">
                              <f:selectItem itemLabel="" />
                              <f:selectItems value="#{personBean.licenseClasses}" />
                            </h:selectOneMenu>
                          </td>
                        </tr>
                        <tr>
                          <td width="100" valign="top">
                            <h:selectBooleanCheckbox rendered="#{personBean.batchEdit}" id="update_driver_state" value="#{personBean.updateField['driver.state']}" />
                            <h:outputText value="#{messages.editPerson_driver_state}" />
                          </td>
                          <td>
                            <rich:message for="driver_state" errorClass="field-error" fatalClass="field-error" warnClass="field-warning" infoClass="field-info" styleClass="field-msg" />
                            <h:selectOneMenu value="#{personBean.item.driver.state}" id="driver_state" onchange="checkMultiple(this)">
                         <f:selectItem itemLabel="" />
                         <f:converter  converterId="StateConverter"/>
                              <f:selectItems value="#{personBean.states}" />
                            </h:selectOneMenu>
                          </td>
                        </tr>
                        <tr>
                          <td width="100" valign="top">
                            <h:selectBooleanCheckbox rendered="#{personBean.batchEdit}" id="update_driver_expiration" value="#{personBean.updateField['driver.expiration']}" />
                            <h:outputText value="#{messages.editPerson_driver_expiration}" />
                          </td>
                          <td>
                            <rich:message for="driver_expiration" errorClass="field-error" fatalClass="field-error" warnClass="field-warning" infoClass="field-info" styleClass="field-msg" />
                            <rich:calendar value="#{personBean.item.driverExp}" id="driver_expiration" 
                              onchange="checkMultiple('driver_expiration')" 
                              oninputchange="checkMultiple('driver_expiration')" ondateselect="checkMultiple('driver_expiration')" 
                              enableManualInput="true" 
                              converterMessage="#{messages.editPerson_dateFormat}" 
                              timeZone="#{personBean.utcTimeZone}" /> 
                                
                          </td>
                        </tr>
                        <ui:fragment rendered="#{not personBean.batchEdit}">
                        <tr>
                          <td width="100" valign="top"><h:outputText value="#{messages.editPerson_driver_RFID}" /></td>
                          <td>
                            <rich:message for="driver_RFID" errorClass="field-error" fatalClass="field-error" warnClass="field-warning" infoClass="field-info" styleClass="field-msg" />
                            <h:inputText value="#{personBean.item.driver.RFID}" id="driver_RFID" onchange="checkMultiple(this)" styleClass="text" size="30"
                              maxlength="16" required="false" converterMessage="#{messages.editPerson_RFIDFormat}" validatorMessage="#{messages.editPerson_RFIDFormat}">
                              <f:validateLongRange minimum="-2305843009213693952" maximum="-2233785415175766017" />
                              <f:converter converterId="HexConverter" />
                            </h:inputText>
                          </td>
                        </tr>
                        </ui:fragment>
                        <tr>
                          <td width="100" valign="top">
                            <h:selectBooleanCheckbox rendered="#{personBean.batchEdit}" id="update_driver_certifications" value="#{personBean.updateField['driver.certifications']}" />
                            <h:outputText value="#{messages.editPerson_driver_certifications}" />
                          </td>
                          <td>
                            <h:inputText value="#{personBean.item.driver.certifications}" id="driver_certifications" onchange="checkMultiple(this)" styleClass="text" size="30" maxlength="160" />
                          </td>
                        </tr>
                        <tr>
                          <td width="100" valign="top">
                            <h:selectBooleanCheckbox rendered="#{personBean.batchEdit}" id="update_driver_dot" value="#{personBean.updateField['driver.dot']}" />
                            <h:outputText value="#{messages.editPerson_driver_dot}" />
                          </td>
                          <td>
                            <h:inputText value="#{personBean.item.driver.dot}" id="driver_dot" onchange="checkMultiple(this)" styleClass="text" size="30" maxlength="160" />
                          </td>
                        </tr>
                        <tr>
                          <td width="100" valign="top">
                             <ui:include src="../../includes/inputLabel.xhtml">
                           <ui:param name="required" value="TRUE"/>
                           <ui:param name="for" value="driver_groupID"/>
                           <ui:param name="fieldName" value="driver.groupID"/>
                           <ui:param name="editBean" value="#{personBean}"/>
                           <ui:param name="label" value="#{messages.editPerson_driver_team}"/>
                       </ui:include>
                          </td>
                          <td>
                            <rich:message for="driver_groupID" errorClass="field-error" fatalClass="field-error" warnClass="field-warning" infoClass="field-info" styleClass="field-msg" />
                            <h:selectOneMenu value="#{personBean.item.driver.groupID}" 
                              id="driver_groupID" 
                              required="#{personBean.item.driverSelected and (not personBean.batchEdit)}" 
                              requiredMessage="#{messages.required}"
                              onchange="checkMultiple(this)">
                              <f:selectItem itemLabel="" />
                              <f:selectItems value="#{personBean.teams}" />
                            </h:selectOneMenu>
                          </td>
                        </tr>
                        <tr>
                          <td width="100" valign="top">
                            <ui:include src="../../includes/inputLabel.xhtml">
                           <ui:param name="required" value="TRUE"/>
                           <ui:param name="fieldName" value="driver.status"/>
                           <ui:param name="for" value="driver_status"/>
                           <ui:param name="editBean" value="#{personBean}"/>
                           <ui:param name="label" value="#{messages.editPerson_driver_status}"/>
                      </ui:include>
                          </td>
                          <td>
                            <rich:message for="driver_status" errorClass="field-error" fatalClass="field-error" warnClass="field-warning" infoClass="field-info" styleClass="field-msg" />
                            <h:selectOneMenu value="#{personBean.item.driver.status}" 
                              id="driver_status" 
                                required="#{personBean.item.driverSelected and (not personBean.batchEdit)}" 
                                requiredMessage="#{messages.required}"
                                onchange="checkMultiple(this)"
                                converter="SimpleBeanConverter">
                              <f:selectItems value="#{personBean.statuses}"/>
                            </h:selectOneMenu>
                          </td>
                        </tr>
                      </table>
                    </td>
                    <td width="10"><h:graphicImage value="/images/x.gif" width="10" /></td>
                    <td width="390" valign="top">

                      <div class="add_section_title"><h:outputText value="#{messages.editPerson_employeeInformation}" /></div>

                      <table width="370" border="0" cellspacing="2" cellpadding="4" align="center">     
                      <ui:fragment rendered="#{not personBean.batchEdit}">  
                        <tr>
                          <td width="100" valign="top">
                            <h:outputText value="#{messages.editPerson_empid}" />
                          </td>
                          <td>
                            <rich:message for="empid" errorClass="field-error" fatalClass="field-error" warnClass="field-warning" infoClass="field-info" styleClass="field-msg" />
                            <h:inputText value="#{personBean.item.empid}" id="empid" disabled="#{!personBean.item.userEditable}" onchange="checkMultiple(this)" styleClass="text" size="30"
                              maxlength="20"/>
                          </td>
                        </tr>   
                        </ui:fragment>
                        <tr>
                          <td width="100" valign="top">
                            <h:selectBooleanCheckbox rendered="#{personBean.batchEdit}" id="update_reportsTo" disabled="#{!personBean.item.userEditable}" value="#{personBean.updateField['reportsTo']}" />
                            <h:outputText value="#{messages.editPerson_reportsTo}" />
                          </td>
                          <td>
                            <h:inputText value="#{personBean.item.reportsTo}" id="reportsTo" disabled="#{!personBean.item.userEditable}" onchange="checkMultiple(this)" styleClass="text" size="30" maxlength="60" />
                            <rich:suggestionbox for="reportsTo" suggestionAction="#{personBean.findPeople}" eventsQueue="reportsToQueue" var="personName">
                              <h:column><h:outputText value="#{personName}"/></h:column>
                            </rich:suggestionbox>
                          </td>
                        </tr>
                        <tr>
                          <td width="100" valign="top">
                            <h:selectBooleanCheckbox rendered="#{personBean.batchEdit}" id="update_title" disabled="#{!personBean.item.userEditable}" value="#{personBean.updateField['title']}" />
                            <h:outputText value="#{messages.editPerson_title}" />
                          </td>
                          <td>
                            <h:inputText value="#{personBean.item.title}" id="title" disabled="#{!personBean.item.userEditable}" onchange="checkMultiple(this)" styleClass="text" size="30" maxlength="30" />
                          </td>
                        </tr>
                        <tr>
                          <td width="100" valign="top">
                          	<ui:include src="../../includes/inputLabel.xhtml">
								<ui:param name="required" value="TRUE"/>
								<ui:param name="for" value="timeZone"/>
								<ui:param name="fieldName" value="timeZone"/>
								<ui:param name="editBean" value="#{personBean}"/>
								<ui:param name="label" value="#{messages.editPerson_timeZone}"/>
							</ui:include>
                          </td>
                          <td>
                            <rich:message for="timeZone" errorClass="field-error" fatalClass="field-error" warnClass="field-warning" infoClass="field-info" styleClass="field-msg" />
                            <h:selectOneMenu value="#{personBean.item.timeZone}" 
                                    id="timeZone" disabled="#{!personBean.item.userEditable}" 
                                    onchange="checkMultiple(this)"
                                    required="#{not personBean.batchEdit}" 
                                    requiredMessage="#{messages.required}" 
                                    style="width:200px">
                              <f:selectItem itemLabel="" />
                              <f:converter  converterId="TimeZoneConverter" />
                              <f:selectItems value="#{personBean.timeZones}" />
                            </h:selectOneMenu>
                          </td>
                        </tr>
                      </table>
                      
                      <rich:message for="isUser" errorClass="field-error" fatalClass="field-error" warnClass="field-warning" infoClass="field-info" styleClass="field-msg" />
                      <div class="add_section_title">
                        <h:selectBooleanCheckbox rendered="#{not personBean.batchEdit}" id="isUser" disabled="#{!personBean.item.userEditable}" value="#{personBean.item.userSelected}">
                          <a4j:support event="onclick" ajaxSingle="true" reRender="isUser,userInfoPanel,emailRequired" limitToList="true" />
                        </h:selectBooleanCheckbox>
                        <h:outputText value="#{messages.editPerson_userInformation}" />
                      </div>
   
                      <h:panelGroup id="userInfoPanel">
                      <h:outputText rendered="#{personBean.item.userSelected}">
                      <table id="userTable" width="370" border="0" cellspacing="2" cellpadding="4" align="center">
                        <ui:fragment rendered="#{not personBean.batchEdit}">
                        <tr>
                          <td width="100" valign="top">
                            <h:outputText value="#{messages.editPerson_user_username}" />
                            <span class="required">*</span>
                          </td>
                          <td>
                            <rich:message for="user_username" errorClass="field-error" fatalClass="field-error" warnClass="field-warning" infoClass="field-info" styleClass="field-msg" />
                            <h:inputText value="#{personBean.item.user.username}" id="user_username" disabled="#{!personBean.item.userEditable}" onchange="checkMultiple(this)" styleClass="text" size="30"
                              maxlength="30" required="#{personBean.item.userSelected and ((not personBean.batchEdit) or personBean.updateField['user.username'])}" requiredMessage="#{messages.required}" />
                          </td>
                        </tr>
                        
                        <tr>
                          <td width="100" valign="top">
                            <h:outputText value="#{messages.editPerson_user_password}" />
                            <h:outputText rendered="#{empty personBean.item.user.password}" styleClass="required" value=" *" />
                          </td>
                          <td>
                            <rich:message for="user_password" errorClass="field-error" fatalClass="field-error" warnClass="field-warning" infoClass="field-info" styleClass="field-msg" />
                            <h:inputSecret value="#{personBean.item.password}" id="user_password" disabled="#{!personBean.item.userEditable}" redisplay="true" onchange="checkMultiple(this)" styleClass="text" size="30"
                              maxlength="30" required="#{personBean.item.userSelected and empty personBean.item.user.password}" requiredMessage="#{messages.required}" validatorMessage="#{messages.editPerson_passwordFormat}">
                              <f:validator validatorId="com.inthinc.pro.validators.RegexValidator" />
                              <f:attribute name="regex" value="\S{6,12}" />
                            </h:inputSecret>
                          </td>
                        </tr>
                        <tr>
                          <td width="100" valign="top">
                            <h:outputText value="#{messages.editPerson_confirmPassword}" />
                            <h:outputText rendered="#{empty personBean.item.user.password}" styleClass="required" value="*" />
                          </td>
                          <td>
                            <rich:message for="confirmPassword" errorClass="field-error" fatalClass="field-error" warnClass="field-warning" infoClass="field-info" styleClass="field-msg" />
                            <h:inputSecret value="#{personBean.item.confirmPassword}" id="confirmPassword" disabled="#{!personBean.item.userEditable}" redisplay="true" onchange="checkMultiple(this)" styleClass="text" size="30"
                              maxlength="30" required="#{personBean.item.userSelected and empty personBean.item.user.password}" requiredMessage="#{messages.required}" />
                          </td>
                        </tr>
                        
                        </ui:fragment>
                        <tr>
                             <td width="100">
                                 <ui:include src="../../includes/inputLabel.xhtml">
                                    <ui:param name="required" value="TRUE"/>
                                    <ui:param name="fieldName" value="user.locale"/>
                                    <ui:param name="for" value="user_locale"/>
                                    <ui:param name="editBean" value="#{personBean}"/>
                                    <ui:param name="label" value="#{messages.editPerson_user_locale}"/>
                                 </ui:include>
                             </td>
                             <td>
                                 <rich:message for="user_locale" errorClass="field-error" fatalClass="field-error" warnClass="field-warning" infoClass="field-info" styleClass="field-msg" />
                                 <h:selectOneMenu id="user_locale" value="#{personBean.item.user.locale}" converter="SimpleBeanConverter" onchange="checkMultiple(this)">
                                     <f:selectItems value="#{localeBean.supportedLocalesItems}"/>
                                 </h:selectOneMenu>
                             </td>
                        </tr>
                        <tr>
                          <td width="100" valign="top">
                          	<ui:include src="../../includes/inputLabel.xhtml">
								<ui:param name="required" value="TRUE"/>
								<ui:param name="fieldName" value="user.groupID"/>
                                <ui:param name="for" value="user_groupID"/>
								<ui:param name="editBean" value="#{personBean}"/>
								<ui:param name="label" value="#{messages.editPerson_user_group}"/>
							</ui:include>
                          </td>
                          <td>
                            <rich:message for="user_groupID" errorClass="field-error" fatalClass="field-error" warnClass="field-warning" infoClass="field-info" styleClass="field-msg" />
                            <h:selectOneMenu value="#{personBean.item.user.groupID}" 
                            	id="user_groupID" disabled="#{!personBean.item.userEditable}" 
                            	required="#{not personBean.batchEdit}" 
                                 requiredMessage="#{messages.required}"
                            	onchange="checkMultiple(this)">
                              <f:selectItem itemLabel="" />
                              <f:selectItems value="#{personBean.groups}" />
                            </h:selectOneMenu>
                          </td>
                        </tr>
                        <tr>
                          <td width="100" valign="top">
                          	<ui:include src="../../includes/inputLabel.xhtml">
								<ui:param name="required" value="TRUE"/>
								<ui:param name="for" value="user_role"/>
								<ui:param name="fieldName" value="user.role"/>
								<ui:param name="editBean" value="#{personBean}"/>
								<ui:param name="label" value="#{messages.editPerson_user_role}"/>
							</ui:include>
                          </td>
                          <td>
                            <rich:message for="user_role" errorClass="field-error" fatalClass="field-error" warnClass="field-warning" infoClass="field-info" styleClass="field-msg" />
                            <h:selectOneMenu value="#{personBean.item.user.role}" id="user_role" 
                            		converter="SimpleBeanConverter"
                            		disabled="#{!personBean.item.userEditable}" 
                                    required="#{not personBean.batchEdit}" 
                                    requiredMessage="#{messages.required}"
                            		onchange="checkMultiple(this)">
                              	<f:selectItems value="#{personBean.roles}" />
                            </h:selectOneMenu>
                          </td>
                        </tr>
                        <tr>
                          <td width="100" valign="top">
                          	<ui:include src="../../includes/inputLabel.xhtml">
								<ui:param name="required" value="TRUE"/>
								<ui:param name="for" value="user_status"/>
								<ui:param name="fieldName" value="user.status"/>
								<ui:param name="editBean" value="#{personBean}"/>
								<ui:param name="label" value="#{messages.editPerson_user_status}"/>
							</ui:include>
                          </td>
                          <td>
                            <rich:message for="user_status" errorClass="field-error" fatalClass="field-error" warnClass="field-warning" infoClass="field-info" styleClass="field-msg" />
                            <h:selectOneMenu value="#{personBean.item.user.status}" 
                                 id="user_status" disabled="#{!personBean.item.userEditable}" 
                                 required="#{not personBean.batchEdit}" 
                               requiredMessage="#{messages.required}"
                                  onchange="checkMultiple(this)"
                                  converter="SimpleBeanConverter">
                             <f:selectItems value="#{personBean.statuses}"/>
                            </h:selectOneMenu>
                          </td>
                        </tr>
                        <tr>
                             <td width="100">
                                 <ui:include src="../../includes/inputLabel.xhtml">
                                    <ui:param name="required" value="TRUE"/>
                                    <ui:param name="fieldName" value="user.person.measurementType"/>
                                    <ui:param name="for" value="user_person_measurementType"/>
                                    <ui:param name="editBean" value="#{personBean}"/>
                                    <ui:param name="label" value="#{messages.editPerson_user_measurementType}"/>
                                 </ui:include>
                             </td>
                             <td>
                                 <rich:message for="user_person_measurementType" errorClass="field-error" fatalClass="field-error" warnClass="field-warning" infoClass="field-info" styleClass="field-msg" />
                                 <h:selectOneMenu id="user_person_measurementType" value="#{measurementBean.person.measurementType}" converter="SimpleBeanConverter" onchange="checkMultiple(this)">
                                        <f:selectItems value="#{measurementBean.measurementTypeItems}"/>
                                 </h:selectOneMenu>
                             </td>
                        </tr>
                      </table>
                      </h:outputText>
                      </h:panelGroup>
                      
                      <div class="spacer"></div>
                      <div class="add_section_title"><h:outputText value="#{messages.editPerson_notifications}" /></div>

                      <table width="370" border="0" cellspacing="2" cellpadding="4" align="center">
                        <ui:fragment rendered="#{not personBean.batchEdit}">
                        <tr>
                          <td width="100" valign="top">
                            <h:outputText value="#{messages.editPerson_priEmail}" />
                            <a4j:outputPanel id="emailRequired">
                              <h:outputText rendered="#{personBean.item.userSelected}" styleClass="required" value=" *" />
                            </a4j:outputPanel>
                          </td>
                          <td>
                            <rich:message for="priEmail" errorClass="field-error" fatalClass="field-error" warnClass="field-warning" infoClass="field-info" styleClass="field-msg" />
                            <h:inputText value="#{personBean.item.priEmail}" id="priEmail" disabled="#{!personBean.item.userEditable}" onkeyup="populateAlertText()" onchange="checkMultiple(this)" styleClass="text" size="30"
                              maxlength="62" validatorMessage="#{messages.editPerson_emailFormat}">
                             <t:validateEmail />
                            </h:inputText>
                          </td>
                        </tr>
                        <tr>
                          <td width="100" valign="top"><h:outputText value="#{messages.editPerson_secEmail}" /></td>
                          <td>
                            <rich:message for="secEmail" errorClass="field-error" fatalClass="field-error" warnClass="field-warning" infoClass="field-info" styleClass="field-msg" />
                            <h:inputText value="#{personBean.item.secEmail}" id="secEmail" disabled="#{!personBean.item.userEditable}" onkeyup="populateAlertText()" onchange="checkMultiple(this)" styleClass="text" size="30"
                              maxlength="62" validatorMessage="#{messages.editPerson_emailFormat}">
                              <t:validateEmail />
                            </h:inputText>
                          </td>
                        </tr>
                        <tr>
                          <td width="100" valign="top"><h:outputText value="#{messages.editPerson_priText}" /></td>
                          <td>
                            <rich:message for="priText" errorClass="field-error" fatalClass="field-error" warnClass="field-warning" infoClass="field-info" styleClass="field-msg" />
                            <h:inputText value="#{personBean.item.priText}" id="priText" disabled="#{!personBean.item.userEditable}" onkeyup="populateAlertText()" onchange="checkMultiple(this)" styleClass="text" size="30"
                              maxlength="62" validatorMessage="#{messages.editPerson_textMessageFormat}">
                              <f:validator validatorId="com.inthinc.pro.validators.EmailValidator" />
                            </h:inputText>
                          </td>
                        </tr>
                        <tr>
                          <td width="100" valign="top"><h:outputText value="#{messages.editPerson_secText}" /></td>
                          <td>
                            <rich:message for="secText" errorClass="field-error" fatalClass="field-error" warnClass="field-warning" infoClass="field-info" styleClass="field-msg" />
                            <h:inputText value="#{personBean.item.secText}" id="secText" disabled="#{!personBean.item.userEditable}" onkeyup="populateAlertText()" onchange="checkMultiple(this)" styleClass="text" size="30"
                              maxlength="62" validatorMessage="#{messages.editPerson_textMessageFormat}">
                              <f:validator validatorId="com.inthinc.pro.validators.EmailValidator" />
                            </h:inputText>
                          </td>
                        </tr>
                        <tr>
                          <td width="100" valign="top"><h:outputText value="#{messages.editPerson_priPhone}" /></td>
                          <td>
                            <rich:message for="priPhone" errorClass="field-error" fatalClass="field-error" warnClass="field-warning" infoClass="field-info" styleClass="field-msg" />
                            <h:inputText value="#{personBean.item.priPhone}" id="priPhone" disabled="#{!personBean.item.userEditable}" onkeyup="populateAlertText()" onchange="checkMultiple(this)" styleClass="text" size="30" maxlength="22" validatorMessage="#{messages.editPerson_phoneFormat}" converter="PhoneNumberConverter">
                              <f:validator validatorId="com.inthinc.pro.validators.RegexValidator" />
                              <f:attribute name="regex" value="\D?\d{3}\D*\d{3}\D?\d{4}" />
                            </h:inputText>
                          </td>
                        </tr>
                        <tr>
                          <td width="100" valign="top"><h:outputText value="#{messages.editPerson_secPhone}" /></td>
                          <td>
                            <rich:message for="secPhone" errorClass="field-error" fatalClass="field-error" warnClass="field-warning" infoClass="field-info" styleClass="field-msg" />
                            <h:inputText value="#{personBean.item.secPhone}" id="secPhone" disabled="#{!personBean.item.userEditable}" onkeyup="populateAlertText()" onchange="checkMultiple(this)" styleClass="text" size="30" maxlength="22" validatorMessage="#{messages.editPerson_phoneFormat}" converter="PhoneNumberConverter">
                              <f:validator validatorId="com.inthinc.pro.validators.RegexValidator" />
                              <f:attribute name="regex" value="\D?\d{3}\D*\d{3}\D?\d{4}" />
                            </h:inputText>
                          </td>
                        </tr>
                        </ui:fragment>
                        <tr>
                          <td width="100">
                            <ui:include src="../../includes/inputLabel.xhtml">
                                 <ui:param name="required" value="FALSE"/>
                                 <ui:param name="fieldName" value="info"/>
                                 <ui:param name="for" value="info"/>
                                 <ui:param name="iconSrc" value="/images/ico_info.png"/>
                                 <ui:param name="editBean" value="#{personBean}"/>
                                 <ui:param name="label" value="#{messages.myAccount_information}"/>
                            </ui:include>
                          </td>
                          <td>
                            <h:selectOneMenu value="#{personBean.item.info}" id="info" disabled="#{!personBean.item.userEditable}" onchange="checkMultiple(this)" style="width:200px">
                              <f:selectItems value="#{personBean.alertOptions}" />
                            </h:selectOneMenu>
                          </td>
                        </tr>
                        <tr>
                          <td width="100">
                            <ui:include src="../../includes/inputLabel.xhtml">
                                 <ui:param name="required" value="FALSE"/>
                                 <ui:param name="fieldName" value="warn"/>
                                 <ui:param name="for" value="warn"/>
                                 <ui:param name="iconSrc" value="/images/ico_warning.png"/>
                                 <ui:param name="editBean" value="#{personBean}"/>
                                 <ui:param name="label" value="#{messages.myAccount_warning}"/>
                            </ui:include>
                          </td>
                          <td>
                            <h:selectOneMenu value="#{personBean.item.warn}" id="warn" disabled="#{!personBean.item.userEditable}" onchange="checkMultiple(this)" style="width:200px">
                              <f:selectItems value="#{personBean.alertOptions}" />
                            </h:selectOneMenu>
                          </td>
                        </tr>
                        <tr>
                          <td width="100">
                            <ui:include src="../../includes/inputLabel.xhtml">
                                 <ui:param name="required" value="FALSE"/>
                                 <ui:param name="fieldName" value="crit"/>
                                 <ui:param name="for" value="crit"/>
                                 <ui:param name="iconSrc" value="/images/ico_critical.png"/>
                                 <ui:param name="editBean" value="#{personBean}"/>
                                 <ui:param name="label" value="#{messages.myAccount_critical}"/>
                            </ui:include>
                          </td>
                          <td>
                            <h:selectOneMenu value="#{personBean.item.crit}" id="crit" disabled="#{!personBean.item.userEditable}" onchange="checkMultiple(this)" style="width:200px">
                              <f:selectItems value="#{personBean.alertOptions}" />
                            </h:selectOneMenu>
                          </td>
                        </tr>
                      </table>

                    </td>
                  </tr>
                </table>

                <div class="required-key"><h:outputText value="#{messages.requiredKey}" /></div>

                <div class="spacer"></div>

                <ul id="grid_nav" style="margin: 0;">
                  <li class="r">
                    <h:commandButton action="#{personBean.save}" styleClass="left"><span class="save"><h:outputText value="#{messages.button_save}" /></span></h:commandButton>
                    <h:outputText value=" " /><h:commandButton action="#{personBean.cancelEdit}" immediate="true" styleClass="left"><span class="cancel"><h:outputText value="#{messages.button_cancel}" /></span></h:commandButton>
                  </li>
                </ul>

              </div>
            </div>
            <div class="panel_sw">
              <div class="panel_statusbar"></div>
            </div>
          </div>

          </a4j:form>
          <!-- END PANEL -->
        </td>

      </tr>
    </table>
    
    <script type="text/javascript">
  var formElements = ["text", "checkbox", "radio", "select-one", "select-multiple", "textarea"];

  function bodyLoad()
  {
    populateAlertText();

    var elements = document.getElementById("edit-form").elements;
    for (var i = 0; i &lt; elements.length; i++)
      for (var j = 0; j &lt; formElements.length; j++)
        if (elements[i].getAttribute("type") == formElements[j])
        {
          elements[i].focus();
          return;
        }
  }

  function populateAlertText(id)
  {
    if (#{personBean.batchEdit})
      return;

    if (id == null)
    {
      populateAlertText("edit-form:info");
      populateAlertText("edit-form:warn");
      populateAlertText("edit-form:crit");
    }
    else
    {
      var select = document.getElementById(id);
      populateAlertOption(select.options[1], "edit-form:priEmail");
      populateAlertOption(select.options[2], "edit-form:secEmail");
      populateAlertOption(select.options[3], "edit-form:priPhone");
      populateAlertOption(select.options[4], "edit-form:secPhone");
      populateAlertOption(select.options[5], "edit-form:priText");
      populateAlertOption(select.options[6], "edit-form:secText");
    }
  }

  function populateAlertOption(option, inputId)
  {
    var value = document.getElementById(inputId).value;
    if ((value != null) &amp;&amp; (value != ""))
      value = "#{messages.myAccount_alertTextSeparator}" + value;
    var index = option.text.indexOf("#{messages.myAccount_alertTextSeparator}");
    if (index != -1)
      option.text = option.text.substring(0, index) + value;
    else
      option.text = option.text + value;
  }

  function showSection(id, show)
  {
    document.getElementById(id).style.display = show ? "" : "none";
  }

  var isUser = document.getElementById("edit-form:isUser");
  if (isUser)
  {
    showSection("userTable", isUser.checked);
    showSection("driverTable", document.getElementById("edit-form:isDriver").checked);
  }
    </script>

  </ui:define>

</ui:composition>
