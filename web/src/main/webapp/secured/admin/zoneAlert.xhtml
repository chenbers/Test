<ui:composition template="/layout/layout.xhtml" 
              xmlns="http://www.w3.org/1999/xhtml" 
              xmlns:ui="http://java.sun.com/jsf/facelets"
              xmlns:h="http://java.sun.com/jsf/html"
              xmlns:rich="http://richfaces.org/rich"
              xmlns:a4j="http://richfaces.org/a4j"
              xmlns:f="http://java.sun.com/jsf/core"
              xmlns:c="http://java.sun.com/jstl/core"
              xmlns:security="http://pro.tiwi.com/jsf/security">

  <ui:param name="adminSelected" value="current" />
  <ui:param name="title" value="#{messages.adminHeader_zoneAlerts}"/>
  
  <ui:define name="scripts">
    <a4j:loadScript src="#{googleMapURLBean.mapUrl}&amp;hl=#{localeBean.locale.language}" />
    <script src="#{facesContext.externalContext.requestContextPath}/js/mapGeocode.js" type="text/javascript"></script>
    <script src="#{facesContext.externalContext.requestContextPath}/js/drawZone.js" type="text/javascript"></script>
    <script type="text/javascript">    
      var map;
    </script>
  </ui:define>

  <ui:define name="content">

    <table width="920" border="0" cellspacing="0" cellpadding="0" align="center" style="margin: 0 auto 0 auto;">
      <tr>
        <td valign="top" width="130">
          <ui:include src="/includes/navigation/adminSideNav.xhtml">
            <ui:param name="selectedAction" value="go_adminZoneAlerts" />
            <ui:param name="parentAction" value="go_adminZoneAlerts" />
            <ui:param name="context" value="zoneAlert"/>
          </ui:include>
        </td>
        <td valign="top">
          <!-- START PANEL -->

          <a4j:form id="zoneAlertForm">

            <h:inputHidden id="zonePoints" value="#{redFlagOrZoneAlertsBean.item.zone.pointsString}" />

            <div class="">
              <div class="panel_nw">
                <div class="panel_title">
                  <span class="admin"><h:outputFormat value="#{messages.adminHeader_zoneAlertDetails}"><f:param value="#{redFlagOrZoneAlertsBean.item.name}" /></h:outputFormat></span>
                  <span class="panel_links"></span>
                </div>
              </div>

              <div class="panel_w">

                <div class="panel_content">

                  <ul id="grid_nav" style="margin: 0;">
                    <li class="l text"><a4j:htmlCommandLink id="zoneAlertCancel" action="#{redFlagOrZoneAlertsBean.cancelDisplay}" value="#{messages.zoneAlert_backToZoneAlerts}" /></li>
                    <li class="r">
                      <a4j:commandButton id="zoneAlertDelete" styleClass="left" onclick="Richfaces.showModalPanel('confirmDelete'); return false;"><span class="delete"><h:outputText value="#{messages.button_delete}" /></span></a4j:commandButton>
                      <h:outputText value=" " /><h:commandButton id="zoneAlertEdit" action="#{redFlagOrZoneAlertsBean.edit}" styleClass="left"><span class="edit"><h:outputText value="#{messages.button_edit}" /></span></h:commandButton>
                    </li>
                  </ul>

                  <rich:messages globalOnly="true" errorClass="error" fatalClass="error" warnClass="warning" infoClass="info" styleClass="msg" />

                  <div class="add_section_title"><h:outputText value="#{messages.editZoneAlert_nameDescriptionZone}" /></div>

                  <div class="spacer"></div>

                  <table width="790" border="0" cellspacing="0" cellpadding="0">
                    <tr>
                      <td width="390" valign="top">

                        <table width="100%" border="0" cellspacing="2" cellpadding="4" style="background-color: #f2efe9; border: 1px solid #acacac;">
                          <tr>
                            <td width="100"><h:outputText value="#{messages.editZoneAlert_zone}" /></td>
                            <td><h:outputText value="#{redFlagOrZoneAlertsBean.item.zone.name}" /></td>
                          </tr>
                        </table>

                        <table width="100%" border="0" cellspacing="2" cellpadding="4">
                          <tr>
                            <td width="100"><h:outputText value="#{messages.editAlerts_name}" /></td>
                            <td><h:outputText value="#{redFlagOrZoneAlertsBean.item.name}" /></td>
                          </tr>
                          <tr>
                            <td width="100"><h:outputText value="#{messages.editAlerts_description}" /></td>
                            <td><h:outputText value="#{redFlagOrZoneAlertsBean.item.description}" /></td>
                          </tr>
                          <tr>
								<td width="100" valign="top">
									<h:outputText value="#{messages.editAlerts_status}" />
								</td>
								<td>
									<h:outputText value="#{messages[redFlagOrZoneAlertsBean.item.status]}"/>
								</td>
						 </tr>
                          <tr>
                            <td width="100" valign="top"><h:outputText value="#{messages.editAlerts_dayOfWeek}" /></td>
                            <td>
                              <ui:include src="../../includes/dayPicker.xhtml">
                                <ui:param name="days" value="#{redFlagOrZoneAlertsBean.item.dayOfWeek}" />
                                <ui:param name="disabled" value="true" />
        						<ui:param name="context" value="zoneAlert" />
                              </ui:include>
                            </td>
                          </tr>
                          <tr>
                            <td width="100" valign="top"><h:outputText value="#{messages.editAlerts_timeframe}" /></td>
                            <td>
                              <h:outputText rendered="#{redFlagOrZoneAlertsBean.item.anytime}" value="#{messages.editAlerts_timeframeAnytime}" />
                              <ui:fragment rendered="#{not redFlagOrZoneAlertsBean.item.anytime}">
                                <h:outputText value="#{messages.editAlerts_timeframeBetween}" />
                                <h:outputText value=" " />
                                <c:set var="hours" value="#{((redFlagOrZoneAlertsBean.item.startTOD - (redFlagOrZoneAlertsBean.item.startTOD % 60)) / 60 % 12)}" />
                                <c:if test="#{hours == 0}">
                                  <c:set var="hours" value="12" />
                                </c:if>
                                <h:outputText value="#{hours}"><f:convertNumber integerOnly="true" /></h:outputText>:<h:outputText value="#{redFlagOrZoneAlertsBean.item.startTOD % 60}"><f:convertNumber integerOnly="true" minIntegerDigits="2" maxIntegerDigits="2" /></h:outputText>
                                <h:outputText value="#{(redFlagOrZoneAlertsBean.item.startTOD ge 720) ? messages.timePicker_pm : messages.timePicker_am}" />
                                <h:outputText value=" " />
                                <h:outputText value="#{messages.editAlerts_betweenAnd}" />
                                <h:outputText value=" " />
                                <c:set var="hours" value="#{((redFlagOrZoneAlertsBean.item.stopTOD - (redFlagOrZoneAlertsBean.item.stopTOD % 60)) / 60 % 12)}" />
                                <c:if test="#{hours == 0}">
                                  <c:set var="hours" value="12" />
                                </c:if>
                                <h:outputText value="#{hours}"><f:convertNumber integerOnly="true" /></h:outputText>:<h:outputText value="#{redFlagOrZoneAlertsBean.item.stopTOD % 60}"><f:convertNumber integerOnly="true" minIntegerDigits="2" maxIntegerDigits="2" /></h:outputText>
                                <h:outputText value="#{(redFlagOrZoneAlertsBean.item.stopTOD ge 720) ? messages.timePicker_pm : messages.timePicker_am}" />
                              </ui:fragment>
                            </td>
                          </tr>
                        </table>

                      </td>
                      <td width="10"><h:graphicImage value="/images/x.gif" width="10" /></td>
                      <td width="390" valign="top" style="background-color: #f2efe9; border: 1px solid #acacac;">
                        <div id="map-canvas" style="height:100%;height:220px;border:0"></div>
                      </td>
                    </tr>
                  </table>

                  <div class="spacer"></div>

                  <table width="790" border="0" cellspacing="0" cellpadding="0">
                    <tr>
                      <td width="390" valign="top">

                        <div class="add_section_title"><h:outputText value="#{messages.editZoneAlert_alertType}" /></div>

                        <table width="380" border="0" cellspacing="2" cellpadding="4" align="center">
                          <tr>
                            <td width="50%">
                              <h:selectBooleanCheckbox value="#{redFlagOrZoneAlertsBean.item.arrival}" disabled="true" />
                              <h:outputText value="#{messages.editZoneAlert_arrival}" />
                            </td>
                            <td width="50%">
                              <h:selectBooleanCheckbox value="#{redFlagOrZoneAlertsBean.item.departure}" disabled="true" />
                              <h:outputText value="#{messages.editZoneAlert_departure}" />
                            </td>
                          </tr>
                        </table>

                      </td>
                      <td width="10"><h:graphicImage value="/images/x.gif" width="10" /></td>
                      <td width="390" valign="top">
                  
                        <div class="add_section_title"><h:outputText value="#{messages.editAlerts_assignTo}" /></div>

                        <ui:repeat value="#{redFlagOrZoneAlertsBean.assignPicker.picked}" var="item">
                          <h:outputText value="#{item.label}" /><br />
                        </ui:repeat>
                        <table width="380" border="0" align="left">
						  <tr><td>&#160;</td></tr>                        	
                          <tr>
                            <td width="30%"><h:outputText value="#{messages.editAlerts_owner}"/></td>
                           	<td><h:outputText value="#{redFlagOrZoneAlertsBean.item.fullName}" /></td>
                    	   </tr>
                    	</table>
                    	</td>
                    </tr>
                  </table>

                  <div class="spacer"></div>

                  <table width="790" border="0" cellspacing="0" cellpadding="0">
                    <tr>
                      <td width="390" valign="top">

                        <div class="add_section_title"><h:outputText value="#{messages.editAlerts_notificationsByName}" /></div>

                        <div>
                          <h:outputText value="#{redFlagOrZoneAlertsBean.peoplePicker.picked[0].label}" />
                          <ui:repeat value="#{redFlagOrZoneAlertsBean.peoplePicker.picked}" var="person" offset="1">
                            <h:outputText value=", " />
                            <h:outputText value="#{person.label}" />
                          </ui:repeat>
                        </div>

                      </td>
                      <td width="10"><h:graphicImage value="/images/x.gif" width="10" /></td>
                      <td width="390" valign="top">
                        <!-- 
                           <div class="add_section_title"><h:outputText value="#{messages.editAlerts_notificationsByEmail}" /></div>
   
                           <div>
                             <a href="mailto:#{email}"><h:outputText value="#{redFlagOrZoneAlertsBean.item.emailTo[0]}" /></a>
                             <ui:repeat value="#{redFlagOrZoneAlertsBean.item.emailTo}" var="email" offset="1">
                               <h:outputText value=", " />
                               <a href="mailto:#{email}"><h:outputText value="#{email}" /></a>
                             </ui:repeat>
                           </div>
                        -->
                      </td>
                    </tr>
                  </table>

                </div>
              </div>

              <div class="panel_sw">
                <div class="panel_statusbar"></div>
              </div>
            </div>

          </a4j:form>

          <script type="text/javascript">
            function showZone()
            {
              map.clearOverlays();
              var outline = fromOutlineString(document.getElementById("zoneAlertForm:zonePoints").value);
              if (outline)
              {
                centerMapAtZone(getLatLngBounds(outline));
                loadZone(outline, false);
              }
            }

            function bodyLoad()
            {
              if (GBrowserIsCompatible())
              {
                map = new GMap2(document.getElementById("map-canvas"));
                map.disableDragging();
                map.disableDoubleClickZoom();
                map.disableInfoWindow();
                showZone();
              }
            }

            function bodyUnload()
            {
              GUnload();
            }
          </script>

          <!-- END PANEL -->
        </td>
      </tr>
    </table>

    <ui:include src="../../includes/confirmDelete.xhtml">
      <ui:param name="deleteBean" value="#{redFlagOrZoneAlertsBean}" />
      <ui:param name="explanation" value="#{messages.zoneAlert_confirmDelete}" />
      <ui:param name="supportRedirect" value="#{true}" />
      <ui:param name="context" value="zoneAlert" />
    </ui:include>

  </ui:define>

</ui:composition>
