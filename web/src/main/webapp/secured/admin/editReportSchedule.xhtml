<ui:composition template="/layout/layout.xhtml"
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:rich="http://richfaces.org/rich"
	xmlns:a4j="http://richfaces.org/a4j"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:security="http://pro.tiwi.com/jsf/security">

	<ui:param name="adminSelected" value="current" />

	<ui:define name="content">
		
		<table width="920" height="430" border="0" cellspacing="0"
			cellpadding="0" align="center" style="margin: 0 auto 0 auto;">
			<tr>
				<td valign="top" width="130">
					<ui:include src="/includes/adminSideNav.xhtml">
						<ui:param name="selectedAction" value="#{(reportScheduleBean.add) ? 'go_adminAddReportSchedule' : 'go_adminReportSchedules'}" />
			            <ui:param name="parentAction" value="go_adminReportSchedules" />
					</ui:include>
				</td>
				<td valign="top">
				<a4j:form id="edit-form">
				<div class="">
				<div class="panel_nw">
				<div class="panel_title">
					<span class="email"><h:outputText value="#{reportScheduleBea.add ? messages.adminHeader_addReportSchedule : (reportScheduleBean.batchEdit ? messages.adminHeader_editReportSchedules : adminHeader_editReportSchedule)}"/></span>
					<span class="panel_links"></span></div>
				</div>

				<div class="panel_w"><!-- MAIN CONTENT -->
				<div class="panel_content">
				<rich:messages globalOnly="true"
					errorClass="error" fatalClass="error" warnClass="warning"
					infoClass="info" styleClass="msg" />
					
				<ul id="grid_nav" style="margin: 0;">
                   	<li class="r">
                      <h:commandButton action="#{reportScheduleBean.save}" styleClass="left"><span class="save"><h:outputText value="#{messages.button_save}" /></span></h:commandButton>
                      <h:outputText value=" " /><h:commandButton action="#{reportScheduleBean.cancelEdit}" immediate="true" styleClass="left"><span class="cancel"><h:outputText value="#{messages.button_cancel}" /></span></h:commandButton>
                    </li>
                </ul>
			   
				<table width="650" border="0" cellspacing="0" cellpadding="0">
					<tr>
						<td width="350" valign="top" align="left">
						<div class="add_section_title"><h:outputText
							value="#{messages.reportSchedule_reportScheduling}" /></div>
						
						<table width="350" border="0" cellspacing="2" cellpadding="4"
							align="center">
							<ui:fragment rendered="#{not reportScheduleBean.batchEdit}">
								<tr>
									<td width="100" valign="top"><h:outputText
										value="#{messages.reportSchedule_name}" />
										<h:outputText rendered="#{not reportScheduleBean.batchEdit}" styleClass="required" value=" *" />
									</td>
									<td>
										<rich:message for="scheduleName" errorClass="field-error" fatalClass="field-error" warnClass="field-warning" infoClass="field-info" styleClass="field-msg" />
										<h:inputText id="scheduleName" value="#{reportScheduleBean.item.name}" styleClass="text" size="30" required="true" requiredMessage="#{messages.required}"></h:inputText>	
									</td>
								</tr>
							</ui:fragment>
							<tr>
								<td width="100" valign="top">
									<h:selectBooleanCheckbox rendered="#{reportScheduleBean.batchEdit}" id="update_status" value="#{reportScheduleBean.updateField['status']}" />
									<h:outputText value="#{messages.reportSchedule_status}" />
								</td>
								<td>
									<h:selectOneMenu id="status" value="#{reportScheduleBean.item.status}" converter="SimpleBeanConverter">
										<f:selectItems value="#{reportScheduleBean.statuses}"/> 
									</h:selectOneMenu>
								</td>
								
							</tr>
							<tr>
								<td width="100" valign="top">
									<h:selectBooleanCheckbox rendered="#{reportScheduleBean.batchEdit}" id="update_startDate" value="#{reportScheduleBean.updateField['startDate']}" />
									<h:outputText value="#{messages.reportSchedule_startDate}" />
									<h:outputText rendered="#{not reportScheduleBean.batchEdit}" styleClass="required" value=" *" />
								</td>
								<td>
									<rich:message for="startDate" errorClass="field-error" fatalClass="field-error" warnClass="field-warning" infoClass="field-info" styleClass="field-msg" />
									<rich:calendar id="startDate" value="#{reportScheduleBean.item.startDate}" required="#{(not reportScheduleBean.batchEdit) or reportScheduleBean.updateField['startDate']}" requiredMessage="#{messages.required}" todayControlMode="hidden" enableManualInput="true" converterMessage="#{messages.editPerson_dateFormat}" timeZone="#{reportScheduleBean.utcTimeZone}"/>	
								</td>
								
							</tr>
							<tr>
								<td width="100" valign="top">
									<h:selectBooleanCheckbox rendered="#{reportScheduleBean.batchEdit}" id="update_endDate" value="#{reportScheduleBean.updateField['endDate']}" />
									<h:outputText value="#{messages.reportSchedule_endDate}" />
								</td>
								<td>
									<rich:calendar value="#{reportScheduleBean.item.endDate}" todayControlMode="hidden" enableManualInput="true" converterMessage="#{messages.editPerson_dateFormat}" timeZone="#{reportScheduleBean.utcTimeZone}"/>	
								</td>
							</tr>
							<tr>
								<td width="100" valign="top">
									<h:selectBooleanCheckbox rendered="#{reportScheduleBean.batchEdit}" id="update_timeOfDay" value="#{reportScheduleBean.updateField['timeOfDay']}" />
									<h:outputText value="#{messages.reportSchedule_timeOfDay}" />
									
								</td>
								<td>
									
									<ui:include src="../../includes/timePicker.xhtml">
                                      <ui:param name="id" value="timeOfDay" />
                                      <ui:param name="value" value="#{reportScheduleBean.item.timeOfDay}" />
                                      <ui:param name="onchange" value="checkMultiple('timeframe')" />
                                    </ui:include>
								</td>
							</tr>
							<tr>
								<td width="100" valign="top">
									<h:selectBooleanCheckbox rendered="#{reportScheduleBean.batchEdit}" id="update_occurrence" value="#{reportScheduleBean.updateField['occurrence']}" />
									<h:outputText value="#{messages.reportSchedule_occurrence}"/>
									<h:outputText rendered="#{not reportScheduleBean.batchEdit}" styleClass="required" value=" *" />
								</td>
								<td>
									<rich:message for="occurrence" errorClass="field-error" fatalClass="field-error" warnClass="field-warning" infoClass="field-info" styleClass="field-msg" />
									<h:selectOneMenu id="occurrence" value="#{reportScheduleBean.item.occurrence}" converter="SimpleBeanConverter" required="#{(not reportScheduleBean.batchEdit) or reportScheduleBean.updateField['occurrence']}" requiredMessage="#{messages.required}">
										<a4j:support event="onchange" reRender="dayOfWeekPanel" ajaxSingle="true"/>
										<f:selectItems value="#{reportScheduleBean.occurrences}"/> 
									</h:selectOneMenu>
								</td>
							</tr>
						</table>
						 <h:panelGroup id="dayOfWeekPanel">
							<table width="350" border="0" cellspacing="2" cellpadding="4"
								align="center">
								<tr>
									<td width="100" valign="top">
										<h:selectBooleanCheckbox rendered="#{reportScheduleBean.batchEdit and reportScheduleBean.item.occurrence eq 'DAILY_CUSTOM'}" id="update_dayOfWeek" value="#{reportScheduleBean.updateField['dayOfWeek']}" />
										<h:outputText value="#{messages.reportSchedule_daysOfWeek}" rendered="#{reportScheduleBean.item.occurrence eq 'DAILY_CUSTOM'}"/>
									</td>
									<td>
										<h:outputText rendered="#{reportScheduleBean.item.occurrence eq 'DAILY_CUSTOM'}">
										<ui:include src="../../includes/dayPicker.xhtml">
			                                <ui:param name="days" value="#{reportScheduleBean.item.dayOfWeek}" />
			                                <ui:param name="onchange" value="checkMultiple('dayOfWeek')" />
	                              		</ui:include>	
	                              		</h:outputText>
									</td>
								</tr>
							</table>
						</h:panelGroup>
						</td>
						<td width="10"><h:graphicImage value="/images/x.gif" width="10" /></td>
						<td width="400" valign="top" align="left">
							
						<ui:fragment rendered="#{not reportScheduleBean.batchEdit}">
						<div class="add_section_title"><h:outputText
							value="#{messages.reportSchedule_reportConfiguration}" /></div>
						<h:panelGroup id="reportConfigTable" >
						<table width="350" border="0" cellspacing="2" cellpadding="4"
							align="center">
							<tr>
								<td width="100" valign="top">
									<h:outputText value="#{messages.reportSchedule_report}"/>
									<h:outputText rendered="#{not reportScheduleBean.batchEdit}" styleClass="required" value=" *" />
								</td>
								<td>
									<rich:message for="report" errorClass="field-error" fatalClass="field-error" warnClass="field-warning" infoClass="field-info" styleClass="field-msg" />
									<h:selectOneMenu id="report" value="#{reportScheduleBean.item.reportID}" required="true" requiredMessage="#{messages.required}">
										<a4j:support event="onchange" reRender="reportConfigTable" ajaxSingle="true"/>
										<f:selectItems value="#{reportScheduleBean.reportGroups}"/> 
									</h:selectOneMenu>
								</td>
							</tr>
							
							<ui:repeat value="#{reportScheduleBean.item.report.criterias}" var="criteria">
								<h:outputText rendered="#{criteria eq 'DURATION'}">
									<tr>
										<td width="100" valign="top">
											<h:outputText value="#{messages.reportSchedule_duration}"/>
											<h:outputText rendered="#{not reportScheduleBean.batchEdit}" styleClass="required" value=" *" />
										</td>
										<td>
											<rich:message for="reportDuration" errorClass="field-error" fatalClass="field-error" warnClass="field-warning" infoClass="field-info" styleClass="field-msg" />
											<h:selectOneMenu id="reportDuration" value="#{reportScheduleBean.item.reportDuration}" converter="SimpleBeanConverter" required="true" requiredMessage="#{messages.required}">
												<f:selectItems value="#{reportScheduleBean.durations}"/> 
											</h:selectOneMenu>
										</td>
									</tr>
								</h:outputText>
							</ui:repeat>
							<h:outputText rendered="#{reportScheduleBean.item.report.entityType eq 'ENTITY_GROUP'}">
								<tr>
									<td width="100" valign="top">
										<h:outputText value="#{messages.reportSchedule_group}"/>
										<h:outputText rendered="#{not reportScheduleBean.batchEdit}" styleClass="required" value=" *" />
									</td>
									<td>
										<rich:message for="group" errorClass="field-error" fatalClass="field-error" warnClass="field-warning" infoClass="field-info" styleClass="field-msg" />
										<h:selectOneMenu id="group" value="#{reportScheduleBean.item.groupID}" required="true" requiredMessage="#{messages.required}">
											<f:selectItems value="#{reportScheduleBean.groups}"/> 
										</h:selectOneMenu>
									</td>
								</tr>
							</h:outputText>
							<h:outputText rendered="#{reportScheduleBean.item.report.entityType eq 'ENTITY_DRIVER'}">
									<tr>
										<td width="100" valign="top">
											<h:outputText value="#{messages.reportSchedule_driver}"/>
											<h:outputText rendered="#{not reportScheduleBean.batchEdit}" styleClass="required" value=" *" />
										</td>
										<td>
											<rich:message for="driver" errorClass="field-error" fatalClass="field-error" warnClass="field-warning" infoClass="field-info" styleClass="field-msg" />
											<h:selectOneMenu id="driver" value="#{reportScheduleBean.item.driverID}" required="true" requiredMessage="#{messages.required}">
												<f:selectItems value="#{reportScheduleBean.drivers}"/> 
											</h:selectOneMenu>
										</td>
									</tr>
							</h:outputText>

						</table>
						</h:panelGroup>
						<div class="add_section_title"><h:outputText
								value="#{messages.reportSchedule_email}" /></div>
						
						<table width="350" border="0" cellspacing="2" cellpadding="4"
							align="center">
							<tr>
								<td>
									<div class="instructions"><h:outputText value="#{messages.editReportSchedule_reportsByEmailInstructions}" /></div>
									<h:inputTextarea cols ="40" rows="5" value="#{reportScheduleBean.item.emailToString}" />
								</td>
							</tr>
							
						</table>
						</ui:fragment>
						</td>
					</tr>
				</table>
				
				 <div class="required-key"><h:outputText rendered="#{not zoneAlertsBean.batchEdit}" value="#{messages.requiredKey}" /></div>
				 
				 <ul id="grid_nav" style="margin: 0;">
                   	<li class="r">
                      <h:commandButton action="#{reportScheduleBean.save}" styleClass="left"><span class="save"><h:outputText value="#{messages.button_save}" /></span></h:commandButton>
                      <h:outputText value=" " /><h:commandButton action="#{reportScheduleBean.cancelEdit}" immediate="true" styleClass="left"><span class="cancel"><h:outputText value="#{messages.button_cancel}" /></span></h:commandButton>
                    </li>
                 </ul>
				</div>

				</div>

				<div class="panel_sw">
				<div class="panel_statusbar"></div>
				</div>
				</div>
					</a4j:form>
				</td>
			</tr>
		</table>
		  <script type="text/javascript">
		         var formElements = ["text", "checkbox", "radio", "select-one", "select-multiple", "textarea"];
				 function bodyLoad()
				  {
		
				    var elements = document.getElementById("edit-form").elements;
				    for (var i = 0; i &lt; elements.length; i++)
				      for (var j = 0; j &lt; formElements.length; j++)
				        if (elements[i].getAttribute("type") == formElements[j])
				        {
				          elements[i].focus();
				          return;
				        }
				  }
				  
				function checkMultiple(item)
			      {
			        var id;
			        if (typeof(item) == "string")
			          id = item;
			        else
			          id = item.id;
			
			        var box;
			        var index = id.indexOf(":");
			        if (index > 0)
			          box = document.getElementById("edit-form:update_" + id.substring(index + 1));
			        else
			          box = document.getElementById("edit-form:update_" + id);
			        if (box)
			          box.checked = true;
			      }
	      </script>
	</ui:define>

</ui:composition>
