<ui:composition template="/layout/layout.xhtml" 
              xmlns="http://www.w3.org/1999/xhtml" 
              xmlns:ui="http://java.sun.com/jsf/facelets"
              xmlns:h="http://java.sun.com/jsf/html"
              xmlns:rich="http://richfaces.org/rich"
              xmlns:a4j="http://richfaces.org/a4j"
              xmlns:f="http://java.sun.com/jsf/core"
              xmlns:c="http://java.sun.com/jstl/core"
              xmlns:security="http://pro.tiwi.com/jsf/security">

  <ui:param name="adminSelected" value="current" />

  <ui:define name="content">

    <table width="920" border="0" cellspacing="0" cellpadding="0" align="center" style="margin: 0 auto 0 auto;">
      <tr>
        <td valign="top" width="130">
          <ui:include src="/includes/adminSideNav.xhtml">
            <ui:param name="selectedAction" value="#{(redFlagAlertsBean.add) ? 'go_adminAddRedFlag' : 'go_adminRedFlags'}" />
            <ui:param name="parentAction" value="go_adminRedFlags" />
          </ui:include>
        </td>
        <td valign="top">
          <!-- START PANEL -->

          <a4j:form id="edit-form">

            <div class="">
              <div class="panel_nw">
                <div class="panel_title">
                  <span class="admin"><h:outputText value="#{redFlagAlertsBean.add ? messages.adminHeader_addRedFlag : (redFlagAlertsBean.batchEdit ? messages.adminHeader_editRedFlags : messages.adminHeader_editRedFlag)}" /></span>
                  <span class="panel_links"></span>
                </div>
              </div>

              <div class="panel_w">

                <div class="panel_content">

                  <ul id="grid_nav" style="margin: 0;">
                    <li class="r">
                      <h:commandButton action="#{redFlagAlertsBean.save}" styleClass="left"><span class="save"><h:outputText value="#{messages.button_save}" /></span></h:commandButton>
                      <h:outputText value=" " /><h:commandButton action="#{redFlagAlertsBean.cancelEdit}" immediate="true" styleClass="left"><span class="cancel"><h:outputText value="#{messages.button_cancel}" /></span></h:commandButton>
                    </li>
                  </ul>

                  <rich:messages globalOnly="true" errorClass="error" fatalClass="error" warnClass="warning" infoClass="info" styleClass="msg" />

                  <table width="790" border="0" cellspacing="0" cellpadding="0">
                    <tr>
                      <td width="390" valign="top">
                
                        <div class="add_section_title"><h:outputText value="#{messages.editRedFlag_nameDescriptionType}" /></div>

                        <table width="370" border="0" cellspacing="2" cellpadding="4" align="center">
                          <tr>
                            <td width="100" valign="top">
                              <h:selectBooleanCheckbox rendered="#{redFlagAlertsBean.batchEdit}" id="update_name" value="#{redFlagAlertsBean.updateField['name']}" />
                              <h:outputText value="#{messages.editAlerts_name}" />
                              <h:outputText rendered="#{not redFlagAlertsBean.batchEdit}" styleClass="required" value=" *" />
                            </td>
                            <td>
                              <rich:message for="name" errorClass="field-error" fatalClass="field-error" warnClass="field-warning" infoClass="field-info" styleClass="field-msg" />
                              <h:inputText value="#{redFlagAlertsBean.item.name}" id="name" onchange="checkMultiple(this)" styleClass="text" size="30"
                                maxlength="30" validatorMessage="#{messages.required}" />
                            </td>
                          </tr>
                          <tr>
                            <td width="100" valign="top">
                              <h:selectBooleanCheckbox rendered="#{redFlagAlertsBean.batchEdit}" id="update_description" value="#{redFlagAlertsBean.updateField['description']}" />
                              <h:outputText value="#{messages.editAlerts_description}" />
                            </td>
                            <td>
                              <h:inputText value="#{redFlagAlertsBean.item.description}" id="description" onchange="checkMultiple(this)" styleClass="text" size="30"
                                maxlength="64" />
                            </td>
                          </tr>
                          <tr>
                            <td width="100" valign="top">
                              <h:selectBooleanCheckbox rendered="#{redFlagAlertsBean.batchEdit}" id="update_dayOfWeek" value="#{redFlagAlertsBean.updateField['dayOfWeek']}" />
                              <h:outputText value="#{messages.editAlerts_dayOfWeek}" />
                              <h:outputText rendered="#{not redFlagAlertsBean.batchEdit}" styleClass="required" value=" *" />
                            </td>
                            <td>
                              <rich:message for="day0" errorClass="field-error" fatalClass="field-error" warnClass="field-warning" infoClass="field-info" styleClass="field-msg" />
                              <ui:include src="../../includes/dayPicker.xhtml">
                                <ui:param name="days" value="#{redFlagAlertsBean.item.dayOfWeek}" />
                                <ui:param name="onchange" value="checkMultiple('dayOfWeek')" />
                              </ui:include>
                            </td>
                          </tr>
                          <tr>
                            <td width="100" valign="top">
                              <h:selectBooleanCheckbox rendered="#{redFlagAlertsBean.batchEdit}" id="update_timeframe" value="#{redFlagAlertsBean.updateField['timeframe']}" />
                              <h:outputText value="#{messages.editAlerts_timeframe}" />
                              <h:outputText rendered="#{not redFlagAlertsBean.batchEdit}" styleClass="required" value=" *" />
                            </td>
                            <td>
                              <rich:message for="stopTOD" errorClass="field-error" fatalClass="field-error" warnClass="field-warning" infoClass="field-info" styleClass="field-msg" />
                              <h:selectOneRadio value="#{redFlagAlertsBean.item.anytime}" onclick="document.getElementById('timeframePickers').style.display = (this.value == 'true' ? 'none' : '')" enabledClass="radioitem">
                                <f:selectItem itemValue="true" itemLabel="#{messages.editAlerts_timeframeAnytime}" />
                                <f:selectItem itemValue="false" itemLabel="#{messages.editAlerts_timeframeBetween}" />
                              </h:selectOneRadio>
                              <table id="timeframePickers" border="0" style="#{redFlagAlertsBean.item.anytime ? 'display:none' : ''}">
                                <tr>
                                  <td>
                                    <ui:include src="../../includes/timePicker.xhtml">
                                      <ui:param name="id" value="startTOD" />
                                      <ui:param name="value" value="#{redFlagAlertsBean.item.startTOD}" />
                                      <ui:param name="onchange" value="checkMultiple('timeframe')" />
                                    </ui:include>
                                  </td>
                                  <td><h:outputText value="#{messages.editAlerts_betweenAnd}" /></td>
                                  <td>
                                    <ui:include src="../../includes/timePicker.xhtml">
                                      <ui:param name="id" value="stopTOD" />
                                      <ui:param name="value" value="#{redFlagAlertsBean.item.stopTOD}" />
                                      <ui:param name="onchange" value="checkMultiple('timeframe')" />
                                    </ui:include>
                                  </td>
                                </tr>
                              </table>
                            </td>
                          </tr>
                        </table>

                      </td>
                      <td width="10"><h:graphicImage value="/images/x.gif" width="10" /></td>
                      <td width="390" valign="top">

                        <div class="add_section_title">
                          <h:selectBooleanCheckbox rendered="#{redFlagAlertsBean.batchEdit}" id="update_assignTo" value="#{redFlagAlertsBean.updateField['assignTo']}" />
                          <h:outputText value="#{messages.editAlerts_assignTo}" />
                          <h:outputText rendered="#{not redFlagAlertsBean.batchEdit}" styleClass="required" value=" *" />
                        </div>

                        <rich:message for="alertAssignFrom" errorClass="field-error" fatalClass="field-error" warnClass="field-warning" infoClass="field-info" styleClass="field-msg" />

                        <ui:include src="../../includes/alertAssign.xhtml">
                          <ui:param name="alertsBean" value="#{redFlagAlertsBean}" />
                          <ui:param name="onchange" value="checkMultiple('assignTo')" />
                        </ui:include>

                      </td>
                    </tr>
                  </table>

                  <div class="spacer"></div>

                  <div class="add_section_title"><h:outputText value="#{messages.editRedFlag_defineRedFlag}" /></div>

                  <div class="spacer"></div>

                  <table width="790" border="0" cellspacing="0" cellpadding="0">
                    <tr>
                      <td width="130" valign="top">
                        <h:selectOneRadio value="#{redFlagAlertsBean.item.type}" layout="pageDirection" style="width:100%" styleClass="ls_tab_table" enabledClass="radioitem">
                          <a4j:support event="onclick" reRender="speed,drivingStyle,safety" limitToList="true" />
                          <f:selectItem itemValue="speed" itemLabel="#{messages.redFlag_speed}" />
                          <f:selectItem itemValue="drivingStyle" itemLabel="#{messages.redFlag_drivingStyle}" />
                          <f:selectItem itemValue="safety" itemLabel="#{messages.redFlag_safety}" />
                        </h:selectOneRadio>
                      </td>
                      <td width="10"><h:graphicImage value="/images/x.gif" width="10" /></td>
                      <td width="650" valign="top">

                        <a4j:outputPanel id="speed">
                          <h:panelGroup rendered="#{redFlagAlertsBean.item.type == 'speed'}">

                            <table width="100%" border="0" cellpadding="2" cellspacing="0">
                              <tr class="datagrid">
                                <ui:fragment rendered="#{redFlagAlertsBean.batchEdit}">
                                  <th><h:outputText value="#{messages.editRedFlag_batchEdit}" /></th>
                                </ui:fragment>
                                <th><h:outputText value="#{messages.editRedFlag_speedHeader}" /></th>
                                <th width="300" colspan="2"><h:outputText value="#{messages.editRedFlag_speedSettingHeader}" /></th>
                                <th width="100"><h:outputText value="#{messages.editRedFlag_severity}" /></th>
                              </tr>
                              <c:forEach begin="0" var="index" end="14">
                                <c:set var="id" value="speed#{index}" />
                                <tr class="#{((index % 2) == 0) ? 'tableOdd' : 'tableEven'}">
                                  <ui:fragment rendered="#{redFlagAlertsBean.batchEdit}">
                                    <td style="padding: 6px 12px 6px 12px; border-bottom: 1px solid #8BAD37;">
                                      <h:selectBooleanCheckbox id="update_#{id}" value="#{redFlagAlertsBean.updateField[id]}" />
                                    </td>
                                  </ui:fragment>
                                  <td style="padding: 6px 12px 6px 12px; border-bottom: 1px solid #8BAD37;">
                                    <h:selectBooleanCheckbox id="#{id}Selected" value="#{redFlagAlertsBean.item.speedSelected[index]}" onchange="checkMultiple(this.id.substring(0, this.id.length - 8))" />
                                    <h:outputText value="#{(index * 5) + 5}" />
                                    <h:outputText value=" mph" />
                                  </td>
                                  <td style="padding: 6px 12px 6px 12px; border-bottom: 1px solid #8BAD37;" width="200">
                                    <rich:inputNumberSlider id="#{id}" value="#{redFlagAlertsBean.item.speedSettings[index]}" showToolTip="false" showBoundaryValues="false" showInput="false" minValue="0" maxValue="25" step="1" onchange="checkMultiple(this.mainTable.id); document.getElementById(this.mainTable.id + 'Selected').checked = true; document.getElementById(this.mainTable.id + 'MPH').innerHTML = this.value" />
                                  </td>
                                  <td style="padding: 6px 12px 6px 12px; border-bottom: 1px solid #8BAD37;">
                                    <h:outputText id="#{id}MPH" value="#{redFlagAlertsBean.item.speedSettings[index]}" />
                                    <h:outputText value=" mph" />
                                  </td>
                                  <td style="padding: 6px 12px 6px 12px; border-bottom: 1px solid #8BAD37;">
                                    <h:selectOneMenu id="#{id}Severity" value="#{redFlagAlertsBean.item.speedLevels[index]}" onchange="var id = this.id.substring(0, this.id.length - 8); checkMultiple(id); document.getElementById(id + 'Selected').checked = true;">
                                      <f:selectItem itemValue="INFO" itemLabel="#{messages.redFlag_info}" />
                                      <f:selectItem itemValue="WARNING" itemLabel="#{messages.redFlag_warning}" />
                                      <f:selectItem itemValue="CRITICAL" itemLabel="#{messages.redFlag_critical}" />
                                    </h:selectOneMenu>
                                  </td>
                                </tr>
                              </c:forEach>
                            </table>

                          </h:panelGroup>
                        </a4j:outputPanel>

                        <a4j:outputPanel id="drivingStyle">
                          <h:panelGroup rendered="#{redFlagAlertsBean.item.type == 'drivingStyle'}">

                            <script type="text/javascript">
                              var sensitivities = new Array();
                              <c:forEach begin="1" var="sensitivity" end="5">
                                <c:set var="sLevel" value="editDevice_sensitivity#{sensitivity}" />
                                sensitivities[#{sensitivity}] = '<h:outputText value="#{messages[sLevel]}" />';
                              </c:forEach>
                            </script>

                            <table width="100%" border="0" cellpadding="0" cellspacing="0">
                              <tr class="datagrid">
                                <ui:fragment rendered="#{redFlagAlertsBean.batchEdit}">
                                  <th><h:outputText value="#{messages.editRedFlag_batchEdit}" /></th>
                                </ui:fragment>
                                <th><h:outputText value="#{messages.editRedFlag_setting}" /></th>
                                <th width="300" colspan="2"><h:outputText value="#{messages.editRedFlag_sensitivity}" /></th>
                                <th width="100"><h:outputText value="#{messages.editRedFlag_severity}" /></th>
                              </tr>
                              <c:forEach begin="1" var="index" end="4">
                                <c:set var="sensitivityItem" value="#{(index == 1) ? 'hardAcceleration' : ((index == 2) ? 'hardBrake' : ((index == 3) ? 'hardTurn' : 'hardVertical'))}" />
                                <tr class="#{((index % 2) == 0) ? 'tableOdd' : 'tableEven'}">
                                  <ui:fragment rendered="#{redFlagAlertsBean.batchEdit}">
                                    <td style="padding: 6px 12px 6px 12px; border-bottom: 1px solid #8BAD37;">
                                      <h:selectBooleanCheckbox id="update_#{sensitivityItem}" value="#{redFlagAlertsBean.updateField[sensitivityItem]}" />
                                    </td>
                                  </ui:fragment>
                                  <td style="padding: 0px 12px 6px 12px; border-bottom: 1px solid #8BAD37;">
                                    <c:set var="sensitivitySelected" value="#{sensitivityItem}Selected" />
                                    <h:selectBooleanCheckbox id="#{sensitivityItem}Selected" value="#{redFlagAlertsBean.item[sensitivitySelected]}" onchange="checkMultiple(this.id.substring(0, this.id.length - 8))" />
                                    <c:set var="sensitivityLabel" value="editDevice_#{sensitivityItem}" />
                                    <h:outputText value="#{messages[sensitivityLabel]}" />
                                  </td>
                                  <td style="padding: 0px 12px 6px 12px; border-bottom: 1px solid #8BAD37;" width="200">
                                    <rich:inputNumberSlider id="#{sensitivityItem}" value="#{redFlagAlertsBean.item[sensitivityItem]}" showToolTip="false" showBoundaryValues="false" showInput="false" minValue="1" maxValue="5" onchange="checkMultiple(this.mainTable.id); document.getElementById(this.mainTable.id + 'Selected').checked = true; document.getElementById(this.mainTable.id + 'Level').innerHTML = sensitivities[this.value]" />
                                  </td>
                                  <td style="padding: 0px 12px 6px 0px; border-bottom: 1px solid #8BAD37;">
                                    <c:set var="sensitivityLevel" value="editDevice_sensitivity#{redFlagAlertsBean.item[sensitivityItem]}" />
                                    <h:outputText id="#{sensitivityItem}Level" style="font-weight:bold" value="#{messages[sensitivityLevel]}" />
                                  </td>
                                  <td style="padding: 6px 12px 6px 12px; border-bottom: 1px solid #8BAD37;">
                                    <c:set var="sensitivityLevel" value="#{sensitivityItem}Level" />
                                    <h:selectOneMenu id="#{sensitivityItem}Severity" value="#{redFlagAlertsBean.item[sensitivityLevel]}" onchange="var id = this.id.substring(0, this.id.length - 8); checkMultiple(id); document.getElementById(id + 'Selected').checked = true;">
                                      <f:selectItem itemValue="INFO" itemLabel="#{messages.redFlag_info}" />
                                      <f:selectItem itemValue="WARNING" itemLabel="#{messages.redFlag_warning}" />
                                      <f:selectItem itemValue="CRITICAL" itemLabel="#{messages.redFlag_critical}" />
                                    </h:selectOneMenu>
                                  </td>
                                </tr>
                              </c:forEach>
                            </table>

                          </h:panelGroup>
                        </a4j:outputPanel>

                        <a4j:outputPanel id="safety">
                          <h:panelGroup rendered="#{redFlagAlertsBean.item.type == 'safety'}">

                            <table width="100%" border="0" cellpadding="2" cellspacing="0" class="datagrid">
                              <tr>
                                <ui:fragment rendered="#{redFlagAlertsBean.batchEdit}">
                                  <th><h:outputText value="#{messages.editRedFlag_batchEdit}" /></th>
                                </ui:fragment>
                                <th><h:outputText value="#{messages.editRedFlag_setting}" /></th>
                                <th width="100"><h:outputText value="#{messages.editRedFlag_severity}" /></th>
                              </tr>
                              <tr class="tableEven">
                                <ui:fragment rendered="#{redFlagAlertsBean.batchEdit}">
                                  <td>
                                    <h:selectBooleanCheckbox id="update_seatBeltLevel" value="#{redFlagAlertsBean.updateField['seatBeltLevel']}" />
                                  </td>
                                </ui:fragment>
                                <td>
                                  <h:outputText value="#{messages.editRedFlag_seatBelt}" />
                                </td>
                                <td>
                                  <h:selectOneMenu id="seatBeltLevelSeverity" value="#{redFlagAlertsBean.item.seatBeltLevel}" onchange="checkMultiple('seatBeltLevel')">
                                    <f:selectItem itemValue="INFO" itemLabel="#{messages.redFlag_info}" />
                                    <f:selectItem itemValue="WARNING" itemLabel="#{messages.redFlag_warning}" />
                                    <f:selectItem itemValue="CRITICAL" itemLabel="#{messages.redFlag_critical}" />
                                  </h:selectOneMenu>
                                </td>
                              </tr>
                            </table>

                          </h:panelGroup>
                        </a4j:outputPanel>

                      </td>
                    </tr>
                  </table>

                  <div class="spacer"></div>

                  <rich:message for="emailToString" errorClass="field-error" fatalClass="field-error" warnClass="field-warning" infoClass="field-info" styleClass="field-msg" />

                  <table width="790" border="0" cellspacing="0" cellpadding="0">
                    <tr>
                      <td width="390" valign="top">

                        <div class="add_section_title">
                          <h:selectBooleanCheckbox rendered="#{redFlagAlertsBean.batchEdit}" id="update_notifyPersonIDs" value="#{redFlagAlertsBean.updateField['notifyPersonIDs']}" />
                          <h:outputText value="#{messages.editAlerts_notificationsByName}" />
                        </div>

                        <div class="instructions"><h:outputText value="#{messages.editAlerts_notificationsByNameInstructions}" /></div>

                        <ui:include src="../../includes/autocompletePicker.xhtml">
                          <ui:param name="autocompleter" value="#{redFlagAlertsBean.peoplePicker}" />
                          <ui:param name="onchange" value="checkMultiple('notifyPersonIDs')" />
                        </ui:include>

                      </td>
                      <td width="10"><h:graphicImage value="/images/x.gif" width="10" /></td>
                      <td width="390" valign="top">

                        <div class="add_section_title">
                          <h:selectBooleanCheckbox rendered="#{redFlagAlertsBean.batchEdit}" id="update_emailToString" value="#{redFlagAlertsBean.updateField['emailToString']}" />
                          <h:outputText value="#{messages.editAlerts_notificationsByEmail}" />
                        </div>

                        <div class="instructions"><h:outputText value="#{messages.editAlerts_notificationsByEmailInstructions}" /></div>

                        <h:inputTextarea id="emailToString" value="#{redFlagAlertsBean.item.emailToString}" rows="4" style="width:100%" onchange="checkMultiple(this)" />

                      </td>
                    </tr>
                  </table>

                  <div class="required-key"><h:outputText rendered="#{not redFlagAlertsBean.batchEdit}" value="#{messages.requiredKey}" /></div>

                  <div class="spacer"></div>

                  <ul id="grid_nav" style="margin: 0;">
                    <li class="r">
                      <h:commandButton action="#{redFlagAlertsBean.save}" styleClass="left"><span class="save"><h:outputText value="#{messages.button_save}" /></span></h:commandButton>
                      <h:outputText value=" " /><h:commandButton action="#{redFlagAlertsBean.cancelEdit}" immediate="true" styleClass="left"><span class="cancel"><h:outputText value="#{messages.button_cancel}" /></span></h:commandButton>
                    </li>
                  </ul>

                </div>
              </div>

              <div class="panel_sw">
                <div class="panel_statusbar"></div>
              </div>
            </div>

          </a4j:form>

          <!-- END PANEL -->
        </td>
      </tr>
    </table>

    <script type="text/javascript">
      var formElements = ["text", "checkbox", "radio", "select-one", "select-multiple", "textarea"];

      function bodyLoad()
      {
        var elements = document.getElementById("edit-form").elements;
        for (var i = 0; i &lt; elements.length; i++)
          for (var j = 0; j &lt; formElements.length; j++)
            if (elements[i].getAttribute("type") == formElements[j])
            {
              elements[i].focus();
              return;
            }
      }

      function checkMultiple(item)
      {
        var id;
        if (typeof(item) == "string")
          id = item;
        else
          id = item.id;

        var box;
        var index = id.indexOf(":");
        if (index > 0)
          box = document.getElementById("edit-form:update_" + id.substring(index + 1));
        else
          box = document.getElementById("edit-form:update_" + id);
        if (!box)
          box = document.getElementById(id + "update_");
        if (box)
          box.checked = true;
      }
    </script>

  </ui:define>

</ui:composition>
