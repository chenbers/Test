<ui:composition template="/layout/layout.xhtml"
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:rich="http://richfaces.org/rich"
	xmlns:a4j="http://richfaces.org/a4j"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:c="http://java.sun.com/jstl/core"
	xmlns:security="http://pro.tiwi.com/jsf/security">

	<ui:param name="adminSelected" value="current" />

	<ui:define name="scripts">
		<script
			src="http://maps.google.com/maps?file=api&amp;v=2&amp;key=#{gmBean.key}"
			type="text/javascript"></script>
	</ui:define>

	<ui:define name="content">

		<table width="920" border="0" cellspacing="0" cellpadding="0"
			align="center" style="margin: 0 auto 0 auto;">
			<tr>
				<td valign="top" width="130"><ui:include
					src="/includes/adminSideNav.xhtml">
					<ui:param name="selectedAction" value="go_adminOrganization" />
				</ui:include></td>
				<td valign="top"><!-- START PANEL --> <h:form id="display-form">

					<div class="">
					<div class="panel_nw">
					<div class="panel_title"><span class="admin"><h:outputText
						value="#{messages.adminHeader_organization}" /></span> <span
						class="panel_links"></span></div>
					</div>

					<div class="panel_w">

					<div class="panel_content">
					<table>
						<tr>
							<td valign="top">
							<div style="textAlign: top; width: 235px">
							<ul id="grid_nav">
								<li class="l grid_icon"><h:graphicImage
									value="/images/ico_building.png" /></li>
								<li class="l grid_title">#{organizationBean.accountName}</li>
							</ul>
							<a4j:region>
							<h:panelGroup id="organizationTreePanel">
								<rich:tree switchType="ajax" selectedClass="selectedNode"
									style="overflow: auto;width:210px;height:400px;border-left:1px solid #A1C667;border-right:1px solid #A1C667;border-bottom:1px solid #A1C667; margin-left: 11px"
									value="#{organizationBean.topLevelNode}" var="node"
									nodeFace="#{node.data.treeNodeType}"
									reRender="groupPanel,driverPanel,vehiclePanel"
									nodeSelectListener="#{organizationBean.selectNode}"
									dragValue="#{node.data}" dropValue="#{node.data}"
									ajaxSubmitSelection="true"
									adviseNodeSelected="#{organizationBean.adviseNodeSelected}">
									<rich:treeNode type="FLEET" iconLeaf="/images/ico_truck.png"
										acceptedTypes="DIVISION" icon="/images/ico_truck.png"
										dropListener="#{organizationBean.processDrop}">
										<h:outputText value="#{node.label}" />
										<rich:dndParam name="label" type="drag" value="#{node.label}" />
									</rich:treeNode>
									<rich:treeNode type="DIVISION"
										iconLeaf="/images/ico_trucks.png" dragType="DIVISION"
										acceptedTypes="DIVISION,TEAM"
										dropListener="#{organizationBean.processDrop}"
										icon="/images/ico_trucks.png">
										<h:outputText value="#{node.label}" />
										<rich:dndParam name="label" type="drag" value="#{node.label}" />
									</rich:treeNode>
									<rich:treeNode type="TEAM" iconLeaf="/images/ico_team.png"
										dragType="TEAM" acceptedTypes="DRIVER,VEHICLE"
										dropListener="#{organizationBean.processDrop}"
										icon="/images/ico_team.png">
										<h:outputText value="#{node.label}" />
										<rich:dndParam name="label" type="drag" value="#{node.label}" />
									</rich:treeNode>
									<rich:treeNode type="DRIVER" iconLeaf="/images/ico_driver.png"
										dragType="DRIVER" icon="/images/ico_team.png">
										<h:outputText value="#{node.label}" />
										<rich:dndParam name="label" type="drag" value="#{node.label}" />
									</rich:treeNode>
									<rich:treeNode type="VEHICLE"
										iconLeaf="/images/ico_vehicle.png" dragType="VEHICLE"
										icon="/images/ico_team.png">
										<h:outputText value="#{node.label}" />
										<rich:dndParam name="label" type="drag" value="#{node.label}" />
									</rich:treeNode>
								</rich:tree>
								<!--
										adviseNodeSelected="#{organizationBean.adviseNodeSelected}" 
										adviseNodeOpened="#{organizationBean.adviseNodeExpanded}"
										changeExpandListener="#{organizationBean.changeExpandListent}"
									-->
							</h:panelGroup>
							</a4j:region>
							 <a4j:jsFunction name="refreshTree"
								reRender="organizationTreePanel"></a4j:jsFunction></div>
							</td>
							<td valign="top">
							<div style="text-align: top; width: 550px; height: 100%"><h:panelGroup
								id="contentPanel">
								<!-- 
								The GROUP PANEL, DRIVER PANEL, AND VEHICLE PANEL are all here at the same level. When an action is fired we only want to reRender
								each panel individually. If we reRender a higher level panel, the the map gets reloaded and the page is much slower. To speed up
								performance, we have the map at this level as well
								 -->
								<h:panelGroup id="groupPanel">
									<h:outputText
										rendered="#{organizationBean.selectedGroupNode ne null and organizationBean.selectedGroupNode.group ne null}">
										<h:outputText
											rendered="#{organizationBean.groupState eq 'VIEW'}">
											<ui:include src="/includes/admin/groupView.xhtml">
												<ui:param name="groupTreeNode"
													value="#{organizationBean.selectedGroupNode}" />
											</ui:include>
										</h:outputText>

										<h:outputText
											rendered="#{organizationBean.groupState ne 'VIEW'}">
											<ui:include src="/includes/admin/groupEdit.xhtml">
												<ui:param name="groupTreeNode"
													value="#{organizationBean.inProgressGroupNode}" />
											</ui:include>

										</h:outputText>
									</h:outputText>
									<c:set var="groupTreeNode" value="#{organizationBean.groupState eq 'VIEW'?organizationBean.selectedGroupNode:organizationBean.inProgressGroupNode}"/>
									<ui:include src="/includes/admin/groupMapView.xhtml">
										<ui:param name="latValue"
											value="#{groupTreeNode.group.mapCenter.lat}" />
										<ui:param name="longValue"
											value="#{groupTreeNode.group.mapCenter.lng}" />
										<ui:param name="zoomLevel"
											value="#{groupTreeNode.group.mapZoom}" />
										<ui:param name="readOnly"
											value="#{organizationBean.groupState eq 'VIEW'}" />
										<ui:param name="formName" value="display-form" />
									</ui:include>

									<h:outputText
										rendered="#{organizationBean.groupState eq 'EDIT'}">
										<div style="padding-top: 25px">
										<ul id="grid_nav_dark">
											<li class="r"><h:panelGroup id="buttonPanelFooter">
												<a4j:commandLink
													rendered="#{organizationBean.groupState eq 'ADD'}"
													onclick="saveGroupNode()">
													<button value="submit" class="left"><span
														class="add"><h:outputText
														value="#{messages.button_create_unit}" /></span></button>
												</a4j:commandLink>
												<h:commandLink
													rendered="#{organizationBean.groupState eq 'EDIT'}"
													onclick="updateGroupNode()">
													<button value="submit" class="left"><span
														class="add"><h:outputText
														value="#{messages.button_save}" /></span></button>
												</h:commandLink>
												<a4j:commandLink
													rendered="#{organizationBean.groupState ne 'VIEW'}"
													action="#{organizationBean.changeState}"
													reRender="groupPanel,organizationTreePanel,buttonPanelFooter">
													<f:param name="state" value="VIEW" />
													<button value="submit" class="left"><span
														class="cancel"><h:outputText
														value="#{messages.button_cancel}" /></span></button>
												</a4j:commandLink>
											</h:panelGroup></li>
										</ul>
										</div>
									</h:outputText>
								</h:panelGroup>

								<h:panelGroup id="driverPanel">
									<h:outputText
										rendered="#{organizationBean.selectedGroupNode.treeNodeType eq 'DRIVER'}">

										<ui:include src="/includes/admin/driverSubview.xhtml">
											<ui:param name="driver"
												value="#{organizationBean.selectedGroupNode.driver}" />
										</ui:include>
									</h:outputText>
								</h:panelGroup>

								<h:panelGroup id="vehiclePanel">

									<h:outputText
										rendered="#{organizationBean.selectedGroupNode.treeNodeType eq 'VEHICLE'}">
										<ui:include src="/includes/admin/vehicleSubview.xhtml">
											<ui:param name="vehicle"
												value="#{organizationBean.selectedGroupNode.vehicle}" />
										</ui:include>
									</h:outputText>
								</h:panelGroup>


							</h:panelGroup></div>
							</td>
						</tr>
					</table>
					</div>
					</div>
					</div>
					<div class="panel_sw">
					<div class="panel_statusbar"></div>
					</div>
				</h:form> <!-- END PANEL --></td>
			</tr>

		</table>

	</ui:define>

</ui:composition>