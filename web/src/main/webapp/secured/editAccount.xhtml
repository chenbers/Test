<ui:composition template="/layout/layout.xhtml" 
				xmlns="http://www.w3.org/1999/xhtml" 
				xmlns:ui="http://java.sun.com/jsf/facelets"
  				xmlns:h="http://java.sun.com/jsf/html" 
  				xmlns:rich="http://richfaces.org/rich"
  				xmlns:a4j="http://richfaces.org/a4j"
  				xmlns:iwi="http://pro.tiwi.com/jsf"
  				xmlns:f="http://java.sun.com/jsf/core"
                xmlns:pretty="http://ocpsoft.com/prettyfaces">
  				
  
	<ui:define name="scripts">

  <a4j:loadStyle src="/css/jsDropdown/dropdownchecklist.css"/>
  <a4j:loadScript src="/js/jsDropdown/ui.dropdownchecklist-1.3-min.js"/>
  <a4j:loadScript src="/js/jsDropdown/jquery-ui-1.8.4.custom.min.js"/>
  
	</ui:define>  
  
  <ui:define name="content">
  <style>
    .rich-message {margin:5px;display:block;}
  </style>
  
  <a4j:form id="my_form">
 
    <ul id="grid_nav">
      <li class="r">
        <h:commandButton id="editAccountSave" action="#{myAccountBean.saveFormAction}" styleClass="left" value="#{messages.button_save} "><h:outputText value="#{messages.button_save} " styleClass="save"/></h:commandButton>
        
        <pretty:urlbuffer var="myAccountLink" mappingId="myAccount"/>
        <button id="editAccountCancel" type="button" class="left" onclick="location.href = '#{requestScope.myAccountLink}';"><h:outputText styleClass="cancel" value="#{messages.button_cancel}"/></button>
      </li>
    </ul>
    
    
    <table class="dash_table" width="940" align="center" border="0" cellpadding="0" cellspacing="0">
      <tbody>
        <tr>
          <td colspan="3" valign="top">
        
            <!-- START PANEL -->
            <div class="">
              <div class="panel_nw">
                <div class="panel_title">
                  <span class="account"><h:outputText value="#{messages.header_myAccount}" /></span>
                  <span class="panel_links"> </span>
                </div>
              </div>
              <div class="panel_w">
                <div class="panel_content">
                  <table width="930" border="0" cellpadding="0" cellspacing="0">
                    <tbody>
                      <tr>
                        <td width="460" style="vertical-align: top">
                          <div class="add_section_title"><h:outputText value="#{messages.myAccount_accountInformation}" /></div>
                            <table width="100%" border="0" cellpadding="4" cellspacing="0">
                              <tbody>
                                <tr>
                                  <td width="100"><h:outputText value="#{messages.myAccount_name}" /></td>
                                  <td><h:outputText value="#{myAccountBean.user.person.fullName}"/></td>
                                </tr>
                                <tr>
                                  <td width="100"><h:outputText value="#{messages.myAccount_region}" /></td>
                                  <td><h:outputText value="#{myAccountBean.regionName}"/></td>
                                </tr>
                                <tr>
                                  <td width="100"><h:outputText value="#{messages.myAccount_team}" /></td>
                                  <td><h:outputText value="#{myAccountBean.teamName}"/></td>
                                </tr>
                            </tbody>
                          </table>
                        </td>

                        <td width="10"><h:graphicImage value="/images/x.gif" width="10"/></td>
                        
                        <td valign="top" width="460" style="vertical-align: top">
                          <div class="add_section_title"><h:outputText value="#{messages.myAccount_loginInformation}" /></div>
                          <table width="100%" border="0" cellpadding="4" cellspacing="0">
                            <tbody>
                              <tr>
                                <td width="150"><h:outputText value="#{messages.myAccount_userName}" /></td>
                                <td><h:outputText value="#{myAccountBean.user.username}"/></td>
                              </tr>
                              <tr>
                                <td width="150"><h:outputText value="#{messages.myAccount_locale}:" /></td>
                                <td>
                                    <h:selectOneMenu id="editAccountLocale" value="#{localeBean.locale}" converter="SimpleBeanConverter">
                                        <f:selectItems value="#{localeBean.supportedLocalesItems}"/>
                                    </h:selectOneMenu>
                                </td>
                              </tr>
                              <tr>
                                <td width="150"><h:outputText value="#{messages.myAccount_measurement}:" /></td>
                                <td>
                                    <h:selectOneMenu id="editAccountMeasurement" value="#{measurementBean.person.measurementType}" converter="SimpleBeanConverter">
                                    	<a4j:support event="onchange" action="#{measurementBean.measurementTypeChosenAction}" reRender="editAccountFuelEfficiency"/>
                                        <f:selectItems value="#{measurementBean.measurementTypeItems}"/>
                                    </h:selectOneMenu>
                                </td>
                              </tr>
                              <tr>
                                <td width="150"><h:outputText value="#{messages.myAccount_fuel_efficiency}:" /></td>
                                <td>
                                    <h:selectOneMenu id="editAccountFuelEfficiency" value="#{fuelEfficiencyBean.person.fuelEfficiencyType}" converter="SimpleBeanConverter">
                                        <f:selectItems value="#{fuelEfficiencyBean.fuelEfficiencyTypeItems}"/>
                                    </h:selectOneMenu>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
              <div class="panel_sw">
                <div class="panel_statusbar"></div>
      
              </div>
            </div>
        <!-- END PANEL -->
        
          </td>
        </tr>
        <tr>
          <td colspan="3" style="height:10px"> </td>
        </tr>
        <tr>
          <td valign="top" width="465">
          	<table width="100%">
    		<tr>
    		<td>
          
            <!-- START PANEL -->
            <div class="">
              <div class="panel_nw">
                <div class="panel_title">
                  <span class="notify"><h:outputText value="#{messages.myAccount_notifications}" /></span>
                </div>
              </div>
              <div class="panel_w">
                <div class="panel_content">
                  <table width="100%" border="0" cellpadding="4" cellspacing="0">
                    <tbody>
                      <tr>
                      	<td colspan="3"><rich:message for="editAccount-info" errorClass="field-error" fatalClass="field-error" warnClass="field-warning" infoClass="field-info" styleClass="field-msg" /></td>
                      </tr>
                      <tr>
                        <td width="16"><h:graphicImage value="/images/ico_info.png" width="16" height="16" /></td>
                        <td width="90"><h:outputText value="#{messages.myAccount_information}" /></td>
                        <td>
                          <h:selectOneMenu value="#{myAccountBean.user.person.info}" id="editAccount-info" style="width:250px">
                            <f:selectItems value="#{myAccountBean.alertOptions}" />
                          </h:selectOneMenu>
                        </td>
                      </tr>
                      <tr>
                        <td width="16"><h:graphicImage value="/images/ico_warning.png" width="16" height="16" /></td>
                        <td width="90"><h:outputText value="#{messages.myAccount_warning}" /></td>
                        <td>
                          <h:selectOneMenu value="#{myAccountBean.user.person.warn}" id="editAccount-warn" style="width:250px">
                            <f:selectItems value="#{myAccountBean.alertOptions}" />
                          </h:selectOneMenu>
                        </td>
                      </tr>
                      <tr>
                        <td width="16"><h:graphicImage value="/images/ico_critical.png" width="16" height="16" /></td>
                        <td width="90"><h:outputText value="#{messages.myAccount_critical}" /></td>
                        <td>
                          <h:selectOneMenu value="#{myAccountBean.user.person.crit}" id="editAccount-crit" style="width:250px">
                            <f:selectItems value="#{myAccountBean.alertOptions}" />
                          </h:selectOneMenu>
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>

              <div class="panel_sw">
                <div class="panel_statusbar"></div>
              </div>
            </div>
            <!-- END PANEL -->
            
            
           	</td>
    	</tr>
	    <tr>
        	<td style="height:10px"> </td>
    	</tr>
    	<tr>
    	<td>
          <!-- START PANEL -->
          <div class="">
            <div class="panel_nw">
              <div class="panel_title">
                <span class="map"><h:outputText value="#{messages.myAccount_mapPref}" /></span>
              </div>
            </div>
            <div class="panel_w">
              <div class="panel_content">
                <table width="100%" border="0" cellpadding="4" cellspacing="0">
                  <tbody>
                    <tr>
                      <td width="120"><h:outputText value="#{messages.myAccount_mapPrefType}" /></td>
                      <td id="myAccountMapType">
                       <h:selectOneMenu value="#{myAccountBean.user.mapType}" id="editAccount-mapType" style="width:250px" converter="SimpleBeanConverter">
                           <f:selectItems value="#{myAccountBean.mapTypeOptions}" />
                       </h:selectOneMenu>
                       </td>
                    </tr>
                    <tr>
                      <td width="120"><h:outputText value="#{messages.myAccount_mapPrefLayers}" /></td>
                      <td id="myAccountMapLayers">
                      <a4j:outputPanel>
						<h:selectManyMenu id="myAccountMapLayersSelect" value="#{myAccountBean.user.selectedMapLayerIDs}"  converter="SimpleBeanConverter"
					  					style="width:200px;size:auto">
							<f:selectItems value="#{myAccountBean.mapLayers}"/>
					  	</h:selectManyMenu>
						<rich:jQuery selector="#myAccountMapLayersSelect" timing="onload"  
                            query="dropdownchecklist({ icon: {placement: 'right', toOpen: 'ui-icon-triangle-1-s', toClose: 'ui-icon-triangle-1-n'}, 
                                                        textFormatFunction: function(options) {
																return '#{messages.mapLayers}';
      		      										},
                                                        width: 200,maxDropHeight: 150,
      		      									}
							)"/>
						</a4j:outputPanel>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
      
            <div class="panel_sw">
              <div class="panel_statusbar"></div>
            </div>
          </div>
          <!-- END PANEL -->
    	</td>
    	</tr>
    	</table>    
        </td>
        <td width="10"><h:graphicImage value="/images/x.gif" width="10"/></td>
        
          <td valign="top" width="465">
          
          <!-- START PANEL -->
            <div class="">
              <div class="panel_nw">
                <div class="panel_title">
                  <span class="contact"><h:outputText value="#{messages.myAccount_contactInformation}" /></span>
                </div>
              </div>
              <div class="panel_w">
                <div class="panel_content">
                  <div class="add_section_title"><h:outputText value="#{messages.myAccount_email}" /></div>
                    <table width="100%" border="0" cellpadding="4" cellspacing="0">
                      <tbody>
                        <tr>
                          <td width="120"><h:outputText value="#{messages.myAccount_priEmail}" /> <span class="required">*</span></td>
                          <td>
                            <rich:message for="editAccount-priEmail" errorClass="field-error" fatalClass="field-error" warnClass="field-warning" infoClass="field-info" styleClass="field-msg" />
                            <h:inputText id="editAccount-priEmail" value="#{myAccountBean.user.person.priEmail}" size="40" maxlength="62"
                              onblur="populateAlertText()" required="true" requiredMessage="#{messages.required}" validator="#{myAccountBean.validateEmail}" />
                          </td>
                        </tr>
                        <tr>
                          <td width="120"><h:outputText value="#{messages.myAccount_secEmail}" /></td>
                          <td>
                            <rich:message for="editAccount-secEmail" errorClass="field-error" fatalClass="field-error" warnClass="field-warning" infoClass="field-info" styleClass="field-msg" />
                            <h:inputText id="editAccount-secEmail" value="#{myAccountBean.user.person.secEmail}" 
                              size="40" maxlength="62" onblur="populateAlertText()" validator="#{myAccountBean.validateEmail}" />
                          </td>
                        </tr>
                      </tbody>
                    </table>
                             
                    <div class="add_section_title"><h:outputText value="#{messages.myAccount_phone}" /></div>
                    <table width="100%" border="0" cellpadding="4" cellspacing="0">
                      <tbody>
                        <tr>
                          <td width="120"><h:outputText value="#{messages.myAccount_priPhone}" /></td>
                          <td>
                            <rich:message for="editAccount-priPhone" errorClass="field-error" fatalClass="field-error" warnClass="field-warning" infoClass="field-info" styleClass="field-msg" />
                            <h:inputText id="editAccount-priPhone" value="#{myAccountBean.user.person.priPhone}" size="40" maxlength="22" onblur="populateAlertText()" validatorMessage="#{messages.myAccount_phoneFormat}" converter="PhoneNumberConverter">
                                  <f:validateLength  maximum="22" />
                             	  <f:validator validatorId="com.inthinc.pro.validators.PhoneValidator" />
<!--                              <f:validator validatorId="com.inthinc.pro.validators.RegexValidator" />-->
<!--                              <f:attribute name="regex" value="\D?\d{3}\D*\d{3}\D?\d{4}" />-->
                            </h:inputText>
                          </td>
                        </tr>
                        <tr>
                          <td width="120"><h:outputText value="#{messages.myAccount_secPhone}" /></td>
                          <td>
                            <rich:message for="editAccount-secPhone" errorClass="field-error" fatalClass="field-error" warnClass="field-warning" infoClass="field-info" styleClass="field-msg" />
                            <h:inputText id="editAccount-secPhone" value="#{myAccountBean.user.person.secPhone}" size="40" maxlength="22" onblur="populateAlertText()" validatorMessage="#{messages.myAccount_phoneFormat}" converter="PhoneNumberConverter">
                                  <f:validateLength  maximum="22" />
                             	  <f:validator validatorId="com.inthinc.pro.validators.PhoneValidator" />
<!--                              <f:validator validatorId="com.inthinc.pro.validators.RegexValidator" />-->
<!--                              <f:attribute name="regex" value="\D?\d{3}\D*\d{3}\D?\d{4}" />-->
                            </h:inputText>
                          </td>
                        </tr>
                      </tbody>
                    </table>
                                  
                    <div class="add_section_title"><h:outputText value="#{messages.myAccount_textMessages}" /></div>
                    <table width="100%" border="0" cellpadding="4" cellspacing="0">
                      <tbody>
                        <tr>
                          <td width="120"><h:outputText value="#{messages.myAccount_priText}" /></td>
                          <td>
                            <rich:message for="editAccount-priText" errorClass="field-error" fatalClass="field-error" warnClass="field-warning" infoClass="field-info" styleClass="field-msg" />
                            <h:inputText id="editAccount-priText" value="#{myAccountBean.user.person.priText}" size="40" maxlength="62" onblur="populateAlertText()" >
       	                          <f:validator validatorId="com.inthinc.pro.validators.RegexValidator" />
	                              <f:attribute name="regex" value="#{messages.smsTextRegex}" />
                              	  <f:attribute name="regexErrorMessage" value="#{messages.myAccount_textMessageFormat}" />
                            </h:inputText>
                          </td>
                        </tr>
                        <tr>
                          <td width="120"><h:outputText value="#{messages.myAccount_secText}" /></td>
                          <td>
                            <rich:message for="editAccount-secText" errorClass="field-error" fatalClass="field-error" warnClass="field-warning" infoClass="field-info" styleClass="field-msg" />
                            <h:inputText id="editAccount-secText" value="#{myAccountBean.user.person.secText}" size="40" maxlength="62" onblur="populateAlertText()" validator="#{myAccountBean.validateEmail}">
       	                          <f:validator validatorId="com.inthinc.pro.validators.RegexValidator" />
	                              <f:attribute name="regex" value="#{messages.smsTextRegex}" />
                              	  <f:attribute name="regexErrorMessage" value="#{messages.myAccount_textMessageFormat}" />
                            </h:inputText>
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
                <div class="panel_sw">
                  <div class="panel_statusbar"></div>
                </div>
              </div>
              <!-- END PANEL -->
            </td>
          
          </tr>
        </tbody>
      </table>
    </a4j:form>  
    
    
    <script type="text/javascript" language="Javascript">
  function bodyLoad()
  {
    populateAlertText();
  }

  function populateAlertText(id)
  {
    if (#{personBean.batchEdit})
      return;

    if (id == null)
    {
      populateAlertText("my_form:editAccount-info");
      populateAlertText("my_form:editAccount-warn");
      populateAlertText("my_form:editAccount-crit");
    }
    else
    {
      var select = document.getElementById(id);
      populateAlertOption(select.options[1], "my_form:editAccount-priEmail");
      populateAlertOption(select.options[2], "my_form:editAccount-secEmail");
      populateAlertOption(select.options[3], "my_form:editAccount-priPhone");
      populateAlertOption(select.options[4], "my_form:editAccount-secPhone");
      populateAlertOption(select.options[5], "my_form:editAccount-priText");
      populateAlertOption(select.options[6], "my_form:editAccount-secText");
    }
  }

  function populateAlertOption(option, inputId)
  {
    var value = document.getElementById(inputId).value;
    if ((value != null) &amp;&amp; (value != ""))
      value = "#{messages.myAccount_alertTextSeparator}" + value;
    var index = option.text.indexOf("#{messages.myAccount_alertTextSeparator}");
    if (index != -1)
      option.text = option.text.substring(0, index) + value;
    else
      option.text = option.text + value;
  }
    </script>
        
  </ui:define>

</ui:composition>
