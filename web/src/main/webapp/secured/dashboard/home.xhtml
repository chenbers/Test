<ui:composition template="/layout/layout.xhtml" 
	            xmlns="http://www.w3.org/1999/xhtml" 
	            xmlns:ui="http://java.sun.com/jsf/facelets"
	            xmlns:h="http://java.sun.com/jsf/html" 
	            xmlns:rich="http://richfaces.org/rich"
	            xmlns:a4j="http://richfaces.org/a4j"
	            xmlns:c="http://java.sun.com/jstl/core"
	            xmlns:f="http://java.sun.com/jsf/core"
	            xmlns:t="http://myfaces.apache.org/tomahawk"
	            xmlns:pretty="http://ocpsoft.com/prettyfaces">
         
       <ui:define name="scripts">
          <script src="#{facesContext.externalContext.request.contextPath}/js/FusionCharts.js" type="text/javascript"></script>   
          <script src="http://maps.google.com/maps?file=api&amp;v=#{gmBean.version}&amp;key=#{gmBean.key}&amp;hl=#{localeBean.locale.language}" type="text/javascript"></script>
          <script src="#{facesContext.externalContext.request.contextPath}/js/markermanager.js"  type="text/javascript"></script>
       </ui:define>  
       
      	<ui:param name="homeSelected" value="current" />
      	<ui:param name="helpFile" value="Overall_Score-Fleet_Level.htm" />

    	<ui:define name="content">
    	
    	<t:saveState value="#{trendBean.sortColumn}"></t:saveState>
		<t:saveState value="#{trendBean.sortDirection}"></t:saveState>
		<t:saveState value="#{trendBean.trendBeanItems}"></t:saveState>
        <t:saveState value="#{dashBoardBean}"></t:saveState>
        <t:saveState value="#{dashDetailBoardBean}"></t:saveState>
		
           <ui:include src="/includes/overviewHeader.xhtml">
             <ui:param name="showContextMenu" value="true"/>
           </ui:include>
    		<table width="940" border="0" cellspacing="0" cellpadding="0" align="center" class="dash_table">
      			<tr>
    			<td colspan="3" valign="top">
      			    					<!-- START CRASH SUMMARY PANEL -->
    					<ui:include src="/includes/crashSummary.xhtml">	
                            <ui:param name="xyheight" value="100"/>
                            <ui:param name="xywidth" value="920"/>  
                            <ui:param name="zorder" value="6"/>	
    					</ui:include>
    					<!-- END CRASH SUMMARY -->
    					<div class="spacer"></div>
    			</td></tr>
    			<tr>	
  
        			<td width="465" valign="top">
    					<!-- START OVERALL/R PANEL -->
    					<!-- leave reRenderList alone -->
    					<ui:include src="/includes/overallScore.xhtml">
                           <ui:param name="zorder" value="6" />
                        </ui:include>
    					<!-- END PANEL -->
    					<div class="spacer"></div>
    				
    					<!-- START MPG PANEL -->
    					<ui:include src="/includes/mpgChart.xhtml">	
                			<ui:param name="barDef" value="#{mpgBean.barDef}"/>  
                            <ui:param name="xyheight" value="350"/>
                            <ui:param name="xywidth" value="440"/>  
                            <ui:param name="zorder" value="6"/>	
    					</ui:include>
    					<!-- END MPG -->	
    
    				</td>
    	
        			<td width="10"><img src="#{facesContext.externalContext.request.contextPath}/images/x.gif" width="10" /></td>
    	
    	    		<td width="465" valign="top">

    					<!-- START TREND PANEL -->
                        <a4j:outputPanel id="trendOutputPanel">
        					<div>
        
        						<div class="panel_nw">
        							<div class="panel_title">
        								<span class="line">#{messages.trendReport_header}</span> 
                                        
                                       <pretty:urlbuffer var="detailedDashboardLink" mappingId="detailedDashboard">
                                            <f:param value="#{navigationBean.groupID}"/>
                                            <f:param value="TREND"/>
                                        </pretty:urlbuffer> 
                                        <ui:include src="/includes/durationPanelHeader.xhtml">
                                            <ui:param name="reRenderList" value="trendOutputPanel" />
                                            <ui:param name="duration" value="#{navigationDurationBean.duration}" />
                                            <ui:param name="groupID" value="#{navigationBean.groupID}"/>
                                            <ui:param name="report" value="TREND" />
                                            <ui:param name="id" value="trend" />
                                            <ui:param name="detailLink" value="#{requestScope.detailedDashboardLink}"/>
                                        </ui:include>
        							</div>
        		
        						</div>
        
        
        						<div class="panel_w">
        								<div class="panel_content">
        								<rich:panel style="height:300;width:445">
        									<div id="chartdiv2" align="center"></div>
        									<script type="text/javascript">
        										var chart = new FusionCharts("#{facesContext.externalContext.request.contextPath}/fusioncharts/MSLine.swf", "TrendChartId", "445", "300", "0", "1");						   						   		
        										chart.setDataXML("<chart></chart>");
        										chart.setTransparent(true);
        										chart.render("chartdiv2");
        									</script>
        								</rich:panel> 	
        								<!-- Start xy graph --> 	
        								<rich:panel id="xypanel">
        								<h:inputHidden value="#{trendBean.lineDef}" id="hiddenField1" />
        
        								<script type="text/javascript">
        									 var targetElement = document.getElementById("hiddenField1");
        									 var chartObj = getChartFromId("TrendChartId");
        
        									 chartObj.setDataXML(targetElement.value);
        
        									 function FC_Rendered(DOMId)
        									 {
        								         //If it's our required chart
        								         if (DOMId=="TrendChartId"){
        								            //Simply alert
        										           
        											chartObj = getChartFromId("TrendChartId");
        											chartObj.setDataXML(targetElement.value);
        								            return;
        								         }
        								      }
        								</script>
        							</rich:panel> 
        							<!-- End xy graph -->			
        	
        							<div style="text-align: right;" >													
        								<h:outputText id="countString" value="#{trendBean.countString}"/><rich:spacer width="15" height="5"/>
        							</div>					
        							<rich:spacer height="3" />
        							<h:form id="trendTable">
<!--    									<rich:datascroller id="topScroller" for="items" immediate="true" styleClass="dataScrollerLarge"-->
<!--    	        								scrollerListener="#{trendBean.scrollerListener}" maxPages="5" align="center" -->
<!--    	        								reRender="bottomScroller,countString,items,xypanel">        			-->
<!--    			        				</rich:datascroller>-->
        					        	<rich:spacer height="15" />
                							
           								<h:inputHidden id="hiddenGroupID" value="#{navigationBean.groupID}"/>   						
        								<rich:dataTable value="#{trendBean.trendBeanItems}" id="items"
        											var="item" styleClass="datatable" rowClasses="tableOdd,tableEven" 
        											cellspacing="1" rows="#{trendBean.numRowsPerPg}" width="100%">
        									
        									<rich:column width="10%">
        										<f:facet name="header">
        											<h:outputText value=" " />
        										</f:facet>
        										<rich:spacer width="17" height="17"
        											style="background-color:#{item.scoreableEntityPkg.colorKey};border-style:solid;border-width:1px;border-color:#000000">
        										</rich:spacer>
        									</rich:column>
        									<rich:column width="65%">
        										<f:facet name="header">
        											<a4j:commandLink value="#{messages.trendReport_header_divisionTeam}" 
        															 reRender="xypanel,bottomScroller,items" action="#{trendBean.sort}" ajaxSingle="true">
        												<f:setPropertyActionListener target="#{trendBean.sortDirection}" value="#{trendBean.sortDirection eq 'DESC' ? 'ASC' : 'DESC'}"/>
        												<f:setPropertyActionListener target="#{trendBean.sortColumn}" value="se.identifier" />	
        												<h:graphicImage styleClass="sortArrows" rendered="#{trendBean.sortColumn eq 'se.identifier'}" value="/images/#{trendBean.sortDirection eq 'DESC' ? 'sort_desc.gif' : 'sort_asc.gif'}" />
        												<h:graphicImage styleClass="sortArrows" rendered="#{trendBean.sortColumn ne 'se.identifier'}" value="/images/sort_available.gif" />		
        											</a4j:commandLink>
        										</f:facet>
                                                <pretty:link mappingId="dashboard">
                                                    <f:param value="#{item.groupID}"/>
                                                    <h:outputText value="#{item.groupName}" />
                                                </pretty:link>
        									</rich:column>
        									<rich:column width="15%" styleClass="trendTableScore">
        										<f:facet name="header">
        											<a4j:commandLink value="#{messages.trendReport_header_score}" 
        															 reRender="xypanel,bottomScroller,items" action="#{trendBean.sort}" ajaxSingle="true">
        												<f:setPropertyActionListener target="#{trendBean.sortDirection}" value="#{trendBean.sortDirection eq 'DESC' ? 'ASC' : 'DESC'}"/>		
        												<f:setPropertyActionListener target="#{trendBean.sortColumn}" value="se.score" />	
        												<h:graphicImage styleClass="sortArrows" rendered="#{trendBean.sortColumn eq 'se.score'}" value="/images/#{trendBean.sortDirection eq 'DESC' ? 'sort_desc.gif' : 'sort_asc.gif'}" />
        												<h:graphicImage styleClass="sortArrows" rendered="#{trendBean.sortColumn ne 'se.score'}" value="/images/sort_available.gif" />															
        											</a4j:commandLink>
        										</f:facet>
                                                <ui:include src="/includes/scoreBox.xhtml">  
                                                    <ui:param name="scoreStyle" value="#{item.scoreableEntityPkg.style}"/>                                  
                                                    <ui:param name="score" value="#{item.score}"/>                                    
                                                </ui:include>
        									</rich:column>
        									<rich:column width="10%" styleClass="trendTableScore">
        										<f:facet name="header">
        											<a4j:commandLink  value="#{messages.crash_summary_overDistanceColumn}" reRender="xypanel,bottomScroller,items" action="#{trendBean.sort}" ajaxSingle="true">
                  										<f:setPropertyActionListener target="#{trendBean.sortDirection}" value="#{trendBean.sortDirection eq 'DESC' ? 'ASC' : 'DESC'}"/>		
        												<f:setPropertyActionListener target="#{trendBean.sortColumn}" value="se.crashes" />	
        												<h:graphicImage styleClass="sortArrows" rendered="#{trendBean.sortColumn eq 'se.crashes'}" value="/images/#{trendBean.sortDirection eq 'DESC' ? 'sort_desc.gif' : 'sort_asc.gif'}" />
        												<h:graphicImage styleClass="sortArrows" rendered="#{trendBean.sortColumn ne 'se.crashes'}" value="/images/sort_available.gif" />															
        											</a4j:commandLink>
        										</f:facet>
                                                    <h:outputText value="#{item.crashesPerMillionMiles}" converter="PerMillionsMilesToPerMillionsKmConverter"/>
 											</rich:column>
        								</rich:dataTable>
        								
    									<rich:datascroller id="bottomScroller" for="items" immediate="true" align="center" styleClass="dataScrollerLarge"
    	   									scrollerListener="#{trendBean.scrollerListener}" maxPages="5" renderIfSinglePage="false"
    	       								reRender="countString,items,xypanel">        			
    	       							</rich:datascroller>
        	        					
        						
        							</h:form> 
        					
        						
        						</div>
        
        						<div class="panel_sw">
        							<div class="panel_statusbar"></div>
        						</div>
        					</div>
        	
        					</div>				
                        </a4j:outputPanel>
    					<!-- END PANEL -->
    				</td>
      			</tr>
    		</table>
        </ui:define>
</ui:composition>

