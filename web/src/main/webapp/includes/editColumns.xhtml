<html xmlns="http://www.w3.org/1999/xhtml"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:c="http://java.sun.com/jstl/core"
    xmlns:a4j="http://richfaces.org/a4j"
    xmlns:rich="http://richfaces.org/rich">

<!--
  A pop-up modal form that allows choosing the visible columns to appear.

  Required Parameters:
  ==============
         allColumns:  A list of available column names.
    allColumnsCount:  The number of column names in allColumns.
    selectedColumns:  A Map with String keys and Boolean values for which columns are chosen.
     messagesPrefix:  A prefix to prepend to the action to obtain a user-friendly message.
           reRender:  Id['s] (in format of call UIComponent.findComponent()) of components, rendered in case
                      of AjaxRequest caused by this component. Can be single id, comma-separated list of Id's,
                      or EL Expression with array or Collection.

  Optional Parameters:
  ==============
           saveBean:  A bean that has a method named saveColumns(), called when the save button is clicked.

  To use:
  ==============
      <ui:include src="/includes/editColumns.xhtml">
        <ui:param name="allColumns" value="#{myBean.availableColumns}" />
        <ui:param name="allColumnsCount" value="#{myBean.availableColumnCount}" />
        <ui:param name="selectedColumns" value="#{myBean.columns}" />
        <ui:param name="messagesPrefix" value="myPrefix_" />
        <ui:param name="messagesPrefix" value="myPrefix_" />
      </ui:include>
-->

  <ui:composition>

    <c:if test="#{(allColumnsCount % 3) == 0}">
      <c:set var="columnCount" value="#{allColumnsCount / 3}" />
    </c:if>
    <c:if test="#{(allColumnsCount % 3) != 0}">
      <c:set var="columnCount" value="#{(allColumnsCount / 3) + 1}" />
    </c:if>

    <rich:modalPanel id="editColumns" headerClass="popupHeader" controlsClass="popupControls" width="500" height="500" zindex="2000">
      <f:facet name="header">
        <h:outputText value="Edit Columns"/>
      </f:facet>
      <f:facet name="controls">
        <h:graphicImage value="/images/modal_close.png" style="cursor:pointer" onclick="Richfaces.hideModalPanel('editColumns')" />
      </f:facet>

      <div class="popupsubtitle">The following columns will be displayed</div>

      <a4j:form id="editColumnsForm">

        <rich:dataTable value="#{allColumns}" rows="#{columnCount}" var="col" rowKeyVar="index">
          <rich:column width="33%">
            <c:set var="columnName" value="#{messagesPrefix}#{col}" />
            <h:outputLabel>
              <h:selectBooleanCheckbox value="#{selectedColumns[col]}" />
              <h:outputText value="#{messages[columnName]}" />
            </h:outputLabel>
          </rich:column>
          <rich:column width="33%">
            <c:set var="columnName" value="#{messagesPrefix}#{allColumns[(index + columnCount)]}" />
            <h:outputLabel>
              <h:selectBooleanCheckbox value="#{selectedColumns[allColumns[(index + columnCount)]]}" />
              <h:outputText value="#{messages[columnName]}" />
            </h:outputLabel>
          </rich:column>
          <rich:column width="33%" rendered="#{(index + (columnCount * 2)) lt (allColumnsCount - 1)}">
            <c:set var="columnName" value="#{messagesPrefix}#{allColumns[(index + (columnCount * 2))]}" />
            <h:outputLabel>
              <h:selectBooleanCheckbox value="#{selectedColumns[allColumns[(index + (columnCount * 2))]]}" />
              <h:outputText value="#{messages[columnName]}" />
            </h:outputLabel>
          </rich:column>
        </rich:dataTable>

        <div class="popupactions">
          <button value="submit" class="left" onclick="Richfaces.hideModalPanel('editColumns'); return false;"><span class="cancel">Cancel</span></button>
          <a4j:commandLink rendered="#{!empty saveBean}" action="#{saveBean['saveColumns']}" onclick="Richfaces.hideModalPanel('editColumns')" reRender="#{reRender}"><button value="submit" class="left"><span class="save">Save</span></button></a4j:commandLink>
          <a4j:commandLink rendered="#{empty saveBean}" onclick="Richfaces.hideModalPanel('editColumns')" reRender="#{reRender}"><button value="submit" class="left"><span class="save">Save</span></button></a4j:commandLink>
        </div>

      </a4j:form>

    </rich:modalPanel>

  </ui:composition>

</html>