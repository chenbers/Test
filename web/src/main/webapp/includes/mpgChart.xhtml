<ui:composition xmlns="http://www.w3.org/1999/xhtml" 
	            xmlns:ui="http://java.sun.com/jsf/facelets"
	            xmlns:h="http://java.sun.com/jsf/html" 
	            xmlns:rich="http://richfaces.org/rich"
	            xmlns:a4j="http://richfaces.org/a4j"
	            xmlns:c="http://java.sun.com/jstl/core"
	            xmlns:f="http://java.sun.com/jsf/core"
	            xmlns:t="http://myfaces.apache.org/tomahawk"
	            xmlns:pretty="http://ocpsoft.com/prettyfaces">
        
    <t:saveState value="#{mpgBean.groupID}"/>
    <a4j:outputPanel id="mpgOutputPanel">    
        <div class="panel_nw">    
            <div class="panel_title" style="z-index: #{zorder}">
                <span class="gas">
                #{messages.mpg_title}
                </span>   
                <pretty:urlbuffer var="detailedDashboardLink" mappingId="detailedDashboard">
                    <f:param value="#{mpgBean.groupID}"/>
                    <f:param value="MPG"/>
                </pretty:urlbuffer> 
                <pretty:urlbuffer var="dashboardLink" mappingId="dashboard">
                    <f:param value="#{mpgBean.groupID}"/>
                </pretty:urlbuffer>
                <ui:include src="/includes/durationPanelHeader.xhtml">
                    <ui:param name="reRenderList" value="mpgOutputPanel" />
                    <ui:param name="duration" value="#{mpgDurationBean.duration}" />
                    <ui:param name="report" value="MPG_GROUP" />
                    <ui:param name="id" value="mpg" />
                    <ui:param name="groupID" value="#{mpgBean.groupID}"/>
                    <ui:param name="detailLink" value="#{maximized ? requestScope.dashboardLink : requestScope.detailedDashboardLink}"/>
                    <ui:param name="maximized" value="#{not empty maximized ? maximized : false}"/>
    				<ui:param name="context" value="#{context}-mpgChart" />
                    
                </ui:include>
            </div>
        </div>
        <div class="panel_w">
            <div class="panel_content">
                <!-- Start xy graph --> 
                <div style="height:#{xyheight};width:#{xywidth}">
                    <div id="mpgChartDiv" align="center"></div>
                    <rich:panel>
            	        <h:inputHidden value="#{barDef}" id="mpgDataElement" />
            	        <script type="text/javascript">
            	            var targetElement = document.getElementById("mpgDataElement");
            	              
            	            var chart = new FusionCharts("#{facesContext.externalContext.request.contextPath}/fusioncharts/ScrollColumn2D.swf", "ChartId", "#{xywidth}", "#{xyheight}", "0", "0");                                
            	            chart.setDataXML(targetElement.value);
            	            chart.setTransparent(true);          
            	            chart.render("mpgChartDiv");
            	          </script>
                     </rich:panel>                  
                </div> 
                <!-- End xy graph --> 
    
                 <c:if test="#{includeTable}">
                     <rich:panel>
                        <div class="spacer"></div>            
                        <a4j:form id="mpgTableForm" ajaxSubmit="true" reRender="mpgTable">
                            <rich:dataTable id="mpgTable" value="#{mpgBean.mpgEntities}" var="item" styleClass="datagrid" rowClasses="tableOdd,tableEven" cellspacing="1" width="100%">
                                <rich:column sortBy="#{item.entityName}">
                                    <f:facet name="header">
                                        <h:outputText value="#{messages.mpg_name_column}" />
                                    </f:facet>
                                    <pretty:link id="#{context}-mggChartDashboard" mappingId="dashboard">
                                        <f:param value="#{item.groupID}"/>
                                        <h:outputText value="#{item.entityName}" />
                                    </pretty:link>
                                </rich:column>
                                <rich:column sortBy="#{item.entity.lightValue}">
                                    <f:facet name="header">
                                        <h:outputText value="#{messages.mpg_light_column}" />
                                    </f:facet>
                                    <h:outputText value="#{item.lightValue}" converter="MpgToKplConverter"/>
                                </rich:column>
                                <rich:column sortBy="#{item.entity.mediumValue}">
                                    <f:facet name="header">
                                        <h:outputText value="#{messages.mpg_medium_column}" converter="MpgToKplConverter"/>
                                    </f:facet>
                                    <h:outputText value="#{item.mediumValue}" converter="MpgToKplConverter" />
                                </rich:column>
                                <rich:column sortBy="#{item.entity.heavyValue}">
                                    <f:facet name="header">
                                        <h:outputText value="#{messages.mpg_heavy_column}" converter="MpgToKplConverter"/>
                                    </f:facet>
                                    <h:outputText value="#{item.heavyValue}" converter="MpgToKplConverter" />
                                </rich:column>
                            </rich:dataTable>
                        </a4j:form>        
                    </rich:panel>
                </c:if>
            </div>
        </div>
        
        <div class="panel_sw">
            <div class="panel_statusbar"/>
        </div>
    </a4j:outputPanel>
    <!-- End xy graph --> 

</ui:composition>