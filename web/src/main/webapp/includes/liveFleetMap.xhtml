<ui:composition 
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:a4j="http://richfaces.org/a4j"
	xmlns:rich="http://richfaces.org/rich"
	xmlns:f="http://java.sun.com/jsf/core"
  	xmlns:iwi="http://pro.tiwi.com/jsf"
	xmlns:h="http://java.sun.com/jsf/html">
	
		<div class="">
				<div class="panel_nw">
					<div class="panel_title">
						<span class="map">Fleet Map</span>
					</div>
				</div>
				<div class="panel_w">
					
					<div class="panel_content">
						<h:panelGroup styleClass="map-border" layout="block">
							<div id="map-canvas" style="#{mapwidth};#{mapheight};border:0"></div>
					  	</h:panelGroup>
					  	<h:form >
					    <script type="text/javascript">
      						if (GBrowserIsCompatible()) {
        						map = new GMap2(document.getElementById("map-canvas"));
        						map.addControl(new GLargeMapControl());
        						map.addControl(new GMapTypeControl());
        						map.addControl(new GOverviewMapControl()); 
								map.setCenter(new GLatLng(#{driverLocationBean.center.lat}, #{driverLocationBean.center.lng}), 5);
								map.setMapType(G_NORMAL_MAP);
 
						        // Create a base icon for all of our markers that specifies the
						        // shadow, icon dimensions, etc.
						        var baseIcon = new GIcon(G_DEFAULT_ICON);
						        baseIcon.shadow = "http://www.google.com/mapfiles/shadow50.png";
						        baseIcon.iconSize = new GSize(20, 34);
						        baseIcon.shadowSize = new GSize(37, 34);
						        baseIcon.iconAnchor = new GPoint(9, 34);
						        baseIcon.infoWindowAnchor = new GPoint(9, 2);
						        
 								// Creates a marker whose info window displays the letter corresponding
						        // to the given index.
						        function createMarker(point, index, name,link) {
						          // Create a lettered icon for this point using our icon class
						          var letter = String.fromCharCode("A".charCodeAt(0) + index);
						          var letteredIcon = new GIcon(baseIcon);
						          letteredIcon.image = "http://www.google.com/mapfiles/marker" + letter + ".png";
						
						          // Set up our GMarkerOptions object
						          markerOptions = { icon:letteredIcon };
						          var marker = new GMarker(point, markerOptions);
						
						          GEvent.addListener(marker, "click", function() {
								            marker.openInfoWindowHtml('Driver &#160;<a href="/tiwipro/secured/driver.faces">'+name+'</a>');
						            
						          });
						          return marker;
						        }
 								var i=0;
								<ui:repeat value="#{driverLocationBean.driverBeans}" var="driver">
								
									var latlng = new GLatLng(#{driver.lastLocation.lat}, #{driver.lastLocation.lng});
						        		map.addOverlay(createMarker(latlng, i++,  "#{driver.driverName}"));
	        						
								
							  	</ui:repeat>
							}	
    					</script> 
    					</h:form>
 					 </div>
				</div>		
																					
				<div class="panel_sw">
					<div class="panel_statusbar"></div>
				</div>
				
				<div class="spacer"></div>		
				
				<div class="panel_nw">
					<div class="panel_title">
						<span class="legend">Fleet Legend</span>
						<span class="panel_links"></span>
					</div>
				</div>						
				
				<div class="panel_w">
					<div class="panel_content">
					  
						<ul class="legend clearfix">
							<li class="red">Washington</li>
						    <li class="orange">Oregon</li>
						    <li class="lt_blue">Vegas</li>
						    <li class="purple">Phoenix</li>
						    <li class="gray">SLC</li>
						    <li class="green">Sac/Bay</li>
						    <li class="blue">LA/San Diego</li>
						    <li class="lt_gray">Idaho</li>
						    <li class="pink">Montana </li>
						</ul>
					  
					</div>
				</div>
													
				<div class="panel_sw">
					<div class="panel_statusbar"></div>
				</div>
		</div>	
		
</ui:composition>	