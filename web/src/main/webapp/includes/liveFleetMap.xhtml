<ui:composition 
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:a4j="http://richfaces.org/a4j"
	xmlns:rich="http://richfaces.org/rich"
	xmlns:f="http://java.sun.com/jsf/core"
  	xmlns:iwi="http://pro.tiwi.com/jsf"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:c="http://java.sun.com/jstl/core">
	
		<script src="#{facesContext.externalContext.request.contextPath}/js/liveFleetMap.js"  type="text/javascript"></script>
		<script type="text/javascript">
			function bodyUnload(){
			
				GUnload();
			}
		</script>
		<rich:panel id="scripts">
		<script type="text/javascript">
			function addMarkers(){
				<ui:repeat value="#{driverLocationBean.driverLastLocationBeans}" var="driverLastLocationBean">
					var latlng = new GLatLng(#{driverLastLocationBean.lastLocation.lat}, #{driverLastLocationBean.lastLocation.lng});
					mgr.addMarker(createMarker(latlng, "#{driverLastLocationBean.driver.driverID}",
						        		 "#{driverLocationBean.mapIconMap.icons[driverLastLocationBean.groupID]}"),0);
	        						
				</ui:repeat>
			}
		</script>
		</rich:panel>
		<div class="">
				<div class="panel_nw">
					<div class="panel_title">
						<span class="map">Fleet Map</span>
						<span class="panel_links">
						<a4j:form id="refresh">
						<a4j:commandButton image="/images/ico_refresh.png" immediate="true"
							reRender="map,scripts"
							value="#{messages.refresh}">
						</a4j:commandButton>
			   			<h:commandLink action="#{flyOutBean.flyNavRuleAction}">
			   				<img src="#{facesContext.externalContext.request.contextPath}/images/#{flyOutImage}" border="0" />
			   				<f:setPropertyActionListener value="#{flyNavRule}" target="#{flyOutBean.navigationRule}" />
			   				<f:setPropertyActionListener value="#{flySelectedTab}" target="#{flyOutBean.selectedTab}" />
			   				<f:setPropertyActionListener value="#{numRowsPerPg}" target="#{navigationBean.numRowsPerPg}"/>
			   			</h:commandLink>
						</a4j:form>
						</span>
					</div>
				</div>
				<div class="panel_w">
					
				 	 <rich:panel  id="map">
										<h:form id="mapLinks">
								<ui:repeat value="#{driverLocationBean.driverLastLocationBeans}" var="driverLastLocationBean">
									<div id="#{driverLastLocationBean.driver.driverID}" style="display:none">
										<h:commandLink value="#{driverLastLocationBean.driverName}" action="#{driverLocationBean.driverAction}">
												<f:param name="driverId" value="#{driverLastLocationBean.driver.driverID}"/>
											</h:commandLink>
	
									</div>
							  	</ui:repeat>
										</h:form>
							  	
					<div class="panel_content">
							<h:form name="maplinks2"> <div id="map-canvas" style="#{mapwidth};#{mapheight};border:0"></div></h:form>
					    <script type="text/javascript">
					    	initMap(#{mapxcenter}, #{mapycenter}, 5);
					    	addMarkers();
					    	
   						</script> 
 					 </div>
 					 </rich:panel>
 				</div>		
																					
				<div class="panel_sw">
					<div class="panel_statusbar"></div>
				</div>
			</div>	
				
				<rich:panel rendered="#{driverLocationBean.showLegend}">	
				<div class="spacer"></div>		
				<div class="">
					<div class="panel_nw">
						<div class="panel_title">
							<span class="legend">Fleet Legend</span>
							<span class="panel_links"></span>
						</div>
					</div>	
	 				<div class="panel_w">
						<div class="panel_content">
						  
						  <rich:dataList value="#{driverLocationBean.childGroups}" var="group" styleClass="legend">
 						  	<img src="#{driverLocationBean.legendIconMap.icons[group.groupID]}" style="vertical-align:middle"></img> 
						  	<h:outputText value="#{group.name}" style="margin-left:5px"></h:outputText>
						  </rich:dataList>
						  <div style="clear:both"/>
	  					</div>
					</div>
	
					<div class="panel_sw">
						<div class="panel_statusbar"></div>
					</div>
					</div>
				</rich:panel>
								
	    <script type="text/javascript">
	    	initMap(#{mapxcenter}, #{mapycenter}, 5);
	    	addMarkers();
	    	
		</script> 
			
</ui:composition>	
