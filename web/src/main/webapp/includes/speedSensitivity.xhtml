<html xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:rich="http://richfaces.org/rich"
                xmlns:a4j="http://richfaces.org/a4j"
                xmlns:c="http://java.sun.com/jstl/core"
                xmlns:fn="http://java.sun.com/jsp/jstl/functions"
                xmlns:tiwiprofn="http://pro.tiwi.com/jsffunctions">

<!-- 
  Required Parameters:
  ======================
          device: The device to show the settings for.

  Optional Parameters:
  ======================
          disabled: Whether the number sliders are disabled for input or not.
         batchEdit: Whether the device is being batch-edited.
       updateField: A map of field name to boolean values for which fields to update; required if batchEdit
                    is true.

  To use:
  ==============
  <ui:include src="/includes/speedSensitivity.xhtml">
    <ui:param name="device" value="#{myBean.device}" />
    <ui:param name="disabled" value="true" />
  </ui:include>

 -->
  <ui:composition>

    <c:if test="empty device">
      <c:set var="disabled" value="true" />
    </c:if>
	    <div class="msg">
			<p id="info">
				<h:outputText  id="editMessage1" value="#{messages.editDevice_speedSensitivityInfo}"/>
			</p>
		</div>
                      <table width="790" border="0" cellspacing="0" cellpadding="0">
                        <tr>
                          <td width="390" valign="top">

                            <div class="add_section_title"><h:outputText value="#{messages.editDevice_speedNotification}" /></div>
                            <div class="spacer"></div>

                            <table width="100%" border="0" cellpadding="2" cellspacing="0">
                              <tr class="datagrid">
                                <th><h:outputText value="#{messages.editDevice_speedHeader}" /></th>
                                <th colspan="2"><h:outputText value="#{messages.editDevice_speedSettingHeader}" /></th>
                              </tr>
                              <c:forEach begin="0" var="index" end="14">
                                <c:set var="id" value="speed#{index}" />
                                <c:set var="minimum" value="#{(index lt 4) ? ((-index * 5) - 5) : -25}" />
                                <tr class="#{((index % 2) == 0) ? 'tableOdd' : 'tableEven'}">
                                  <td style="padding: 6px 12px 6px 12px; border-bottom: 1px solid #8BAD37;">
                                    <h:selectBooleanCheckbox rendered="#{batchEdit}" id="update_#{id}" value="#{updateField[id]}" />
                                    <h:outputText value="#{(index * 5) + 5}" converter="MphToKphConverter"/>
                                  </td>
                                  <td style="padding: 6px 0px 6px 12px; border-bottom: 1px solid #8BAD37;">
                                    <rich:inputNumberSlider disabled="#{disabled}" onfocus="this.select();" 
                                          id="#{id}" value="#{device.speedSettings[index]}" width="250"
                                          converter="MphToKphConverter"
                                          showToolTip="false" showBoundaryValues="false" 
                                          minValue="${tiwiprofn:fromMphToKph(minimum)}" maxValue="${tiwiprofn:fromMphToKph(25)}" step="1" 
                                          onchange="if (checkMultiple) checkMultiple(this.mainTable.id)" />
                                  </td>
                                  <td style="padding: 6px 12px 6px 2px; border-bottom: 1px solid #8BAD37;">
                                    <h:outputText value="editRedFlag_mph" converter="MeasurementTextConverter" />
                                  </td>
                                </tr>
                              </c:forEach>
                              <ui:fragment rendered="#{not disabled}">
                                <tr class="tableEven">
                                  <td colspan="3" align="right" style="border-bottom: 1px solid #8BAD37">
                                    <h:outputText value="#{messages.editDevice_speedAdjustAll}" />
                                    <a href="#" onclick="bumpSpeeds(true); return false;"><h:graphicImage value="/images/btn_plus.png" style="border: 0px; vertical-align: middle;" /></a>
                                    <a href="#" onclick="bumpSpeeds(false); return false;"><h:graphicImage value="/images/btn_minus.png" style="border: 0px; vertical-align: middle;" /></a>
                                  </td>
                                </tr>
                              </ui:fragment>
                            </table>
                            <script type="text/javascript">
                              function bumpSpeeds(up)
                              {
                                for (var i = 0; i &lt; 15; i++)
                                {
                                  var input = document.getElementById("edit-form:speed" + i).component;
                                  if (up)
                                    input.setValue(Number(input.input.value) + 1);
                                  else
                                    input.setValue(Number(input.input.value) - 1);
                                }
                              }
                            </script>

                            <div class="spacer"></div>

                          </td>
                          <td width="10"><h:graphicImage value="/images/x.gif" width="10" /></td>
                          <td width="390" valign="top">

                            <script type="text/javascript">
                              var sensitivities = new Array();
                              <c:forEach begin="1" var="sensitivity" end="5">
                                <c:set var="sLevel" value="editDevice_sensitivity#{sensitivity}" />
                                sensitivities[#{sensitivity}] = '<h:outputText value="#{messages[sLevel]}" />';
                              </c:forEach>

                              function getCurrentValueLabel(currentValue , defaultValue)
                              {
                                  if(currentValue > defaultValue)
                                  {
                                      var positive = currentValue - defaultValue;
                                      return "#{messages.editDevice_more} (+" + positive + ")";
                                  }
                                  if(currentValue == defaultValue)
                                  {
                                     return "#{messages.editDevice_average}";
                                  }

                                  var negative = defaultValue - currentValue;
                                  return "#{messages.editDevice_less} (-" + negative + ")";
                                 
                              }
                            </script>

                            <div class="add_section_title"><h:outputText value="#{messages.editDevice_sensitivityTitle}" /></div>
                            <div class="spacer"></div>

                            <table width="100%" border="0" cellpadding="0" cellspacing="0">
                              <tr class="datagrid">
                                <th><h:outputText value="#{messages.editDevice_sensitivityHeader}" /></th>
                                <th colspan="3"><h:outputText value="#{messages.editDevice_sensitivitySettingHeader}"  /></th>
                              </tr>
                              
                              <a4j:repeat value="#{devicesBean.sensitivityTypes}" var="sensitivityType" rowKeyVar="index">
                                 <c:set var="sensitivityItem" value="#{(sensitivityType == 'HARD_ACCEL_SETTING') ? 'hardAcceleration' : ((sensitivityType == 'HARD_BRAKE_SETTING') ? 'hardBrake' : ((sensitivityType == 'HARD_TURN_SETTING') ? 'hardTurn' : 'hardVertical'))}" />
                                 <tr class="#{((index % 2) == 0) ? 'tableOdd' : 'tableEven'}">
                                     <td></td>
                                     <td style="padding: 6px 12px 0px 12px" colspan="2" align="right">
                                       <h:outputText value="#{messages.editDevice_currentSensitivity}" />
                                       <span id="#{sensitivityItem}Level" style="font-weight:bold">
                                       </span>
                                       <script type="text/javascript">
                                           document.getElementById("#{sensitivityItem}Level").innerHTML = getCurrentValueLabel(#{device[sensitivityItem]},#{sensitivityType.defaultSetting});
                                       </script>
                                     </td>
                                     <td></td>
                                 </tr>
                                 <tr class="#{((index % 2) == 0) ? 'tableOdd' : 'tableEven'}">
                                     <td style="padding: 0px 12px 6px 12px; border-bottom: 1px solid #8BAD37;">
                                       <h:selectBooleanCheckbox rendered="#{batchEdit}" id="update_#{sensitivityItem}" value="#{updateField[sensitivityItem]}" />
                                       <h:outputText value="#{messages[sensitivityType]}" />
                                     </td>
                                     <td style="padding: 0px 0px 6px 12px; border-bottom: 1px solid #8BAD37;">
                                          <h:outputText value="#{messages.editDevice_sensitivity1}" />
                                     </td>
                                     <td style="padding: 0px 12px 6px 12px; border-bottom: 1px solid #8BAD37;">
                                       <rich:inputNumberSlider id="#{sensitivityItem}" 
                                             disabled="#{disabled}" 
                                             value="#{device[sensitivityItem]}" 
                                             showToolTip="false" showBoundaryValues="false" 
                                             handleSelectedClass="handleSelected"
                                             showInput="false" minValue="1" maxValue="#{sensitivityType.settingsCount}" 
                                             barStyle="padding:0;height:10px;background-color:black;background-image:url('#{facesContext.externalContext.requestContextPath}/images/slider_bar_#{sensitivityType.settingsCount}.png')"
                                             onslide="if (checkMultiple) checkMultiple(this.mainTable.id); document.getElementById('#{sensitivityItem}Level').innerHTML = getCurrentValueLabel(this.value,#{sensitivityType.defaultSetting})"
                                             onchange="if (checkMultiple) checkMultiple(this.mainTable.id); document.getElementById('#{sensitivityItem}Level').innerHTML = getCurrentValueLabel(this.value,#{sensitivityType.defaultSetting})" />
                                    </td>
                                    <td style="padding: 0px 12px 6px 0px; border-bottom: 1px solid #8BAD37;">
                                          <h:outputText value="#{messages.editDevice_sensitivity5}" />
                                    </td>
                                 </tr>
                              </a4j:repeat>
                              
                             
                            </table>

                          </td>
                        </tr>
                      </table>

  </ui:composition>
</html>