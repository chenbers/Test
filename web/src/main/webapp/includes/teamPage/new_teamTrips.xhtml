<ui:composition 
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:rich="http://richfaces.org/rich"
	xmlns:a4j="http://richfaces.org/a4j"
	xmlns:iwi="http://pro.tiwi.com/jsf"
	xmlns:c="http://java.sun.com/jstl/core"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:t="http://myfaces.apache.org/tomahawk">
	
	<style>
	.clear: after {
	  content: ". ";
	  display: block;
	  height: 0;
	  font-size: 0;
	  clear: both;
	  visibility: hidden;
	}
	.clear {
	  zoom: 1;
	}			
	
	.trips_markerLabel  {
	  color: black;
	  text-align: center;
	  font-size:12px
	}
	
	</style>
	
	<a4j:loadScript src="#{googleMapURLBean.mapUrl}&amp;hl=#{localeBean.locale.language}" />
	<a4j:loadScript src="/js/arrowedPolyline.js"/>
	<a4j:loadScript src="/js/labeledMarker.js"/>
	<a4j:loadScript src="/js/teamTrips.js"/>
	<a4j:loadScript src="/js/markerClustererWithStackedMarkers.js"/>
	
	
	<script type="text/javascript">
	//<![CDATA[
	
	var icons = [	"#{facesContext.externalContext.request.contextPath}/images/green_circle.png",
					"#{facesContext.externalContext.request.contextPath}/images/yellow_circle.png", 
					"#{facesContext.externalContext.request.contextPath}/images/red_circle.png", 
					"#{facesContext.externalContext.request.contextPath}/images/ico_violation.png", 
					"#{facesContext.externalContext.request.contextPath}/images/teamIdle2.png",
					"#{facesContext.externalContext.request.contextPath}/images/ico_tampering.png",
					"#{facesContext.externalContext.request.contextPath}/images/x.gif"
				];
	 
	function initMap() {
		
		if (GBrowserIsCompatible()) {					
			GUnload();
			map = new GMap2(document.getElementById("map-canvas"));						
			map.addControl(new GLargeMapControl());
			map.addControl(new GMapTypeControl());
			map.addControl(new GOverviewMapControl()); 
			map.setMapType(G_NORMAL_MAP);
			map.setCenter(new GLatLng(#{teamCommonBean.group.mapLat},#{teamCommonBean.group.mapLng}), #{teamCommonBean.group.mapZoom});
			tripIcons = icons;
		}
	}
	var dayClickFunction = function(event){
	   	resetTripsForSelectedDrivers();
	};
	var longDurationClickFunction = function(event){
			event.preventDefault();
		};
		
	function onTabSelectionComplete(){
		
		initMap();
		getLatestTrips();
		
  	   	jQuery("[id$='Day']").bind('click',dayClickFunction);
  	   	jQuery("[id$='teamDurationPanelHeaderDays']").bind('click',dayClickFunction);
		jQuery('#longDurations').children().addClass('disable');
		jQuery('#longDurations').children().click(longDurationClickFunction);
	}
	function onTabLeave(){
		GUnload();
 	   	jQuery("[id$='Day']").unbind('click',dayClickFunction);
 	   	jQuery("[id$='teamDurationPanelHeaderDays']").unbind('click',dayClickFunction);
		jQuery('#longDurations').children().removeClass('disable');
		jQuery('#longDurations').children().unbind('click',longDurationClickFunction);
	}
//]]>
 </script>
 	<t:saveState  value="#{teamTripsBean}"/>
 
   <rich:tab id="teamTrips" ontableave="onTabLeave();"  oncomplete="onTabSelectionComplete()" >
	 
	<a4j:queue name="tripsQueue"/>     
	 <f:facet name="label">
	 	<h:panelGroup>
	 		<h:graphicImage value="/images/ico_map.png" /><rich:spacer width="10"/>Trips
	 	</h:panelGroup>
	 </f:facet>
	
	
	
   	<!-- Trips Map -->
   	<div class="section">
	       
	         <div id="driverTable" 	style="float:left; width:25%;height: 500px; border: 0;">
	        	<h:form id="tripsTableForm">
	        	<a4j:region id="teamTripsRegion">
	         	<rich:dataTable	value="#{teamTripsBean.drivers}" 
					       		id="driversTrips" 
					       		var="driver"
					       		rowKeyVar="index"
								styleClass="datagrid" 
								rowClasses="tableOdd,tableEven"
								rows="15"
								columnsWidth="50px,85%,50px"
								width="100%">
				<rich:column>
				<f:facet name="header">
				     <h:outputText value="#{messages.teamPage_hideShow}"/>
                </f:facet>
                <h:selectBooleanCheckbox id="select" value="#{driver.selected}">
                  <a4j:support event="onclick" eventsQueue="tripsQueue" data="#{driver}" 
                  				oncomplete="processDriverTrips(#{index},data)" >
                   </a4j:support>
                  				
                </h:selectBooleanCheckbox>
              </rich:column>
												
				<rich:column>
					<f:facet name="header">
						<h:outputText value="#{messages.teamPage_driverHeader}"/>
					</f:facet>
					<h:outputText value="#{driver.fullName}"/>
				</rich:column>
				<rich:column>
				<f:facet name="header">
				  <a4j:status layout="block">
                	<f:facet name="start">
                    	<h:graphicImage  value="/images/progress2.gif"/>
                	</f:facet>
            	</a4j:status>
				
				</f:facet>
				   <img src="#{teamTripsBean.icons[index].url}" alt="#{index}"/>
				</rich:column>
				</rich:dataTable>
				<rich:datascroller 	align="left" for="driversTrips" action="#{teamTripsBean.reset}" oncomplete="resetTrips();" 
            		 				styleClass="dataScrollerSmall" renderIfSinglePage="false" id="driverTableScroller" width="98%"
            		 				eventsQueue="tripsQueue"/>
            		 
				 </a4j:region>
 				</h:form>	
 				         
	         </div>  
	            
			 <div id="map-canvas" style="float:right; width: 74%; height: 500px; border: 0"></div>
			 <div style="clear:both"></div>
	       </div>
    <!-- End Trips Map -->
    <h:form>
    	<a4j:jsFunction name="getLatestTrips" action="#{teamTripsBean.reloadTrips}" data="#{teamTripsBean.selectedDriversTrips}" 
    						eventsQueue="tripsQueue" oncomplete="redisplayAllTrips(data)"/>
    </h:form>
    </rich:tab>
 </ui:composition>