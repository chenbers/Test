<ui:composition 
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:rich="http://richfaces.org/rich"
	xmlns:a4j="http://richfaces.org/a4j"
	xmlns:iwi="http://pro.tiwi.com/jsf"
	xmlns:c="http://java.sun.com/jstl/core"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:pretty="http://ocpsoft.com/prettyfaces"
	xmlns:t="http://myfaces.apache.org/tomahawk">
	

	<rich:tab id="statisticsTab" >
	 <f:facet name="label">
	 	<h:panelGroup>
	 		<h:graphicImage value="/images/ico_line.png" /><rich:spacer width="10"/>Driver Statistics
	 	</h:panelGroup>
	 </f:facet>
	
	<!-- Driver Statistics -->
	<div class="section">

	       <div class="datagrid_panel" style="width: 880px;">
	      

	       <!-- Table -->
	       <h:form id="driverForm">	  
	       <rich:dataTable value="#{teamStatisticsBean.driverStatistics}" 
	       		id="drivers" 
	       		var="item"
				styleClass="datagrid" 
				rowClasses="tableOdd,tableEven"
				rows="#{teamStatisticsBean.numRowsPerPg}">				

				<rich:column width="8%">
					<f:facet name="header">
						#{messages.team_driver}
					</f:facet>
					<!-- 
					<f:facet name="footer">
						#{teamStatisticsBean.driverTotals.driver.person.fullName}
					</f:facet>
					-->
                        <pretty:link mappingId="driverPerformance">
							  #{item.driver.person.fullName}
                              <f:param value="#{item.driver.driverID}"/>
                        </pretty:link>
				</rich:column>
				<rich:column width="7%">
					<f:facet name="header">
						#{messages.team_score}
					</f:facet>
					<!--    
					<f:facet name="footer">
						
					</f:facet>
					-->  
                    <ui:include src="/includes/scoreBox.xhtml">
	                    <ui:param name="score" value="#{item.score.overall}" />
	                    <ui:param name="scoreStyle" value="#{item.scoreStyle}" /> 
	                    <ui:param name="item" value="#{item.driver.driverID}" /> 
	                    <ui:param name="scoreMappingId" value="driverPerformance"/>
						<ui:param name="context" value="driversOverallAvailable" />
                    </ui:include> 
				</rich:column>			
				<rich:column width="8%">
					<f:facet name="header">
						#{messages.team_vehicle}
					</f:facet>
					<!-- 
					<f:facet name="footer">
					
					</f:facet>
					-->
                    <pretty:link id="driversVehiclePerformance" mappingId="vehiclePerformance" rendered="#{item.vehicle ne null}">
                    	<h:outputText value="#{item.vehicle.name}"/>
                        <f:param value="#{item.vehicle.vehicleID}"/>
                    </pretty:link>					
					<h:outputText id="noDriversVehiclePerformance" value="#{item.vehicle.name}" rendered="#{item.vehicle eq null}"></h:outputText>
				</rich:column>
				<rich:column width="7%">
					<f:facet name="header">
						#{messages.team_trips}
					</f:facet>
					<!-- 
					<f:facet name="footer">
						#{teamStatisticsBean.driverTotals.score.trips}
					</f:facet>
					-->
					#{item.score.trips}
				</rich:column>
				<rich:column width="7%">
					<f:facet name="header">
						#{messages.team_stops}
					</f:facet>
					<!-- 
					<f:facet name="footer">
						#{teamStatisticsBean.driverTotals.score.idleHiEvents + teamStatisticsBean.driverTotals.score.idleLoEvents + teamStatisticsBean.driverTotals.score.trips}
					</f:facet>
					-->
					#{item.score.idleHiEvents + item.score.idleLoEvents + item.score.trips}
				</rich:column>
				<rich:column width="7%">
					<f:facet name="header">
						#{messages.team_miles_driven}
					</f:facet>
					<!-- 
					<f:facet name="footer">
						<h:outputFormat value="#{messages.reports_distanceDrivenInUnits}" >
                    		<a4j:actionparam value="#{(teamStatisticsBean.driverTotals.score.endingOdometer - teamStatisticsBean.driverTotals.score.startingOdometer)/100}" converter="MilesToKilometersConverter"/>
                    		<a4j:actionparam value="mi" converter="MeasurementTextConverter"/>
                    	</h:outputFormat>
					</f:facet>
					-->
                    <h:outputFormat value="#{messages.reports_distanceDrivenInUnits}" >
                    	<a4j:actionparam value="#{(item.score.endingOdometer - item.score.startingOdometer)/100}" converter="MilesToKilometersConverter"/>
                    	<a4j:actionparam value="mi" converter="MeasurementTextConverter"/>
                    </h:outputFormat>										
				</rich:column>
				<rich:column width="7%">
					<f:facet name="header">
						#{messages.team_drive_time}
					</f:facet>
					<!-- 
					<f:facet name="footer">
						<h:outputFormat value="#{messages.reports_time}" rendered="#{teamStatisticsBean.driverTotals.score.driveTime != null}">
                    		<a4j:actionparam value="#{teamStatisticsBean.driverTotals.score.driveTime}" converter="TimeToStringConverter"/>                    
                    	</h:outputFormat>										
                    	<h:outputText value="00:00:00" rendered="#{teamStatisticsBean.driverTotals.score.driveTime == null}"/>
					</f:facet>
					-->
                    <h:outputFormat value="#{messages.reports_time}" rendered="#{item.score.driveTime != null}">
                    	<a4j:actionparam value="#{item.score.driveTime}" converter="TimeToStringConverter"/>                    
                    </h:outputFormat>										
                    <h:outputText value="00:00:00" rendered="#{item.score.driveTime == null}"/>
				</rich:column>
				<rich:column width="7%">
					<f:facet name="header">
						#{messages.team_idle_time}
					</f:facet>
					<!-- 
					<f:facet name="footer">
						<h:outputFormat value="#{messages.reports_time}" >
                    		<a4j:actionparam value="#{(teamStatisticsBean.driverTotals.score.idleLo + teamStatisticsBean.driverTotals.score.idleHi)}" converter="TimeToStringConverter"/>                    
                    	</h:outputFormat>	
					</f:facet>
					-->
                    <h:outputFormat value="#{messages.reports_time}" >
                    	<a4j:actionparam value="#{(item.score.idleLo + item.score.idleHi)}" converter="TimeToStringConverter"/>                    
                    </h:outputFormat>										
				</rich:column>
				<rich:column width="7%">
					<f:facet name="header">
						#{messages.team_low_idle}
					</f:facet>
					<!-- 
					<f:facet name="footer">
						<h:outputFormat value="#{messages.reports_time}"  rendered="#{teamStatisticsBean.driverTotals.score.idleLo != null}">
                    		<a4j:actionparam value="#{teamStatisticsBean.driverTotals.score.idleLo}" converter="TimeToStringConverter"/>                    
                    	</h:outputFormat>	
                    	<h:outputText value="00:00:00" rendered="#{teamStatisticsBean.driverTotals.score.idleLo == null}"/>				
					</f:facet>
					-->
                    <h:outputFormat value="#{messages.reports_time}"  rendered="#{item.score.idleLo != null}">
                    	<a4j:actionparam value="#{item.score.idleLo}" converter="TimeToStringConverter"/>                    
                    </h:outputFormat>	
                    <h:outputText value="00:00:00" rendered="#{item.score.idleLo == null}"/>					
				</rich:column>
				<rich:column width="7%">
					<f:facet name="header">
						#{messages.team_high_idle}
					</f:facet>
					<!-- 
					<f:facet name="footer">
					    <h:outputFormat value="#{messages.reports_time}" rendered="#{teamStatisticsBean.driverTotals.score.idleHi != null}">
                    		<a4j:actionparam value="#{teamStatisticsBean.riverTotals.score.idleHi}" converter="TimeToStringConverter"/>                    
                    	</h:outputFormat>	
                    	<h:outputText value="00:00:00" rendered="#{teamStatisticsBean.driverTotals.score.idleHi == null}"/>		
					</f:facet>
					-->
                    <h:outputFormat value="#{messages.reports_time}" rendered="#{item.score.idleHi != null}">
                    	<a4j:actionparam value="#{item.score.idleHi}" converter="TimeToStringConverter"/>                    
                    </h:outputFormat>	
                    <h:outputText value="00:00:00" rendered="#{item.score.idleHi == null}"/>								
				</rich:column>
				<rich:column width="7%">
					<f:facet name="header">
						#{messages.team_idle_percentage}
					</f:facet>
					<!-- 
					<f:facet name="footer">
						<h:outputText id="idlePercentageNonZeroFooter" rendered="#{teamStatisticsBean.driverTotals.score.driveTime != 0 and teamStatisticsBean.driverTotals.score.driveTime != null}" value="#{((teamStatisticsBean.driverTotals.score.idleHi+teamStatisticsBean.driverTotals.score.idleLo)*100)/(teamStatisticsBean.driverTotals.score.driveTime)}" converter="DoubleConverter"/>
						<h:outputText id="idlePercentageZeroFooter" rendered="#{teamStatisticsBean.driverTotals.score.driveTime == 0 or teamStatisticsBean.driverTotals.score.driveTime == null}" value="0.00"/>																									
					</f:facet>
					-->
					<h:outputText id="idlePercentageNonZero" rendered="#{item.score.driveTime != 0 and item.score.driveTime != null}" value="#{((item.score.idleHi+item.score.idleLo)*100)/(item.score.driveTime)}" converter="DoubleConverter"/>
					<h:outputText id="idlePercentageZero" rendered="#{item.score.driveTime == 0 or item.score.driveTime == null}" value="0.00"/>																				
				</rich:column>
				<rich:column width="7%">
					<f:facet name="header">
						#{messages.team_mpg}
					</f:facet>
					<!-- 
					<f:facet name="footer">
						<h:outputFormat value="#{messages.reports_time}">
							<a4j:actionparam value="#{(teamStatisticsBean.driverTotals.score.mpgLight + teamStatisticsBean.driverTotals.score.mpgMedium + teamStatisticsBean.driverTotals.score.mpgHeavy)/1}" converter="DoubleConverter"/>
						</h:outputFormat>
					</f:facet>
					-->
					<h:outputFormat value="#{messages.reports_time}">
						<a4j:actionparam value="#{(item.score.mpgLight + item.score.mpgMedium + item.score.mpgHeavy)/1}" converter="DoubleConverter"/>
					</h:outputFormat>
				</rich:column>
				<rich:column width="7%">
					<f:facet name="header">
						#{messages.team_crashes}
					</f:facet>
					<!-- 
					<f:facet name="footer">
						#{teamStatisticsBean.driverTotals.score.crashTotal}
					</f:facet>
					-->				
					#{item.score.crashEvents}
				</rich:column>
				<rich:column width="7%">
					<f:facet name="header">
						#{messages.team_flags}
					</f:facet>
					<!-- 
					<f:facet name="footer">
						#{teamStatisticsBean.driverTotals.score.seatbeltEvents + teamStatisticsBean.driverTotals.score.speedEvents + teamStatisticsBean.driverTotals.score.aggressiveAccelEvents + teamStatisticsBean.driverTotals.score.aggressiveBrakeEvents + teamStatisticsBean.driverTotals.score.aggressiveBumpEvents + teamStatisticsBean.driverTotals.score.aggressiveLeftEvents + teamStatisticsBean.driverTotals.score.aggressiveRightEvents}						
					</f:facet>
					-->
					#{item.score.seatbeltEvents + item.score.speedEvents + item.score.aggressiveAccelEvents + item.score.aggressiveBrakeEvents + item.score.aggressiveBumpEvents + item.score.aggressiveLeftEvents + item.score.aggressiveRightEvents}
				</rich:column>
			</rich:dataTable>
			
			<br></br>
			<rich:datascroller align="center" for="drivers" id="driverScroller" reRender="drivers" renderIfSinglePage="true" />
			<br></br>
			
	       <!-- Summary -->
	       <rich:dataTable	value="#{teamStatisticsBean.driverTotals}" 
	       		id="driverTotals" 
	       		var="item"
				styleClass="datagrid" 
				rowClasses="tableOdd,tableEven"
				rows="10">				

				<rich:column width="8%">
					<f:facet name="header">
						#{messages.team_team}	
					</f:facet>
					#{item.driver.person.fullName}
				</rich:column>
				<rich:column width="7%">
					<f:facet name="header">
						#{messages.team_score}	
					</f:facet>					 
					<ui:include src="/includes/scoreBox.xhtml">
	                    <ui:param name="score" value="#{item.score.overall}" />
	                    <ui:param name="scoreStyle" value="#{item.scoreStyle}" /> 
	                    <ui:param name="item" value="#{item.driver.driverID}" /> 	                   
						<ui:param name="context" value="driversOverallNotAvailable" />
                    </ui:include> 
				</rich:column>
				<rich:column width="8%">  
					<h:outputText value=""/>
				</rich:column>
				<rich:column width="7%">
					<f:facet name="header">
						#{messages.team_trips}
					</f:facet>
					#{item.score.trips}
				</rich:column>
				<rich:column width="7%">
					<f:facet name="header">
						#{messages.team_stops}
					</f:facet>
					#{item.score.idleHiEvents + item.score.idleLoEvents + item.score.trips}
				</rich:column>
				<rich:column width="7%">
					<f:facet name="header">
						#{messages.team_miles_driven}
					</f:facet>
                    <h:outputFormat value="#{messages.reports_distanceDrivenInUnits}" >
                    	<a4j:actionparam value="#{(item.score.endingOdometer - item.score.startingOdometer)/100}" converter="MilesToKilometersConverter"/>
                    	<a4j:actionparam value="mi" converter="MeasurementTextConverter"/>
                    </h:outputFormat>										
				</rich:column>
				<rich:column width="7%">
					<f:facet name="header">
						#{messages.team_drive_time}
					</f:facet>
                    <h:outputFormat value="#{messages.reports_time}" >
                    	<a4j:actionparam value="#{item.score.driveTime}" converter="TimeToStringConverter"/>                    
                    </h:outputFormat>										
				</rich:column>
				<rich:column width="7%">
					<f:facet name="header">
						#{messages.team_idle_time}
					</f:facet>
                    <h:outputFormat value="#{messages.reports_time}" >
                    	<a4j:actionparam value="#{(item.score.idleLo + item.score.idleHi)}" converter="TimeToStringConverter"/>                    
                    </h:outputFormat>										
				</rich:column>
				<rich:column width="7%">
					<f:facet name="header">
						#{messages.team_low_idle}
					</f:facet>
                    <h:outputFormat value="#{messages.reports_time}" >
                    	<a4j:actionparam value="#{item.score.idleLo}" converter="TimeToStringConverter"/>                    
                    </h:outputFormat>					
				</rich:column>
				<rich:column width="7%">
					<f:facet name="header">
						#{messages.team_high_idle}
					</f:facet>
                    <h:outputFormat value="#{messages.reports_time}" >
                    	<a4j:actionparam value="#{item.score.idleHi}" converter="TimeToStringConverter"/>                    
                    </h:outputFormat>										
				</rich:column>
				<rich:column width="7%">
					<f:facet name="header">
						#{messages.team_idle_percentage}
					</f:facet>
					<h:outputText id="idlePercentageNonZero" rendered="#{item.score.driveTime != 0 and item.score.driveTime != null}" value="#{(item.score.idleHi+item.score.idleLo)*100/item.score.driveTime}" converter="DoubleConverter"/>
					<h:outputText id="idlePercentageZero" rendered="#{item.score.driveTime == 0 or item.score.driveTime == null}" value="0.00"/>																				
				</rich:column>
				<rich:column width="7%">
					<f:facet name="header">
						#{messages.team_mpg}
					</f:facet>
					#{item.score.mpgLight + item.score.mpgMedium + item.score.mpgHeavy}                  					
				</rich:column>
				<rich:column width="7%">
					<f:facet name="header">
						#{messages.team_crashes}
					</f:facet>
					#{item.score.crashTotal}
				</rich:column>
				<rich:column width="7%">
					<f:facet name="header">
						#{messages.team_flags}
					</f:facet>
					#{item.score.seatbeltEvents + item.score.speedEvents + item.score.aggressiveAccelEvents + item.score.aggressiveBrakeEvents + item.score.aggressiveBumpEvents + item.score.aggressiveLeftEvents + item.score.aggressiveRightEvents}
				</rich:column>

			</rich:dataTable>	
			
			
			</h:form>

				
			</div>
   	</div>
    <!-- End Driver Statistics Table -->
    </rich:tab>

</ui:composition>