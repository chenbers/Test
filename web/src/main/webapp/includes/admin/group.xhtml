<ui:composition
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:rich="http://richfaces.org/rich"
	xmlns:a4j="http://richfaces.org/a4j"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:c="http://java.sun.com/jstl/core"
	xmlns:security="http://pro.tiwi.com/jsf/security">
	<!-- 
	The GROUP PANEL, DRIVER PANEL, AND VEHICLE PANEL are all here at the same level. When an action is fired we only want to reRender
	each panel individually. If we reRender a higher level panel, the the map gets reloaded and the page is much slower. To speed up
	performance, we have the map at this level as well
	
	
	
	 -->
	<h:panelGroup id="groupPanel">
		<h:outputText rendered="#{organizationBean.selectedGroupNode ne null and organizationBean.selectedGroupNode.group ne null}">	
			<h:outputText rendered="#{organizationBean.groupState eq 'VIEW'}">
				<ui:include src="/includes/admin/groupView.xhtml">
					<ui:param name="groupTreeNode"
						value="#{organizationBean.selectedGroupNode}" />
				</ui:include>
			</h:outputText>

			<h:outputText rendered="#{organizationBean.groupState ne 'VIEW'}">
				<ui:include src="/includes/admin/groupEdit.xhtml">
					<ui:param name="groupTreeNode"
						value="#{organizationBean.inProgressGroupNode}" />
				</ui:include>

			</h:outputText>
		</h:outputText>
	</h:panelGroup>
	
	<h:panelGroup id="driverPanel">
		<h:outputText rendered="#{organizationBean.selectedGroupNode.treeNodeType eq 'DRIVER'}">	
			<ui:include src="/includes/admin/driverSubview.xhtml">
				<ui:param name="driver" value="#{organizationBean.selectedGroupNode.driver}"/>
			</ui:include>
		</h:outputText>
	</h:panelGroup>
	
	<h:panelGroup id="vehiclePanel">
		<h:outputText rendered="#{organizationBean.selectedGroupNode.treeNodeType eq 'VEHICLE'}">	
			<ui:include src="/includes/admin/driverSubview.xhtml">
				<ui:param name="vehicle" value="#{organizationBean.selectedGroupNode.vehicle}"/>
			</ui:include>
		</h:outputText>
	</h:panelGroup>

	<div class="add_section_title">#{messages.group_default_view}</div>
	<div style="width: 100%; height: 510px">
	<table style="width: 100%" cellpadding="4" border="0" align="center">
		<tbody>
			<tr>
				<td style="font-weight: bold" width="100"></td>
			</tr>
			<tr>
				<td><h:panelGroup styleClass="map-border" layout="block">
					<div id="map-canvas" style="width: 500px; height: 500px; border: 0"></div>
				</h:panelGroup> 
				<script type="text/javascript">	

					var gControl = new GLargeMapControl()
											    
   					if (GBrowserIsCompatible()) {
   					
   						GUnload();
   					
   	   					
   						map = new GMap2(document.getElementById("map-canvas"));
   						
   						map.addControl(new GMapTypeControl());
						map.setMapType(G_NORMAL_MAP);
						map.setCenter(new GLatLng(#{organizationBean.selectedGroupNode.group.mapCenter.lat},#{organizationBean.selectedGroupNode.group.mapCenter.lng}),#{organizationBean.selectedGroupNode.group.mapZoom});
						<h:outputText rendered="#{organizationBean.groupState eq 'VIEW'}">
							map.disableDragging();
							map.disableScrollWheelZoom();
							map.disableDoubleClickZoom();
						</h:outputText>
						<h:outputText rendered="#{organizationBean.groupState ne 'VIEW'}">
							map.enableGoogleBar();
							map.addControl(new GLargeMapControl());
						</h:outputText>
    				}
	    		</script> 
	    		</td>
			</tr>
			<tr>
				<td></td>
			</tr>
		</tbody>

	</table>

	</div>
	<h:outputText rendered="#{organizationBean.groupState eq 'EDIT'}">
	<div style="padding-top:25px">
	<ul id="grid_nav_dark">
		<li class="r"><h:panelGroup id="buttonPanelFooter">
			<a4j:commandButton rendered="#{organizationBean.groupState eq 'ADD'}"
				onclick="saveGroupNode()" styleClass="left"><span class="add"><h:outputText
					value="#{messages.button_create_unit}" /></span></a4j:commandButton>
			<h:commandButton rendered="#{organizationBean.groupState eq 'EDIT'}"
				onclick="updateGroupNode()"styleClass="left"><span class="add"><h:outputText
					value="#{messages.button_save}" /></span></h:commandButton>
			<a4j:commandButton rendered="#{organizationBean.groupState ne 'VIEW'}"
				action="#{organizationBean.changeState}"
				reRender="groupPanel,organizationTreePanel,buttonPanelFooter" styleClass="left">
				<f:param name="state" value="VIEW" />
				<span class="cancel"><h:outputText
					value="#{messages.button_cancel}" /></span></a4j:commandButton>
		</h:panelGroup></li>
	</ul>
	</div>
	</h:outputText>

</ui:composition>