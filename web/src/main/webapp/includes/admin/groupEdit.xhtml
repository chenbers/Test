<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:rich="http://richfaces.org/rich"
	xmlns:a4j="http://richfaces.org/a4j"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:c="http://java.sun.com/jstl/core"
	xmlns:security="http://pro.tiwi.com/jsf/security">


	<h:panelGroup id="buttonPanel">
		<ul id="grid_nav_dark">
			<li class="r">
				<a4j:commandButton rendered="#{organizationBean.groupState ne 'VIEW'}"
					action="#{organizationBean.view}"
					reRender="groupPanel,organizationTreePanel" immediate="true" styleClass="left">
					<span class="cancel"><h:outputText
						value="#{messages.button_cancel}" /></span></a4j:commandButton>
			</li>
			<li class="r">
				<a4j:commandButton rendered="#{organizationBean.groupState eq 'EDIT'}"
					action="#{organizationBean.update}"
					reRender="groupPanel,organizationTreePanel" styleClass="left">
					<f:param name="state" value="VIEW" />
					<span class="save"><h:outputText
						value="#{messages.button_save}" /></span></a4j:commandButton>
			</li>
			<li class="r">
				<a4j:commandButton rendered="#{organizationBean.groupState eq 'ADD'}"
					action="#{organizationBean.save}"
					reRender="groupPanel,organizationTreePanel" styleClass="left">
					<f:param name="state" value="VIEW" />
					<span class="save"><h:outputText
						value="#{messages.button_save}" /></span></a4j:commandButton>
			</li>
				
		</ul>
	</h:panelGroup>
	
	<div style="padding-left: 11px">
	<rich:messages globalOnly="true" errorClass="error" fatalClass="error" warnClass="warning" infoClass="info" styleClass="msg" />
	<table>
		<tr>
			<td width="100%" valign="top">
		
			<div class="add_section_title"><h:outputFormat
				value="#{organizationBean.groupState eq 'ADD'? messages.group_add_title : messages.group_edit_title}">
				<f:param
					value="#{organizationBean.groupState eq 'ADD'? organizationBean.selectedGroupNode.group.name : groupTreeNode.group.name}" />
			</h:outputFormat></div>
			
			<table width="520px" cellspacing="2" cellpadding="4" border="0"
				align="center">
				<ui:fragment rendered="#{groupTreeNode.group.type ne 'FLEET'}">
					<tr>
						<td width="100">#{messages.group_parent_group}:
						<span class="required">*</span></td>
						<td>
				
							<rich:message for="parent_group"
									errorClass="field-error" fatalClass="field-error"
									warnClass="field-warning" infoClass="field-info"
									styleClass="field-msg" />
							<h:selectOneMenu
									value="#{organizationBean.selectedParentGroup}"
									id="parent_group" converter="SimpleBeanConverter"
									required="true" requiredMessage="#{messages.required}"
									tabindex="1">
									<f:selectItems value="#{organizationBean.parentGroups}" />
							</h:selectOneMenu>
						</td>
					</tr>
					<tr>
						<td width="100">#{messages.group_group_type}:
						<span class="required">*</span></td>
						<td>
						<rich:message for="group_type" errorClass="field-error"
									fatalClass="field-error" warnClass="field-warning"
									infoClass="field-info" styleClass="field-msg" /><h:selectOneMenu value="#{groupTreeNode.group.type}"
									id="group_type" converter="SimpleBeanConverter" required="true"
									requiredMessage="#{messages.required}" tabindex="2">
									<f:selectItems value="#{organizationBean.groupTypeList}" />
								</h:selectOneMenu>
						</td>
					</tr>
					
				</ui:fragment>
				<tr>
					<td width="100">#{messages.group_name}:
					<span class="required">*</span></td>
					<td>
						<rich:message for="group_name" errorClass="field-error" fatalClass="field-error" warnClass="field-warning" infoClass="field-info" styleClass="field-msg" />
						<h:inputText value="#{groupTreeNode.group.name}" id="group_name" tabindex="3"   styleClass="text" size="30" maxlength="30" required="true" requiredMessage="#{messages.required}" /> 
					</td>
				</tr>
				<tr>
					<td width="100">#{messages.group_description}:</td>
					<td><h:inputTextarea value="#{groupTreeNode.group.description}" style="width:100%" tabindex="4"/></td>
				</tr>
				<tr>
					<td width="100">#{messages.group_manager}:</td>
					<td>
						<rich:message for="group_manager" errorClass="field-error" fatalClass="field-error" warnClass="field-warning" infoClass="field-info" styleClass="field-msg" />
						<h:selectOneMenu id="group_manager" tabindex="5"
								value="#{groupTreeNode.group.managerID}"
								requiredMessage="#{messages.required}">
								<f:selectItems value="#{organizationBean.peopleSelectItems}" />
						</h:selectOneMenu>
					</td>
				</tr>

			</table>
			
			<div class="required-key"><h:outputText value="#{messages.requiredKey}" /></div>
			</td>
		</tr>
	</table>
	</div>

	<div style="padding: 15px">
	<ui:include src="/includes/admin/groupMapView.xhtml">
		<ui:param name="latValue" value="#{groupTreeNode.group.mapLat}" />
		<ui:param name="longValue" value="#{groupTreeNode.group.mapLng}" />
		<ui:param name="zoomLevel" value="#{groupTreeNode.group.mapZoom}" />
		<ui:param name="readOnly"
			value="#{organizationBean.groupState eq 'VIEW'}" />
		<ui:param name="formName" value="display-form" />
		<ui:param name="uniqueID" value="EDIT"/>
	</ui:include></div>

	<h:outputText rendered="#{organizationBean.groupState eq 'EDIT'}">

		<ul id="grid_nav_dark">
			<li class="r">
				<a4j:commandButton rendered="#{organizationBean.groupState ne 'VIEW'}"
					action="#{organizationBean.view}"
					reRender="groupPanel,organizationTreePanel" immediate="true" styleClass="left">
					<span class="cancel"><h:outputText
						value="#{messages.button_cancel}" /></span></a4j:commandButton>
			</li>
			<li class="r">
				<a4j:commandButton rendered="#{organizationBean.groupState eq 'EDIT'}"
					action="#{organizationBean.update}"
					reRender="groupPanel,organizationTreePanel" styleClass="left">
					<f:param name="state" value="VIEW" />
					<span class="save"><h:outputText
						value="#{messages.button_save}" /></span></a4j:commandButton>
			</li>
			<li class="r">
				<a4j:commandButton rendered="#{organizationBean.groupState eq 'ADD'}"
					action="#{organizationBean.save}"
					reRender="groupPanel,organizationTreePanel" styleClass="left">
					<f:param name="state" value="VIEW" />
					<span class="add"><h:outputText
						value="#{messages.button_create_unit}" /></span></a4j:commandButton>
			</li>
			
			
		</ul>

	</h:outputText>
	<script type="text/javascript">	
		
		function setFocus(id) {
		    var element = document.getElementById(id);
		    if (element) {
		        element.focus();
		    }
		}

		setFocus("#{groupTreeNode.group.type eq 'FLEET'? 'display-form:group_name' : 'display-form:parent_group'}");
									
	</script> 
</ui:composition>