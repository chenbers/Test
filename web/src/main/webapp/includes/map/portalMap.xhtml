<html xmlns="http://www.w3.org/1999/xhtml"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:c="http://java.sun.com/jstl/core"
    xmlns:a4j="http://richfaces.org/a4j"
    xmlns:rich="http://richfaces.org/rich">

<!--
    To use:
  ==============
  include a <div> on the page with the id='map_canvas' where the map should be placed
  <ui:include src="/includes/map/portalMap.xhtml" >
  </ui:include>
  
-->

<ui:composition>
	<a4j:loadScript src="#{googleMapURLBean.mapUrl}&amp;hl=#{localeBean.locale.language}" />
    <a4j:loadStyle src="/css/jsDropdown/dropdownchecklist.css"/>
    <a4j:loadScript src="/js/jsDropdown/jquery-ui-1.8.4.custom.min.js"/>
    <a4j:loadScript src="/js/jsDropdown/ui.dropdownchecklist-1.3-min.js"/>
	<a4j:loadScript src="/js/map/maps.js" />


	<script type="text/javascript">
		function initLayers() {
			portalmap.reinit();
			portalmap.getMap().setMapType(#{customMapsBean.googleMapType});
			i = 0;
			<ui:repeat value="#{customMapsBean.customMaps}" var="customMap">
				portalmap.addWMSLayer("#{customMap.customMapID}", "#{customMap.url}", "#{customMap.name}", "#{customMap.layer}", "#{customMap.minZoom}",  "#{customMap.maxZoom}",  "#{customMap.opacity}", "#{customMap.pngFormat}", "#{customMap.selected ? true : null}");
				i = i + 1;
			</ui:repeat>
			if (i > 0) {
				portalmap.addOverlaysControl();
			}
			
			
			GEvent.addListener(portalmap.getMap(), "maptypechanged", function() {
				name = portalmap.getMap().getCurrentMapType().getName();
				if (name == G_NORMAL_MAP.getName())
					setGoogleMapType('G_NORMAL_MAP'); 				
				else if (name == G_SATELLITE_MAP.getName())
					setGoogleMapType('G_SATELLITE_MAP'); 				
				if (name == G_HYBRID_MAP.getName())
					setGoogleMapType('G_HYBRID_MAP'); 				
    		});
    		
    		
			GEvent.addListener(portalmap.getMap(), "layerselect", function(layerID, checked) {
				setGoogleMapLayerState(layerID, checked);
			});  		
			
			
		}
	</script>
	<a4j:form>
	<a4j:jsFunction name="setGoogleMapType" ajaxSingle="true" > 
     	<a4j:actionparam name="param1" assignTo="#{customMapsBean.googleMapTypeStr}"/> 
   	</a4j:jsFunction> 
	<a4j:jsFunction name="setGoogleMapLayerState" action="#{customMapsBean.saveLayerState}"> 
     	<a4j:actionparam name="param1" assignTo="#{customMapsBean.googleMapLayerID}"/> 
     	<a4j:actionparam name="param2" assignTo="#{customMapsBean.googleMapLayerSelected}"/> 
   	</a4j:jsFunction> 
	</a4j:form>
	
	
</ui:composition>

</html>