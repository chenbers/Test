<ui:composition 
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:a4j="http://richfaces.org/a4j"
	xmlns:rich="http://richfaces.org/rich"
	xmlns:f="http://java.sun.com/jsf/core"
  	xmlns:iwi="http://pro.tiwi.com/jsf"
	xmlns:h="http://java.sun.com/jsf/html">
		
		<div class="datagrid">
				<h:form id="redFlagsTableForm">
	
    	    	<rich:datascroller id="topScroller" for="items" immediate="true"
        			scrollerListener="#{redFlagsBean.scrollerListener}"
        			reRender="bottomScroller,items,header">
        		</rich:datascroller>
        		
				<rich:dataTable value="#{tableData}" id="items"
					var="item" styleClass="datagrid"
					rowClasses="trendTableOdd,trendTableEven" cellspacing="1" 
					rows="#{numRowsPerPg}"
					width="100%">
					
					<!-- Data -->
					<rich:column rendered="#{tableColumns['level'].visible}" 
						sortBy="#{item.level}" width="10%">
						<f:facet name="header">
							<h:outputText value="#{messages.redflags_level}" />
						</f:facet>
						<h:outputLink value="#" styleClass="ls_tab_#{item.redFlag.level}">#{item.redFlag.level.description}</h:outputLink>
    				</rich:column>
    				<rich:column rendered="#{tableColumns['alerts'].visible}" 
    					sortBy="#{item.redFlag.alert}" width="10%">
      					<f:facet name="header">
      						<h:outputText value="#{messages.redflags_alerts}" />
      					</f:facet>
						<h:outputText value="#{(item.redFlag.alert) ? 'yes' : 'no'}" />      
    				</rich:column>
    				<rich:column rendered="#{tableColumns['date'].visible}" 
    					sortBy="#{item.date}"  width="20%">
      					<f:facet name="header">
      						<h:outputText value="#{messages.redflags_date}" />
      					</f:facet>
      					<h:outputText value="#{item.date}"/>
    				</rich:column>
    				<rich:column rendered="#{tableColumns['group'].visible}" 
    					sortBy="#{item.group}"  width="10%">
      					<f:facet name="header">
      						<h:outputText value="#{messages.redflags_group}" />
      					</f:facet>
      					<h:outputText value="#{item.group}"/>
    				</rich:column>
    				<rich:column rendered="#{tableColumns['category'].visible}" 
    					sortBy="#{item.category}"  width="20%">
      					<f:facet name="header">
      						<h:outputText value="#{messages.redflags_category}" />
      					</f:facet>
      					<h:outputText value="#{item.category}" />
    				</rich:column>
    				<rich:column rendered="#{tableColumns['detail'].visible}"
    					sortBy="#{item.detail}"  width="20%">
      					<f:facet name="header">
      						<h:outputText value="#{messages.redflags_detail}" />
      					</f:facet>
      					<h:outputText value="#{item.detail}" />
    				</rich:column>
    				<rich:column rendered="#{tableColumns['clear'].visible}"  width="10%">
      					<f:facet name="header">
      						<h:outputText value="" />
      					</f:facet>
						<a4j:commandLink title="#{messages.redflags_clear}" oncomplete="javascript:Richfaces.showModalPanel('clearRedFlagPanel')" reRender="clearItemForm:clearItem" >
							<h:outputText value="#{messages.redflags_clear}" />
							<f:setPropertyActionListener target="#{redFlagsBean.clearItem}" value="#{item}" />
						</a4j:commandLink>
    				</rich:column>
    			</rich:dataTable>
    			
    			<rich:datascroller id="bottomScroller" for="items" immediate="true"    			
    				scrollerListener="#{redFlagsBean.scrollerListener}"
        			reRender="topScroller,items,header">        			
        		</rich:datascroller>
    			</h:form>

			</div>	
			
    <rich:modalPanel id="clearRedFlagPanel" headerClass="popupHeader" controlsClass="popupControls" width="500" height="350" zindex="2000">
      <f:facet name="header">
        <h:outputText value="#{messages.redflags_clearTitle}" />
      </f:facet>
      <f:facet name="controls">
        <h:graphicImage value="/images/modal_close.png" style="cursor:pointer" onclick="Richfaces.hideModalPanel('clearRedFlagPanel')" />
      </f:facet>

      <h:panelGroup layout="block" styleClass="popupsubtitle">
      	<h:outputText value="#{messages.redflags_clearInst}"/>
      </h:panelGroup>

      <a4j:form id="clearItemForm">
		<h:panelGroup layout="block"  styleClass="popupcontent">
      		<h:outputFormat id="clearItem" value="#{messages.redflags_clearDesc}">
      			<a4j:actionparam value="#{redFlagsBean.clearItem.detail}"/>
      			<a4j:actionparam value="#{redFlagsBean.clearItem.date}"/>
      		</h:outputFormat>
      	</h:panelGroup>
	
        <div class="popupactions">
          <button value="submit" class="left" onclick="Richfaces.hideModalPanel('clearRedFlagPanel'); return false;"><span class="cancel"><h:outputText value="#{messages.button_no}" /></span></button>
          <a4j:commandLink 
          				action="#{redFlagsBean.clearItemAction}"         				
          				oncomplete="Richfaces.hideModalPanel('clearRedFlagPanel')" 
          				reRender="items">
          				<button value="submit" class="left">
          					<span class="apply">
          						<h:outputText value="#{messages.button_yes}" />
          					</span>
          				</button>
			</a4j:commandLink>          			
        </div>

      </a4j:form>

    </rich:modalPanel>

			

</ui:composition>