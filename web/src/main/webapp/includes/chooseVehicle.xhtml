<html xmlns="http://www.w3.org/1999/xhtml"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:c="http://java.sun.com/jstl/core"
    xmlns:a4j="http://richfaces.org/a4j"
    xmlns:rich="http://richfaces.org/rich">

<!--
  A pop-up modal form that allows choosing a vehicle.

  Required Parameters:
  ==============
           reRender:  Id['s] (in format of call UIComponent.findComponent()) of components, rendered in case
                      of AjaxRequest caused by this component. Can be single id, comma-separated list of Id's,
                      or EL Expression with array or Collection.
         editorBean:  A bean that has a List<VehicleView> named vehicles and a method named chooseVehicle(),
                      called when the "choose" link is clicked for a vehicle (the vehicleID will be passed as
                      a request parameter).

  To use:
  ==============
      <ui:include src="/includes/chooseVehicle.xhtml">
        <ui:param name="reRender" value="myStuff" />
        <ui:param name="editorBean" value="#{myBean}" />
      </ui:include>
-->

  <ui:composition>

    <rich:modalPanel id="chooseVehicle" headerClass="popupHeader" controlsClass="popupControls" width="650" height="380" autosized="true" zindex="2001">
      <f:facet name="header">
        <h:outputText value="#{messages.chooseVehicle_title}" />
      </f:facet>
      <f:facet name="controls">
        <h:graphicImage value="/images/modal_close.png" style="cursor:pointer" onclick="Richfaces.hideModalPanel('chooseVehicle')" />
      </f:facet>

      <a4j:form id="chooseVehicleForm">

        <rich:dataTable id="chooseVehicleTable" value="#{editorBean.vehicles}" var="item" rowKeyVar="index" styleClass="datagrid"
          rows="10" rowClasses="tableOdd,tableEven" width="100%">
          <rich:column sortBy="#{item.name}" sortOrder="ASCENDING">
            <f:facet name="header"><h:outputText value="#{messages.vehiclesHeader_name}" /></f:facet>
            <h:outputText value="#{item.name}" />
          </rich:column>
          <rich:column sortBy="#{item.driver.person.fullName}">
            <f:facet name="header"><h:outputText value="#{messages.vehiclesHeader_driverID}" /></f:facet>
            <h:outputText value="#{item.driver.person.fullName}" />
          </rich:column>
          <rich:column sortBy="#{item.group.name}">
            <f:facet name="header"><h:outputText value="#{messages.vehiclesHeader_groupID}" /></f:facet>
            <h:outputText value="#{item.group.name}" />
          </rich:column>
          <rich:column sortBy="#{item.status}">
            <f:facet name="header"><h:outputText value="#{messages.chooseVehicle_vehicleStatus}" /></f:facet>
            <c:set var="status" value="status#{item.status.code}" /><h:outputText value="#{messages[status]}" />
          </rich:column>
          <rich:column sortBy="#{empty item.deviceID}">
            <f:facet name="header"><h:outputText value="#{messages.chooseVehicle_assigned}" /></f:facet>
            <h:outputText value="#{(empty item.deviceID) ? messages.chooseVehicle_unassigned : messages.chooseVehicle_assigned}" />
          </rich:column>
          <rich:column filterExpression="#{(empty editorBean.item.vehicleID) or (item.vehicleID != editorBean.item.vehicleID)}">
            <f:facet name="header">
              <h:outputText value=" " />
            </f:facet>
            <a4j:commandLink action="#{editorBean.chooseVehicle}" onclick="Richfaces.hideModalPanel('chooseVehicle')" reRender="chooseVehicleTable,#{reRender}" value="#{messages.chooseVehicle_choose}">
              <f:param name="vehicleID" value="#{item.vehicleID}" />
              <f:param name="immediate" value="#{immediate}" />
            </a4j:commandLink>
          </rich:column>
        </rich:dataTable>

        <div class="spacer"></div>

        <rich:datascroller id="chooseVehicleScroller" for="chooseVehicleTable" reRender="chooseVehicleTable" renderIfSinglePage="false"/>

      </a4j:form>

    </rich:modalPanel>

  </ui:composition>

</html>