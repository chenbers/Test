<html xmlns="http://www.w3.org/1999/xhtml"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:c="http://java.sun.com/jstl/core"
    xmlns:a4j="http://richfaces.org/a4j"
    xmlns:rich="http://richfaces.org/rich">

<!--
  A table that supports picking columns, sorting, searching, editing, batch editing and batch deleting.

  Required parameters:
  ==============
        recordCount:  The number of displayed items - if a filter is in effect the number of filtered records.
              items:  The items to include in the table, filtered by filterValue.
        filterValue:  A value to filter by, displayed in the search box.
               page:  The scroller page index, starting with 0.
         editorBean:  A child of BaseAdminBean.

Note: The following parameters are required by the included editColumns.xhtml
         allColumns:  A list of column names.
    allColumnsCount:  The number of column names in allColumns.
    selectedColumns:  A Map with String keys and Boolean values for which columns are selected.
     messagesPrefix:  A prefix to prepend to the action to obtain a user-friendly message.

  Optional parameters:
  ==============
               rows:  The number of rows to display at a time; if not provided 10 is used.

  To use:
  ==============
  1. Create an include (we'll call it myTable.xhtml) that defines the columns:
      <ui:composition template="adminTable.xhtml"
        xmlns="http://www.w3.org/1999/xhtml"
        xmlns:ui="http://java.sun.com/jsf/facelets"
        xmlns:h="http://java.sun.com/jsf/html"
        xmlns:f="http://java.sun.com/jsf/core"
        xmlns:rich="http://richfaces.org/rich"
        xmlns:security="http://www.springframework.org/security/tags">

        <ui:define name="columns">
          <rich:column sortBy="#{item.score}">
            <f:facet name="header"><h:outputText value="Score" /></f:facet>
            <ui:include src="scoreBox.xhtml">
              <ui:param name="score" value="#{item.score}" />
              <ui:param name="scoreStyle" value="#{item.scoreStyle}" />
            </ui:include>
          </rich:column>
          <rich:column sortBy="#{item.name}">
            <f:facet name="header"><h:outputText value="Name" /></f:facet>
            <h:outputText value="#{item.name}" />
          </rich:column>
        </ui:define>

      </ui:composition>

  2. Include it:
      <ui:include src="/includes/myTable.xhtml">
        <ui:param name="recordCount" value="#{myBean.myCount}" />
        <ui:param name="items" value="#{myBean.filteredItems}" />
        <ui:param name="filterValue" value="#{myBean.filterValue}" />
        <ui:param name="page" value="#{myBean.page}" />
        <ui:param name="editorBean" value="#{myBean}" />
        <ui:param name="allColumns" value="#{myBean.availableColumns}" />
        <ui:param name="allColumnsCount" value="#{myBean.availableColumnCount}" />
        <ui:param name="selectedColumns" value="#{myBean.columns}" />
        <ui:param name="messagesPrefix" value="myPrefix_" />
      </ui:include>
-->

  <ui:composition>

    <c:if test="#{empty rows}">
      <c:set var="rows" value="10" />
    </c:if>
    <c:set var="firstRecord" value="#{rows * (page - 1)}" />

    <a4j:form id="admin-table-form">

      <div class="panel_w">
        <div class="panel_content">
          <ul id="grid_nav" style="margin: 0;">
            <li class="l"><a4j:commandLink><button value="submit" class="left" onclick="Richfaces.showModalPanel('confirmDelete'); return false;"><span class="cancel"><h:outputText value="#{messages.button_delete}" /></span></button></a4j:commandLink></li>
            <li class="l"><h:commandLink action="#{editorBean['batchEdit']}"><button value="submit" class="left"><span class="edit"><h:outputText value="#{messages.button_batchEdit}" /></span></button></h:commandLink></li>
            <li class="l">
              <table border="0" cellspacing="0" cellpadding="4" id="grid_nav_search_box">
                <tr>
                  <td><h:outputText value="#{messages.button_search}" /></td>
                  <td>
                    <h:inputText id="filterTable" value="#{filterValue}" class="text" size="25" />
                  </td>
                </tr>
              </table>
            </li>
            <li class="l"><a4j:commandLink reRender="dataTable,recordCounts,bottomScroller"><button value="submit" class="left"><span class="search"><h:outputText value="#{messages.button_search}" /></span></button></a4j:commandLink></li>
            <li class="l text"><a href="#" class="ls_tab_edit_columns" onclick="Richfaces.showModalPanel('editColumns');"><h:outputText value="#{messages.button_editColumns}" /></a></li>
            <li class="r text">
              <h:outputFormat id="recordCounts" value="#{messages.recordCounts}">
                <f:param value="#{(recordCount gt 0) ? (firstRecord + 1) : 0}"/>
                <f:param value="#{((firstRecord + rows) lt recordCount) ? (firstRecord + rows) : recordCount}"/>
                <f:param value="#{recordCount}"/>
              </h:outputFormat>
            </li>
          </ul>

          <rich:messages globalOnly="true" errorClass="error" fatalClass="error" warnClass="warning" infoClass="info" styleClass="msg" />

          <div class="spacer"></div>

          <div class="datagrid">

<!--
TODO: the top scroller doesn't work right with filtering
            <rich:datascroller id="topScroller" for="dataTable" reRender="recordCounts,dataTable,bottomScroller" page="#{page}" />
-->

            <rich:dataTable id="dataTable" value="#{items}" var="item" rowKeyVar="index" styleClass="datagrid"
              rows="#{rows}" rowClasses="tableOdd,tableEven" width="100%">
              <rich:column>
                <f:facet name="header">
                  <h:outputText value=" " />
                </f:facet>
                <h:selectBooleanCheckbox value="#{item.selected}" />
              </rich:column>
              <ui:insert name="columns" />
              <rich:column>
                <f:facet name="header">
                  <h:outputText value=" " />
                </f:facet>
                <h:commandLink action="#{editorBean['edit']}" value="#{messages.adminTable_edit}">
                  <f:param name="editID" value="#{item.id}" />
                </h:commandLink>
              </rich:column>
            </rich:dataTable>

            <rich:datascroller id="bottomScroller" for="dataTable" reRender="recordCounts,dataTable" page="#{page}" />

          </div>
    
        </div>
      </div>

    </a4j:form>

    <ui:include src="confirmDelete.xhtml">
      <ui:param name="deleteBean" value="#{editorBean}" />
      <ui:param name="reRender" value="dataTable" />
    </ui:include>

    <ui:include src="editColumns.xhtml">
      <ui:param name="saveBean" value="#{editorBean}" />
      <ui:param name="reRender" value="dataTable" />
    </ui:include>

  </ui:composition>

</html>