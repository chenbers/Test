<ui:composition template="/template/template.xhtml"
   xmlns="http://www.w3.org/1999/xhtml" 
	xmlns:ui="http://java.sun.com/jsf/facelets" 
	xmlns:h="http://java.sun.com/jsf/html"
  	xmlns:f="http://java.sun.com/jsf/core" 
  	xmlns:a4j="http://richfaces.org/a4j" 
  	xmlns:rich="http://richfaces.org/rich">

<ui:define name="scripts">
<style>
.selectedGroup {
	background:#cccccc;
}
.error {
	background-color:#cc0000 !important;
}
</style>
<script type="text/javascript">
function setGroupSelection(groupId){

	document.getElementById("configurationSelectionForm:selectedGroup").value = groupId;
}
/**
 * Set highlight on the elements of the given ids. It basically sets the classname of the elements
 * to 'highlight'. This require at least a CSS style class '.highlight'.
 * @param ids The ids of the elements to be highlighted, comma separated.
 */
function setHighlight(row, element, message) {
	
	var elementBaseName = "configuratorForm:settingList:"+row+":";
	var messageElement = document.getElementById(elementBaseName+message);
	
    var tableElement = document.getElementById(elementBaseName+element);
    if (tableElement) {
        
    	tableElement.style.backgroundColor = (document.getElementById(elementBaseName+message).textContent == "")?"white":"pink";
    }
}

</script>
</ui:define>
  	
<a4j:keepAlive beanName="configuratorBean" ajaxOnly="true"/>

<ui:param name="panelTitle" value="Configurator"/>
<ui:param name="groupSelected" value="MAIN"/>
<ui:define name="util_leftPanel">
<a4j:form id="vehicleSelectionForm">
<rich:panel id="vehicle-centric">
	<h:outputText value="Vehicle-centric" styleClass="label"></h:outputText>
<h:panelGrid columns="2" style="width: 150px">
	<h:outputText value="Vehicle id:" styleClass="label"></h:outputText>
	<h:inputText value="#{configuratorBean.selectedVehicleID}">
	</h:inputText>
</h:panelGrid>
	<h:commandButton id="getVehicle" value="Get Vehicle Settings" action="#{configuratorBean.displayVehicle}"/>

</rich:panel>
</a4j:form>
<a4j:form id="configurationSelectionForm">
<rich:panel id="configuration-centric">
	<h:outputText value="Configuration-centric" styleClass="label"></h:outputText>
<h:panelGrid columns="2" style="width: 150px">
	<h:outputText value="Product:" styleClass="label"></h:outputText>
	<h:selectOneMenu value="#{configurationSelectionBean.productTypeCode}">
	<f:selectItems value="#{productSelectItems.selectItems}"/>
	</h:selectOneMenu>
</h:panelGrid>
   <rich:panel id="configuratorGroupRegion" style="border:none">
   <h:inputHidden id="selectedGroup" value="#{configurationSelectionBean.selectedGroupId}"/>
 	<rich:tree style="width:150px" switchType="client" 
                value="#{treeNavigationBean.navigationTree}" var="item" ajaxKeys="#{null}" nodeFace="#{item.type}">
         	<rich:treeNode type="fleet" iconLeaf="/images/ico_truck.png"
							icon="/images/ico_truck.png" selectedClass="selectedGroup">
					<h:outputLink onclick="setGroupSelection(#{item.attributes['groupid']});return false">
					<h:outputText value="#{item.title}" />
					</h:outputLink>
			</rich:treeNode>
			<rich:treeNode type="group"
				iconLeaf="/images/ico_trucks.png"
				icon="/images/ico_trucks.png" selectedClass="selectedGroup">
					<h:outputLink onclick="setGroupSelection(#{item.attributes['groupid']});return false">
					<h:outputText value="#{item.title}" />
					</h:outputLink>
			</rich:treeNode>
			<rich:treeNode type="team" iconLeaf="/images/ico_team.png"
				icon="/images/ico_team.png" selectedClass="selectedGroup">
					<h:outputLink onclick="setGroupSelection(#{item.attributes['groupid']});return false">
					<h:outputText value="#{item.title}" />
					</h:outputLink>
			</rich:treeNode>
		</rich:tree>
    </rich:panel>
		<h:commandButton id="getConfigurations" value="Get Configurations" action="go_configurator"/>
    </rich:panel>
</a4j:form>
</ui:define>
<ui:define name="util_content">

<div>
            <h:form id="configuratorForm">

    	    <rich:panel id="configuratorSettings" >
    	    <rich:panel style="border: none" rendered="#{configuratorBean.hasConfigurations}">
 			<h:outputText value="Show only differences:" styleClass="label"></h:outputText>
			<h:selectBooleanCheckbox value="#{configuratorBean.differentOnly}">
			<a4j:support event="onchange" reRender="configuratorSettings"/>
			</h:selectBooleanCheckbox>
    	    </rich:panel>   	    
            <rich:dataTable rowKeyVar="rkv" rendered="#{configuratorBean.hasConfigurations}"
                id="settingList" rows="0" width="100%" 
                value="#{configuratorBean.configurationSet.configurations}" var="configuration">
            	<rich:column id="configurationIndex">
                    <f:facet name="header">
                    </f:facet>
                     <h:outputText value="#{configuration.configurationID}" />
                </rich:column>
                <rich:column id="actions">
                    <f:facet name="header">
                    	<h:outputText styleClass="headerText" value="Actions" />
                    </f:facet>
             		<a4j:commandLink value="Save" action="#{configuratorBean.updateConfiguration}" 
             					reRender="configuratorSettings" ajaxSingle="true">
             			 <a4j:actionparam name="selectedConfiguration" value="#{configuration.configurationID}" assignTo="#{configuratorBean.selectedConfigurationID}"/>
             		</a4j:commandLink>
                    
                </rich:column>
                 <rich:column id="count">
                    <f:facet name="header">
                    	<h:outputText styleClass="headerText" value="# of Vehicles" />
                    </f:facet>
                    <h:outputText value="#{configuration.count}" />
                </rich:column>
			     <rich:column id="reason">
                   <f:facet name="header">
                    	<h:outputText styleClass="headerText" value="Reason" />
                    </f:facet>
				 	<rich:inplaceInput id="reasonField"  value="#{configuration.reason}" 
				 				 showControls="true" selectOnEdit="true">
				 				 <a4j:support event="onviewactivated" ajaxSingle="true"/>
					</rich:inplaceInput>
			 		<rich:message id="messageTable" for="reasonField" style="color:red" rendered="true" value="ok"/>
				</rich:column>
 				<rich:columns value="#{configuratorBean.displaySettingsDefinitions}" var="setting" rendered="#{not configuratorBean.differentOnly}"
 								index="index" id="id#{index}">
					<f:facet name="header">
				 		<h:outputText  value="#{setting.settingID}-#{setting.name}"></h:outputText>
				 	</f:facet>
				 	<h:panelGrid columns="3" title="#{setting.description}.  #{setting.varType.name} - min:#{setting.min},max:#{setting.max}" rendered="#{not setting.hasChoices}">
					 	<rich:inplaceInput id="input-#{setting.settingIDKey}"  value="#{configuration.settingValues[setting.settingID]}" 
					 				 showControls="true" selectOnEdit="true" 
					 				 style="background-color:#{deviceSettingDefinitions.deviceSettingDefinitionsMap[setting.settingIDKey].errorColor[configuration.settingValues[setting.settingID]]}"
					 				  valueChangeListener="#{configuratorBean.markSetting}"
					 				 validator="#{deviceSettingDefinitions.deviceSettingDefinitionsMap[setting.settingIDKey].validate}" >
					 				  <a4j:support event="onviewactivated" ajaxSingle="true" oncomplete="setHighlight(#{rkv},'input-#{setting.settingIDKey}','message-#{setting.settingIDKey}');"/>
						</rich:inplaceInput>
					 		<h:outputText  value="#{setting.unit.name}"></h:outputText>
 					 		<rich:message id="message-#{setting.settingIDKey}" for="input-#{setting.settingIDKey}" style="color:red" rendered="true" value="ok"/>
					</h:panelGrid>					
				 	<h:panelGrid columns="2" title="#{setting.description}.  #{setting.varType.name} - min:#{setting.min},max:#{setting.max}" rendered="#{setting.hasChoices}">
					 	<rich:inplaceSelect id="select-#{setting.settingID}" name="#{setting.settingID}-#{index}" value="#{configuration.settingValues[setting.settingID]}" defaultLabel="#{configuration.settingValues[setting.settingID]}"
					 				 		 valueChangeListener="#{configuratorBean.markSetting}">
	
							<f:selectItems value="#{choiceSelectItems.selectItems[setting.settingID]}" />
							 <a4j:support event="onviewactivated" ajaxSingle="true"/>
						</rich:inplaceSelect>
					 		<h:outputText  value="#{setting.unit.name}"></h:outputText>
					</h:panelGrid>					
				 				 
				</rich:columns>
 				<rich:columns value="#{configuratorBean.differentDeviceSettings}" var="setting" rendered="#{configuratorBean.differentOnly}"
 								index="index" id="diff-#{setting.name}" >
					<f:facet name="header">
				 		<h:outputText  value="#{setting.settingID}-#{setting.name}"></h:outputText>
				 	</f:facet>
				 	<h:panelGrid columns="3" title="#{setting.description}.  #{setting.varType.name} - min:#{setting.min},max:#{setting.max}" rendered="#{not setting.hasChoices}">
					 	<rich:inplaceInput id="diff-#{setting.settingIDKey}"  value="#{configuration.settingValues[setting.settingID]}" 
					 				 style="background-color:#{deviceSettingDefinitions.deviceSettingDefinitionsMap[setting.settingIDKey].errorColor[configuration.settingValues[setting.settingID]]}"
									 showControls="true" selectOnEdit="true"
					 				 valueChangeListener="#{configuratorBean.markSetting}"
					 				 validator="#{deviceSettingDefinitions.deviceSettingDefinitionsMap[setting.settingIDKey].validate}" >
					 				  <a4j:support event="onviewactivated" ajaxSingle="true"/>
						</rich:inplaceInput>
					 		<h:outputText  value="#{setting.unit.name}"></h:outputText>
 					 		<rich:message id="diffmessage-#{setting.settingIDKey}" for="diff-#{setting.settingIDKey}" style="color:red" rendered="true" value="ok"/>
					</h:panelGrid>					
				 	<h:panelGrid columns="2" title="#{setting.description}.  #{setting.varType.name} - min:#{setting.min},max:#{setting.max}" rendered="#{setting.hasChoices}">
					 	<rich:inplaceSelect id="diffselect-#{setting.settingID}" name="#{setting.settingID}-#{index}" value="#{configuration.settingValues[setting.settingID]}" defaultLabel="#{configuration.settingValues[setting.settingID]}"
					 				 		 valueChangeListener="#{configuratorBean.markSetting}">
	
							<f:selectItems value="#{choiceSelectItems.selectItems[setting.settingID]}" />
							 <a4j:support event="onviewactivated" ajaxSingle="true"/>
						</rich:inplaceSelect>
					 		<h:outputText  value="#{setting.unit.name}"></h:outputText>
					</h:panelGrid>					
				</rich:columns>
                
             </rich:dataTable>
 	              
</rich:panel>
</h:form>
<a4j:form>
             <rich:panel id="vehicleEditSettingsRegion" rendered="#{configuratorBean.selectedVehicleID ne null}">
           	<rich:dataGrid id="selectedSettings" value="#{configuratorBean.displaySettingsDefinitions}" var="setting" 
           					columns="6" elements="120" width="600px" rendered="#{configuratorBean.selectedVehicleID ne null}">
                <f:facet name="header">
                    <h:outputText value="Setting"></h:outputText>
                </f:facet>
                <h:panelGrid columns="2">
                    <h:outputText value="Category:" styleClass="label"></h:outputText>
                    <h:outputText value="#{setting.category}"></h:outputText>
                    <h:outputText value="Name:" styleClass="label"></h:outputText>
                    <h:outputText value="#{setting.name}"></h:outputText>
                     <h:outputText value="ID:" styleClass="label"></h:outputText>
                   <h:outputText value="#{setting.settingID}"></h:outputText>
                     <h:outputText value="Actual Value:" styleClass="label"></h:outputText>
                    <h:outputText value="#{configuratorBean.selectedVehicleSetting.actual[setting.settingID]}" />
                     <h:outputText value="Desired Value:" styleClass="label"></h:outputText>
                    <h:outputText value="#{configuratorBean.selectedVehicleSetting.desired[setting.settingID]}" />
                     <h:outputText value="Type:" styleClass="label"></h:outputText>
                   <h:outputText value="#{setting.varTypeString}"></h:outputText>
                      <h:outputText value="Unit:" styleClass="label"></h:outputText>
                   <h:outputText value="#{setting.unit}"></h:outputText>
                     <h:outputText value="Choices:" styleClass="label"></h:outputText>
                   <h:outputText value="#{setting.choices}"></h:outputText>
                     <h:outputText value="Min:" styleClass="label"></h:outputText>
                   <h:outputText value="#{setting.min}"></h:outputText>
                     <h:outputText value="Max:" styleClass="label"></h:outputText>
                   <h:outputText value="#{setting.max}"></h:outputText>
                </h:panelGrid>
              <f:facet name="footer">
                <rich:datascroller></rich:datascroller>
            </f:facet>
        </rich:dataGrid>
        </rich:panel>
            </a4j:form>
</div><!-- end page -->
</ui:define>
</ui:composition>
